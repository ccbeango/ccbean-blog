<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#af4c4c","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="凹凸豆的博客">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="凹凸豆的博客">
<meta property="og:description" content="个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ccbeango">
<meta property="article:tag" content="Javascript">
<meta property="article:tag" content="TypeScript">
<meta property="article:tag" content="Nodejs">
<meta property="article:tag" content="Node">
<meta property="article:tag" content="Mysql">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>凹凸豆的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">凹凸豆的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">那天，黄昏，开始飘起来白雪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">21</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">49</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/ccbeango" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/JavaScript/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/JavaScript/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">异步编程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-11 19:44:10" itemprop="dateCreated datePublished" datetime="2018-07-11T19:44:10+08:00">2018-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h1><h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><p>JavaScript中的函数基本上可以为所欲为，无论是调用它，或者作为参数，或者作为返回值均可，拥有者至高无上的能力。函数作为<code>JavaScript</code>异步编程的基础，先了解<code>JavaScript</code>现如今的回调函数和深层嵌套是很有必要的。</p>
<h3 id="1-高阶函数"><a href="#1-高阶函数" class="headerlink" title="1.高阶函数"></a>1.高阶函数</h3><p><strong>高阶函数可以把函数作为参数，或是将函数作为返回值的函数。</strong>如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>高阶函数除了通常意义的函数调用返回外，还形成了一种后续传递风格的结果接收方式，而非单一的返回值形式。后续传递风格的程序编写将函数的业务重点从返回值转移到了回调函数中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">x,bar</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bar(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面函数中，对于相同的<code>foo()</code>函数，传入的<code>bar</code>不同，则可以得到不同的结果。一个经典的例子是数组的<code>sort()</code>方法，可以接受一个方法作为参数参与运算排序：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> points = [<span class="number">40</span>, <span class="number">100</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">25</span>, <span class="number">10</span>]; points.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b; </span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// [ 1, 5, 10, 25, 40, 100 ]</span></span><br></pre></td></tr></table></figure>

<p>通过改动<code>sort()</code>方法的参数，可以决定不同的排序方式，从这里可以看出高阶函数的灵活性来。</p>
<p>​    结合<code>Node</code>提供的最基本的事件模块可以看出，事件的处理方式正式基于高阶函数的特性来完成的。在自定义事件实例中，通过为相同事件注册不同的回调函数，可以很灵活地处理业务逻辑。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line">emitter.on(<span class="string">'event_foo'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>事件可以很方便地进行复杂业务逻辑的解耦，它其实受益于高阶函数。</p>
<h3 id="2-偏函数用法"><a href="#2-偏函数用法" class="headerlink" title="2.偏函数用法"></a>2.偏函数用法</h3><p> <strong>偏函数用法是指创建一个调用另外一个部分—参数或变量已经预置的函数—的函数的用法。</strong>WTF</p>
<p>举例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toString = <span class="built_in">Object</span>.prototype.toSting;</span><br><span class="line"><span class="keyword">var</span> isString = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(obj) == <span class="string">'[object Stirng]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isFunction = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(obj) == <span class="string">'[object Function]'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>JavaScript</code>进行类型判断时，通常会定义类似的代码，但这种方式需要重复去定义一些相似的代码，如果有更多的<code>isXXX()</code>，就会出现更多的荣域代码。为解决此问题，我们引入一个新的函数，这个函数可以像工厂一样批量创建一些类似的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isType = <span class="function"><span class="keyword">function</span> (<span class="params">type</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> toString.call(obj) == <span class="string">'[object '</span> + type + <span class="string">']'</span>; </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> isString = isType(<span class="string">'String'</span>);</span><br><span class="line"><span class="keyword">var</span> isFunction = isType(<span class="string">'Function'</span>);</span><br></pre></td></tr></table></figure>

<p>这样就会简单很多，这种通过指定部分参数来产生一个新的定值函数的形式就是偏函数。</p>
<h2 id="异步编程-1"><a href="#异步编程-1" class="headerlink" title="异步编程"></a>异步编程</h2><p>目前，异步编程的主要解决方案有如下三种：</p>
<ul>
<li>事件发布/订阅模式</li>
<li>Promise/Deferred模式</li>
<li>流程控制库</li>
</ul>
<h3 id="1-事件发布-订阅模式"><a href="#1-事件发布-订阅模式" class="headerlink" title="1.事件发布/订阅模式"></a>1.事件发布/订阅模式</h3><p>事件监听器是一种广泛应用于异步编程的模式，是回调函数的事件化，又称发布/订阅模式。</p>
<p><code>Node</code>自身提供的<code>events</code>模块就是此模式的一个简单实现。<code>Node</code>中部分模块都继承自它。事件发布/订阅模式操作很简单，示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅</span></span><br><span class="line">emitter.on(<span class="string">"event1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">emitter.emit(<span class="string">"event1"</span>, <span class="string">"I am message!"</span>);</span><br></pre></td></tr></table></figure>

<p>​    事件发布/订阅模式可以实现一个事件与多个回调函数关联，这些函数又叫事件侦听器。通过<code>emit()</code>发布时间后，消息会立即传递给当前事件的所有侦听器执行。这种模式本身并无同步和异步的问题，但在<code>Node</code>中，<code>emit()</code>调用多半是伴随事件循环而异步触发的，所以事件发布/订阅广泛用于异步编程。</p>
<p>​    在一些典型的场景中，可以 过事 发布/订阅模式进行组件封装，将不变的部分封装在组件内部，将容易变化、需要自定义的部分通过事件暴露给外部处理，这是一种典型的逻辑分离方式。从另一个角度看，事件侦听器模式也是一种钩子（hook）机制，利用钩子导出内部数据或状态给外部调用者。</p>
<h4 id="利用异步解决队列雪崩问题"><a href="#利用异步解决队列雪崩问题" class="headerlink" title="利用异步解决队列雪崩问题"></a>利用异步解决队列雪崩问题</h4><p>​        事件订阅/发布模式中，有<code>once()</code>方法，通过它添加的侦听器只执行一次，在执行之后就会将它与事件的关联移除。利用这个特性可以帮助我们过滤一些重复性的事件响应。</p>
<p>​    所谓雪崩问题，就是在高访问量、大并发的情况下缓存失效的情景，此时大量的请求同时涌入数据库中，数据库无法同时承受如此大的查询请求，进而影响到网站的整体相应速度。</p>
<p>​    以下是一个数据库查询语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> select = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    db.select(<span class="string">'SQL'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">        callback(results);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    如果站点刚好启动，这时缓存数据是不存在的，而如果访问量巨大，同一句SQL会被发送到数据库中反复查询，会影响服务器整体性能。一种改进方案是添加一个状态锁，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> status = <span class="string">'ready'</span>;</span><br><span class="line"><span class="keyword">const</span> select = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (status === <span class="string">'ready'</span>) &#123;</span><br><span class="line">        status = <span class="string">'pending'</span>;</span><br><span class="line">        db.select(<span class="string">'SQL'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">        	status = <span class="string">'ready'</span>;</span><br><span class="line">            callback(results);</span><br><span class="line">    	&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这种情况下只有第一次是有效的，其余的都无数据返回。这时可以引入事件队列，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"><span class="keyword">let</span> status = <span class="string">'ready'</span>;</span><br><span class="line"><span class="keyword">const</span> select = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    proxy.once(<span class="string">'selected'</span>, callback);</span><br><span class="line">    <span class="keyword">if</span>(status === <span class="string">'ready'</span>) &#123;</span><br><span class="line">        status = <span class="string">'pending'</span>;</span><br><span class="line">        db.select(<span class="string">'SQL'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">resules</span>) </span>&#123;</span><br><span class="line">            proxy.emit(<span class="string">'selected'</span>, results);</span><br><span class="line">            status = <span class="string">'ready'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>利用<code>once()</code>方法，将所有的请求回调都压入事件队列中，利用其执行一次就会将监视器移除的特点，保证每一个回调只会执行一次。SQL在进行查询时，新到来的相同调用只需在队列中等待数据就绪即可，一旦查询结束，得到的结果可以被这些调用共同使用。</p>
<h4 id="多异步指尖的协作方案"><a href="#多异步指尖的协作方案" class="headerlink" title="多异步指尖的协作方案"></a>多异步指尖的协作方案</h4><p>以渲染页面所需要的模板读取、数据读取和本地化资源读取为例简要介绍，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> results = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> done = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    result[key] = value;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">if</span>(count === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="comment">// 渲染页面</span></span><br><span class="line">        render(results);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fs.readFile(template_path, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, template</span>) </span>&#123;</span><br><span class="line">    done(<span class="string">'template'</span>, template);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.query(sql, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">	done(<span class="string">"data"</span>, data); </span><br><span class="line">&#125;);</span><br><span class="line">l10n.get(<span class="function"><span class="keyword">function</span> (<span class="params">err, resources</span>) </span>&#123; 		    </span><br><span class="line">    done(<span class="string">"resources"</span>, resources);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>​    由于多个异步场景中回调函数的执行并不能保证顺序，且回调函数之间互相没有任何交集，所以需要借助一个第三方函数和第三方变量来处理异步协作的结果。通常把这个用于检测次数的变量叫做<strong>哨兵变量</strong>。利用偏函数来处理哨兵变量和第三方函数的关系，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> after = <span class="function"><span class="keyword">function</span> (<span class="params">times, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> count, results = &#123;&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        results[key] = value;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">if</span>(count === times) &#123;</span><br><span class="line">            callback(results);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> done = after(times, render);</span><br></pre></td></tr></table></figure>

<p>​    上述方法实现多对一的目标。如果业务继续增长，我们依然可以继续利用发布/订阅方式来完成多对多的方案，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.Emitter(); </span><br><span class="line"><span class="keyword">var</span> done = after(times, render);</span><br><span class="line"></span><br><span class="line">emitter.on(<span class="string">"done"</span>, done); </span><br><span class="line">emitter.on(<span class="string">"done"</span>, other);</span><br><span class="line"></span><br><span class="line">fs.readFile(template_path, <span class="string">"utf8"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, template</span>) </span>&#123;</span><br><span class="line">    emitter.emit(<span class="string">"done"</span>, <span class="string">"template"</span>, template);</span><br><span class="line">&#125;);</span><br><span class="line">db.query(sql, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    emitter.emit(<span class="string">"done"</span>, <span class="string">"data"</span>, data);</span><br><span class="line">&#125;);</span><br><span class="line">l10n.get(<span class="function"><span class="keyword">function</span> (<span class="params">err, resources</span>) </span>&#123;</span><br><span class="line">    emitter.emit(<span class="string">"done"</span>, <span class="string">"resources"</span>, resources);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这种方案结合了前者用简单的偏函数完成了多对一的收敛和时间订阅/发布模式中一对多的发散。</p>
<h3 id="2-Promise-Deferred模式"><a href="#2-Promise-Deferred模式" class="headerlink" title="2.Promise/Deferred模式"></a>2.Promise/Deferred模式</h3><p><code>Promise/Deferred</code>是典型的异步模式，它的使用使得回调、嵌套所产生的深层嵌套问题在一定程度上得到了缓解。这里着重介绍<code>Promise/A</code>来以点带面介绍<code>Promise/Deferred</code>模式。</p>
<h4 id="Promise-Deferred基本介绍"><a href="#Promise-Deferred基本介绍" class="headerlink" title="Promise/Deferred基本介绍"></a>Promise/Deferred基本介绍</h4><p><code>Promise/Deferred</code>模式包含两部分，即<code>Promise</code>和<code>Deferred</code>，两者的差别暂且不说，先来看前者。</p>
<p><code>Promise/A</code>提议对单个异步操作做出了这样的抽象定义：</p>
<ul>
<li><code>Promise</code>操作只会处在3中状态的一种：未完成态<code>pending</code>、完成态<code>fulfilled</code>和失败态<code>rejected</code>。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。</li>
<li><code>Promise</code>的状态只会出现从未完成态向完成态或失败态转化，不能逆反。完成态和失败态不能互相转化。</li>
<li><code>Promise</code>的状态一旦转化，将不能被更改。</li>
</ul>
<p>一个<code>Promise</code>只要具备<code>then()</code>方法即可。对于<code>then()</code>方法有以下要求：</p>
<ul>
<li><p>接受完成态、错误态的回调方法。在操作完成或出现错误时，将会调用对应方法。</p>
</li>
<li><p>可选地支持<code>progress</code>事件回调作为第三个方法。</p>
</li>
<li><p><code>then()</code>方法只接受<code>function</code>对象，其余对象将被忽略。</p>
</li>
<li><p><code>then()</code>方法继续返回<code>Promise</code>对象，以实现链式调用。</p>
<p>方法定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">then(fulfilledHandler, errorHandler, progressHandler)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>下面通过继承<code>Node</code>的<code>events</code>模块来完成一个简单的实现，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">Promise</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    EventEmitter.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">util.inherrits(<span class="built_in">Promise</span>, EventEmitter);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">fulfilledHandler, errorHandler, progressHandler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> fulfilledHandler === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="comment">// 利用once()方法，保证成功回调只执行一次</span></span><br><span class="line">        <span class="keyword">this</span>.once(<span class="string">'success'</span>, fulfilledHandler);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> errorHandler === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="comment">// 利用once()方法，保证异常回调只执行一次</span></span><br><span class="line">        <span class="keyword">this</span>.once(<span class="string">'error'</span>, errorHandler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> progressHanlder === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.on(<span class="string">'progress'</span>, progressHandler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    这里可以看到<code>the()</code>方法所做的事情是将回调函数存放起来。为了完成整个流程，还需要触发执行这些回调函数的地方，实现这些功能的对象通常被称为<code>Deferred</code>，即延迟对象。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Deferred = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'unfulfilled'</span>;</span><br><span class="line">    <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Deferred.prototype.resolve = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'fulfilled'</span>;</span><br><span class="line">    <span class="keyword">this</span>.promise.emit(<span class="string">'success'</span>, obj);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Deferred.prototype.reject = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'failed'</span>;</span><br><span class="line">    <span class="keyword">this</span>.promise.emit(<span class="string">'error'</span>, err);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Deferred.prototype.progress = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.promise.emit(<span class="string">'progrress'</span>, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B01.png" alt=""></p>
<p>利用Promise/A提议模式，可以对一个典型对象进行封装，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'BODY:'</span> + chunk);</span><br><span class="line">&#125;);</span><br><span class="line">res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Done</span></span><br><span class="line">&#125;);</span><br><span class="line">res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Error</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上述代码可以转换为如下的简略格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">res.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Done</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Error</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'BODY:'</span> + chunk);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>要实现这样的API，只需要简单地改造一下即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promisify = <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> deferred = <span class="keyword">new</span> Deferred();</span><br><span class="line">    <span class="keyword">const</span> result = <span class="string">''</span>;</span><br><span class="line">    res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        result += chunk;</span><br><span class="line">        deferred.progress(chunk);</span><br><span class="line">    &#125;);</span><br><span class="line">   	res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">		deferred.resolve(result);</span><br><span class="line">   	&#125;);</span><br><span class="line">	res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		deferred.reject(err); </span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里返回<code>deferred.promise</code>的目的是为了不让外部程序调用<code>resolve()</code>和<code>reject()</code>方法，更改内部状态的行为交由定义者处理。下面是定义好<code>Promise</code>后的调用示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">promisify(res).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="comment">// Done</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// Error</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// progress</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'BODY: '</span> + chunk);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里回到<code>Promise</code>和<code>Deferred</code>的差别上。从上面的代码可以看出，<code>Deferred</code>主要用于内部，用于维护异步模型的状态；<code>Promise</code>则作用于外部，通过<code>then()</code>方法暴露给外部以添加自定义逻辑。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B02.png" alt=""></p>
<p>​        与事件发布/订阅模式相比，<code>Promise/Deferred</code>模式的API接口和抽象模型都十分简洁。从图中可以看出，它将业务中不可变的部分封装在<code>Deferred</code>中，将可变的部分交给了<code>Promise</code>。此时，对于不同的场景，都需要去封装和改造其<code>Deferred</code>部分，然后才能得到简洁的接口。如果场景不常用，封装花费的时间与 带来的简洁相比并不一定划算。</p>
<p>​         <code>Promise</code>是高级接口，事件是低级接口。低级接口可以构成更多更复杂的场景，高级接口一旦定义，不太容易变化，不再有低级接口的灵活性，但对于解决典型问题非常有效。</p>
<h4 id="Promise中的多异步协作"><a href="#Promise中的多异步协作" class="headerlink" title="Promise中的多异步协作"></a>Promise中的多异步协作</h4><p>当我们需要处理多个异步调用时，原理类似于此：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Deferred.prototype.all = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> count = promises.length;</span><br><span class="line">    <span class="keyword">let</span> results = [];</span><br><span class="line">    promises.forEach(<span class="function">(<span class="params">promise, i</span>) =&gt;</span> &#123;</span><br><span class="line">        promise.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">           	count--;</span><br><span class="line">            results[i] = data;</span><br><span class="line">            <span class="keyword">if</span>(count === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.resolve(results);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, error =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.reject(err)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于多次文件读取场景，下面代码使用<code>all()</code>方法将两个单独的<code>Promise</code>组合成一个新的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise1 = readFile(<span class="string">"foo.txt"</span>, <span class="string">"utf-8"</span>);</span><br><span class="line"><span class="keyword">var</span> promise2 = readFile(<span class="string">"bar.txt"</span>, <span class="string">"utf-8"</span>);</span><br><span class="line"><span class="keyword">var</span> deferred = <span class="keyword">new</span> Deferred();</span><br><span class="line">deferred.all([promise1, promise2]).then(<span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// TODO </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里通过<code>all()</code>方法抽象多个异步操作。只有所有异步操作成功，这个异步操作才算成功，一旦其中一个异步操作失败，整个异步操作就失败。</p>
<h4 id="Promise队列操作"><a href="#Promise队列操作" class="headerlink" title="Promise队列操作"></a>Promise队列操作</h4><p>在<code>Node</code>中，异步是不可或缺的，有时在使用时，需要多个异步按顺序依次进行，以前在实现过程中，回调地狱就这样出现了。</p>
<p>代码大致如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">obj.api1(<span class="function"><span class="keyword">function</span> (<span class="params">value1</span>) </span>&#123;</span><br><span class="line">    obj.api2(value1, <span class="function"><span class="keyword">function</span> (<span class="params">value2</span>) </span>&#123;</span><br><span class="line">        obj.api3(value2, <span class="function"><span class="keyword">function</span> (<span class="params">value3</span>) </span>&#123;</span><br><span class="line">            obj.api4(value3, <span class="function"><span class="keyword">function</span> (<span class="params">value4</span>) </span>&#123;</span><br><span class="line">                callback(value4);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>由于每个按步骤执行，所以不得不进行嵌套执行。多个嵌套会让代码变得很丑。</p>
<p>利用Promise进行序列化执行，理想的编程体验应该是<strong>前一个的调用结果作为下一个调用的开始</strong>，即链式调用。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">promise()</span><br><span class="line">	.then(obj.api1)</span><br><span class="line">	.then(obj.api2)</span><br><span class="line">	.then(obj.api3)</span><br><span class="line">	.then(obj.api4)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">value4</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// do something with value4</span></span><br><span class="line">	&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// handle any error from step1</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.done();</span><br></pre></td></tr></table></figure>

<p>尝试改变一下代码以实现链式调用，具体如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">Promise</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 队列用于存储待执行的回调函数</span></span><br><span class="line">    <span class="keyword">this</span>.queue = [];</span><br><span class="line">    <span class="keyword">this</span>.isPromise = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">fulfilledHandler, errorHandler, progressHandler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> handler = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> fulfilledHandler === <span class="string">'function'</span>) &#123;</span><br><span class="line">        handler.fulfilled = fulfilledHandler;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> errorHandler === <span class="string">'function'</span>) &#123;</span><br><span class="line">        handler.error = errorHandler;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.queue.push(handler);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Deferred = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 完成态</span></span><br><span class="line">Deferred.prototype.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">this</span>.promise;</span><br><span class="line">    <span class="keyword">let</span> handler;</span><br><span class="line">    <span class="keyword">while</span>((handler = promise.queue.shift())) &#123;</span><br><span class="line">        <span class="keyword">if</span> (handler &amp;&amp; handler.fulfilled) &#123;</span><br><span class="line">            <span class="keyword">const</span> ret = handler.fulfilled(obj);</span><br><span class="line">            <span class="keyword">if</span>(ret &amp;&amp; ret.isPromise) &#123;</span><br><span class="line">                ret.queue = promise.queue;</span><br><span class="line">                <span class="keyword">this</span>.promise = ret;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 失败态</span></span><br><span class="line">Deferred.prototype.reject = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">this</span>.promise;</span><br><span class="line">    <span class="keyword">let</span> handler;</span><br><span class="line">    <span class="keyword">while</span>((handler = promise.queue.shift())) &#123;</span><br><span class="line">        <span class="keyword">if</span> (handler &amp;&amp; handler.error) &#123;</span><br><span class="line">            <span class="keyword">const</span> ret = handler.error(err);</span><br><span class="line">            <span class="keyword">if</span>(ret &amp;&amp; ret.isPromise) &#123;</span><br><span class="line">                ret.queue = promise.queue;</span><br><span class="line">                <span class="keyword">this</span>.promise = ret;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成回调函数</span></span><br><span class="line">Deferred.prototype.callback =<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">err, file</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.reject(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.resolve(file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面以两次文件读取作为例子，验证设计的可行性。假设读取第二个文件是依赖于第一个文件中的内容，相关代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readFile1 = <span class="function"><span class="keyword">function</span> (<span class="params">file, encoding</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deferred = <span class="keyword">new</span> Deferred();</span><br><span class="line">    fs.readFile(file, encoding, deferred.callback()); </span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> readFile2 = <span class="function"><span class="keyword">function</span> (<span class="params">file, encoding</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deferred = <span class="keyword">new</span> Deferred();</span><br><span class="line">    fs.readFile(file, encoding, deferred.callback()); </span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">readFile1(<span class="string">'file1.txt'</span>, <span class="string">'utf8'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">file1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> readFile2(file1.trim(), <span class="string">'utf8'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">file2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(file2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行这段代码，将会得到输出结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node sequence.js</span></span><br><span class="line">I am file2.</span><br></pre></td></tr></table></figure>

<p>要让Promise支持链式操作，主要通过以下两个步骤：</p>
<ol>
<li>将所有的回调都存到队列中。</li>
<li>Promise完成时，逐个执行回调，一旦检测到返回了新的<code>Promise</code>对象，停止执行，然后将当前<code>Deferred</code>对象的<code>promise</code>引用改为新的<code>Promise</code>对象，并将队列中余下的回调转交给它。</li>
</ol>
<p><strong>将API Promise化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// smooth(fs.readFile);</span></span><br><span class="line"><span class="keyword">var</span> smooth = <span class="function"><span class="keyword">function</span> (<span class="params">method</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> deferred = <span class="keyword">new</span> Deferred();</span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>); </span><br><span class="line">        args.push(deferred.callback());</span><br><span class="line">        method.apply(<span class="literal">null</span>, args);</span><br><span class="line">        <span class="keyword">return</span> deferred.promise;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>于是之前的调用可以简化为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readFile = smooth(fs.readFile);</span><br><span class="line">readFile1(<span class="string">'file1.txt'</span>, <span class="string">'utf8'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">file1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> readFile2(file1.trim(), <span class="string">'utf8'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">file2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// file2 =&gt; I am file2</span></span><br><span class="line">    <span class="built_in">console</span>.log(file2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/Mysql/JOIN,LEFTJOIN,ALLJOIN%E7%AD%89%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/Mysql/JOIN,LEFTJOIN,ALLJOIN%E7%AD%89%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/" class="post-title-link" itemprop="url">JOIN ，LEFT JOIN ，ALL JOIN 等的区别和联系</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-05 10:27:10" itemprop="dateCreated datePublished" datetime="2018-07-05T10:27:10+08:00">2018-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mysql/" itemprop="url" rel="index"><span itemprop="name">Mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JOIN-，LEFT-JOIN-，ALL-JOIN-等的区别和联系"><a href="#JOIN-，LEFT-JOIN-，ALL-JOIN-等的区别和联系" class="headerlink" title="JOIN ，LEFT JOIN ，ALL JOIN 等的区别和联系"></a>JOIN ，LEFT JOIN ，ALL JOIN 等的区别和联系</h1><p><code>left join</code> (左联接) 返回包括左表中的所有记录和右表中联结字段相等的记录</p>
<p><code>right join</code>(右联接) 返回包括右表中的所有记录和左表中联结字段相等的记录</p>
<p><code>inner join</code> (等值连接) 只返回两个表中联结字段相等的行</p>
<p>举例如下：</p>
<p>-——————————————-</p>
<p>表A记录如下：</p>
<p>aID　　　　　aNum</p>
<p>1　　　　　a20050111</p>
<p>2　　　　　a20050112</p>
<p>3　　　　　a20050113</p>
<p>4　　　　　a20050114</p>
<p>5　　　　　a20050115</p>
<p>表B记录如下:</p>
<p>bID　　　　　bName</p>
<p>1　　　　　2006032401</p>
<p>2　　　　　2006032402</p>
<p>3　　　　　2006032403</p>
<p>4　　　　　2006032404</p>
<p>8　　　　　2006032408</p>
<p>-——————————————-</p>
<h3 id="1-left-join"><a href="#1-left-join" class="headerlink" title="1.left join"></a>1.left join</h3><p>sql语句如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from A left join B on A.aID &#x3D; B.bID</span><br></pre></td></tr></table></figure>

<p>结果如下:</p>
<p>aID　　　　　aNum　　　　　bID　　　　　bName</p>
<p>1　　　　　a20050111　　　　1　　　　　2006032401</p>
<p>2　　　　　a20050112　　　　2　　　　　2006032402</p>
<p>3　　　　　a20050113　　　　3　　　　　2006032403</p>
<p>4　　　　　a20050114　　　　4　　　　　2006032404</p>
<p>5　　　　　a20050115　　　　NULL　　　　　NULL</p>
<p>（所影响的行数为 5 行）</p>
<p><strong>结果说明:</strong></p>
<p>left join是以A表的记录为基础的,A可以看成左表,B可以看成右表,left join是以左表为准的.</p>
<p>换句话说,左表(A)的记录将会全部表示出来,而右表(B)只会显示符合搜索条件的记录(例子中为: A.aID = B.bID).</p>
<p>B表记录不足的地方均为NULL.</p>
<p>-——————————————-</p>
<h3 id="2-right-join"><a href="#2-right-join" class="headerlink" title="2.right join"></a>2.right join</h3><p>sql语句如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from A right join B on A.aID &#x3D; B.bID</span><br></pre></td></tr></table></figure>

<p>结果如下:</p>
<p>aID　　　　　aNum　　　　　bID　　　　　bName</p>
<p>1　　　　　a20050111　　　　1　　　　　2006032401</p>
<p>2　　　　　a20050112　　　　2　　　　　2006032402</p>
<p>3　　　　　a20050113　　　　3　　　　　2006032403</p>
<p>4　　　　　a20050114　　　　4　　　　　2006032404</p>
<p>NULL　　　　　NULL　　　　　8　　　　　2006032408</p>
<p>（所影响的行数为 5 行）</p>
<p>结果说明:</p>
<p>仔细观察一下,就会发现,和left join的结果刚好相反,这次是以右表(B)为基础的,A表不足的地方用NULL填充.</p>
<p>-——————————————-</p>
<h3 id="3-inner-join"><a href="#3-inner-join" class="headerlink" title="3.inner join"></a>3.inner join</h3><p>sql语句如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from A innerjoin B on A.aID &#x3D; B.bID</span><br></pre></td></tr></table></figure>



<p>结果如下:</p>
<p>aID　　　　　aNum　　　　　bID　　　　　bName</p>
<p>1　　　　　a20050111　　　　1　　　　　2006032401</p>
<p>2　　　　　a20050112　　　　2　　　　　2006032402</p>
<p>3　　　　　a20050113　　　　3　　　　　2006032403</p>
<p>4　　　　　a20050114　　　　4　　　　　2006032404</p>
<p>结果说明:</p>
<p>很明显,这里只显示出了 A.aID = B.bID的记录.这说明inner join并不以谁为基础,它只显示符合条件的记录.</p>
<p>-——————————————-</p>
<p>###注:</p>
<p>LEFT JOIN操作用于在任何的 FROM 子句中，组合来源表的记录。使用 LEFT JOIN 运算来创建一个左边外部联接。左边外部联接将包含了从第一个（左边）开始的两个表中的全部记录，即使在第二个（右边）表中并没有相符值的记录。</p>
<p>语法：FROM table1 LEFT JOIN table2 ON table1.field1 compopr table2.field2</p>
<p>说明：table1, table2参数用于指定要将记录组合的表的名称。</p>
<p>field1, field2参数指定被联接的字段的名称。且这些字段必须有相同的数据类型及包含相同类型的数据，但它们不需要有相同的名称。</p>
<p>compopr参数指定关系比较运算符：”=”， “&lt;”， “&gt;”， “&lt;=”， “&gt;=” 或 “&lt;&gt;”。</p>
<p>如果在INNER JOIN操作中要联接包含Memo 数据类型或 OLE Object 数据类型数据的字段，将会发生错误.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/JavaScript/%E5%85%B3%E4%BA%8EJSON/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/JavaScript/%E5%85%B3%E4%BA%8EJSON/" class="post-title-link" itemprop="url">关于JSON</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-02 11:24:10" itemprop="dateCreated datePublished" datetime="2018-07-02T11:24:10+08:00">2018-07-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 09:22:48" itemprop="dateModified" datetime="2020-05-16T09:22:48+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="关于JSON"><a href="#关于JSON" class="headerlink" title="关于JSON"></a>关于JSON</h1><blockquote>
<p>摘自：《JavaScript高级程序设计》</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​       <code>JSON</code>是<code>JavaScript</code>的一个严格的子集，利用了<code>JavaScript</code>中的一些模式来表示结构化数据。</p>
<p>​    关于<code>JSON</code>，最重要的是理解它是一种数据格式，不是一种编程语言。虽然具有相同的语法形式，但<code>JSON</code>并不从属于<code>JavaScript</code>。所以<code>JSON</code>在很多编程语言中都有针对<code>JSON</code>的解析器和序列化器，它其实只是一种数据格式。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p><code>JSON</code>的可以表示以下三种类型的值。</p>
<ul>
<li><strong>简单值：</strong>使用与JavaScript相同的语法，可在JSON中表示字符串、数值、布尔值和null。JSON不支持JavaScript中的特殊值。</li>
<li><strong>对象：</strong>对象表示的是一组无序的键值对，每个键值对中的值可以是简单值，也可以是复杂数据类型的值。</li>
<li><strong>数组：</strong>数组表示的是一组有序的键值对，可以通过数值索引来访问其中的值。数组的值也可以是任意类型。</li>
</ul>
<p><code>JSON</code>不支持变量、函数或对象实例，它只是一种表示结构化数据的格式，虽然与<code>JavaScript</code>中表示数据的某些语法相同，但它并不局限于<code>JavaScript</code>的范畴。</p>
<h3 id="简单值"><a href="#简单值" class="headerlink" title="简单值"></a>简单值</h3><p>​    最简单的数据形式就是简单值。</p>
<p>​     <code>JavaScript</code>字符串和<code>JSON</code>字符串的最大区别在于，<code>JSON</code>字符串必须使用<strong>双引号</strong>（单引号会导致语法错误）。在实际应用中，<code>JSON</code>通常用来表示复杂的数据结构，简单值只是整个数据结构中的一部分。</p>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>​     <code>JSON</code>中对象与<code>JavaScript</code>字面量稍有不同。</p>
<p> <code>JavaScript</code>对象字面量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">"Andy"</span>,</span><br><span class="line">    age: <span class="number">25</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p> <code>JSON</code>表示方式：</p>
<pre><code><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Andy"</span>,</span><br><span class="line">    <span class="attr">"age"</span>: <span class="number">25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><p>​    实际上，<code>JavaScript</code>中前面的键也可以加上引号，可有可无。但JSON的双引号是不可或缺的。<code>JSON</code>与<code>JavaScript</code>相比有两个不同：</p>
<ul>
<li>没有变量声明，JSON中没有变量的概念。</li>
<li>没有末尾的分号。</li>
</ul>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p><code>JSON</code>数组采用的是<code>JavaScript</code>中的数组字面量形式。</p>
<p><code>JavaScript</code>中的数组字面量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> values = [<span class="number">23</span>, <span class="string">"hello"</span>, <span class="literal">true</span>];</span><br></pre></td></tr></table></figure>

<p><code>JSON</code>中的表示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">23</span>, <span class="string">"hello"</span>, <span class="literal">true</span>]</span><br></pre></td></tr></table></figure>

<p>同样，<code>JSON</code>数组也没有变量和分号。三者相结合，可以构成复杂的数据结构：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line">    <span class="attr">"authors"</span>: [</span><br><span class="line">        <span class="string">"Nicholas C. Zakas"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"edition"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">"year"</span>: <span class="number">2011</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="attr">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line">         <span class="attr">"authors"</span>: [</span><br><span class="line">              <span class="string">"Nicholas C. Zakas"</span></span><br><span class="line">         ],</span><br><span class="line">    <span class="attr">"edition"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"year"</span>: <span class="number">2009</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="attr">"title"</span>: <span class="string">"Professional Ajax"</span>,</span><br><span class="line">         <span class="attr">"authors"</span>: [</span><br><span class="line">             <span class="string">"Nicholas C. Zakas"</span>,</span><br><span class="line">             <span class="string">"Jeremy McPeak"</span>,</span><br><span class="line">             <span class="string">"Joe Fawcett"</span></span><br><span class="line">         ],</span><br><span class="line">         <span class="attr">"edition"</span>: <span class="number">2</span>,</span><br><span class="line">         <span class="attr">"year"</span>: <span class="number">2008</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="序列化选项"><a href="#序列化选项" class="headerlink" title="序列化选项"></a>序列化选项</h2><p><code>JSON</code>流行的重要原因是可以把<code>JSON</code>数据结构解析为有用的<code>JavaScript</code>对象。</p>
<h3 id="JSON对象"><a href="#JSON对象" class="headerlink" title="JSON对象"></a>JSON对象</h3><p><code>JSON</code>对象有两个方法：</p>
<ul>
<li><p><code>stringify()</code>：</p>
<ul>
<li><p>语法：<code>JSON.stringify(value[, replacer[, space]])</code></p>
</li>
<li><p>参数说明：</p>
<ul>
<li><p>value 必需， 要转换的 JavaScript 值（通常为对象或数组）</p>
</li>
<li><p>replacer 过滤器 可选。用于转换结果的函数或数组。</p>
<p>如果 replacer 为函数，则 JSON.stringify 将调用该函数，并传入每个成员的键和值。使用返回值而不是原始值。如果此函数返回 undefined，则排除成员。根对象的键是一个空字符串：””。</p>
<p>如果 replacer 是一个数组，则仅转换该数组中具有键值的成员。成员的转换顺序与键在数组中的顺序一样。当 value 参数也为数组时，将忽略 replacer 数组。</p>
</li>
<li><p>space: 可选，文本添加缩进、空格和换行符，如果 space 是一个数字，则返回值文本在每个级别缩进指定数目的空格，如果 space 大于 10，则文本缩进 10 个空格。space 有可以使用非数字，如：\t。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>parse()</code></p>
<ul>
<li>语法： <code>JSON.parse(value[, reviver])</code></li>
<li>参数说明： <ul>
<li>value 要被解析成JavaScript值的字符串</li>
<li>reviver 还原函数 是一个函数，则规定了原始值如何被解析改造，在被返回之前</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在最简单的情况下，这两个方法分别用于把<code>JavaScript</code>对象序列化为JSON字符串和把JSON字符串解析为原生JavaScript值。</p>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book =  &#123;</span><br><span class="line"> 	title: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line"> 	authors: [</span><br><span class="line">   		<span class="string">"Nicholas C. Zakas"</span></span><br><span class="line">	],</span><br><span class="line">    edition: <span class="number">3</span>,</span><br><span class="line">    year: <span class="number">2011</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book);</span><br></pre></td></tr></table></figure>

<p>默认情况下，<code>JOSN.stringify()</code>输出的<code>JSON</code>字符串不包含任何空格字符或缩进，因此保存在<code>jsonText</code>中的字符串如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"Professional JavaScript"</span>,<span class="attr">"authors"</span>:[<span class="string">"Nicholas C. Zakas"</span>],<span class="attr">"edition"</span>:<span class="number">3</span>, <span class="attr">"year"</span>:<span class="number">2011</span>&#125;</span><br></pre></td></tr></table></figure>

<p>在序列化<code>JavaScript</code>对象时，所有函数及原型成员都会被有意忽略，不体现在结果中。此外，值未undefined的任何属性也都会被跳过。</p>
<p> 将<code>JSON</code> 字符串直接传递给<code>JSON.parse()</code>就可以得到相应的<code>JavaScript</code>值。</p>
<h3 id="序列化选项-1"><a href="#序列化选项-1" class="headerlink" title="序列化选项"></a>序列化选项</h3><h4 id="过滤结果replacer"><a href="#过滤结果replacer" class="headerlink" title="过滤结果replacer"></a>过滤结果replacer</h4><p>​        如果过滤器参数是数组，那么<code>JSON.stringify()</code>的结果中将只包含数组中列出的属性。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">	<span class="string">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line"> 	<span class="string">"authors"</span>: [</span><br><span class="line">    	<span class="string">"Nicholas C. Zakas"</span></span><br><span class="line"> 	],</span><br><span class="line">	edition: <span class="number">3</span>,</span><br><span class="line">	year: <span class="number">2011</span> </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book, [<span class="string">"title"</span>, <span class="string">"edition"</span>]);</span><br></pre></td></tr></table></figure>

<p>​    第二个参数是一个数组，其中包含<code>title</code>和<code>edition</code>。这两个属性与将要序列化的对象中的属性是对应的，因此在返回的结果字符串中，就只会包含两个属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"Professional JavaScript"</span>,<span class="attr">"edition"</span>:<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<p>​    如果第二个参数是函数，行为会稍有不同。传入的函数接收两个参数，属性名和属性值。根据属性名可以知道如何处理要序列化的对象中的属性。属性名只能是字符串，而在值并非键值对结构的值时，键名可以是空字符串。函数返回的结果就是相应键的值。如果返回的是<code>undefined</code>，那么相应的属性会被忽略。</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line">    <span class="string">"authors"</span>: [</span><br><span class="line">        <span class="string">"Nicholas C. Zakas"</span></span><br><span class="line">    ],</span><br><span class="line">    edition: <span class="number">3</span>,</span><br><span class="line">    year: <span class="number">2011</span> </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>)</span>&#123; 		<span class="keyword">switch</span>(key)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"authors"</span>:</span><br><span class="line">            <span class="keyword">return</span> value.join(<span class="string">","</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"year"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">5000</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"edition"</span>:</span><br><span class="line">             <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    	<span class="keyword">default</span>: </span><br><span class="line">        	<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line">                                                        </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>序列化后的字符串如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"Professional JavaScript"</span>,<span class="attr">"authors"</span>:<span class="string">"Nicholas C. Zakas"</span>,<span class="attr">"year"</span>:<span class="number">5000</span>&#125;</span><br></pre></td></tr></table></figure>

<p>要序列化的每一个对象都要经过过滤器，因此数组中的每个带有这些属性的对象经过过滤之后，每个对象都会只包含<code>title</code>、<code>authors</code>和<code>year</code>属性。</p>
<h3 id="字符串缩进"><a href="#字符串缩进" class="headerlink" title="字符串缩进"></a>字符串缩进</h3><p><code>JSON.stringify()</code>方法的第三个参数用于控制结果中的缩进和空白符。如果这个参数是一个数值，那它表示的是每个级别缩进的空格数。例如，要在每个级别缩进4个空格，可以这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">	<span class="string">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line"> 	<span class="string">"authors"</span>: [</span><br><span class="line">    	<span class="string">"Nicholas C. Zakas"</span></span><br><span class="line"> 	],</span><br><span class="line">	edition: <span class="number">3</span>,</span><br><span class="line">	year: <span class="number">2011</span> </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book, <span class="literal">null</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>保存在jsonText中的字符串为</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line">    <span class="attr">"authors"</span>: [</span><br><span class="line">        <span class="string">"Nicholas C. Zakas"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"edition"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">"year"</span>: <span class="number">2011</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>JSON.stringify()</code>也在结果字符串中插入了换行符提高可读性，只要传入有效的控制缩进的参数值，结果字符串就会包含换行符号。（只缩进不换行的意义不大。）最大缩进空格数为<code>10</code>，所有大于<code>10</code>的值都会被自动转换为<code>10</code>。    </p>
<p>如果缩进参数是一个字符串，那么这个字符串将被用作缩进字符。</p>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book, <span class="literal">null</span>, <span class="string">" --"</span>);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> --"title": "Professional JavaScript",</span><br><span class="line"> --"authors": [</span><br><span class="line"> -- --"Nicholas C. Zakas"</span><br><span class="line"> --],</span><br><span class="line"> --"edition": 3,</span><br><span class="line"> --"year": 2011</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样，缩进字符串长度不能超过<code>10</code>个字符长，如果超过，将只出现前<code>10</code>个字符。    </p>
<h3 id="toJSON-方法"><a href="#toJSON-方法" class="headerlink" title="toJSON()方法"></a>toJSON()方法</h3><p>​        有时，<code>JSON.stringify()</code>不能满足对某些对象进行自定义序列化的需求。在这些情况下，可以给对象定义<code>toJSON()</code>方法，返回其自身的JSON数据。</p>
<p>​    可以为任何对象添加<code>toJSON()</code>方法，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">	<span class="string">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line"> 	<span class="string">"authors"</span>: [</span><br><span class="line">    	<span class="string">"Nicholas C. Zakas"</span></span><br><span class="line"> 	],</span><br><span class="line">	edition: <span class="number">3</span>,</span><br><span class="line">	year: <span class="number">2011</span>,</span><br><span class="line">    toJSON: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book);</span><br><span class="line"><span class="comment">// Professional JavaScript</span></span><br><span class="line"><span class="built_in">console</span>.log(jsonText);</span><br></pre></td></tr></table></figure>

<p>​    以上代码<code>book</code>对象上定义了一个<code>toJOSN()</code>方法，方法返回图书的名字。        与<code>Date</code>对象类似，这个对象也将被序列化为一个简单的字符串而非对象。可以让<code>toJSON()</code>方法返回任何值，它都能正常工作。</p>
<p>​        比如，可以让这个方法返回<code>undefined</code>，此时如果包含它的对象嵌入在另一个对象中，会导致它的值变成<code>null</code>，而如果它是顶级对象，记过就是<code>undefined</code>。</p>
<p><code>toJSON()</code>可以作为函数过滤器的补充，因此理解序列化的内部顺序十分重要。假设把一个对象传入<code>JSON.stringify()</code>，序列化的对象顺序如下：</p>
<ol>
<li>如果存在<code>toJSON()</code>方法而且能通过它取得有效的值，则调用该方法。否则返回对象本身。</li>
<li>如果提供了第二个参数，应用这个函数过滤器。传入函数过滤器的值是第1步返回的值。</li>
<li>对第2步返回的每个值进行相应的序列化。</li>
<li>如果提供第三个参数，执行相应的格式化。</li>
</ol>
<p>无论是考虑定义<code>toJSON()</code>还是使用函数过滤器，亦或需要同时使用两者，理解这个顺序至关重要。</p>
<h2 id="解析选项"><a href="#解析选项" class="headerlink" title="解析选项"></a>解析选项</h2><p>​        <code>JSON.parse()</code>方法可以接受另一个参数，该参数是一个函数，将在每个键值对调用。为了区别<code>JSON.stringify()</code>接收的替换（过滤）函数（replacer），这个函数被称为还原函数（reviver），但实际上这两个函数的签名是相同的,它们都接收两个参数，一个键和一个值，而且都需要返回一个值。</p>
<p>如果还原函数返回<code>undefined</code>，则表示要从结果中删除相应的键；如果返回其他值，则将该值插入到结果中。在将日期字符串转换为<code>Date</code>对象时，经常要用到还原函数。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">	<span class="string">"title"</span>: <span class="string">"Professional JavaScript"</span>,</span><br><span class="line"> 	<span class="string">"authors"</span>: [</span><br><span class="line">    	<span class="string">"Nicholas C. Zakas"</span></span><br><span class="line"> 	],</span><br><span class="line">	edition: <span class="number">3</span>,</span><br><span class="line">	year: <span class="number">2011</span>,</span><br><span class="line">    releaseDate: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2011</span>,<span class="number">11</span>,<span class="number">1</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="built_in">JSON</span>.stringify(book);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bookCopy = <span class="built_in">JSON</span>.parse(jsonText, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="string">"releaseDate"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2011</span></span><br><span class="line"><span class="built_in">console</span>.log(bookCopy.releaseDate.getFullYear());</span><br></pre></td></tr></table></figure>

<p>​    以上代码<code>book</code>对象新增了一个<code>releaseDate</code>属性，该属性保存着一个<code>Date</code>对象。这个对象在经过序列化之后又变成了有效的JSON字符串，然后经过解析又在<code>bookCopy</code>中还原<code>Date</code>对象。还原函数在遇到<code>releaseDate</code>键时，会基于相应的值创建一个新的<code>Date</code>对象。结果就是<code>bookCopy.releaseDate</code>属性中会保存一个<code>Date</code>对象。正因为如此，才能基于这个对象调用<code>getFullYear()</code>方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/Linux/%E5%B0%8F%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/Linux/%E5%B0%8F%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">小视频笔记(三)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-28 15:27:10" itemprop="dateCreated datePublished" datetime="2018-04-28T15:27:10+08:00">2018-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="小视频笔记-三"><a href="#小视频笔记-三" class="headerlink" title="小视频笔记(三)"></a>小视频笔记(三)</h1><h1 id="8-权限管理"><a href="#8-权限管理" class="headerlink" title="8 权限管理"></a>8 权限管理</h1><h2 id="8-1-ACL权限"><a href="#8-1-ACL权限" class="headerlink" title="8.1 ACL权限"></a>8.1 ACL权限</h2><h3 id="1-权限简介"><a href="#1-权限简介" class="headerlink" title="1.权限简介"></a>1.权限简介</h3><p>Linux的文件有所有者，所属组，其他人三种权限，但这是远远不够的，比如说，有一个project，项目管理员将所有项目人员添加到该项目的所属组中，分配权限770，有一天，临时来了一个成员，该成员需要先进行学习，然后才能工作，这时我们需要对该成员对project分配读和可执行的权限，不能将其他人权限设为5，文件只有一个所属组，所以对project分配两个所属组的方式不成立，显然此时的权限管理方式无法满足要求，这时候就用到ACL权限了，所谓的ACL权限，可以简单的理解为为某一用户或某一组分配不属于所有，所属组，其他人的额外权限。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9104.png" alt=""></p>
<h3 id="2-查看分区ACL权限是否开启"><a href="#2-查看分区ACL权限是否开启" class="headerlink" title="2.查看分区ACL权限是否开启"></a>2.查看分区ACL权限是否开启</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看分区使用状况</span></span><br><span class="line">~ andy$ df -h</span><br><span class="line">Filesystem      Size   Used  Avail Capacity iused      ifree %iused  Mounted on</span><br><span class="line">/dev/disk1     112Gi   61Gi   51Gi    55% 1632930 4293334349    0%   /</span><br><span class="line">devfs          182Ki  182Ki    0Bi   100%     632          0  100%   /dev</span><br><span class="line">map -hosts       0Bi    0Bi    0Bi   100%       0          0  100%   /net</span><br><span class="line">map auto_home    0Bi    0Bi    0Bi   100%       0          0  100%   /home</span><br></pre></td></tr></table></figure>

<p>命令格式：<code>dumpefs [选项] 分区路径</code></p>
<p>​    查询指定分区详细文件系统信息的命令 </p>
<p>选项: </p>
<p>​    -h 仅显示超级块中信息，而不显示磁盘块组的详细信息 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpe2fs -h /dev/sda3</span><br></pre></td></tr></table></figure>

<h3 id="3-临时开启分区ACL权限"><a href="#3-临时开启分区ACL权限" class="headerlink" title="3.临时开启分区ACL权限"></a>3.临时开启分区ACL权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重新挂载根分区，并挂载加入acl权限</span></span><br><span class="line">[root@localhost ~]# mount -o remount,acl /</span><br></pre></td></tr></table></figure>

<h3 id="4-永久开启分区ACL权限"><a href="#4-永久开启分区ACL权限" class="headerlink" title="4.永久开启分区ACL权限"></a>4.永久开启分区ACL权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/fstab</span><br><span class="line">UUID=c2ca6f57-b15c-43ea-bca0-f239083d8bd2 / ext4 defaults,acl #加入acl</span><br><span class="line">[root@localhost ~]# mount -o remount /</span><br><span class="line"><span class="meta">#</span><span class="bash">重新挂载文件系统或重启动系统，使修改生效</span></span><br></pre></td></tr></table></figure>

<p><strong>注：</strong> fastab是系统开机启动默认挂载的文件</p>
<h3 id="5-设定ACL权限的命令"><a href="#5-设定ACL权限的命令" class="headerlink" title="5. 设定ACL权限的命令"></a>5. 设定ACL权限的命令</h3><p>命令：<code>setfacl 选项 文件名</code> 设置ACL权限</p>
<p>选项：</p>
<ul>
<li>-m       设定ACL权限</li>
<li>-x         删除指定的ACL权限</li>
<li>-b         删除所有的ACL权限</li>
<li>-d         设定默认ACL权限</li>
<li>-k          删除默认ACL权限</li>
<li>-R         递归设定ACL权限</li>
</ul>
<p>命令：<code>getacl 路径</code> 查看ACL权限</p>
<p>准备工作，创建需要的用户和用户组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 ~]# useradd zhangsan</span><br><span class="line">[root@262e395bc9e9 ~]# useradd lisi</span><br><span class="line">[root@262e395bc9e9 ~]# useradd st</span><br><span class="line">[root@262e395bc9e9 ~]# groupadd tgroup</span><br><span class="line">[root@262e395bc9e9 ~]# mkdir /tmp/project</span><br><span class="line">[root@262e395bc9e9 ~]# chown root:tgroup /tmp/project/</span><br><span class="line">[root@262e395bc9e9 ~]# chmod 770 /tmp/project/</span><br></pre></td></tr></table></figure>

<p>给用户设定ACL权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 给用户st赋予r-x权限，使用“u:用户名:权限”格式</span></span><br><span class="line">[root@262e395bc9e9 ~]# setfacl -m u:st:rx /tmp/project</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设定结果 多了个“+”</span></span><br><span class="line">[root@262e395bc9e9 ~]# ll -d</span><br><span class="line">drwxrwx---+ 2 root tgroup 4096 Aug  9 07:22 /tmp/project</span><br><span class="line">[root@262e395bc9e9 project]# getfacl .</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: .</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换用户测试 没有w权限</span></span><br><span class="line">[root@262e395bc9e9 project]# su - st</span><br><span class="line">[st@262e395bc9e9 ~]$ cd /tmp/project/</span><br><span class="line">[st@262e395bc9e9 project]$ touch test.js</span><br><span class="line">touch: cannot touch 'test.js': Permission denied</span><br></pre></td></tr></table></figure>

<p>给用户组设定ACL权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 project]# groupadd tgroup2</span><br><span class="line">[root@262e395bc9e9 project]# setfacl -m g:tgroup2:rwx /tmp/project</span><br><span class="line">[root@262e395bc9e9 project]# getfacl /tmp/project</span><br><span class="line">getfacl: Removing leading '/' from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: tmp/project</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx</span><br><span class="line">group:tgroup2:rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure>

<h3 id="6-最大有效权限与删除"><a href="#6-最大有效权限与删除" class="headerlink" title="6.最大有效权限与删除"></a>6.最大有效权限与删除</h3><p>​    最大有效权限mask：mask是用来指定最大有效权限的。如果 我给用户赋予了ACL权限，是需要和 mask的权限“相与”才能得到用户的真正权限 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 project]# setfacl -m m:rx /tmp/project</span><br><span class="line">[root@262e395bc9e9 project]# getfacl /tmp/project</span><br><span class="line">getfacl: Removing leading '/' from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: tmp/project</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx			    #effective:r-x</span><br><span class="line">group:tgroup2:rwx		#effective:r-x</span><br><span class="line">mask::r-x</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure>

<p>它并不影响所有者的权限，而是影响所属组和ACL的权限。</p>
<p>删除ACL权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除指定用户的ACL权限</span></span><br><span class="line">[root@localhost /]# setfacl -x u:用户名 文件名</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定用户组的ACL权限</span></span><br><span class="line">[root@localhost /]# setfacl -x g:组名 文件名</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 project]# setfacl -x g:tgroup2 /tmp/project</span><br><span class="line">[root@262e395bc9e9 project]# getfacl .</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: .</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br><span class="line"></span><br><span class="line">[root@262e395bc9e9 project]# setfacl -b /tmp/project</span><br><span class="line">[root@262e395bc9e9 project]# getfacl .</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: .</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">group::rwx</span><br><span class="line">other::---</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 没“+”</span></span><br><span class="line">[root@262e395bc9e9 project]# ll -d</span><br><span class="line">drwxrwx--- 2 root tgroup 4096 Aug  9 07:22 .</span><br></pre></td></tr></table></figure>

<h3 id="7-默认与递归ACL权限"><a href="#7-默认与递归ACL权限" class="headerlink" title="7.默认与递归ACL权限"></a>7.默认与递归ACL权限</h3><p>​    递归是父目录在设定ACL权限时，所有的子文件和子目录也会拥有相同的ACL权限。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m u:用户名:权限 -R 目录</span><br></pre></td></tr></table></figure>

<p>​    注：<code>-R</code>只能在这个位置，其他位置会报错</p>
<p>使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 project]# setfacl -m u:st:rx -R /tmp/project </span><br><span class="line">[root@262e395bc9e9 project]# ll -a</span><br><span class="line">total 16</span><br><span class="line">drwxrwx---+ 4 root tgroup 4096 Aug  9 08:26 .</span><br><span class="line">drwxrwxrwt  1 root root   4096 Aug  9 07:22 ..</span><br><span class="line">drwxr-xr-x+ 2 root root   4096 Aug  9 08:25 test1</span><br><span class="line">drwxr-xr-x+ 2 root root   4096 Aug  9 08:26 test2</span><br></pre></td></tr></table></figure>

<p>​    默认ACL权限：如果给父目录设定 了默认ACL权限，那么父目录中所有新建 的子文件都会继承父目录的ACL权限 。这个操作只会对新创建在目录下的文件生效，对现有的文件无影响，如果现有文件也需要设置ACL权限，需要使用递归赋予权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m d:u:用户名:权限 文件名</span><br></pre></td></tr></table></figure>

<p>​    注：<code>d</code>指的是<code>default</code></p>
<p>使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 project]# setfacl -m d:u:st:rx /tmp/project</span><br><span class="line">[root@262e395bc9e9 project]# mkdir test3 </span><br><span class="line">[root@262e395bc9e9 project]# getfacl test3</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: test3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: root</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br><span class="line">default:user::rwx</span><br><span class="line">default:user:st:r-x</span><br><span class="line">default:group::rwx</span><br><span class="line">default:mask::rwx</span><br><span class="line">default:other::---</span><br></pre></td></tr></table></figure>

<h2 id="8-2-文件特殊权限"><a href="#8-2-文件特殊权限" class="headerlink" title="8.2 文件特殊权限"></a>8.2 文件特殊权限</h2><h3 id="1-SetUID"><a href="#1-SetUID" class="headerlink" title="1.SetUID"></a>1.SetUID</h3><h3 id="2-SetUID"><a href="#2-SetUID" class="headerlink" title="2.SetUID"></a>2.SetUID</h3><h3 id="3-Sticky-BIT"><a href="#3-Sticky-BIT" class="headerlink" title="3.Sticky BIT"></a>3.Sticky BIT</h3><h2 id="8-3-文件系统属性权限"><a href="#8-3-文件系统属性权限" class="headerlink" title="8.3 文件系统属性权限"></a>8.3 文件系统属性权限</h2><h3 id="chattr"><a href="#chattr" class="headerlink" title="chattr"></a>chattr</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>chattr</td>
</tr>
<tr>
<td>原意</td>
<td>change attributes</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/chattr</td>
</tr>
<tr>
<td>功能描述</td>
<td>更改系统文件属性</td>
</tr>
<tr>
<td>语法</td>
<td>chattr [+-=].  [选项] 文件或目录名</td>
</tr>
</tbody></table>
<p><code>+:增加权限 -：删除权限 =：等于某权限</code></p>
<p>选项说明:</p>
<ul>
<li><code>i</code>: 如果对文件设置i属性，那么不允许对文件进行删除、改名，也不能添加和修改数据;如果对目录设置i属性，那么只能修改目录下文件的数据，但不允许建立和删除文件 。</li>
<li><code>a</code>: 如果对文件设置a属性，那么只能在文件中增加数据，但是不能删除也不能修改数据(数据增加只能是追加的方式);如果对目录设置<code>a</code>属性，那么只允许在目录中建立和修改文件 ，但是不允许删除 。</li>
</ul>
<p><code>chattr</code>对于保护文件系统当中重要数据免遭误操作是非常有效的。但是可以通过<code>+-</code>进行方便的设置是否可以操作，它不是为了限制用户，而是为了防止连在root用户在内的用户进行误操作的措施。</p>
<h3 id="lsattr"><a href="#lsattr" class="headerlink" title="lsattr"></a>lsattr</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>lsattr</td>
</tr>
<tr>
<td>原意</td>
<td>ls attributes</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/lsattr</td>
</tr>
<tr>
<td>功能描述</td>
<td>查看系统文件属性</td>
</tr>
<tr>
<td>语法</td>
<td>chattr  选项名 文件名</td>
</tr>
</tbody></table>
<p>选项说明：</p>
<ul>
<li><code>-a</code>：显示所有文件和目录</li>
<li><code>-d</code>：若目标是目录，仅列出目录本身的属性，而不是子文件的</li>
</ul>
<h2 id="8-4-系统命令sudo权限"><a href="#8-4-系统命令sudo权限" class="headerlink" title="8.4 系统命令sudo权限"></a>8.4 系统命令sudo权限</h2><h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>sudo</td>
</tr>
<tr>
<td>原意</td>
<td>super user do</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/sudo</td>
</tr>
<tr>
<td>功能描述</td>
<td>root把本来只能超级用户执行的命令赋予普通用户执行</td>
</tr>
<tr>
<td>语法</td>
<td>sudo 系统命令</td>
</tr>
</tbody></table>
<p>使用：</p>
<ol>
<li>赋予普通用户权限或用户组权限</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 实际修改的是/etc/sudoers文件 直接用vi修改这个文件也可以</span></span><br><span class="line">[root@262e395bc9e9 tmp]# visudo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户名 被管理主机的地址=(可使用的身份)  授权命令(绝对路径)</span></span><br><span class="line">root ALL=(ALL)          ALL</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> %组名 被管理主机的地址=(可使用的身份)   授权命令(绝对路径)</span></span><br><span class="line"><span class="meta">%</span><span class="bash">wheel  ALL=(ALL)       ALL</span></span><br></pre></td></tr></table></figure>

<p><code>ALL=(ALL)</code>第一个<code>ALL</code>并不是定义允许哪个ip地址或网络允许访问我们，而是定义允许哪一个用户在哪一台计算机上执行某一条命令，即写的是被管理主机的地址。限制的是访问IP而不是来源IP。第二个<code>ALL</code>指的是可使用的用户。第三个<code>ALL</code>标识授权命令，写ALL其实是不合理的，赋予的能力过于强大，正常来讲，应该写具体哪个命令，使用的是绝对路径。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 tmp]# visudo</span><br><span class="line">sc ALL= /sbin/shutdown –r now</span><br><span class="line"><span class="meta">#</span><span class="bash"> 赋予sc此权限很危险，用户可以操作任何文件。不过看公司使用全都给的ALL。。。</span></span><br><span class="line">sc ALL=/usr/bin/vim</span><br></pre></td></tr></table></figure>

<p>注意：如果命令写的越简单，代表用户具有的权限越大。比如说上面的命令没有写<code>-r now</code>代表用户可以执行<code>shutdown</code>的所有参数。即命令可以根据需求，进行修改。</p>
<p><code>sudo -l</code>可查看拥有的权限</p>
<h1 id="9-文件系统管理"><a href="#9-文件系统管理" class="headerlink" title="9.文件系统管理"></a>9.文件系统管理</h1><h2 id="9-1-分区和文件系统"><a href="#9-1-分区和文件系统" class="headerlink" title="9.1 分区和文件系统"></a>9.1 分区和文件系统</h2><h3 id="1-分区类型"><a href="#1-分区类型" class="headerlink" title="1.分区类型"></a>1.分区类型</h3><p>分区有三种类型：</p>
<ul>
<li>主分区： 总共最多只能分四个</li>
<li>扩展分区：只能有一个，也算作主分区的一种 ，也就是说主分区加扩展分区最多有四个。但是扩展分区不能存储数据和格式化，必须再划分成逻辑分区才能使用。 </li>
<li>逻辑分区：逻辑分区是在扩展分区中划分的， 如果是<code>IDE</code>硬盘，<code>Linux</code>最多支持<strong>59</strong>个逻辑分区 ，如果是<code>SCSI</code>硬盘<code>Linux</code>最多支持<code>11</code>个逻辑分区 。</li>
</ul>
<p>​         分区可以理解为把一个大柜子分为几个小柜子，但是只允许打四个柜子，但当物品分类更多四个柜子不够用时，可以把其中一个小柜子再进行划分成更细致的柜子。这种分区方法的目的就是为了突破四个分区的限制。</p>
<p>分区表示方法：</p>
<p>设备文件名</p>
<table>
<thead>
<tr>
<th>分区名称</th>
<th>文件名</th>
</tr>
</thead>
<tbody><tr>
<td>主分区1</td>
<td>/dev/sda1</td>
</tr>
<tr>
<td>主分区2</td>
<td>/dev/sda2</td>
</tr>
<tr>
<td>主分区3</td>
<td>/dev/sda3</td>
</tr>
<tr>
<td>扩展分区</td>
<td>/dev/sda4</td>
</tr>
<tr>
<td>逻辑分区1</td>
<td>/dev/sda5</td>
</tr>
<tr>
<td>逻辑分区2</td>
<td>/dev/sda6</td>
</tr>
<tr>
<td>逻辑分区3</td>
<td>/dev/sda7</td>
</tr>
</tbody></table>
<p>注：<code>sd</code>代表<code>SCSI</code>或<code>sdtype</code>硬盘接口，<code>a</code>代表第一块硬盘，<code>1 2 3 4</code>代表四个主分区，只能给主分区使用，就算空下来也不能给逻辑分区使用。 从<code>5</code>开始代表逻辑分区。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9105.png" alt=""></p>
<p>更习惯的分区方式是:</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9106.jpg" alt=""></p>
<h3 id="2-文件系统"><a href="#2-文件系统" class="headerlink" title="2.文件系统"></a>2.文件系统</h3><p>有了分区之后，硬盘还不能使用，必须格式化之后才可以使用。格式化就是为了写入文件系统。</p>
<p>Linux默认文件系统分类：</p>
<ul>
<li><code>ext2</code>：是ext文件系统的升级版本，Red Hat Linux7.2版本以前的系统默认都是ext2 文件系统。1993年发布，最大支持16TB 的分区和最大2TB的文件<code>1TB=1024GB=1024*1024KB</code>。</li>
<li><code>ext3</code>：ext3文件系统是ext2文件系统的升 级版本，最大的区别就是带日志功能，以在系统突然停止时提高文件系统的可靠性 。支持最大16TB的分区和最大2TB的文件 。</li>
<li><code>ext4</code>：它是ext3文件系统的升级版。ext4 在性能 、伸缩性和可靠性方面进行了大量改进。EXT4的变化可以说是翻天覆地的，比如向下兼容 EXT3、最大1EB文件系统和16TB文件、无限数量子目录、Extents连续数据块概念、多块分配 、延迟分配、持久预分配、快速FSCK、日志校 验、无日志模式、在线碎片整理、inode增强、 默认启用barrier等。<code>1EB=1024PB=1024*1024TB</code></li>
</ul>
<h2 id="9-2-文件系统常用命令"><a href="#9-2-文件系统常用命令" class="headerlink" title="9.2 文件系统常用命令"></a>9.2 文件系统常用命令</h2><h3 id="1-挂载命令"><a href="#1-挂载命令" class="headerlink" title="1.  挂载命令"></a>1.  挂载命令</h3><h4 id="df"><a href="#df" class="headerlink" title="df"></a>df</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>df</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/df</td>
</tr>
<tr>
<td>功能描述</td>
<td>统计文件系统的占用情况</td>
</tr>
<tr>
<td>语法</td>
<td><code>df [选项] [挂载点]</code></td>
</tr>
</tbody></table>
<p>选项说明：</p>
<ul>
<li><code>-a</code>：显示所有的文件系统信息，包括特殊文件系统，如 /proc、/sysfs </li>
<li><code>-h</code>：使用习惯单位显示容量，如KB，MB或GB等 </li>
<li><code>-T</code>：显示文件系统类型</li>
<li><code>-m</code>：以MB为单位显示容量</li>
<li><code>-k</code>：以KB为单位显示容量。默认就是以KB为单位</li>
</ul>
<h4 id="du"><a href="#du" class="headerlink" title="du"></a>du</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>du</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/du</td>
</tr>
<tr>
<td>功能描述</td>
<td>统计目录或文件大小</td>
</tr>
<tr>
<td>语法</td>
<td><code>df [选项] [挂载点]</code></td>
</tr>
</tbody></table>
<p>选项说明：</p>
<ul>
<li><code>-a</code>：显示每个子文件的磁盘占用量。默认只统计子目录的磁盘占用量 </li>
<li><code>-h</code>：使用习惯单位显示磁盘占用量，如KB，MB或GB等 </li>
<li><code>-s</code>：统计总占用量，而不列出子目录和子文件的占用量 </li>
</ul>
<p>注:此命令一般不用做统计文件大小，因为完全可用<code>ls</code>代替，但<code>ls</code>统计目录大小时，只会统计目录下一级子目录和文件的文件名所占用空间大小，而不会统计子目录和文件中的数据占用的空间多大。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 /]# ls -lh /</span><br><span class="line">total 56K</span><br><span class="line">-rw-r--r--   1 root root  12K Aug  4 22:05 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root    7 Aug  4 22:04 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  360 Aug  8 09:30 dev</span><br><span class="line">drwxr-xr-x   1 root root 4.0K Aug  9 13:06 etc</span><br><span class="line">drwxr-xr-x   1 root root 4.0K Aug  9 07:39 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Aug  4 22:04 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Aug  4 22:04 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root 4.0K Apr 11 04:59 media</span><br><span class="line">drwxr-xr-x   2 root root 4.0K Apr 11 04:59 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4.0K Apr 11 04:59 opt</span><br><span class="line">dr-xr-xr-x 166 root root    0 Aug  8 09:30 proc</span><br><span class="line">dr-xr-x---   1 root root 4.0K Aug  8 09:30 root</span><br><span class="line">drwxr-xr-x   1 root root 4.0K Aug 10 03:19 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Aug  4 22:04 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4.0K Apr 11 04:59 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Aug 10 03:52 sys</span><br><span class="line">drwxrwxrwt   1 root root 4.0K Aug  9 12:28 tmp</span><br><span class="line">drwxr-xr-x   1 root root 4.0K Aug  4 22:04 usr</span><br><span class="line">drwxr-xr-x   1 root root 4.0K Aug  4 22:04 var</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@262e395bc9e9 /]# du -sh /etc/</span><br><span class="line">2.7M	/etc/</span><br></pre></td></tr></table></figure>

<p><strong>du命令和df命令的区别：</strong></p>
<p> <code>df</code>命令是从文件系统考虑的，不光要考虑文件占用的空间，还要统计被命令或程序占用的空间(最常见的就是文件已经删除 ，但是程序并没有释放空间) ；<code>du</code>命令是面向文件的，只会计算文件或目录占用的空间。</p>
<h4 id="fsck"><a href="#fsck" class="headerlink" title="fsck"></a>fsck</h4><p>系统在启动时会自动执行，不需要手动执行，是底层修复命令，自己执行有时候反而会出问题，了解就好</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>fsck</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/sbin/fsck</td>
</tr>
<tr>
<td>功能描述</td>
<td>文件系统修复命令</td>
</tr>
<tr>
<td>语法</td>
<td><code>df [选项] [挂载点]</code></td>
</tr>
</tbody></table>
<p>选项说明：</p>
<ul>
<li><code>-a</code>：不用显示用户提示，自动修复文件系统 </li>
<li><code>-y</code>：自动修复。和-a作用一致，不过有些文件系统只支持<code>-y</code> </li>
</ul>
<h4 id="dumpe2fs"><a href="#dumpe2fs" class="headerlink" title="dumpe2fs"></a>dumpe2fs</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>dumpe2fs</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/sbin/dumpe2fs</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示磁盘状态 （主要用来查看数据块大小）</td>
</tr>
<tr>
<td>语法</td>
<td><code>dumpe2fs [选项] 分区设备文件名</code></td>
</tr>
</tbody></table>
<h3 id="2-挂载命令"><a href="#2-挂载命令" class="headerlink" title="2.挂载命令"></a>2.挂载命令</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>mount</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/mount</td>
</tr>
<tr>
<td>功能描述</td>
<td>查询和挂载</td>
</tr>
<tr>
<td>语法</td>
<td><code>mount [-la][-t 文件系统][-L 卷标名][-o 特殊选项] 设备文件名 挂载点</code></td>
</tr>
</tbody></table>
<p>选项说明：</p>
<ul>
<li><p><code>-l</code>：查询系统中已经挂载的设备时，会显示卷标名称。</p>
</li>
<li><p><code>-a</code>：根据配置文件<code>/etc/fstab</code>的内容，自动挂载</p>
</li>
<li><p><code>-t 文件系统</code>：加入文件系统类型来指定挂载的类型，可以<code>ext3</code>、<code>ext4</code>、<code>iso9600</code>等文件系统</p>
</li>
<li><p><code>-L 卷标名</code>：挂载指定卷标的分区，而不是安装设备文件名挂载</p>
</li>
<li><p><code>-o 特殊选项</code>：可以指定挂载的额外选项，用逗号隔开特殊选项，如：<code>remount,noexec</code></p>
<p>特殊选项说明：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9107.jpg" alt=""></p>
</li>
</ul>
<p>把设备文件名和挂载点连接起来</p>
<p>使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">重新挂载/boot分区，并使用noexec权限 </span></span><br><span class="line">[root@localhost sh]# mount -o remount,noexec /home</span><br><span class="line">[root@localhost sh]# cd /home </span><br><span class="line">[root@localhost boot]# vi hello.sh </span><br><span class="line">[root@localhost boot]# ./hello.sh</span><br><span class="line">[root@localhost boot]# chmod 755 hello.sh</span><br><span class="line">hello world</span><br><span class="line">[root@localhost boot]# mount -o remount,exec /home</span><br></pre></td></tr></table></figure>

<h3 id="3-挂载光盘与U盘"><a href="#3-挂载光盘与U盘" class="headerlink" title="3.挂载光盘与U盘"></a>3.挂载光盘与U盘</h3><h4 id="mount挂载光盘"><a href="#mount挂载光盘" class="headerlink" title="mount挂载光盘"></a>mount挂载光盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">建立挂载点</span></span><br><span class="line">[root@localhost ~]# mkdir /mnt/cdrom/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">挂载光盘 </span></span><br><span class="line">[root@localhost ~]# mount -t iso9660 /dev/cdrom /mnt/cdrom/</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# mount /dev/sr0 /mnt/cdrom/</span><br></pre></td></tr></table></figure>

<p><code>mount</code>其实就是把设备文件和挂载点连接起来。上述就是把<code>/dev/cdrom</code>设备文件挂载到<code>/mnt/cdrom</code>。</p>
<p>挂载挂盘时，设备文件使用<code>/dev/cdrom</code>和<code>/dev/sr0</code>效果相同，其实前者是后者的一个软链接。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ll /dev/cdrom</span><br><span class="line">lrwxrwxrwx. l root root 3 1月 14 17：26 /dev/cdrom -&gt; sr0</span><br></pre></td></tr></table></figure>

<p>访问数据的时候，直接去挂载点访问数据。</p>
<h4 id="unmount卸载光盘"><a href="#unmount卸载光盘" class="headerlink" title="unmount卸载光盘"></a>unmount卸载光盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# umount 设备文件名或挂载点</span><br><span class="line">[root@localhost ~]# umount /mnt/cdrom</span><br></pre></td></tr></table></figure>

<h4 id="挂载U盘"><a href="#挂载U盘" class="headerlink" title="挂载U盘"></a>挂载U盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看U盘设备文件名</span></span><br><span class="line">[root@localhost ~]# fdisk –l</span><br><span class="line">[root@localhost ~]# mount -t vfat /dev/sdb1 /mnt/usb/</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong>Linux默认是不支持NTFS文件系统的。在Linux中， 把<code>fat</code>和<code>fat16</code>分区识别为<code>fat</code>,把<code>fat32</code>分区识别为<code>vfat</code>。</p>
<h3 id="4-fdisk分区"><a href="#4-fdisk分区" class="headerlink" title="4.fdisk分区"></a>4.fdisk分区</h3><h4 id="1-fdisk命令分区过程"><a href="#1-fdisk命令分区过程" class="headerlink" title="1.fdisk命令分区过程"></a>1.fdisk命令分区过程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 添加新硬盘</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看新硬盘</span></span><br><span class="line">[root@localhost ~]# fdisk -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 使用fdisk命令分区</span></span><br><span class="line">[root@localhost ~]# fdisk /dev/sdb</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 重新读取分区</span></span><br><span class="line">[root@localhost ~]# partprobe</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9108.jpg" alt=""></p>
<h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/Linux/%E5%B0%8F%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/Linux/%E5%B0%8F%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">小视频笔记（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-02 15:27:10" itemprop="dateCreated datePublished" datetime="2018-04-02T15:27:10+08:00">2018-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="小视频笔记（二）"><a href="#小视频笔记（二）" class="headerlink" title="小视频笔记（二）"></a>小视频笔记（二）</h1><h1 id="5-文本编辑器Vim"><a href="#5-文本编辑器Vim" class="headerlink" title="5.文本编辑器Vim"></a>5.文本编辑器Vim</h1><h2 id="5-1-Vim简介"><a href="#5-1-Vim简介" class="headerlink" title="5.1 Vim简介"></a>5.1 Vim简介</h2><p>Vim是一个功能强大的全屏幕文本编辑器，是Linux/UNIX上最常用的文本编辑器，它的作用是建立、编辑、显示文本文件。</p>
<p><strong>Vim 没有菜单，只有命令。</strong></p>
<h2 id="5-2-Vim工作模式"><a href="#5-2-Vim工作模式" class="headerlink" title="5.2 Vim工作模式"></a>5.2 Vim工作模式</h2><p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9102.png" alt=""></p>
<h2 id="5-3-常用操作"><a href="#5-3-常用操作" class="headerlink" title="5.3 常用操作"></a>5.3 常用操作</h2><h3 id="5-3-1-插入命令"><a href="#5-3-1-插入命令" class="headerlink" title="5.3.1 插入命令"></a>5.3.1 插入命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>在光标所在字符后插入</td>
</tr>
<tr>
<td>A</td>
<td>在光标所在行尾插入</td>
</tr>
<tr>
<td>i</td>
<td>在光标所在字符前插入</td>
</tr>
<tr>
<td>I</td>
<td>在光标所在行行首插入</td>
</tr>
<tr>
<td>o</td>
<td>在光标下插入新航</td>
</tr>
<tr>
<td>O</td>
<td>在光标上插入新航</td>
</tr>
</tbody></table>
<h3 id="5-3-2-定位命令"><a href="#5-3-2-定位命令" class="headerlink" title="5.3.2 定位命令"></a>5.3.2 定位命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>: set nu</td>
<td>设置行号</td>
</tr>
<tr>
<td>: set nonu</td>
<td>取消行号</td>
</tr>
<tr>
<td>gg/G</td>
<td>到第一行/到最后一行</td>
</tr>
<tr>
<td>nG</td>
<td>到第n行</td>
</tr>
<tr>
<td>: nG</td>
<td>到第n行</td>
</tr>
<tr>
<td>$</td>
<td>移至行尾</td>
</tr>
<tr>
<td>0</td>
<td>移至行首</td>
</tr>
</tbody></table>
<h3 id="5-3-3-删除命令"><a href="#5-3-3-删除命令" class="headerlink" title="5.3.3 删除命令"></a>5.3.3 删除命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>x</td>
<td>删除光标所在处字符</td>
</tr>
<tr>
<td>nx</td>
<td>删除光标所在处后n个字符</td>
</tr>
<tr>
<td>dd</td>
<td>删除光标所在行，ndd删除n行</td>
</tr>
<tr>
<td>dG</td>
<td>删除光标所在行到文件末尾内容</td>
</tr>
<tr>
<td>D</td>
<td>删除光标所在处到行尾内容</td>
</tr>
<tr>
<td>:n1,n2d</td>
<td>删除指定范围的行</td>
</tr>
</tbody></table>
<h3 id="5-3-4-复制和剪切命令"><a href="#5-3-4-复制和剪切命令" class="headerlink" title="5.3.4 复制和剪切命令"></a>5.3.4 复制和剪切命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>yy</td>
<td>复制当前行</td>
</tr>
<tr>
<td>nyy</td>
<td>复制当前行以下n行</td>
</tr>
<tr>
<td>dd</td>
<td>剪切当前行</td>
</tr>
<tr>
<td>ndd</td>
<td>剪切当前行以下n行</td>
</tr>
<tr>
<td>p、P</td>
<td>粘贴在当前光标所在行下或行上</td>
</tr>
</tbody></table>
<h3 id="5-3-5-替换和取消命令"><a href="#5-3-5-替换和取消命令" class="headerlink" title="5.3.5 替换和取消命令"></a>5.3.5 替换和取消命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>取代光标所在处字符</td>
</tr>
<tr>
<td>R</td>
<td>从光标所在处开始替换字符，按Esc结束</td>
</tr>
<tr>
<td>u</td>
<td>取消上一步操作</td>
</tr>
</tbody></table>
<h3 id="5-3-6-搜索和搜索替换命"><a href="#5-3-6-搜索和搜索替换命" class="headerlink" title="5.3.6 搜索和搜索替换命"></a>5.3.6 搜索和搜索替换命</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>/string</td>
<td>搜索指定字符串；搜索时忽略大小写<code>:set ic</code></td>
</tr>
<tr>
<td>n</td>
<td>搜索指定字符串的下一个出现位置</td>
</tr>
<tr>
<td>:%s/old/new/g</td>
<td>全文替换指定字符串</td>
</tr>
<tr>
<td>:n1,n2s/old/new/g</td>
<td>在一定范围内替换指定字符串</td>
</tr>
</tbody></table>
<h3 id="5-3-7-存和退出命令"><a href="#5-3-7-存和退出命令" class="headerlink" title="5.3.7 存和退出命令"></a>5.3.7 存和退出命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>:w</td>
<td>保存修改</td>
</tr>
<tr>
<td>:w new_filename</td>
<td>另存为指定文件</td>
</tr>
<tr>
<td>:wq</td>
<td>保存修改并退出</td>
</tr>
<tr>
<td>ZZ</td>
<td>快捷键，保存修改并退出</td>
</tr>
<tr>
<td>:q!</td>
<td>不保存修改退出</td>
</tr>
<tr>
<td>:wq!</td>
<td>保存修改并退出（文件所有者及root可使用）</td>
</tr>
</tbody></table>
<h2 id="5-4-使用技巧"><a href="#5-4-使用技巧" class="headerlink" title="5.4 使用技巧"></a>5.4 使用技巧</h2><p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9103.png" alt=""></p>
<p><strong>注：</strong></p>
<ul>
<li><code>:r 文件路径</code> 可以直接把文件导入光标所在的文件 </li>
<li>设置好的快捷键在重启之后会失效，可以在宿主目录下创建vim的配置文件，用户的家目录下，文件名字叫做<code>.vimrc</code></li>
<li>普通用户在<code>/home/username/.vimrc</code>；Root用户在 <code>/root/.vimrc</code></li>
</ul>
<h1 id="6-软件包管理"><a href="#6-软件包管理" class="headerlink" title="6 软件包管理"></a>6 软件包管理</h1><h2 id="6-1-软件包管理简介"><a href="#6-1-软件包管理简介" class="headerlink" title="6.1 软件包管理简介"></a>6.1 软件包管理简介</h2><h3 id="6-1-1-软件包分类和各自优缺点"><a href="#6-1-1-软件包分类和各自优缺点" class="headerlink" title="6.1.1 软件包分类和各自优缺点"></a>6.1.1 软件包分类和各自优缺点</h3><p>分类：</p>
<ul>
<li>源码包</li>
<li>二进制包（RPM包、系统默认包）</li>
</ul>
<p><strong>源码包</strong></p>
<p>优点：</p>
<ul>
<li>开源，如果有足够的能力，可以修改源代码</li>
<li>可以自由选择所需的功</li>
<li>能软件是编译安装，所以更加适合自己的系统，更加稳定也效率更高卸载方便</li>
<li>卸载方便</li>
</ul>
<p>缺点：</p>
<ul>
<li>安装过程步骤较多，尤其安装较大的软件集合时(如LAMP环境搭建)，容易出现拼写错误</li>
<li>编译过程时间较长，安装比二进制安装时间长</li>
<li>因为是编译安装，安装过程中一旦报错新手很难解决</li>
</ul>
<p><strong>RPM包（二进制包）</strong></p>
<p>优点：</p>
<ul>
<li>包管理系统简单，只通过几个命令就可以实现包的安装、升级、查询和卸载</li>
<li>安装速度比源码包安装快的多</li>
</ul>
<p>缺点：</p>
<ul>
<li>经过编译，不再可以看到源代码</li>
<li>功能选择不如源码包灵活</li>
<li>依赖性</li>
</ul>
<h2 id="6-2-RPM包管理"><a href="#6-2-RPM包管理" class="headerlink" title="6.2 RPM包管理"></a>6.2 RPM包管理</h2><h3 id="6-2-1-RPM命令管理"><a href="#6-2-1-RPM命令管理" class="headerlink" title="6.2.1 RPM命令管理"></a>6.2.1 RPM命令管理</h3><p>RPM包命名原则：<code>httpd-2.2.15-15.el6.centos.1.i686.rpm</code></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>httpd</td>
<td>软件包名</td>
</tr>
<tr>
<td>2.2.15</td>
<td>软件版本</td>
</tr>
<tr>
<td>15</td>
<td>软件发布的次数</td>
</tr>
<tr>
<td>el6.centos</td>
<td>适合的Linux平台</td>
</tr>
<tr>
<td>i686</td>
<td>适合的硬件平台；<code>noarch</code>或者没有写，表示适合所有的硬件平台</td>
</tr>
<tr>
<td>rpm</td>
<td>rpm包扩展名</td>
</tr>
</tbody></table>
<h3 id="6-2-2-RPM包依赖性"><a href="#6-2-2-RPM包依赖性" class="headerlink" title="6.2.2 RPM包依赖性"></a>6.2.2 RPM包依赖性</h3><p>包依赖性分为三种：</p>
<ol>
<li>树形依赖： <code>a-&gt;b-&gt;c</code>； 安装顺序是cba，卸载顺序是abc</li>
<li>环形依赖：<code>a-&gt;b-&gt;c-&gt;a</code> ；这种依赖关系的解决办法是abc一条命令同时安装</li>
<li>模块依赖： <a href="http://www.rpmfind.net/" target="_blank" rel="noopener">模块依赖查询网站</a></li>
</ol>
<p>==这种方案可以安装包，但是依赖问题很难解决，更好的方案是使用yum安装==</p>
<h3 id="6-2-3-安装升级和卸载"><a href="#6-2-3-安装升级和卸载" class="headerlink" title="6.2.3 安装升级和卸载"></a>6.2.3 安装升级和卸载</h3><h3 id="6-2-4-RPM包查询"><a href="#6-2-4-RPM包查询" class="headerlink" title="6.2.4 RPM包查询"></a>6.2.4 RPM包查询</h3><h3 id="6-2-5-检验与文件提取"><a href="#6-2-5-检验与文件提取" class="headerlink" title="6.2.5 检验与文件提取"></a>6.2.5 检验与文件提取</h3><h2 id="6-3-yum在线管理"><a href="#6-3-yum在线管理" class="headerlink" title="6.3 yum在线管理"></a>6.3 yum在线管理</h2><h3 id="6-3-1-网络yum源"><a href="#6-3-1-网络yum源" class="headerlink" title="6.3.1 网络yum源"></a>6.3.1 网络yum源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CentOS-Base.repo</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The mirror system uses the connecting IP address of the client and the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> update status of each mirror to pick mirrors that are updated to and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> geographically close to the client.  You should use this <span class="keyword">for</span> CentOS updates</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> unless you are manually picking other mirrors.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the mirrorlist= does not work <span class="keyword">for</span> you, as a fall back you can try the </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remarked out baseurl= line instead.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span><br><span class="line"><span class="meta">#</span><span class="bash">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">released updates </span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-$releasever - Updates</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra</span><br><span class="line"><span class="meta">#</span><span class="bash">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-$releasever - Extras</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra</span><br><span class="line"><span class="meta">#</span><span class="bash">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-$releasever - Plus</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra</span><br><span class="line"><span class="meta">#</span><span class="bash">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>

<p>这些容器，默认会使用base 这些默认就是配好的</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>[base]</td>
<td>容器名称，一定要放在[]中</td>
</tr>
<tr>
<td>name</td>
<td>容器说明，可以自己随便写点什么</td>
</tr>
<tr>
<td>mirrorlist</td>
<td>镜像站点，可以注释掉</td>
</tr>
<tr>
<td>baseurl</td>
<td>我们的yum源服务器的地址。默认是CentOS官方的yum源服务器，是可以使用的，如果你觉得慢可以改成你喜欢的yum源地址</td>
</tr>
<tr>
<td>enabled</td>
<td>此容器是否生效，如果不写或写成enable=1都是生效，写成enable=0就是不生效</td>
</tr>
<tr>
<td>gpgcheck</td>
<td>如果是1是指RPM的数字证书生效，如果是0则不生效</td>
</tr>
<tr>
<td>gpgkey</td>
<td>数字证书的公钥文件保存位置。不用修改</td>
</tr>
</tbody></table>
<h3 id="6-3-2-常用yum命令"><a href="#6-3-2-常用yum命令" class="headerlink" title="6.3.2 常用yum命令"></a>6.3.2 常用yum命令</h3><ol>
<li><p>查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查询所有可用软件包列表</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum list </span></span><br><span class="line">apr-devel.x86_64                         1.4.8-3.el7_4.1                @updates</span><br><span class="line">apr-util.x86_64   (软件包)                1.5.2-6.el7 (版本号)            @base (容器)   </span><br><span class="line">apr-util-devel.x86_64                    1.5.2-6.el7                    @base   </span><br><span class="line">audit.x86_64                             2.7.6-3.el7                    @base   </span><br><span class="line">audit-libs.i686                          2.7.6-3.el7                    @base   </span><br><span class="line">audit-libs.x86_64                        2.7.6-3.el7                    @base </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">搜索服务器上所有和关键字相关的包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum search 关键字</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> install 安装 -y 自动回答yes</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum –y install 包名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>升级</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum -y update 包名</span></span><br></pre></td></tr></table></figure>

<p>yum –y update 如果不加包名，就是升级linux中所有的软件包，包括linux内核等都会升级，小心。如果升级，后面请跟包名。</p>
</li>
<li><p>卸载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum -y remove 包名</span></span><br></pre></td></tr></table></figure>

<p>卸载也要慎用，卸载包a会把所有的依赖包都卸载，当然这些依赖包也可能被其他包使用，或被系统使用，这样在卸载a之后可能会出现很多问题。用什么装什么，尽量不卸载</p>
</li>
</ol>
<h3 id="6-3-3-yum软件组管理命令"><a href="#6-3-3-yum软件组管理命令" class="headerlink" title="6.3.3 yum软件组管理命令"></a>6.3.3 yum软件组管理命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出所有可用的软件组列表</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum grouplist</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装指定软件组，组名可以由grouplist查询出来</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum grouopinstall 软件组名</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载指定软件组</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum groupremove 软件组名</span></span><br></pre></td></tr></table></figure>

<p>注： 软件组名要用双引号引起来</p>
<h3 id="6-3-4-光盘yum源"><a href="#6-3-4-光盘yum源" class="headerlink" title="6.3.4 光盘yum源"></a>6.3.4 光盘yum源</h3><p>搭建步骤：</p>
<ol>
<li><p>挂载光盘</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mount /dev/cdrom /mnt/cdrom/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>让网络yum源失效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /etc/yum.repos.d/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv CentOS-Base.repo \ CentOS-Base.repo.bak</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv CentOS-Debuginfo.repo \CentOS-Debuginfo.repo.bak</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv CentOS-Vault.repo \ CentOS-V ault.repo.bak</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改光盘yum源文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim CentOS-Media.repo [c6-media]</span></span><br><span class="line">name=CentOS-$releasever - Media baseurl=file:///mnt/cdrom #地址为你自己的光盘挂载地址</span><br><span class="line"><span class="meta">#</span><span class="bash"> file:///media/cdrom/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file:///media/cdrecorder/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">注释这两个不存在的地址</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1 #把enabled=0改为enabled=1，让这个yum源配置文件生效 </span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6  # /// 第三个斜杠是根目录</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="6-3-5-源码包和rpm包的区别"><a href="#6-3-5-源码包和rpm包的区别" class="headerlink" title="6.3.5 源码包和rpm包的区别"></a>6.3.5 源码包和rpm包的区别</h3><ol>
<li><p>两者的区别在于安装之前概念上的区别（上面已讲）和安装之后安装位置不同：</p>
<p><strong>RPM包安装位置：</strong></p>
<p>是安装在默认位置中，RPM包默认安装路径是：</p>
<table>
<thead>
<tr>
<th>/etc/</th>
<th>配置文件安装目录</th>
</tr>
</thead>
<tbody><tr>
<td>/usr/bin/</td>
<td>可执行的命令安装目录</td>
</tr>
<tr>
<td>/usr/lib/</td>
<td>程序所使用的函数库保存位置</td>
</tr>
<tr>
<td>/usr/share/doc/</td>
<td>基本的软件使用手册保存位置</td>
</tr>
<tr>
<td>/usr/share/man/</td>
<td>帮助文件保存位置</td>
</tr>
</tbody></table>
<p>==所有的rpm包安装基本都遵守这个安装位置==</p>
<p><strong>源码包安装位置：</strong>安装在指定位置当中，一般是<code>/usr/local/软件名/</code></p>
</li>
<li><p>安装位置不同带来的影响</p>
<p>RPM包安装的服务可以使用系统服务管理命令(service)来管理，不需要再配置；源码包安装可以直接使用绝对路径来进行服务的管理，或者自己去配置service来管理。</p>
</li>
</ol>
<h1 id="7-用户和用户组管理"><a href="#7-用户和用户组管理" class="headerlink" title="7 用户和用户组管理"></a>7 用户和用户组管理</h1><h2 id="7-1-用户配置文件"><a href="#7-1-用户配置文件" class="headerlink" title="7.1 用户配置文件"></a>7.1 用户配置文件</h2><p>越是对服务器安全性要求高的服务器，越需要建立合理的用户权限等级制度和服务器操作规范。</p>
<p>在Linux中主要是通过用户配置文件来查看和修改用户信息。</p>
<h3 id="7-1-1-用户信息文件"><a href="#7-1-1-用户信息文件" class="headerlink" title="7.1.1 用户信息文件"></a>7.1.1 用户信息文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> more /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">redmine:x:1008:1008::/home/redmine:/bin/bash</span><br><span class="line">saslauth:x:994:76:Saslauthd user:/run/saslauthd:/sbin/nologin</span><br><span class="line">apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">postgres:x:26:26:PostgreSQL Server:/var/lib/pgsql:/bin/bash</span><br><span class="line">lisong:x:1009:1010::/home/lisong:/bin/bash</span><br><span class="line">huarong:x:1010:1011::/home/huarong:/bin/bash</span><br></pre></td></tr></table></figure>

<p><code>/etc/passwd</code>字段含义：</p>
<p>这个文件中每一行代表一个用户，而且每个字段用：分割，总共7个字段</p>
<ul>
<li>第1字段：用户名称</li>
<li>第2字段：密码标志早期的密码是直接放在这个文件中的，现在的密码放在了影子文件<code>/etc/shadow</code>，为什么这样做，是因为<code>passwd</code>文件的默认权限是<strong>644</strong>，<code>shadow</code>文件的默认权限是<strong>000</strong>，除了root用户，任何用户都不能读这个文件，增强系统的安全性； <code>x</code>表示需要密码登录，登录的时候回去<code>shadow</code>中找密码进行验证，没<code>x</code>就会认为没有密码，用户可以直接登录，这种登录只允许本机登录，远程是不允许的。</li>
<li>第3字段：UID(用户ID) <ul>
<li>0                            超级用户</li>
<li>1-499                      系统用户（伪用户） 用户不能登录，不能删除，删除系统会崩溃</li>
<li>500-65535              普通用户</li>
</ul>
</li>
<li>第4字段：GID（用户初始组ID） 每个用户创建时，就会创建出一个同名的初始组，初始组不可或缺，并且每个用户只能有一个初始组，初始组可以改，但只能是一个。初始组并不推荐更改</li>
<li>第5字段：用户说明</li>
<li>第6字段：家目录<ul>
<li>普通用户：<code>/home/用户名/</code></li>
<li>超级用户：<code>/root/</code>      </li>
</ul>
</li>
<li>第7字段：登录之后的Shell</li>
</ul>
<p><strong>注：</strong></p>
<p>初始组和附加组：</p>
<ol>
<li>初始组：    就是指用户一登录就立刻拥有这个用户组的相关权限，每个用户的初始组只能有一个，一般就是和这个用户的用户名相同的组名作为这个用户的初始组。</li>
<li>附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个。</li>
</ol>
<p>Shell是什么：</p>
<ol>
<li>Shell就是Linux的命令解释器。命令解释器：比如ls，会通过命令解释器解释传输给内核，内核再做出应答，显示在命令操作窗口。 用户想要和系统交流，都需要有这个命令解释器。</li>
<li>在<code>/etc/passwd</code>当中，除了标准Shell是<code>/bin/bash</code>之外，还可以写如<code>/sbin/nologin</code>，<code>/usr/bin/passwd</code>等。</li>
</ol>
<h3 id="7-1-2-影子文件"><a href="#7-1-2-影子文件" class="headerlink" title="7.1.2 影子文件"></a>7.1.2 影子文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> more /etc/shadow</span></span><br><span class="line">root:$6$hoha7imwDef9ruvl$7f1TuPB4.fWn7CkAHED3zbM1l3hG4UPEoTJjg2Mrz2dqjhxvCzhMX9RhXtb5y/JJTB32/7HXKcjslj0hLI6Xb1::0:99999:7:::</span><br><span class="line">bin:*:17110:0:99999:7:::</span><br><span class="line">daemon:*:17110:0:99999:7:::</span><br><span class="line">adm:*:17110:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p><code>/etc/shadow</code>字段含义：</p>
<ul>
<li>第1字段：用户名</li>
<li>第2字段：加密密码<ul>
<li>加密算法为SHA512散列加密算法。加密的默认为数是512位</li>
<li>如果密码是“!!”或“*”代表没有密码，不能登录</li>
</ul>
</li>
<li>第3字段：密码最后一次修改时间<ul>
<li>使用1970年1月1日作为标准时间，每过一天时间戳加1</li>
</ul>
</li>
<li>第4字段：两次密码的修改间隔时间（和第3字段相比）</li>
<li>第5字段:密码有效期(和第3字段相比)</li>
<li>第6字段:密码修改到期前的警告天数(和第5字段相比)</li>
<li>第7字段：密码过期后的宽限天数（和第5字段相比）<ul>
<li> 0:代表密码过期后立即失效</li>
<li> -1:则代表密码永远不会失效。</li>
</ul>
</li>
<li>第8字段:账号失效时间 要用时间戳表示</li>
<li>第9字段:保留</li>
</ul>
<p><strong>时间戳换算：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 把时间戳换算为日期</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> date -d <span class="string">"1970-01-01 16066 days"</span></span></span><br><span class="line"></span><br><span class="line"># 把日期换算为时间戳</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> $(($(date --date=<span class="string">"2014/01/06"</span> +%s)/86400+1))</span></span><br></pre></td></tr></table></figure>

<h3 id="7-1-3-组信息文件和组密码文件"><a href="#7-1-3-组信息文件和组密码文件" class="headerlink" title="7.1.3 组信息文件和组密码文件"></a>7.1.3 组信息文件和组密码文件</h3><ol>
<li><p>组信息文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> more /etc/group</span></span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:</span><br><span class="line">daemon:x:2:</span><br><span class="line">sys:x:3:</span><br><span class="line">adm:x:4:</span><br><span class="line">tty:x:5:</span><br><span class="line">disk:x:6:</span><br><span class="line">lp:x:7:</span><br><span class="line">mem:x:8:</span><br><span class="line">kmem:x:9:</span><br><span class="line">wheel:x:10:</span><br><span class="line">cdrom:x:11:</span><br><span class="line">mail:x:12:postfix</span><br></pre></td></tr></table></figure>

<p><code>/etc/group</code>字段含义：</p>
<ul>
<li>第1字段：组名</li>
<li>第2字段：组密码标志</li>
<li>第3字段：GID</li>
<li>第4字段：组中附加用户</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>组密码文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> more /etc/gshadow</span></span><br><span class="line">root:::</span><br><span class="line">bin:::bin,daemon</span><br><span class="line">daemon:::bin,adm</span><br><span class="line">adm:::adm,daemon</span><br><span class="line">tty:::</span><br><span class="line">disk:::</span><br><span class="line">lp:::daemon</span><br><span class="line">men:::</span><br><span class="line">kmen:::</span><br></pre></td></tr></table></figure>

<p><code>/etc/gshadow</code>字段含义:</p>
<ul>
<li>第1字段：组名</li>
<li>第2字段：组密码</li>
<li>第3字段：组管理员用户名</li>
<li>第4字段：组中附加用户</li>
</ul>
<p>发现所有的组都没有密码，组密码用的不多，并且不推荐使用。</p>
<p>因为设置组密码和组管理员之后，组的管理员可以通过组密码来代替root用户完成添加组用户或者删除组用户，它执行了root用户的部分权限。这样会降低系统的安全性，这些事情本来应该root来做。</p>
</li>
</ol>
<h2 id="7-2-用户管理相关文件"><a href="#7-2-用户管理相关文件" class="headerlink" title="7.2 用户管理相关文件"></a>7.2 用户管理相关文件</h2><ol>
<li><p>用户的家目录</p>
<ul>
<li><p>普通用户:/home/用户名/，所有者和所属组都是此用户，权限是700</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ll /home</span></span><br><span class="line">total 8</span><br><span class="line">drwx------. 17 demo       demo     4096 Mar 19 17:55 demo</span><br><span class="line">drwx------.  7 git        git       222 Feb 28 18:25 git</span><br></pre></td></tr></table></figure>
</li>
<li><p>超级用户:/root/，所有者和所属组都是root用户，权限是550</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ll -d /root</span></span><br><span class="line">dr-xr-x---. 12 root root 4096 Apr  3 11:49 /root</span><br></pre></td></tr></table></figure>

<p>给的是550，但是权限对root其实没有限制。添加一个用户会自动生成/home/用户名的文件夹。</p>
<p>如果把普通用户变成超级用户，修改passwd文件的用户id为0</p>
</li>
</ul>
</li>
<li><p>用户的邮箱</p>
<p>邮箱路径：<code>/var/spool/mail/用户名</code></p>
<p>添加用户时，会自动创建用户邮箱</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ll /var/spool/mail/</span></span><br><span class="line">total 9940</span><br><span class="line">-rw-rw----. 1 demo       mail        0 Aug 21  2017 demo</span><br><span class="line">-rw-rw----. 1 git        mail        0 Jun 29  2017 git</span><br><span class="line">-rw-rw----  1 huarong    mail        0 Nov 22 09:59 huarong</span><br><span class="line">-rw-rw----. 1 jie        mail        0 Jun 29  2017 jie</span><br><span class="line">-rw-rw----  1 lisong     mail        0 Oct 26 08:59 lisong</span><br><span class="line">-rw-rw----. 1 liuyinghao mail        0 Jun 29  2017 liuyinghao</span><br></pre></td></tr></table></figure>
</li>
<li><p>用户模板目录</p>
<p>用户模板目录：<code>/etc/skel/</code></p>
<p>创建出来的用户会有默认的几个文件，如下，这些文件是在创建用户时自动生成的，是自动从/etc/skel/下拷贝过来的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ls -a /home/liuyinghao/</span></span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc</span><br></pre></td></tr></table></figure>

<p>如果想要在创建用户时默认添加一个说明文件，可以把说明文件写好放在这个目录下，创建用户时会自动将这些文件生成在用户的家目录下。</p>
</li>
</ol>
<h2 id="7-3-用户管理命令"><a href="#7-3-用户管理命令" class="headerlink" title="7.3 用户管理命令"></a>7.3 用户管理命令</h2><h3 id="7-3-1-用户添加命令-useradd"><a href="#7-3-1-用户添加命令-useradd" class="headerlink" title="7.3.1 用户添加命令 useradd"></a>7.3.1 用户添加命令 useradd</h3><ol>
<li><p>命令格式：<code>useradd [选项] 用户名</code></p>
<p>选项说明：</p>
<p>​    -u UID:  手工指定用户的UID号</p>
<p>​    -d 家目录：手工指定用户的家目录</p>
<p>​    -c 用户说明：手工指定用户的说明</p>
<p>​    -g 组名：手工指定用户的初始组</p>
<p>​    -G 组名：指定用户的附加组</p>
<p>​        -s shell：手工指定用户的登录shell。默认是<code>/bin/bash</code></p>
</li>
<li><p>添加默认用户</p>
<p>使用useradd默认会写入到如下文件中信息或创建相应目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useradd lamp</span><br><span class="line"><span class="meta">#</span><span class="bash"> grep <span class="string">"lamp"</span> /etc/passwd </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> grep <span class="string">"lamp"</span> /etc/shadow </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> grep <span class="string">"lamp"</span> /etc/group</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> grep <span class="string">"lamp"</span> /etc/gshadow </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll -d /home/lamp/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll /var/spool/mail/lamp</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>指定选项添加用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd wangge</span><br><span class="line">useradd -u 550 -g wangge -G root -d /home/wangge \</span><br><span class="line">-c "test user" -s /bin/bash wangge</span><br></pre></td></tr></table></figure>

<p>上面的操作是：创建用户组<code>wangge</code>；创建用户<code>wangge</code>，并指定用户的的<code>uid</code>为550，用户初始组为<code>wangge</code>，附加组为<code>root</code>（多个附加组用户逗号隔开），用户家目录为<code>/home/wangge</code>,用户说明为”test user”，用户的<code>shell</code>为<code>/bin/bash</code></p>
</li>
<li><p>用户默认值文件</p>
<p>用户默认值文件路径：<code>/etc/default/useradd</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/etc/default/useradd  </span><br><span class="line"> GROUP=100              #用户默认组  </span><br><span class="line"> HOME=/home             #用户家目录</span><br><span class="line"> INACTIVE=-1            #密码过期宽限天数(7)</span><br><span class="line"> EXPIRE=                #密码失效时间(8)</span><br><span class="line"> SHELL=/bin/bash        #默认shell</span><br><span class="line"> SKEL=/etc/skel         #模板目录</span><br><span class="line"> CREATE_MAIL_SPOOL=yes  #是否建立邮箱</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/etc/login.defs</span><br><span class="line"> PASS_MAX_DAYS 99999     #密码有效期(5)</span><br><span class="line"> PASS_MIN_DAYS 0         #密码修改间隔(4)</span><br><span class="line"> PASS_MIN_LEN 5          #密码最小5位(PAM)</span><br><span class="line"> PASS_WARN_AGE 7         #密码到期警告(6)</span><br><span class="line"> UID_MIN 500             #最小和最大UID范围</span><br><span class="line"> GID_MAX 60000  </span><br><span class="line"> ENCRYPT_METHOD SHA512   #加密模式</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="7-3-2-修改用户密码passwd"><a href="#7-3-2-修改用户密码passwd" class="headerlink" title="7.3.2 修改用户密码passwd"></a>7.3.2 修改用户密码passwd</h3><ol>
<li><p>passwd命令格式</p>
<p>命令格式：<code>passwd [选项] 用户名</code></p>
<p>选项：</p>
<p>​    -S       查询用户密码的密码状态。仅root用户可用。看到的信息是             shadow中的信息</p>
<p>​        -l      暂时锁定用户。仅root用户可用</p>
<p>​        -u      解锁用户。仅root用户可用</p>
<p>​    -stdin       可以通过管道符输出的数据作为用户的密码。</p>
</li>
<li><p>查看密码状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">passwd -S lamp</span><br><span class="line">lamp PS 2013-01-06 0 99999 7 -1</span><br><span class="line"><span class="meta">#</span><span class="bash">用户名密码设定时间(2013-01-06) 密码修改间隔时间(0) <span class="comment">#密码有效期(99999) 警告时间(7)密码不失效(-1)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>锁定用户和解锁用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# passwd -l lamp </span><br><span class="line">[root@localhost ~]# passwd -u lamp</span><br></pre></td></tr></table></figure>

<p>锁定用户其实是给密码前加了双感叹号，用户将无法登陆。</p>
<p>手动更改添加或删除双感叹号作用是一样的，用户将被锁定。原理是密码字符串加上其他的字符，换算出来的密码肯定发生了变化，用户就无法正常登陆。</p>
</li>
<li><p>使用字符串作为用户的密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo "123" | passwd --stdin lamp</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="7-3-3-修改用户信息和修改用户密码状态"><a href="#7-3-3-修改用户信息和修改用户密码状态" class="headerlink" title="7.3.3 修改用户信息和修改用户密码状态"></a>7.3.3 修改用户信息和修改用户密码状态</h3><ol>
<li><p>修改用户信息：<code>usermod [选项] 用户名</code></p>
<p>选项说明：</p>
<p>​    -u UID：                修改用户的UID号</p>
<p>​    -c 用户说明:            修改用户的说明信息</p>
<p>​    -G 组名:                修改用户的附加组</p>
<p>​    -L:                    临时锁定用户(Lock)</p>
<p>​    -U:                    解锁用户锁定(Unlock)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">修改用户的说明</span></span><br><span class="line">[root@localhost ~]# usermod -c "test user" lamp</span><br><span class="line"><span class="meta">#</span><span class="bash">把lamp用户加入root组</span></span><br><span class="line">[root@localhost ~]# usermod -G root lamp </span><br><span class="line"><span class="meta">#</span><span class="bash">锁定用户</span></span><br><span class="line">[root@localhost ~]# usermod -L lamp </span><br><span class="line"><span class="meta">#</span><span class="bash">解锁用户</span></span><br><span class="line">[root@localhost ~]# usermod -U lamp</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改用户密码状态：<code>chage [选项] 用户名</code></p>
<p>选项：</p>
<p>​    -l: 列出用户的详细密码状态</p>
<p>​    -d 日期: 修改密码最后一次更改日期(shadow3字段)</p>
<p>​    -m 天数: 两次密码修改间隔(4字段)</p>
<p>​    -M 天数: 密码有效期(5字段)</p>
<p>​    -W 天数: 密码过期前警告天数(6字段)</p>
<p>​    -I 天数: 密码过后宽限天数(7字段)</p>
<p>​    -E日期: 账号失效时间(8字段)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这个命令其实是把密码修改日期归0了(shadow第3字段),这样用户一登陆就要修改密码</span></span><br><span class="line">change -d 0 test</span><br></pre></td></tr></table></figure>

<p>这些就是shadow中的信息，其实手工修改shadow文件远要比使用这个命令去修改方便</p>
</li>
</ol>
<h3 id="7-3-4-删除用户"><a href="#7-3-4-删除用户" class="headerlink" title="7.3.4 删除用户"></a>7.3.4 删除用户</h3><p>删除用户：<code>userdel [-r] 用户名</code></p>
<p>选项：</p>
<p>​    -r    删除用户的同时删除用户家目录</p>
<p>手工删除用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/passwd</span><br><span class="line">vi /etc/shadow</span><br><span class="line">vi /etc/group</span><br><span class="line">vi /etc/gshadow</span><br><span class="line">rm -rf /var/spool/mail/lamp rm -rf /home/lamp/</span><br></pre></td></tr></table></figure>

<p>查看用户ID</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> id 用户名</span></span><br></pre></td></tr></table></figure>

<h3 id="7-3-5-切换用户身份su"><a href="#7-3-5-切换用户身份su" class="headerlink" title="7.3.5 切换用户身份su"></a>7.3.5 切换用户身份su</h3><p>语法：<code>su [选项] 用户名</code></p>
<p>选项：</p>
<p>​    - ： 选项只使用“-”代表连带用户的环境变量一起切换</p>
<p>​        -c 命令：仅执行一次命令，而不切换用户身份</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">切换成root</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su – root</span></span><br><span class="line"><span class="meta">#</span><span class="bash">不切换成root，但是执行useradd命令添加user1用户</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su - root -c <span class="string">"useradd user3"</span></span></span><br></pre></td></tr></table></figure>

<p>使用su和sudo是有区别的，使用su切换用户需要输入所切换到的用户的密码，而使用sudo则是当前用户的密码。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/Linux/%E5%B0%8F%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/Linux/%E5%B0%8F%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">小视频笔记（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-30 15:27:10" itemprop="dateCreated datePublished" datetime="2018-03-30T15:27:10+08:00">2018-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="小视频笔记（一）"><a href="#小视频笔记（一）" class="headerlink" title="小视频笔记（一）"></a>小视频笔记（一）</h1><p>看的小视频，好早以前的，了解下Linux基础。</p>
<h1 id="1-Linux系统简介"><a href="#1-Linux系统简介" class="headerlink" title="1.Linux系统简介"></a>1.Linux系统简介</h1><h2 id="1-1-1-UNIX发展历史和发行版本"><a href="#1-1-1-UNIX发展历史和发行版本" class="headerlink" title="1.1.1 UNIX发展历史和发行版本"></a>1.1.1 UNIX发展历史和发行版本</h2><p><strong>历史简介:</strong></p>
<ul>
<li>1965 年，美国麻省理工学院（ MIT ）、通用电气公司（ GE ）及 AT &amp; T 的贝尔实验室联合开发 Multies 工程计划，其目标是开发一种交互式的具有多道程序处理能力的分时操作系统，但因 MulticS 追求的目标过于庞大复杂，项目进度远远落后于计划，最后贝尔实验室宣布退出。</li>
<li>1969 年，美国贝尔实验室的肯 · 汤普森在 DEC PDP 一 7 机器上开发出了 UNIX 系统。</li>
<li>1971年，肯·汤普森的同事丹尼斯·里发明了C语言；1973年，UNIX系统的绝大部分源代码用C语言重写，这为提高UNIX系统的可移植性打下基础。</li>
</ul>
<p><strong>发行版本：</strong></p>
<table>
<thead>
<tr>
<th>操作系统</th>
<th>公司</th>
<th>硬件平台</th>
</tr>
</thead>
<tbody><tr>
<td>AIX</td>
<td>IBM</td>
<td>PowerPC</td>
</tr>
<tr>
<td>HP-UX</td>
<td>HP</td>
<td>PA-RISC</td>
</tr>
<tr>
<td>Solaris</td>
<td>Sun</td>
<td>SPARC</td>
</tr>
<tr>
<td>Linux</td>
<td>Red HAt、Ubuntu…</td>
<td>IA(Intel、ADM…)</td>
</tr>
</tbody></table>
<h2 id="1-1-2-Linux发展历史和发行版本"><a href="#1-1-2-Linux发展历史和发行版本" class="headerlink" title="1.1.2 Linux发展历史和发行版本"></a>1.1.2 Linux发展历史和发行版本</h2><p>​    Linux系统诞生于1991年，由芬兰大学生李纳斯（LinusTorvalds)和后来陆续加入的众多爱好者共同开发完成。<br>Linux是开源软件，源代码开放的UNIX。</p>
<ul>
<li>Linux内核官网：<a href="http://www.kernel.org" target="_blank" rel="noopener">www.kernel.org</a></li>
</ul>
<ul>
<li>Linux主要发行版本：RedHat、CentOS、SuSE、fedora、gentoo linux、Mandriva、turbolinux、红旗、 debian、ubuntu、KNOPPIX</li>
</ul>
<h1 id="2-Linux系统安装"><a href="#2-Linux系统安装" class="headerlink" title="2.Linux系统安装"></a>2.Linux系统安装</h1><h2 id="2-1-VMware虚拟机安装与使用"><a href="#2-1-VMware虚拟机安装与使用" class="headerlink" title="2.1 VMware虚拟机安装与使用"></a>2.1 VMware虚拟机安装与使用</h2><p>VMware是一个虚拟PC的软件，可以在现有的操作系统上虚拟出一个新的硬件环境，相当于模拟出一台新的PC，以此来实现在一台机器上真正同时运行两个独立的操作系统。</p>
<blockquote>
<p>VMware官方网站 <a href="http://www.vmware.com" target="_blank" rel="noopener">http://www.vmware.com</a></p>
</blockquote>
<p>VMware主要特点：</p>
<ul>
<li>不需要分区或重新开机就能在同一台PC上使用两种以上的操作系统</li>
<li>本机系统可以与虚拟机系统网络通信</li>
<li>可以设定并且随时修改虚拟机操作系统的硬件环境</li>
</ul>
<p>VMware建议配置：</p>
<ul>
<li>CPU：建议主频1GHz以上</li>
<li>内存：建议1GB以上</li>
<li>硬盘：建议分区空闲空间8GB以上</li>
</ul>
<h2 id="2-2-安装"><a href="#2-2-安装" class="headerlink" title="2.2 安装"></a>2.2 安装</h2><p>安装欢迎界面</p>
<ul>
<li>Install or upgrade an existing system : 安装或升级现有系统</li>
<li>Install system with basic video driver: 安装过程采用基本的显卡驱动</li>
<li>Resuce install system : 进入系统修复模式</li>
<li>Boot from local deive : 退出安装从硬盘启动</li>
<li>Memory test ：存储介质检测</li>
</ul>
<p>软件包选择</p>
<ul>
<li>Desktop(桌面)</li>
<li>Minimal Desktop(最小化桌面)</li>
<li>Minimal(最小化)</li>
<li>Basic Server(基本服务器)</li>
<li>Database Server (数据库服务器)</li>
<li>Web Server(网页服务器)</li>
<li>Virtual Host(虚拟主机)</li>
<li>software development workstation(软件开发工作站) </li>
</ul>
<p>安装日志</p>
<ul>
<li>/root/install.log : 存储了安装在系统中的软件包及其版本信息</li>
<li>/root/install.log.syslog : 存储了安装过程中留下的事件记录</li>
<li>/root/anaconda-ks.cfg : 以Kickstart配置文件的格式记录安装过程中设置的选项信息</li>
</ul>
<h1 id="3-初学建议"><a href="#3-初学建议" class="headerlink" title="3.初学建议"></a>3.初学建议</h1><h2 id="3-1-注意事项"><a href="#3-1-注意事项" class="headerlink" title="3.1 注意事项"></a>3.1 注意事项</h2><ol>
<li>Linux严格区分大小写</li>
</ol>
<ol start="2">
<li>Linux中所有内容以文件形式保存，包括硬件<ul>
<li>硬盘文件是/dev/sd[a-p]</li>
<li>光盘文件是/dev/srO等</li>
</ul>
</li>
</ol>
<h2 id="3-2-Linux各目录的作用"><a href="#3-2-Linux各目录的作用" class="headerlink" title="3.2 Linux各目录的作用"></a>3.2 Linux各目录的作用</h2><p>在终端运行<code>ls /</code>可看到如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mcee@mcee ~]$ ls /</span><br><span class="line">bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  etc  lib   media  opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>

<p>###树状目录结构：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.jpg" alt=""></p>
<h3 id="树状目录结构解释："><a href="#树状目录结构解释：" class="headerlink" title="树状目录结构解释："></a>树状目录结构解释：</h3><ul>
<li><p><strong>/bin</strong>/</p>
<ul>
<li>bin是Binary的缩写, 这个目录存放着最经常使用的命令。</li>
<li>存放系统命令的目录，普通用户和超级用户都可以执行。不过，放在/bin下的命令在单用户模式下也可以执行。</li>
</ul>
</li>
<li><p><strong>/sbin/</strong></p>
<ul>
<li>s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。</li>
<li>保存和系统环境设置相关的命令，只有超级用户可以使用这些命令进行系统环境设置，但是有些命令可以允许普通用户查看。</li>
</ul>
</li>
<li><p><strong>/usr/bin/</strong></p>
<ul>
<li>系统用户使用的应用程序。</li>
<li>存放系统命令目录，普通用户和超级用户都可以执行。这些命令和系统启动无关，在单用户模式下不能执行。</li>
</ul>
</li>
<li><p><strong>/usr/sbin/</strong></p>
<ul>
<li>超级用户使用的比较高级的管理程序和系统守护程序。</li>
<li>存放根文件系统不必要的系统管理命令，例如多数服务程序。只有超级用户可以使用。大家其实可以注意到Linux的系统，在所有“sbin” 目录中保存的命令只有超级用户可以使用，“bin”目录中保存的命令所有用户都可以使用。</li>
</ul>
</li>
<li><p><strong>/boot/</strong></p>
<ul>
<li>这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。</li>
<li>系统启动目录，保存系统启动相关的文件，如内核文件和启动引导程序（grub）文件等。</li>
</ul>
</li>
<li><p><strong>/dev/</strong></p>
<ul>
<li>dev是Device(设备)的缩写, 该目录下存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。</li>
<li>设备文件保存位置。Linux中所有内容以文件方式保存，包括硬件。这个目录就是用来保存所有硬件设备文件的。</li>
</ul>
</li>
<li><p><strong>/etc/</strong></p>
<ul>
<li>这个目录用来存放所有的系统管理所需要的配置文件和子目录。</li>
<li>配置文件保存位置。系统内所有采用默认安装方式（rpm安装）的服务的配置文件都保存在这个目录中，如用户账户和密码、服务的启动脚本、常用服务的配置文件等。</li>
</ul>
</li>
<li><p><strong>/home/</strong></p>
<ul>
<li>用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。</li>
<li>普通用户的家目录。建立每个用户时，每个用户要有一个默认登录位置，这个位置就是用户的家目录，所有普通用户的家目录就是在/home下建立一个和用户名相同的目录。</li>
</ul>
</li>
<li><p><strong>/lib/</strong></p>
<ul>
<li>这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。</li>
<li>系统调用的函数库保存位置</li>
</ul>
</li>
<li><p><strong>/lost+found/</strong></p>
<ul>
<li>这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</li>
<li>当系统意外崩溃或机器意外关机，而产生一些文件碎片放在这里。当系统启动的过程中fsck工具会检查这里，并修复已经损坏的文件系统。这个目录只在每个分区中出现，例如/lost+found就是根分区的备份回复目录；/bootlost+found就是/boot分区的备份恢复目录</li>
</ul>
</li>
<li><p><strong>/media/</strong></p>
<ul>
<li>linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。</li>
<li>挂载目录。系统建议用户挂载媒体设备的，例如软盘和光盘</li>
</ul>
</li>
<li><p><strong>/mnt/</strong></p>
<ul>
<li>系统提供该目录是为了让用户临时挂载别的文件系统的，可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</li>
<li>挂载目录。早起Linux中只有这一个挂载目录，并没有细分。现在这个目录系统建议挂载额外设备，如U盘，移动硬盘和其他操作系统的分区</li>
</ul>
</li>
<li><p><strong>/misc/</strong></p>
<ul>
<li>挂载目录。系统建议用来挂载NFS服务的共享目录。</li>
</ul>
</li>
<li><p><strong>/opt/</strong></p>
<ul>
<li>这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</li>
<li>第三方安装的软件保存位置。这个目录就是放置和安装其他软件的位置，手工安装的源码包软件都可以安装在这个目录中。</li>
<li>安装在/usr/local/中挺好的，可以不安装在这里，习惯问题</li>
</ul>
</li>
<li><p><strong>/proc/</strong> </p>
<ul>
<li><p>这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure>
</li>
<li><p>虚拟文件系统。该目录中的数据并不保存在硬盘中，而是保存到内存中。主要保存系统的内核、进程、外部设备状态和网络状态灯。如/proc/cpuinfo是保存CPU信息的、/proc/devices是保存设备驱动的列表的、/proc/filesystems是保存文件系统列表的、/proc/net/是保存网络协议信息的</p>
</li>
</ul>
</li>
<li><p><strong>/sys/</strong></p>
<ul>
<li>虚拟文件系统。和/proc目录相似，都是保存在内存当中的，主要是保存内核相关信息的</li>
</ul>
</li>
<li><p><strong>/root/</strong></p>
<ul>
<li>该目录为系统管理员，也称作超级权限者的用户主目录。</li>
</ul>
</li>
<li><p><strong>/srv/</strong></p>
<ul>
<li>该目录存放一些服务启动之后需要提取的数据。</li>
<li>服务数据目录。一些系统服务启动之后，可以在这个目录中保存所需要的数据</li>
</ul>
</li>
<li><p><strong>/tmp/</strong></p>
<ul>
<li>这个目录是用来存放一些临时文件的。</li>
<li>临时目录。系统存放临时文件的目录，该目录下所有用户都可以访问和写入。</li>
</ul>
</li>
<li><p><strong>/usr/</strong></p>
<ul>
<li>这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</li>
<li>系统软件资源目录。是“Unix Software Resource”的缩写，所以存放系统软件资源的目录。系统中安装的软件大多数保存在这里。</li>
</ul>
</li>
<li><p><strong>/usr/src</strong></p>
<ul>
<li>内核源代码默认的放置目录</li>
</ul>
</li>
<li><p><strong>/var/</strong></p>
<ul>
<li>动态数据保存位置。主要保存缓存、日志以及软件运行所产生的文件。</li>
</ul>
</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>​    在linux系统中，有几个目录是比较重要的，平时需要注意不要误删除或者随意更改内部文件。</p>
<p><code>/etc</code>： 上边也提到了，这个是系统中的配置文件，如果你更改了该目录下的某个文件可能会导致系统不能启动。</p>
<p><code>/bin, /sbin, /usr/bin, /usr/sbin</code>: 这是系统预设的执行文件的放置目录，比如 ls 就是在/bin/ls 目录下的。</p>
<p>值得提出的是，/bin, /usr/bin 是给系统用户使用的指令（除root外的通用户），而/sbin, /usr/sbin 则是给root使用的指令。</p>
<p><code>/var</code>： 这是一个非常重要的目录，系统上跑了很多程序，那么每个程序都会有相应的日志产生，而这些日志就被记录到这个目录下，具体在/var/log 目录下，另外mail的预设放置也是在这里。</p>
<h2 id="3-3-服务器注意事项"><a href="#3-3-服务器注意事项" class="headerlink" title="3.3 服务器注意事项"></a>3.3 服务器注意事项</h2><ol>
<li>远程服务器不允许关机，只能重启</li>
<li>重启时应该关闭服务</li>
<li>不要在服务器访问高峰运行高负载命令</li>
<li>重启时应该关闭服务</li>
<li>制定合理的密码规范并定期更新</li>
<li>合理分配权限</li>
<li>定期备份重要数据和日志</li>
</ol>
<h1 id="4-常用命令"><a href="#4-常用命令" class="headerlink" title="4.常用命令"></a>4.常用命令</h1><h2 id="4-0-命令格式与目录处理命令ls"><a href="#4-0-命令格式与目录处理命令ls" class="headerlink" title="4.0 命令格式与目录处理命令ls"></a>4.0 命令格式与目录处理命令ls</h2><p>*<em>命令格式: *</em>  命令 -选项  [参数]</p>
<p>​    例:ls -la /etc</p>
<p><strong>说明:</strong></p>
<pre><code>1. 个别命令使用不遵循此格式
 2. 当有多个选项时，可以写在一起
  3. 简化选项与完整选项-a 等于 --all</code></pre><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>ls</td>
</tr>
<tr>
<td>原意</td>
<td>list</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/ls</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示目录文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>ls 选项 [-aldih] [文件或目录]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong>    </p>
<p>​    -a 显示所有文件，包括隐藏文件</p>
<p>​    -l 详细信息显示</p>
<p>​    -d 查看目录属性</p>
<p>​        -i  选项是查看文件的i节点，系统中每个文件都有自己唯一的i节点犹如每个人的身份证号 </p>
<p>​    -h 选项是人性化显示信息</p>
<p><strong>ls打印文件含义：</strong></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E5%B0%8F%E8%A7%86%E9%A2%9101.png" alt=""></p>
<p><code>-rw-r--r—</code>含义：</p>
<ul>
<li>第一个<code>-</code> 文件类型(<code>-</code> 文件 <code>d</code> 目录 <code>l</code> 软链接文件)，然后每三个为一组<code>rw- r-- r—</code>分别表示u所有者  g所属组  o其他人的权限，r读 w写 x执行；<ul>
<li>之后的含义依次是： 文件计数、所有者、所属组、文件大小、文件最后修改时间、文件名    </li>
</ul>
</li>
</ul>
<h2 id="4-1-文件处理命令"><a href="#4-1-文件处理命令" class="headerlink" title="4.1 文件处理命令"></a>4.1 文件处理命令</h2><h3 id="4-1-1-目录处理命令"><a href="#4-1-1-目录处理命令" class="headerlink" title="4.1.1 目录处理命令"></a>4.1.1 目录处理命令</h3><h4 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>mkdir</td>
</tr>
<tr>
<td>原意</td>
<td>make directories</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/mkdir</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>创建新目录</td>
</tr>
<tr>
<td>语法</td>
<td><code>mkdir -p [目录名]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -p 递归创建</p>
<p>范例: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p /tmp/Japan/boduo</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir /tmp/Japan/longze /tmp/Japan/cangjing</span></span><br></pre></td></tr></table></figure>

<h4 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>cd</td>
</tr>
<tr>
<td>原意</td>
<td>change directory</td>
</tr>
<tr>
<td>所在路径</td>
<td>shell内置命令</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>切换目录</td>
</tr>
<tr>
<td>语法</td>
<td><code>cd [目录名]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /tmp/Japan/boduo 切换到指定目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> .. 回到上一级目录</span></span><br></pre></td></tr></table></figure>

<h4 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>pwd</td>
</tr>
<tr>
<td>原意</td>
<td>print working directory</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/pwd</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示当前目录</td>
</tr>
<tr>
<td>语法</td>
<td><code>pwd</code></td>
</tr>
</tbody></table>
<h4 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>rmdir</td>
</tr>
<tr>
<td>原意</td>
<td>remove empty directory</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/rmdir</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>删除空目录</td>
</tr>
<tr>
<td>语法</td>
<td><code>rmdir [目录名]</code></td>
</tr>
</tbody></table>
<p>范例： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rmdir /tmp/Japan/boduo</span></span><br></pre></td></tr></table></figure>

<h4 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>cp</td>
</tr>
<tr>
<td>原意</td>
<td>copy</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/cp</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>复制文件或目录</td>
</tr>
<tr>
<td>语法</td>
<td><code>cp -rp [原文件或目录][目标目录]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong>    </p>
<p>​    -r 复制目录</p>
<p>​    -p 保留文件属性</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将目录/tmp/Japan/cangjing复制到目录/root下</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp -r /tmp/Japan/cangjing /root</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将/tmp/Japan目录下的boduo和longze目录复制到 /root下，保持目录属性</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp -rp /tmp/Japan/boduo /tmp/Japan/longze /root</span></span><br></pre></td></tr></table></figure>

<h4 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>mv</td>
</tr>
<tr>
<td>原意</td>
<td>move</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/mv</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>剪切文件、改名</td>
</tr>
<tr>
<td>语法</td>
<td><code>mv [原文件或目录][目标目录]</code></td>
</tr>
</tbody></table>
<h4 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>rm</td>
</tr>
<tr>
<td>原意</td>
<td>remove</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/rm</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>剪切文件、改名</td>
</tr>
<tr>
<td>语法</td>
<td><code>mv -rf [文件或目录]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong>    </p>
<p>​    -r 删除目录</p>
<p>​    -f 强制执行</p>
<p>范例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">删除文件/tmp/yum.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rm /tmp/yum.log</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除目录/tmp/Japan/longze</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rm -rf /tmp/Japan/longze</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-2文件处理命令"><a href="#4-1-2文件处理命令" class="headerlink" title="4.1.2文件处理命令"></a>4.1.2文件处理命令</h3><h4 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>touch</td>
</tr>
<tr>
<td>原意</td>
<td>touch</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/touch</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>创建空文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>touch [文件名]</code></td>
</tr>
</tbody></table>
<p>范例: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> touch Japanlovestory.list</span></span><br></pre></td></tr></table></figure>

<h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>cat</td>
</tr>
<tr>
<td>原意</td>
<td>concatenate</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/cat</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示文件内容</td>
</tr>
<tr>
<td>语法</td>
<td><code>cat [文件名]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong>    </p>
<p>​    -n 显示行号</p>
<h4 id="tac"><a href="#tac" class="headerlink" title="tac"></a>tac</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>tac</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/tac</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示文件内容（反向列式）</td>
</tr>
<tr>
<td>语法</td>
<td><code>tac [文件名]</code></td>
</tr>
</tbody></table>
<h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>more</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/more</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>分页显示文件内容</td>
</tr>
<tr>
<td>语法</td>
<td><code>more [文件名]</code>      （空格）或f翻页，（enter）换行 q或Q退出</td>
</tr>
</tbody></table>
<h4 id="less"><a href="#less" class="headerlink" title="less"></a>less</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>less</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/less</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>分页显示文件内容（可向上翻页）</td>
</tr>
<tr>
<td>语法</td>
<td><code>less [文件名]</code></td>
</tr>
</tbody></table>
<p>使用“/”+搜索的关键词可以把所查看的文件中的关键字变为高亮 按“n”(next)可以继续向下看</p>
<h4 id="head"><a href="#head" class="headerlink" title="head"></a>head</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>head</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/head</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示文件前面几行</td>
</tr>
<tr>
<td>语法</td>
<td><code>head [文件名]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong>    </p>
<p>​    -n 指定显示行数    不加-n 参数默认显示10行</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> head -n 20 /etc/services</span></span><br></pre></td></tr></table></figure>

<h4 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>tail</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/tail</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示文件后面几行</td>
</tr>
<tr>
<td>语法</td>
<td><code>tail [文件名]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -n 指定行数</p>
<p>​        -f 动态显示文件末尾内容</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tail -n 18 /etc/services</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-3-链接命令"><a href="#4-1-3-链接命令" class="headerlink" title="4.1.3 链接命令"></a>4.1.3 链接命令</h3><h4 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>ln</td>
</tr>
<tr>
<td>原意</td>
<td>link</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/ln</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>生成链接文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>ln -s [原文件][目标文件]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -s 创建软链接</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建文件/etc/issue的软链接/tmp/issue.soft</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /etc/issue /tmp/issue.soft</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建文件/etc/issue的硬链接/tmp/issue.hard</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln /etc/issue /tmp/issue.hard</span></span><br></pre></td></tr></table></figure>

<p>软链接特征：        </p>
<p>​    类似Windows快捷方式</p>
<ul>
<li>lrwxrwxrwx l 软链接     软链接文件权限都为rwxrwxrwx</li>
<li>文件大小<code>-</code>只是符号链接</li>
<li>/tmp/issue.soft -&gt; /etc/issue    箭头指向原文件</li>
</ul>
<p>硬链接特征：</p>
<ul>
<li>拷贝cp -p + 同步更新    echo “this is a test” &gt;&gt; /etc/motd</li>
<li>可通过i节点识别</li>
<li>不能跨分区</li>
<li>不能针对目录使用</li>
</ul>
<h2 id="4-2-权限管理命令"><a href="#4-2-权限管理命令" class="headerlink" title="4.2 权限管理命令"></a>4.2 权限管理命令</h2><h3 id="4-2-1-权限管理命令：chmod"><a href="#4-2-1-权限管理命令：chmod" class="headerlink" title="4.2.1 权限管理命令：chmod"></a>4.2.1 权限管理命令：chmod</h3><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>chmod</td>
</tr>
<tr>
<td>原意</td>
<td>change the permissions mode of a file</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/chmod</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>改变文件或目录权限</td>
</tr>
<tr>
<td>语法</td>
<td><code>chmod [{ugoa}{+-=}{rwx}][文件或目录][mode=421][文件或目录]</code>   -R 递归修改</td>
</tr>
</tbody></table>
<p>权限的数字表示：<code>r --- 4 w --- 2 x --- 1</code></p>
<p>范例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 赋予文件testfile所属组写权限</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod g+w testfile</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改目录testfile及其目录下文件为所有用户具有全部权限</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod -R 777 testdir</span></span><br></pre></td></tr></table></figure>

<p>删除一个文件，并不是看是否对这个文件具有写权限，而是对这个文件所在的目录具有写的权限，对文件具有写权限只是可以修改这个文件。</p>
<h3 id="4-2-2-其他权限管理命令"><a href="#4-2-2-其他权限管理命令" class="headerlink" title="4.2.2 其他权限管理命令"></a>4.2.2 其他权限管理命令</h3><h4 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>chown</td>
</tr>
<tr>
<td>原意</td>
<td>change file ownership</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/chown</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>改变文件或目录的所有者</td>
</tr>
<tr>
<td>语法</td>
<td><code>chown [用户] [文件或目录]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 改变文件xiaoding的所有者为wangege</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chown wangge xiaoding</span></span><br></pre></td></tr></table></figure>

<h4 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>chgrp</td>
</tr>
<tr>
<td>原意</td>
<td>change file group ownership</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/chgrp</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>改变文件或目录的所属组</td>
</tr>
<tr>
<td>语法</td>
<td><code>chgrp [用户组][文件或目录]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 改变文件xiaoding的所属组为wangege</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chown wangge xiaoding</span></span><br></pre></td></tr></table></figure>

<h4 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h4><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>umask</td>
</tr>
<tr>
<td>原意</td>
<td>the user file-certain mask</td>
</tr>
<tr>
<td>所在路径</td>
<td>shell内置命令</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示、设置文件的缺省权限</td>
</tr>
<tr>
<td>语法</td>
<td><code>umask [-S]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -S 以rwx形式显示新建文件缺省权限</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建文件的默认权限是</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">umask</span> -S</span></span><br><span class="line">u=rwx,g=rx,o=rx</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Linux中默认新建的文件不具有可执行权限x，任何创建的文件，都会把可执行权限去掉；文件夹具有x。比如常见的病毒都是具有可执行权限的，如果不具有可执行权限，那么也就没什么意义了，在linux系统中，为了安全起见，默认创建的文件都不具有可执行权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir <span class="built_in">test</span></span></span><br><span class="line">andyliudeMBP:tmp andy$ ls -ld test</span><br><span class="line">drwxr-xr-x  2 andy  wheel  68  3 30 16:47 test</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> touch test.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -ld test.txt </span></span><br><span class="line">-rw-r--r--  1 andy  wheel  0  3 30 16:48 test.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接执行umask得到0022 第一个0代表特殊权限，后面会介绍，再后面的022代表正常的权限，所有者、所属组和其他人的。这个权限很奇怪，写出来是—-w–w-，但是其实不是这样的；第一个0表示特殊权限 后三位022叫做权限掩码值，777-022 =755是真正的权限即 <code>rwxr-xr-x</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">umask</span></span></span><br><span class="line">0022</span><br></pre></td></tr></table></figure>
</li>
<li><p>更改缺省权限：如更改为rwxr-xr—对应的值位754  权限掩码值位777-754即023，直接执行 umask 023 即可更改权限；可以修改，但并不建议这样修改，使用系统默认的755比较好</p>
</li>
</ul>
<h2 id="4-3-文件搜索命令"><a href="#4-3-文件搜索命令" class="headerlink" title="4.3 文件搜索命令"></a>4.3 文件搜索命令</h2><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>find</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/find</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>文件搜索</td>
</tr>
<tr>
<td>语法</td>
<td><code>find [搜索范围][匹配条件]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<ol>
<li><p>根据文件名查找</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在目录/etc中查找文件init </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /etc -name init</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索名字中有init的</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /etc -name *init*</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所有以init开头并且结尾有三个字母的文件</span></span><br><span class="line">find /etc -name init???</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> *匹配所有字符 ？匹配单个字符</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -iname 不区分大小写</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /etc -iname init</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在根目录下查找所有者为shenchao的文件 -group 根据所属组查找</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /home -user shenchao</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在/etc下查找5分钟内被修改过属性的文件和目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-amin 访问时间 access -cmin 文件属性 change -mmin 文件内容 modify</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /etc -cmin -5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据文件大小查找</p>
<p>  Linux中数据的大小是数据块，一个数据块的大小是512字节即0.5K，那么100M的大小在linux中表示就是100M=102400KB=204800</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在根目录下查找大于100MB的文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +n 大于 -n小于 n等于</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find / -size +204800</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在/etc下查找大于80MB小于100MB的文件 -a 两个条件同时满足 -o 两个条件满足任意一个即可</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /etc -size +163840 -a -size -204800</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据文件类型查找和根据i节点查找</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> f 文件 d 目录 l 软链接文件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -inum 根据i节点查找</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对操作结果执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在/etc下查找inittab文件并显示其详细信息 -<span class="built_in">exec</span>/-ok 命令 &#123;&#125; \; 对搜索结果执行操作</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> find /etc -name inittab -<span class="built_in">exec</span> ls -l &#123;&#125; \;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>注：</p>
<ul>
<li>exec和ok的区别在于ok会询问是否；“{}”表示find查找的结果，“\”表示转义符，“；”表示结束，不要忘记加分号</li>
<li>find /etc -name init* -a -type f -exec ls -l {} ; 查找etc目录下以init开头并且类型为文件的数据，然后执行显示出来  exec后面可以做其他操作命令</li>
<li>find /tmp -name haha.txt -exec cp -rp {} /tmp ;  找到文件并移动到目标目录 。“{}”代表已经找到的东西。</li>
</ul>
<h3 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>locate</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/locate</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>在文件资料库中查找文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>find [搜索范围][匹配条件]</code></td>
</tr>
</tbody></table>
<p>可以使用<code>locate loacte</code>查找本身，其资料库在</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> locate locate </span></span><br><span class="line">/var/lib/mlocate/mlocate.db</span><br></pre></td></tr></table></figure>

<p>由于是在资料库中查找文件，有些文件可能找不到，因为没有更新到资料库。测试在、tmp下创建文件locatetest.txt，这时可以使用updatedb手动更新（升级）资料库，使用之后还是找不到locatetest.txt，因为这个文件是存放在tmp目录下，找不到。</p>
<p>locate找到的 文件是区分大小写的，加“-i”可以不区分大小写。</p>
<h3 id="which"><a href="#which" class="headerlink" title="which"></a>which</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>which</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/which</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>搜索命令所在目录及别名信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>which 命令</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">which</span> rm </span></span><br><span class="line">alias rm = 'rm -i'</span><br><span class="line">	/bin/rm</span><br></pre></td></tr></table></figure>

<p>其实在linux中操作文件是没有确认机制的，之所以有，是因为使用命令的时候，是使用的别名，会先去寻找真正的命令，真正的命令中有“-i”选项。</p>
<h3 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>whereis</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/whereis</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>搜索命令所在目录及帮助文档路径</td>
</tr>
<tr>
<td>语法</td>
<td><code>whereis [命令名称]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> whereis ls</span></span><br><span class="line">ls: /usr/bin/ls /usr/share/man/man1/ls.1.gz</span><br></pre></td></tr></table></figure>

<h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>grep</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/grep</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>在文件中搜寻字串匹配的行并输出</td>
</tr>
<tr>
<td>语法</td>
<td><code>grep -iv [指定字串][文件]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -i 不区分大小写</p>
<p>​    -v 排除指定字串</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep base admin.php </span><br><span class="line">require './thinkphp/base.php';</span><br></pre></td></tr></table></figure>

<h2 id="4-4-帮助命令"><a href="#4-4-帮助命令" class="headerlink" title="4.4 帮助命令"></a>4.4 帮助命令</h2><h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>man</td>
</tr>
<tr>
<td>原意</td>
<td>manual</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/man</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>获取帮助信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>man [命令或配置文件]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看ls命令的帮助信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> man ls</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看配置文件services的帮助信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> man services</span></span><br></pre></td></tr></table></figure>

<p>注: info(information)命令与man大同小异，都可使用。</p>
<ul>
<li><p>查看配置文件，不需要加绝对路径</p>
</li>
<li><p>Linux中，查看帮助信息，帮助类型有很多种，一般情况下<code>1</code>是命令的帮助，<code>5</code>是配置文件的帮互助。</p>
</li>
<li><p>查看帮助信息，例如查看<code>passwd</code>，有两个帮助信息，<code>1</code>和<code>5</code>，系统默认查看的是<code>1</code>，如果需要查看<code>5</code>，可自行声明</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> whereis passwd</span></span><br><span class="line">passwd: /usr/bin/passwd /etc/passwd /usr/share/man/man1/passwd.1.gz /usr/share/man/man5/passwd.5.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> man passwd</span></span><br><span class="line">PASSWD(1)                       User utilities                       PASSWD(1)</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">       passwd - update user's authentication tokens</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       passwd  [-k]  [-l]  [-u  [-f]]  [-d] [-e] [-n mindays] [-x maxdays] [-w</span><br><span class="line">       warndays] [-i inactivedays] [-S] [--stdin] [username]</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       The passwd utility is used to update user's authentication token(s).</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看5的</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> man 5 passwd</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="whatis"><a href="#whatis" class="headerlink" title="whatis"></a>whatis</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>whatis</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/whatis</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>获取简短帮助信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>whatis [命令]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> whatis ls</span></span><br><span class="line">	ls (1)               - list directory contents</span><br><span class="line"><span class="meta">$</span><span class="bash"> whatis mv</span></span><br><span class="line">	mv (1)               - move (rename) files</span><br><span class="line"><span class="meta">$</span><span class="bash"> whatis ifconfig</span></span><br><span class="line">	ifconfig (8)         - configure a network interface</span><br></pre></td></tr></table></figure>

<h3 id="apropos"><a href="#apropos" class="headerlink" title="apropos"></a>apropos</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>apropos</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/apropos</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>获取简短配置文件信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>aprops [配置文件]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> apropos inittab</span></span><br><span class="line">inittab 		(5) -init daemon configuration</span><br></pre></td></tr></table></figure>

<h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>help</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>Shell内置命令</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>获得shell内置命令的帮助信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>help 命令</code></td>
</tr>
</tbody></table>
<p>范例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看<span class="built_in">umask</span>命令的帮助信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">help</span> <span class="built_in">umask</span></span></span><br></pre></td></tr></table></figure>

<p>注：内置命令可通俗理解为找不到命令所在路径的命令，都是内置命令，这些内置命令不能使用<code>man</code>来查看帮助信息 </p>
<h2 id="4-5-用户管理命令"><a href="#4-5-用户管理命令" class="headerlink" title="4.5 用户管理命令"></a>4.5 用户管理命令</h2><h3 id="useradd"><a href="#useradd" class="headerlink" title="useradd"></a>useradd</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>useradd</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/sbin/useradd</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>添加新用户</td>
</tr>
<tr>
<td>语法</td>
<td><code>useradd 用户名</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> useradd wangge</span></span><br></pre></td></tr></table></figure>

<h3 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>passwd</td>
</tr>
<tr>
<td>原意</td>
<td>password</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/passwd</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>设置用户密码</td>
</tr>
<tr>
<td>语法</td>
<td><code>passwd 密码</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> passwd wangge</span></span><br></pre></td></tr></table></figure>

<h3 id="who"><a href="#who" class="headerlink" title="who"></a>who</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>who</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/who</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>查看登录用户信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>who</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> who</span></span><br><span class="line">mcee     tty1         2017-09-28 09:03</span><br><span class="line">mcee     pts/0        2018-04-02 10:01 (andyliudembp)</span><br><span class="line">mcee     pts/1        2018-04-02 10:07 (jies-mbp)</span><br></pre></td></tr></table></figure>

<p>信息是： 登录用户  登录终端 登录时间  登录用户主机名</p>
<p>注: tty叫本地登录 pts叫远程终端 然后用不同的数字终端号来区分不同的终端</p>
<h3 id="w"><a href="#w" class="headerlink" title="w"></a>w</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>passwd</td>
</tr>
<tr>
<td>原意</td>
<td>password</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/w</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>查看登录用户详细信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>w</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> w</span></span><br><span class="line"> 10:53:17 up 186 days,  1:50,  2 users,  load average: 0.03, 0.05, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">mcee     tty1                      28Sep17 186days  0.78s  0.78s -bash</span><br><span class="line">mcee     pts/0    andyliudembp     10:01    5.00s  0.14s  0.02s sshd: mcee [priv]</span><br></pre></td></tr></table></figure>

<ul>
<li>第一行信息：系统时间 up是系统连续运行时间 3 users是当前在线用户数，<code>load average</code>是负载均衡指数：有三个数值，分别记录了系统在过去的1分钟、5分钟、15分钟负载值。</li>
<li>之后的信息：<ul>
<li>登录用户 登录终端 登录主机ip 登录时间</li>
<li>IDLE：用户登录过来的空闲时间</li>
<li>JCPU ：当前登录过来的用户执行的操作累计占用的cpu时间</li>
<li>PCPU：当前登录过来的用户执行的最近一次操作占用的cpu的时间</li>
<li>WHAT：执行了什么操作</li>
</ul>
</li>
</ul>
<h2 id="4-6-压缩解压命令"><a href="#4-6-压缩解压命令" class="headerlink" title="4.6 压缩解压命令"></a>4.6 压缩解压命令</h2><h3 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>gzip</td>
</tr>
<tr>
<td>原意</td>
<td>GUN zip</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/gzip</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>压缩文件，压缩格式<code>.gz</code></td>
</tr>
<tr>
<td>语法</td>
<td><code>gzip [文件]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gzip <span class="built_in">test</span></span></span><br><span class="line">gzip: test is a directory -- ignored</span><br><span class="line"><span class="meta">$</span><span class="bash"> touch test.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> gzip test.txt</span></span><br></pre></td></tr></table></figure>

<p>注：gzip压缩之后，不保留源文件;gzip只能压缩文件，不能压缩目录</p>
<h3 id="gunzip"><a href="#gunzip" class="headerlink" title="gunzip"></a>gunzip</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>gunzip</td>
</tr>
<tr>
<td>原意</td>
<td>GUN unzip</td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/gunzip</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>解压缩<code>.gz</code>的压缩文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>gunzip 文件.gz</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gunzip test.txt.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>tar</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/tar</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>打包目录</td>
</tr>
<tr>
<td>语法</td>
<td><code>tar 选项 [-zcf] [压缩后文件名] [目录]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -c 打包</p>
<p>​    -x 解压</p>
<p>​    -v 显示详细信息</p>
<p>​    -f 指定文件名</p>
<p>​    -z 打包同时压缩 </p>
<p>​    -j 操作.bz2格式文件</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将目录Japan打包并压缩为.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zcf Japan.tar.gz Japan</span></span><br></pre></td></tr></table></figure>

<h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>zip</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/zip</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>压缩文件或目录，压缩格式<code>.zip</code>，保留源文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>zip 选项[-r][压缩后的文件名][文件或目录]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -r 压缩目录</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 压缩文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> zip buduo.zip boduo</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 压缩目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> zip -r Japan.zip Japan</span></span><br></pre></td></tr></table></figure>

<h3 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>unzip</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/unzip</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>解压<code>.zip</code>的压缩文件</td>
</tr>
<tr>
<td>语法</td>
<td><code>zip [压缩文件]</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> unzip test.zip</span></span><br></pre></td></tr></table></figure>

<h3 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>bzip2</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/bzip2</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>压缩文件，压缩格式<code>.bz2</code></td>
</tr>
<tr>
<td>语法</td>
<td><code>bzip2 选项[-k][文件]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -k 产生压缩文件后保留源文件</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bzip2 -k boduo </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -cjf Japan.tar.bz2 Japan</span></span><br></pre></td></tr></table></figure>

<p><code>bzip2</code>压缩比很大，压缩比较大的文件时，很有效,和<code>tar</code>配合使用，类似于<code>gzip</code></p>
<h3 id="bunzip2"><a href="#bunzip2" class="headerlink" title="bunzip2"></a>bunzip2</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>bunzip2</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/bunzip2</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>解压缩</td>
</tr>
<tr>
<td>语法</td>
<td><code>bunzip2 选项[-k][压缩文件]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -k 解压文件后保留源文件</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bunzip2 -k boduo.bz2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xjf Japan.tar.bz2</span></span><br></pre></td></tr></table></figure>

<p><code>bzip2</code>压缩比很大，压缩比较大的文件时，很有效,和<code>tar</code>配合使用，类似于<code>gzip</code></p>
<h2 id="4-7-网络命令"><a href="#4-7-网络命令" class="headerlink" title="4.7 网络命令"></a>4.7 网络命令</h2><h3 id="write"><a href="#write" class="headerlink" title="write"></a>write</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>write</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/write</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>给用户发信息，以Ctrl+D保存结束</td>
</tr>
<tr>
<td>语法</td>
<td><code>write &lt;用户名&gt;</code></td>
</tr>
<tr>
<td>范例</td>
<td><code># write  linzhiling</code></td>
</tr>
</tbody></table>
<h3 id="wall"><a href="#wall" class="headerlink" title="wall"></a>wall</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>wall</td>
</tr>
<tr>
<td>原意</td>
<td>write all</td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/wall</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>发送广播信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>wall [message]</code></td>
</tr>
<tr>
<td>范例</td>
<td><code># wall This is a test message.</code></td>
</tr>
</tbody></table>
<h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>ping</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/ping</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>测试网络连通性</td>
</tr>
<tr>
<td>语法</td>
<td><code>ping 选项[-c] IP地址</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -c 指定发送次数</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  ping -c 5 127.0.0.1</span></span><br><span class="line">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.022 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.065 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.034 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.082 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.074 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 3999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.022/0.055/0.082/0.024 ms</span><br></pre></td></tr></table></figure>

<h3 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>ifconfig</td>
</tr>
<tr>
<td>原意</td>
<td>interface configure</td>
</tr>
<tr>
<td>所在路径</td>
<td>/sbin/ifconfig</td>
</tr>
<tr>
<td>执行权限</td>
<td>root</td>
</tr>
<tr>
<td>功能描述</td>
<td>查看和设置网卡信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>ifconfig 网卡名称 IP地址</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ifconfig</span></span><br><span class="line">em1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.11.115  netmask 255.255.255.0  broadcast 192.168.11.255</span><br><span class="line">        inet6 fe80::d0b1:533e:a82c:99e  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether f4:8e:38:c1:df:ba  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 676670130  bytes 441920618068 (411.5 GiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 496246515  bytes 118705907935 (110.5 GiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        device interrupt 16  </span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 306661425  bytes 72938709575 (67.9 GiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 306661425  bytes 72938709575 (67.9 GiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>注：</p>
<ul>
<li>lo 表示回环网卡，用于本机的测试和通信 </li>
</ul>
<ul>
<li>Link encap：Ethernet  网络类型：以太网</li>
<li>HWaddr 网卡的硬件地址（物理地址）即MAC地址 16进制保存的18位的地址</li>
<li>Inet addr： 当前计算机的IP地址</li>
<li>Bcast ：当前网络的广播地址</li>
<li>Mask：子网掩码</li>
<li>Inet6 addr ： IPV6的地址信息</li>
<li>UP ··· ：这一行是网络的附加信息</li>
<li>RX packets：接收到的数据包的总数量</li>
<li>TX packets：发送的数据包的总数量  这两行后面是丢包丢失或报错的对比机率</li>
<li>BX bytes：接收的数据包的总大小</li>
<li>TX bytes：发送的数据包的总大小</li>
<li>Interrupt：网卡在内存当中的物理地址</li>
</ul>
<h3 id="mail"><a href="#mail" class="headerlink" title="mail"></a>mail</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>mail</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/mail</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>查看发送电子邮件</td>
</tr>
<tr>
<td>语法</td>
<td><code>mail [用户名]</code></td>
</tr>
<tr>
<td>范例</td>
<td><code># mail root</code></td>
</tr>
</tbody></table>
<h3 id="last"><a href="#last" class="headerlink" title="last"></a>last</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>last</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/last</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>列出目前与过去登入系统的用户信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>last</code></td>
</tr>
<tr>
<td>范例</td>
<td><code># last</code></td>
</tr>
</tbody></table>
<h3 id="lastlog"><a href="#lastlog" class="headerlink" title="lastlog"></a>lastlog</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>lastlog</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/usr/bin/lastlog</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>检查某特定用户上次登录的时间</td>
</tr>
<tr>
<td>语法</td>
<td><code>lastlog</code></td>
</tr>
<tr>
<td>范例</td>
<td><code># lastlog</code>  <code># lastlog -u 502</code></td>
</tr>
</tbody></table>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>netstat</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/netstat</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>显示网络相关信息</td>
</tr>
<tr>
<td>语法</td>
<td><code>netstat [选项]</code></td>
</tr>
</tbody></table>
<p><strong>选项说明：</strong></p>
<p>​    -t  TCP协议</p>
<p>​    -u UDP协议</p>
<p>​    -r 路由</p>
<p>​    -l 监听</p>
<p>​    -n 显示IP地址和端口号</p>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看本机监听的端口</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> netstat -tlun</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看本机所有的网络连接</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> netstat -an </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看本机路由表</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> netstat -rn</span></span><br></pre></td></tr></table></figure>

<h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h3><table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>命令名称</td>
<td>mount</td>
</tr>
<tr>
<td>原意</td>
<td></td>
</tr>
<tr>
<td>所在路径</td>
<td>/bin/mount</td>
</tr>
<tr>
<td>执行权限</td>
<td>所有用户</td>
</tr>
<tr>
<td>功能描述</td>
<td>挂载</td>
</tr>
<tr>
<td>语法</td>
<td><code>mount [-t 文件系统] 设备文件名 挂载点</code></td>
</tr>
</tbody></table>
<p>范例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mount -t iso9660 /dev/sr0 /mnt/cdrom</span></span><br></pre></td></tr></table></figure>

<p>注：-t iso9660可以省略，默认就是这样的设置</p>
<p>##4.8 关机重启命令及注销登录</p>
<h3 id="关机重启命令"><a href="#关机重启命令" class="headerlink" title="关机重启命令"></a>关机重启命令</h3><p><strong>shutdown</strong></p>
<p>语法：<code># shutdown [选项] 时间</code>  </p>
<p>选项:</p>
<p>​    -c: 取消前一个关机命令<br>​    -h: 关机<br>​    -r: 重启</p>
<p>其他关机命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> halt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> poweroff</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> init 0</span></span><br></pre></td></tr></table></figure>

<p>其他重启命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> reboot</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> init 0</span></span><br></pre></td></tr></table></figure>



<p><strong>系统运行级别：</strong></p>
<ol>
<li><code>0</code>  关机</li>
<li><code>1</code>  单用户</li>
<li><code>2</code>  不完全多用户，不含NFS服务</li>
<li><code>3</code> 完全多用户</li>
<li><code>4</code>未分配</li>
<li><code>5</code> 图形界面<br> . <code>6</code>重启<br>​    </li>
</ol>
<p>配置文件位置：<code>/etc/inittab</code></p>
<p>查询系统运行级别：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> runlevel</span></span><br><span class="line">N 3</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> init 5</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> init 3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> runlevel</span></span><br><span class="line">5 3</span><br></pre></td></tr></table></figure>

<p>N代表上次系统运行级别，有的话会是数字</p>
<h3 id="注销命令-logout"><a href="#注销命令-logout" class="headerlink" title="注销命令 logout"></a>注销命令 logout</h3><p>​    </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/PHP/%E9%9B%B6%E7%A2%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/PHP/%E9%9B%B6%E7%A2%8E/" class="post-title-link" itemprop="url">PHP 零碎记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-02 13:00:10" itemprop="dateCreated datePublished" datetime="2018-03-02T13:00:10+08:00">2018-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1、返回本地主机的标准主机名</p>
<p>​    gethostname()     </p>
<p>​    gethostbyaddr($_SERVER[‘REMOTE_ADDR’]);                            </p>
<p>2、获取主机名的IPv4地址</p>
<p>​    gethostbyname()</p>
<p>3    array_multisort() // 这个函数好操蛋啊</p>
<p>4    func_get_args()  好像是高级函数</p>
<p>5    修改器会在赋值时执行；数据完成会被执行两次，一次是赋值时，一次是写入数据时</p>
<p>6    json_encode(); 函数中文乱码(u265/ 类似情形)和部分符号被转化解决方法：</p>
<p>​    foreach ($data as $key =&gt; $value) {</p>
<p>　　    $data[$key] = urlencode($value);</p>
<p>​    }</p>
<p>​    为每个值urlencode一下，返回时再urldecode（json_encode()）就好了！</p>
<p>7    dirname(dirname(<strong>FILE</strong>));得到的是文件上一层目录名</p>
<p>​    dirname(<strong>FILE</strong>);得到的是文件所在层目录名</p>
<p>​    dirname(dirname(<strong>FILE</strong>));</p>
<p>​    假设<strong>FILE</strong>为 /home/web/config/config.PHP  </p>
<p>​    输出为 /home/web/  </p>
<p>​    dirname(<strong>FILE</strong>)</p>
<p>​    输出为 /home/web/config/</p>
<p>8     iconv函数库能够完成各种字符集间的转换</p>
<p>​    iconv(“utf-8”,”gb2312”,$content); 将utf8转成gb2312</p>
<p>​    iconv(“utf-8”,”gb2312//IGNORE”,$content); 同上，不过遇到错会忽略</p>
<p>9   curl请求数据要求json格式传过去 header数组这样写</p>
<p>​    $data = json_encode($data);</p>
<p>​    $headers[] = ‘Content-Type: application/json’;</p>
<p>​    $headers[] = ‘Content-Length: ‘ . strlen($data);</p>
<p>10  array_unshift($a,”blue”);     函数用于向数组插入新元素。新数组的值将被插入到数组的开头。被加上的元素作为一个整体添加，这些元素在数组中的顺序和在参数中的顺序一样。</p>
<p>​                                该函数会返回数组中元素的个数</p>
<p>​    array_push($a,’red’);         函数向第一个参数的数组尾部添加一个或多个元素（入栈），然后返回新数组的长度。</p>
<p>11 http_build_query — 生成 URL-encode 之后的请求字符串 使用给出的关联（或下标）数组生成一个经过 URL-encode 的请求字符串。</p>
<p>12 end() 函数将数组内部指针指向最后一个元素，并返回该元素的值（如果成功）</p>
<p>13 constant() 当你不知道常量名，却需要获取常量的值时，constant() 就很有用了。也就是常量名储存在一个变量里，或者由函数返回常量名。</p>
<p>14 glob() 函数返回匹配指定模式的文件名或目录。</p>
<p>15 ip2long 将IPv4的ip地址（以小数点分隔形式）转换为int 如果ip地址非法，返回FALSE（PHP 5.0.0以后）</p>
<p>   long2ip：将int型表示的ip地址表示成字符串 aaa.bbb.ccc.ddd 的形式</p>
<p>16  array_splice(array,offset,length,array)</p>
<p>​    参数    描述</p>
<p>​    array    必需。规定数组。</p>
<p>​    offset    必需。数值。如果 offset 为正，则从输入数组中该值指定的偏移量开始移除。如果 offset 为负，则从输入数组末尾倒数该值指定的偏移量开始移除。</p>
<p>​    length    可选。数值。如果省略该参数，则移除数组中从 offset 到 结尾的所有部分。如果指定了 length 并且为正值，则移除这么多元素。如果指定了 length 且为负值，则移除从 offset 到数组末尾倒数 length 为止中间所有的元素。</p>
<p>​    array    被移除的元素由此数组中的元素替代。如果没有移除任何值，则此数组中的元素将插入到指定位置。</p>
<p>17  var entry_id = $(“#input_entry”).val(); // 输入指标的id</p>
<p>​    var entry_id_option = $(“#input_entry”).find(“option:selected”).text();// 输入指标option中的值</p>
<p>18 Jquery下判断Id是否存在的代码</p>
<p>​    如果是下面的 jQuery 代码判断一个对象是否存在，是不能用的</p>
<p>​    if($(“#id”)){</p>
<p>​    }else{}</p>
<p>​    因为 $(“#id”) 不管对象是否存在都会返回 object 。 正确使用判断对象是否存在应该用：</p>
<p>​    if($(“#id”).length&gt;0){}else{}</p>
<p>​    使用 jQuery 对象的属性 length 来判断，如果 &gt; 0 就存在。 或者</p>
<p>​    if($(“#id”)[0]){} else {}</p>
<p>​    或者直接使用原生的 Javascript 代码来判断：</p>
<p>​    if(document.getElementById(“id”)){} else {}</p>
<p>心跳包计算：</p>
<p>精确：每次心跳或者其他数据过来，都重置定时器，如果定时器在触发时仍未收到消息，则认为断连。</p>
<p>粗略：每次心跳包过来，都为一个记录变量A值加一，定时器设置好周期后一直循环执行，每次执行一次就A减一，正常情况下不会为零，当减掉为零时，则说明断连。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" class="post-title-link" itemprop="url">Linux系统目录结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-02 12:57:10" itemprop="dateCreated datePublished" datetime="2018-03-02T12:57:10+08:00">2018-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux下搭建LNMP环境"><a href="#Linux下搭建LNMP环境" class="headerlink" title="Linux下搭建LNMP环境"></a>Linux下搭建LNMP环境</h1><p><strong>装环境之前，首先配置好yum源</strong></p>
<h2 id="一、安装PHP"><a href="#一、安装PHP" class="headerlink" title="一、安装PHP"></a>一、安装PHP</h2><h3 id="1-安装php的必要依赖"><a href="#1-安装php的必要依赖" class="headerlink" title="1. 安装php的必要依赖"></a>1. 安装php的必要依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ openssl openssl-devel bzip2-devel libxslt libxslt-devel libmcrypt libmcrypt-devel libxml2 libxml2-devel autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel  zlib zlib-devel glibc glibc-devel glib2 glib2-devel</span><br></pre></td></tr></table></figure>

<h3 id="2-获取安装包"><a href="#2-获取安装包" class="headerlink" title="2.获取安装包"></a>2.获取安装包</h3><p>官网上下载需要的包，解压进入解压目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf php-7.0.22.tar.gz</span><br><span class="line">cd php-7.0.22</span><br></pre></td></tr></table></figure>

<h3 id="3-配置安装变量"><a href="#3-配置安装变量" class="headerlink" title="3.配置安装变量"></a>3.配置安装变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/php  --enable-fpm  --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv-dir --with-freetype-dir=/usr/local/freetype --with-jpeg-dir --with-png-dir --with-zlib --with-libxml-dir=/usr --enable-xml --disable-rpath --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex --enable-mbstring --enable-intl --with-mcrypt --enable-ftp --with-gd --enable-gd-native-ttf --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --with-gettext --enable-fileinfo --enable-opcache --with-xsl --with-xpm-dir=/usr</span><br></pre></td></tr></table></figure>

<p><code>--with-fpm-user=admin --with-fpm-group=admin</code> 如果需要设置php-fpm的用户和用户组，加上这个 不用的话别加，要不然后面启动的时候会报错</p>
<blockquote>
<p>ERROR: [pool www] cannot get uid for user ‘admin’</p>
<p>ERROR: FPM initialization failed</p>
</blockquote>
<p>此时，找到php-fpm的配置文件修改user=nobody group=nobody 如果谁都可以启的话</p>
<p>报错：</p>
<blockquote>
<p>configure: error: mcrypt.h not found. Please reinstall libmcrypt.</p>
</blockquote>
<p>解决： <code>yum install libmcrypt-devel -y</code> </p>
<p>==./configure 作用： 软件配置与检查==</p>
<ul>
<li>定义需要的功能选项</li>
<li>检测系统环境是否符合安装要求</li>
<li>把定义好的功能选项和检测系统环境的信息都写入Makefile文件，用于后续的编辑</li>
</ul>
<p>配置安装变量时提示：</p>
<p>​    No package libmcrypt available.</p>
<p>​    No package libmcrypt-devel available.</p>
<p>之前安装依赖时候，安装过这个两个包，但是yum源中没有这两个包，更新yum源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y upgrade</span><br><span class="line"></span><br><span class="line">yum -y install epel-release  //扩展包更新包</span><br><span class="line"></span><br><span class="line">yum -y install libmcrypt libmcrypt-devel  // 重新安装这两个包</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%8301.jpeg" alt="Linux下搭建LNMP环境"></p>
<p>安装成功。 </p>
<p>重新执行 ./configure</p>
<p>出现 <strong>Thank you for using PHP</strong>. </p>
<p>###4.进行make操作</p>
<p>编译会花费一些时间，耐心等待即可。编译完成的最后会提示你执行make test命令。就是对上一步 make 的检查，要确保 make 是没有错误的，也就是这一步的 test、check要全部是 OK 的，error 为0。</p>
<p>###5.安装</p>
<p>make install</p>
<p>###6.配置PHP</p>
<p>将PHP源码包中的<code>php.ini-development</code>文件复制到<code>/usr/local/php/</code>下，更名为<code>php.ini</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/src/php-7.0.22/php.ini-development /usr/local/php/php.ini</span><br><span class="line"></span><br><span class="line">cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</span><br><span class="line"></span><br><span class="line">cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure>

<p>配置php.ini   <code>cgi.fix_pathinfo=0</code></p>
<p>####启动php-fpm服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;php&#x2F;sbin&#x2F;php-fpm</span><br></pre></td></tr></table></figure>

<p><strong>设置php-fpm开机自启</strong></p>
<ol>
<li><p>创建脚本文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi  &#x2F;etc&#x2F;init.d&#x2F;php-fpm</span><br></pre></td></tr></table></figure>

</li>
</ol>
<ol start="2">
<li><p>写入脚本并保存退出</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">       #</span><br><span class="line">       # php-fpm - this script starts and stops the php-fpm daemin</span><br><span class="line">       #</span><br><span class="line">       # chkconfig: - 85 15</span><br><span class="line">       # processname: php-fpm</span><br><span class="line">       # config:      /usr/local/php/etc/php-fpm.conf</span><br><span class="line"></span><br><span class="line">       set -e</span><br><span class="line"></span><br><span class="line">       PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">       DESC="php-fpm daemon"</span><br><span class="line">       NAME=php-fpm</span><br><span class="line">       DAEMON=/usr/local/php/sbin/$NAME     </span><br><span class="line">       CONFIGFILE=/usr/local/php/etc/php-fpm.conf   </span><br><span class="line">       PIDFILE=/usr/local/php/var/run/$NAME.pid   </span><br><span class="line">       SCRIPTNAME=/etc/init.d/$NAME  </span><br><span class="line">       </span><br><span class="line">       # If the daemon file is not found, terminate the script.</span><br><span class="line">       test -x $DAEMON || exit 0</span><br><span class="line"></span><br><span class="line">       d_start()&#123;</span><br><span class="line">           $DAEMON -y $CONFIGFILE || echo -n " already running"</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       d_stop()&#123;</span><br><span class="line">           kill -QUIT `cat $PIDFILE` || echo -n " no running"</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       d_reload()&#123;</span><br><span class="line">           kill -HUP `cat $PIDFILE` || echo -n " could not reload"</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       case "$1" in</span><br><span class="line">           start)</span><br><span class="line">               echo -n "Starting $DESC: $NAME"</span><br><span class="line">               d_start</span><br><span class="line">               echo "."</span><br><span class="line">               ;;</span><br><span class="line">           stop)</span><br><span class="line">               echo -n "Stopping $DESC: $NAME"</span><br><span class="line">               d_stop</span><br><span class="line">               echo "."</span><br><span class="line">               ;;</span><br><span class="line">           reload)</span><br><span class="line">               echo -n "Reloading $DESC configuration..."</span><br><span class="line">               d_reload</span><br><span class="line">               echo "Reloaded."</span><br><span class="line">               ;;</span><br><span class="line">           restart)</span><br><span class="line">               echo -n "Restarting $DESC: $NAME"</span><br><span class="line">               d_stop</span><br><span class="line">               # Sleep for two seconds before starting again, this should give the nginx daemon some time to perform a graceful stop</span><br><span class="line">               sleep 2</span><br><span class="line">               d_start</span><br><span class="line">               echo "."</span><br><span class="line">               ;;</span><br><span class="line">           *)</span><br><span class="line">               echo "Usage: $SCRIPTNAME &#123;start|stop|restart|force-reload)" &gt;&amp;2</span><br><span class="line">               exit 3</span><br><span class="line">               ;;</span><br><span class="line">       esac</span><br><span class="line">       exit 0</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>修改权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x php-fpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试并设置开机自启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> /etc/init.d/php-fpm --<span class="built_in">help</span></span></span><br><span class="line"></span><br><span class="line">   Usage: /etc/init.d/php-fpm &#123;start|stop|restart|force-reload)</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> chkconfig php-fpm on</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
</li>
</ol>
<h2 id="二、安装Nginx"><a href="#二、安装Nginx" class="headerlink" title="二、安装Nginx"></a>二、安装Nginx</h2><h3 id="1-官网上下载Nginx，并安装依赖"><a href="#1-官网上下载Nginx，并安装依赖" class="headerlink" title="1.官网上下载Nginx，并安装依赖"></a>1.官网上下载Nginx，并安装依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc pcre-devel zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>

<h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2.安装"></a>2.安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 解压</span></span></span><br><span class="line">tar -zxvf nginx-1.9.9.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#进入nginx目录</span></span></span><br><span class="line">cd nginx-1.9.9</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 配置</span></span></span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> make</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span>到刚才配置的安装目录/usr/loca/nginx/</span></span><br><span class="line">./sbin/nginx -t</span><br><span class="line"></span><br><span class="line">提示成功</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<h3 id="3-访问"><a href="#3-访问" class="headerlink" title="3.访问"></a>3.访问</h3><p>浏览器中访问ip，网页没有任何显示，是防火墙，80端口没开，开启80端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">/etc/rc.d/init.d/iptables save</span><br><span class="line">/etc/init.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>再访问就正常了。</p>
<h3 id="4-配置Nginx"><a href="#4-配置Nginx" class="headerlink" title="4.配置Nginx"></a>4.配置Nginx</h3><p>编辑nginx配置文件/usr/local/nginx/conf/nginx.conf，主要修改nginx的server {}配置块中的内容，修改location块，追加index.php让nginx服务器默认支持index.php为首页：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%8303.png" alt=""></p>
<p>打开php配置模块：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%8304.png" alt=""></p>
<p>这里面很多都是默认的，<code>root</code>是配置php程序放置的根目录，主要修改的就是<code>fastcgi_param</code>中的<code>/scripts</code>为<code>$document_root</code></p>
<p>修改完这些保存并退出，然后重启nginx:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>

<h3 id="5-测试"><a href="#5-测试" class="headerlink" title="5.测试"></a>5.测试</h3><p>创建index.php：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%8305.png" alt=""></p>
<h3 id="6-配置Nginx全局变量"><a href="#6-配置Nginx全局变量" class="headerlink" title="6.配置Nginx全局变量"></a>6.配置Nginx全局变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在linux系统的/etc/init.d/目录下创建nginx文件</span></span><br><span class="line">vim /etc/init.d/nginx</span><br></pre></td></tr></table></figure>

<p>在文件中添加如下脚本，自定义安装的话：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx=”/usr/sbin/nginx”                         #修改成nginx执行程序的路径。</span><br><span class="line">NGINX_CONF_FILE=”/etc/nginx/nginx.conf”         #修改成配置文件的路径。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx - this script starts and stops the nginx daemon</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig:   - 85 15</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> description:  Nginx is an HTTP(S) server, HTTP(S) reverse \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               proxy and IMAP/POP3 proxy server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Source <span class="keyword">function</span> library.</span></span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"><span class="meta">#</span><span class="bash"> Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="meta">#</span><span class="bash"> Check that networking is up.</span></span><br><span class="line">[ "$NETWORKING" = "no" ] &amp;&amp; exit 0</span><br><span class="line">nginx="/usr/local/nginx/sbin/nginx"</span><br><span class="line">prog=$(basename $nginx)</span><br><span class="line">NGINX_CONF_FILE="/usr/local/nginx/conf/nginx.conf"</span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line">make_dirs() &#123;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> make required directories</span></span><br><span class="line">   user=`nginx -V 2&gt;&amp;1 | grep "configure arguments:" | sed 's/[^*]*--user=\([^ ]*\).*/\1/g' -`</span><br><span class="line">   options=`$nginx -V 2&gt;&amp;1 | grep 'configure arguments:'`</span><br><span class="line">   for opt in $options; do</span><br><span class="line">       if [ `echo $opt | grep '.*-temp-path'` ]; then</span><br><span class="line">           value=`echo $opt | cut -d "=" -f 2`</span><br><span class="line">           if [ ! -d "$value" ]; then</span><br><span class="line">               # echo "creating" $value</span><br><span class="line">               mkdir -p $value &amp;&amp; chown -R $user $value</span><br><span class="line">           fi</span><br><span class="line">       fi</span><br><span class="line">   done</span><br><span class="line">&#125;</span><br><span class="line">start() &#123;</span><br><span class="line">    [ -x $nginx ] || exit 5</span><br><span class="line">    [ -f $NGINX_CONF_FILE ] || exit 6</span><br><span class="line">    make_dirs</span><br><span class="line">    echo -n $"Starting $prog: "</span><br><span class="line">    daemon $nginx -c $NGINX_CONF_FILE</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $"Stopping $prog: "</span><br><span class="line">    killproc $prog -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line">restart() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line">reload() &#123;</span><br><span class="line">    configtest || return $?</span><br><span class="line">    echo -n $"Reloading $prog: "</span><br><span class="line">    killproc $nginx -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">&#125;</span><br><span class="line">force_reload() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line">configtest() &#123;</span><br><span class="line"><span class="meta">  $</span><span class="bash">nginx -t -c <span class="variable">$NGINX_CONF_FILE</span></span></span><br><span class="line">&#125;</span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status $prog</span><br><span class="line">&#125;</span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">case "$1" in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        echo $"Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>保存脚本文件后设置文件的执行权限:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x /etc/init.d/nginx   # a+x参数表示 ==&gt; all user can execute  所有用户可执行</span><br></pre></td></tr></table></figure>

<p>然后就可以通过这个脚本对nginx进行管理了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nginx —status-all</span><br><span class="line"></span><br><span class="line">Usage: /etc/init.d/nginx &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用chkconfig管理列表：</strong></p>
<ol>
<li><p>先将nginx服务加入chkconfig管理列表：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add /etc/init.d/nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p>加完这个之后，就可以使用service对nginx进行启动，重启等操作</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>
<p> $ service nginx –status-all<br> Usage: /etc/init.d/nginx {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3.  设置终端模式开机启动</span><br><span class="line"></span><br><span class="line">    &#96;&#96;&#96;shell</span><br><span class="line">     $ chkconfig nginx on</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="三、安装Mysql"><a href="#三、安装Mysql" class="headerlink" title="三、安装Mysql"></a>三、安装Mysql</h2><h3 id="1-安装必要依赖"><a href="#1-安装必要依赖" class="headerlink" title="1.安装必要依赖"></a>1.安装必要依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum –y install gcc gcc-c++ gcc-lib ncurses-devel cmake</span><br></pre></td></tr></table></figure>

<h3 id="2-官网上下载mysql"><a href="#2-官网上下载mysql" class="headerlink" title="2.官网上下载mysql"></a>2.官网上下载mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mysql-5.6.37.tar.gz</span><br><span class="line">cd mysql-5.6.37</span><br></pre></td></tr></table></figure>

<h3 id="3、编译"><a href="#3、编译" class="headerlink" title="3、编译"></a>3、编译</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1</span></span><br><span class="line">cmake \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \</span><br><span class="line">-DMYSQL_DATADIR=/usr/local/mysql/data \</span><br><span class="line">-DSYSCONFDIR=/usr/local/mysql \</span><br><span class="line">-DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_MEMORY_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/var/lib/mysql/mysql.sock \</span><br><span class="line">-DMYSQL_TCP_PORT=3306 \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">-DEXTRA_CHARSETS=all \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################################################</span></span></span><br><span class="line">CMake Warning:</span><br><span class="line">  Manually-specified variables were not used by the project:</span><br><span class="line">    WITH_MEMORY_STORAGE_ENGINE</span><br><span class="line">    WITH_READLINE</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#####################################################</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2<span class="comment">################################</span></span></span><br><span class="line">make –j #</span><br><span class="line"><span class="meta">#</span><span class="bash">3<span class="comment">################################</span></span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h3 id="4-修改配置文件"><a href="#4-修改配置文件" class="headerlink" title="4.修改配置文件"></a>4.修改配置文件</h3><p><code>my.cnf</code>配置文件放置<code>/usr/local/myslql</code>目录下，配置文件如下，根据具体情况修改:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">user &#x3D; mysql</span><br><span class="line">port &#x3D; 3306</span><br><span class="line">socket &#x3D; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">basedir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data</span><br><span class="line"></span><br><span class="line">#default-character-set&#x3D;utf8</span><br><span class="line">#skip-name-resolve</span><br><span class="line"></span><br><span class="line">lower_case_table_names&#x3D;1</span><br><span class="line">back_log &#x3D; 600   </span><br><span class="line">max_connections &#x3D; 3000   </span><br><span class="line">max_connect_errors &#x3D; 1000</span><br><span class="line"></span><br><span class="line">table_open_cache &#x3D; 4096  </span><br><span class="line">max_allowed_packet &#x3D; 32M  </span><br><span class="line">sort_buffer_size &#x3D; 16M  </span><br><span class="line">join_buffer_size &#x3D; 16M   </span><br><span class="line">thread_cache_size &#x3D; 512</span><br><span class="line">thread_concurrency &#x3D; 16</span><br><span class="line">query_cache_size &#x3D; 128M</span><br><span class="line">query_cache_limit &#x3D; 4M    </span><br><span class="line">query_cache_min_res_unit &#x3D; 2k    </span><br><span class="line">default-storage-engine &#x3D; InnoDB</span><br><span class="line">thread_stack &#x3D; 512K</span><br><span class="line">tmp_table_size &#x3D; 256M   </span><br><span class="line">max_heap_table_size &#x3D; 256M</span><br><span class="line"></span><br><span class="line">long_query_time &#x3D; 6</span><br><span class="line">slow-query-log&#x3D;1</span><br><span class="line">slow-query-log-file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;logs&#x2F;slow.log</span><br><span class="line">#log-queries-not-using-indexes</span><br><span class="line"></span><br><span class="line">log-bin&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;mysql-bin</span><br><span class="line">binlog_cache_size &#x3D; 4M</span><br><span class="line">max_binlog_cache_size &#x3D; 512M</span><br><span class="line">max_binlog_size &#x3D; 512M</span><br><span class="line">binlog-ignore-db&#x3D;mysql</span><br><span class="line">log-slave-updates</span><br><span class="line">replicate-ignore-db&#x3D;mysql</span><br><span class="line">binlog_format&#x3D;ROW</span><br><span class="line"></span><br><span class="line">innodb_additional_mem_pool_size &#x3D; 64M   </span><br><span class="line">innodb_buffer_pool_size &#x3D; 512M   </span><br><span class="line">innodb_data_file_path &#x3D; ibdata1:32M:autoextend   </span><br><span class="line">innodb_file_io_threads &#x3D; 4   </span><br><span class="line">innodb_thread_concurrency &#x3D; 8   </span><br><span class="line">innodb_flush_log_at_trx_commit &#x3D; 2   </span><br><span class="line">innodb_log_buffer_size &#x3D; 16M  </span><br><span class="line">innodb_log_file_size &#x3D; 128M   </span><br><span class="line">innodb_log_files_in_group &#x3D; 3   </span><br><span class="line">innodb_max_dirty_pages_pct &#x3D; 90   </span><br><span class="line">innodb_lock_wait_timeout &#x3D; 120   </span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet &#x3D; 32M</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;logs&#x2F;mysql.err</span><br><span class="line">pid-file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;mysqld.pid</span><br><span class="line">open_files_limit &#x3D; 20480</span><br></pre></td></tr></table></figure>

<p>切换到已经安装的目录，创建配置文件中的<code>logs</code>文件夹</p>
<h3 id="5-创建用户，修改所属关系"><a href="#5-创建用户，修改所属关系" class="headerlink" title="5.创建用户，修改所属关系"></a>5.创建用户，修改所属关系</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql -s /bin/false</span><br></pre></td></tr></table></figure>

<h3 id="6-初始化mysql"><a href="#6-初始化mysql" class="headerlink" title="6.初始化mysql"></a>6.初始化mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/loca/mysql/scripts</span><br><span class="line"></span><br><span class="line">./mysql_install_db --datadir=/usr/local/mysql/data --user=mysql --basedir=/usr/local/mysql</span><br></pre></td></tr></table></figure>

<h3 id="7-规划启动脚本"><a href="#7-规划启动脚本" class="headerlink" title="7.规划启动脚本"></a>7.规划启动脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置开机自启</span></span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>

<p>输入mysqld提示command not found 把mysql配置到环境变量 创建mysql.sh并添加</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1、 创建mysql.sh文件</span></span><br><span class="line">vim /etc/profile.d/mysql.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">2、添加 保存</span></span><br><span class="line">export PATH=$PATH:/usr/local/mysql/bin</span><br><span class="line"><span class="meta">#</span><span class="bash">3、执行</span></span><br><span class="line">source /etc/profile.d/mysql.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">4、测试 查看配置的环境变量是否有效</span></span><br><span class="line">service mysqld —help</span><br><span class="line">service mysqld --status-all</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/Linux%E4%B8%8B%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%8306.png" alt=""></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./support-files/mysql.server start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 报错了</span></span><br><span class="line">Starting MySQL.170802 23:25:04 mysqld_safe error: log-error set to '/usr/local/mysql/logs/mysql.err', however file don't exists. Create writable for user 'mysql'.</span><br><span class="line">The server quit without updating PID file (/usr/local/mysql/data/192.168.11.201.pid).</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">echo "" &gt; /usr/local/mysql/logs/mysql.err</span><br><span class="line">chown -R mysql:mysql /usr/local/mysql/logs/mysql.err</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<h3 id="8-启动服务，构建数据库账户信息"><a href="#8-启动服务，构建数据库账户信息" class="headerlink" title="8.启动服务，构建数据库账户信息"></a>8.启动服务，构建数据库账户信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all on *.* to &#39;root&#39;@&#39;192.168.%.%&#39; identified by &#39;root&#39;;</span><br><span class="line">create database DATABASE_NAME;</span><br></pre></td></tr></table></figure>

<p>删除行:<code>delete from DB_name.tb_name where *=x ;</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Join语句的正确使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-02 12:43:10" itemprop="dateCreated datePublished" datetime="2018-03-02T12:43:10+08:00">2018-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mysql/" itemprop="url" rel="index"><span itemprop="name">Mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Join语句的正确使用"><a href="#Join语句的正确使用" class="headerlink" title="Join语句的正确使用"></a>Join语句的正确使用</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近对于Mysql使用少之又少，今天刚好看了一点关于Mysql的视频，记录下经常使用的Join语句，了解Join语句的优点~</p>
<p>正确使用SQL语言的重要性</p>
<ul>
<li>增加数据库处理效率，较少应用响应时间。</li>
<li>减少数据库服务器负载，增加服务器稳定性。</li>
<li>减少服务器间通讯的网络流量。</li>
</ul>
<p>先上下面例子中讲解要用到的数据表：</p>
<ol>
<li><p>西天取经四人组表 <code>user1</code>：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>user_name</th>
<th>title</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>唐僧</td>
<td>旖檀功德佛</td>
</tr>
<tr>
<td>2</td>
<td>猪八戒</td>
<td>净坛使者</td>
</tr>
<tr>
<td>3</td>
<td>孙悟空</td>
<td>斗战胜佛</td>
</tr>
<tr>
<td>4</td>
<td>沙僧</td>
<td>金身罗汉</td>
</tr>
</tbody></table>
</li>
<li><p>悟空的结拜兄弟表 <code>user2</code>：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>user_name</th>
<th>title</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>孙悟空</td>
<td>成佛</td>
</tr>
<tr>
<td>2</td>
<td>牛魔王</td>
<td>被降服</td>
</tr>
<tr>
<td>3</td>
<td>蛟魔王</td>
<td>被降服</td>
</tr>
<tr>
<td>4</td>
<td>鹏魔王</td>
<td>被降服</td>
</tr>
<tr>
<td>5</td>
<td>狮驼王</td>
<td>被降服</td>
</tr>
</tbody></table>
</li>
<li><p>按日期记录了<code>user1</code>四人组中每个人打怪的数量<code>user_kills</code>：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>user_id</th>
<th>timestr</th>
<th>kills</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2018-06-05</td>
<td>10</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2018-06-06</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>2018-07-05</td>
<td>12</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td>2018-02-05</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>2018-07-15</td>
<td>6</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>2018-06-13</td>
<td>2</td>
</tr>
<tr>
<td>7</td>
<td>3</td>
<td>2018-04-28</td>
<td>12</td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td>2018-09-04</td>
<td>10</td>
</tr>
<tr>
<td>9</td>
<td>2</td>
<td>2018-03-05</td>
<td>18</td>
</tr>
</tbody></table>
</li>
</ol>
<p>之后通过这三张表，来帮助我们理解Join从句的使用方式。</p>
<h2 id="如何正确的使用Join从句"><a href="#如何正确的使用Join从句" class="headerlink" title="如何正确的使用Join从句"></a>如何正确的使用Join从句</h2><p>Join从句的类型：</p>
<ul>
<li>内连接（INNER）</li>
<li>全外连接（FULL OUTER）</li>
<li>左外连接（LEFT OUTER）</li>
<li>右外连接（RIGHT OUTER）</li>
<li>交叉连接（CROSS）</li>
</ul>
<h3 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h3><p>​    内连接<code>INNER JOIN</code>基于连接谓词将两种表（如A和B）的列组合在一起，产生新的表结果。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A801.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A INNER JOIN TableB B ON A.Key &#x3D; B.KEY;</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<p>取出取经四人组<code>user1</code>和悟空朋友们<code>user2</code>这两张表中同时存在于两张表中的用户记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,a.title,b.title FROM user1 a INNER JOIN user2 b on a.user_name &#x3D; b.user_name;</span><br><span class="line">+-----------+--------------+--------+</span><br><span class="line">| user_name | title        | title  |</span><br><span class="line">+-----------+--------------+--------+</span><br><span class="line">| 孙悟空     | 斗战胜佛      | 成佛    |</span><br><span class="line">+-----------+--------------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h3><p>以A表为基础，包含A表中所有的数据与B表中谓词连接词相等的数据。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A802.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A LEFT JOIN TABLEB B ON A.Key &#x3D; B.Key;</span><br></pre></td></tr></table></figure>

<p>以A表为基础，查询只存在A表中的数据。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A803.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A LEFT JOIN TableB B ON A.Key &#x3D; B.Key WHERE B.Key IS NULL;</span><br></pre></td></tr></table></figure>

<p>在使用<code>not in</code>时，不可以使用索引优化，使用<code>left join</code>这种方法可以用来优化<code>not in</code>查询。</p>
<p>例子：</p>
<p>查询取经四人组中哪些人不是悟空的结拜兄弟？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name, a.title, b.title FROM user1 a LEFT JOIN user2 b ON a.user_name &#x3D; b.user_name WHERE b.user_name is NULL;</span><br><span class="line">+-----------+-----------------+-------+</span><br><span class="line">| user_name | title           | title |</span><br><span class="line">+-----------+-----------------+-------+</span><br><span class="line">| 唐僧      | 旖檀功德佛        | NULL  |</span><br><span class="line">| 猪八戒    | 净坛使者          | NULL  |</span><br><span class="line">| 沙僧      | 金身罗汉          | NULL  |</span><br><span class="line">+-----------+-----------------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h3><p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A804.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A RIGHT JOIN TableB B ON A.Key &#x3D; B.key</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A805.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A RIGHT JOIN TableB B ON A.Key &#x3D; B.Key WHERE A.Key IS NULL;</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<p>悟空的结拜兄弟中哪些人没有去取经？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT b.user_name,b.title,a.title FROM user1 A RIGHT JOIN user2 b ON a.user_name&#x3D;b.user_name WHERE a.user_name is NULL;</span><br><span class="line">+-----------+-----------+-------+</span><br><span class="line">| user_name | title     | title |</span><br><span class="line">+-----------+-----------+-------+</span><br><span class="line">| 牛魔王     | 被降服     | NULL  |</span><br><span class="line">| 蛟魔王     | 被降服     | NULL  |</span><br><span class="line">| 鹏魔王     | 被降服     | NULL  |</span><br><span class="line">| 狮驼王     | 被降服     | NULL  |</span><br><span class="line">+-----------+-----------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="FULL-JOIN"><a href="#FULL-JOIN" class="headerlink" title="FULL JOIN"></a>FULL JOIN</h3><p>查询A、B表所有的数据都显示出来，如果连接谓词中无法对应它们，则以<code>NULL</code>来填充。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A806.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A FULL OUTER JOIN TableB B ON A.Key &#x3D; B.Key;</span><br></pre></td></tr></table></figure>

<p>查询只存在于A或B表中的数据，即过滤A、B表的公共部分。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/join%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A807.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;select_list&gt; FROM TableA A FULL OUTER JOIN TableB B ON A.Key &#x3D; B.Key WHERE A.Key IS NULL OR B.Key IS NULL;</span><br></pre></td></tr></table></figure>

<p><strong>问题</strong>：</p>
<p>在mysql中执行<code>FULL JOIN</code>会报错<code>1064</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,a.title,b.title FROM user1 a FULL JOIN user2 b ON a.user_name&#x3D;b.user_name;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;FULL JOIN user2 b ON a.user_name&#x3D;b.user_name&#39; at line 1</span><br></pre></td></tr></table></figure>

<p>这是因为<code>MySQL</code>中不支持<code>FULL JOIN</code>的连接。如果想要在<code>MySQL</code>中使用<code>FULL JOIN</code>，可以通过使用 <code>UNION ALL</code>来解决。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,a.title,b.title FROM user1 a LEFT JOIN user2 b ON a.user_name&#x3D;b.user_name UNION ALL SELECT b.user_name,b.title,a.title FROM user1 a RIGHT JOIN user2 b ON b.user_name&#x3D;a.user_name;</span><br><span class="line">+-----------+-----------------+--------------+</span><br><span class="line">| user_name | title           | title        |</span><br><span class="line">+-----------+-----------------+--------------+</span><br><span class="line">| 孙悟空    | 斗战胜佛        | 成佛         |</span><br><span class="line">| 唐僧      | 旖檀功德佛      | NULL         |</span><br><span class="line">| 猪八戒    | 净坛使者        | NULL         |</span><br><span class="line">| 沙僧      | 金身罗汉        | NULL         |</span><br><span class="line">| 孙悟空    | 成佛            | 斗战胜佛     |</span><br><span class="line">| 牛魔王    | 被降服          | NULL         |</span><br><span class="line">| 蛟魔王    | 被降服          | NULL         |</span><br><span class="line">| 鹏魔王    | 被降服          | NULL         |</span><br><span class="line">| 狮驼王    | 被降服          | NULL         |</span><br><span class="line">+-----------+-----------------+--------------+</span><br><span class="line">9 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>UNION 操作符用于合并两个或多个 SELECT 语句的结果集。</p>
<p>请注意，UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。</p>
<h3 id="SQL-UNION-语法"><a href="#SQL-UNION-语法" class="headerlink" title="SQL UNION 语法"></a>SQL UNION 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s) FROM table_name1</span><br><span class="line">UNION</span><br><span class="line">SELECT column_name(s) FROM table_name2</span><br></pre></td></tr></table></figure>

<p>注释：默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL。</p>
<h3 id="SQL-UNION-ALL-语法"><a href="#SQL-UNION-ALL-语法" class="headerlink" title="SQL UNION ALL 语法"></a>SQL UNION ALL 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s) FROM table_name1</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT column_name(s) FROM table_name2</span><br></pre></td></tr></table></figure>

<p>另外，UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。</p>
</blockquote>
<h3 id="CROSS-JOIN"><a href="#CROSS-JOIN" class="headerlink" title="CROSS JOIN"></a>CROSS JOIN</h3><p>交叉连接，又称笛卡尔连接（cartesian join）或叉乘（Product）,如果<code>A</code>和<code>B</code>是两个集合，它们的交叉连接就记为：<code>A×B</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,a.title,a.user_name,b.title FROM user1 a CROSS JOIN user2 b;</span><br><span class="line">+-----------+-----------------+-----------+-----------+</span><br><span class="line">| user_name | title           | user_name | title     |</span><br><span class="line">+-----------+-----------------+-----------+-----------+</span><br><span class="line">| 唐僧      | 旖檀功德佛      | 唐僧      | 成佛      |</span><br><span class="line">| 猪八戒    | 净坛使者        | 猪八戒    | 成佛      |</span><br><span class="line">| 孙悟空    | 斗战胜佛        | 孙悟空    | 成佛      |</span><br><span class="line">| 沙僧      | 金身罗汉        | 沙僧      | 成佛      |</span><br><span class="line">| 唐僧      | 旖檀功德佛      | 唐僧      | 被降服    |</span><br><span class="line">| 猪八戒    | 净坛使者        | 猪八戒    | 被降服    |</span><br><span class="line">| 孙悟空    | 斗战胜佛        | 孙悟空    | 被降服    |</span><br><span class="line">| 沙僧      | 金身罗汉        | 沙僧      | 被降服    |</span><br><span class="line">| 唐僧      | 旖檀功德佛      | 唐僧      | 被降服    |</span><br><span class="line">| 猪八戒    | 净坛使者        | 猪八戒    | 被降服    |</span><br><span class="line">| 孙悟空    | 斗战胜佛        | 孙悟空    | 被降服    |</span><br><span class="line">| 沙僧      | 金身罗汉        | 沙僧      | 被降服    |</span><br><span class="line">| 唐僧      | 旖檀功德佛      | 唐僧      | 被降服    |</span><br><span class="line">| 猪八戒    | 净坛使者        | 猪八戒    | 被降服    |</span><br><span class="line">| 孙悟空    | 斗战胜佛        | 孙悟空    | 被降服    |</span><br><span class="line">| 沙僧      | 金身罗汉        | 沙僧      | 被降服    |</span><br><span class="line">| 唐僧      | 旖檀功德佛      | 唐僧      | 被降服    |</span><br><span class="line">| 猪八戒    | 净坛使者        | 猪八戒    | 被降服    |</span><br><span class="line">| 孙悟空    | 斗战胜佛        | 孙悟空    | 被降服    |</span><br><span class="line">| 沙僧      | 金身罗汉        | 沙僧      | 被降服    |</span><br><span class="line">+-----------+-----------------+-----------+-----------+</span><br><span class="line">20 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="Join使用技巧"><a href="#Join使用技巧" class="headerlink" title="Join使用技巧"></a>Join使用技巧</h2><h3 id="使用Join更新表"><a href="#使用Join更新表" class="headerlink" title="使用Join更新表"></a>使用Join更新表</h3><p>如何更新使用过滤条件中包含自身的表？</p>
<p>情景：</p>
<p>​    把同时存在于取经四人组和悟空兄弟表中的记录的人在取经四人组表中的<code>title</code>字段更新为“齐天大圣”。</p>
<p>最容易想到的是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE user1 SET title&#x3D;&#39;齐天大圣&#39; WHERE user1.user_name IN (SELECT b.user_name FROM user1 a INNER JOIN user2 b ON a.user_name&#x3D;b.user_name);</span><br><span class="line">ERROR 1093 (HY000): You can&#39;t specify target table &#39;user1&#39; for update in FROM clause</span><br></pre></td></tr></table></figure>

<p>会报错不能更新<code>FROM</code>从句中出现的表，<code>MySQL</code>不支持这种更新。如果放在<code>Oracle</code>或<code>SQLServer</code>中，是完全可以执行的。</p>
<p><strong>联合更新</strong>，在<code>MySQL</code>中这种方式更新可以使用<code>JOIN</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE user1 a JOIN (SELECT b.user_name FROM user1 a INNER JOIN user2 b ON a.user_name&#x3D;b.user_name) b ON a.user_name&#x3D;b.user_name SET a.title&#x3D;&#39;齐天大圣&#39;;</span><br></pre></td></tr></table></figure>

<p>利用<code>join</code>进行更新，其实就是将<code>user1</code>与<code>user2</code>表中查询出的结果进行联合，然后进行更新。</p>
<p>在实际工作中如果遇到需要更新自身表的情况，即==更新出现在<code>FROM</code>从句中的表的话==(???)，就可使用此方法。</p>
<h3 id="使用JOIN优化子查询"><a href="#使用JOIN优化子查询" class="headerlink" title="使用JOIN优化子查询"></a>使用JOIN优化子查询</h3><p>查询存在于<strong>取经四人组</strong>和<strong>悟空的结拜兄弟</strong>的数据：</p>
<ol>
<li>利用子查询：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,a.title,(SELECT b.title FROM user2 b WHERE a.user_name&#x3D;b.user_name) AS title2 FROM user1 a;</span><br><span class="line">+-----------+-----------------+--------+</span><br><span class="line">| user_name | title           | title2 |</span><br><span class="line">+-----------+-----------------+--------+</span><br><span class="line">| 唐僧       | 旖檀功德佛       | NULL   |</span><br><span class="line">| 猪八戒     | 净坛使者         | NULL   |</span><br><span class="line">| 孙悟空     | 斗战胜佛         | 成佛    |</span><br><span class="line">| 沙僧       | 金身罗汉         | NULL   |</span><br><span class="line">+-----------+-----------------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>​        如果两张表中的数据非常多，那么<code>user1</code>表中的每一条数据都要进行一次子查询，那么这种查询方式是非常低效的。</p>
<ol start="2">
<li>使用联合查询：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,a.title,b.title AS title2 FROM user1 a LEFT JOIN user2 b ON a.user_name&#x3D;b.user_name;</span><br><span class="line">+-----------+-----------------+--------+</span><br><span class="line">| user_name | title           | title2 |</span><br><span class="line">+-----------+-----------------+--------+</span><br><span class="line">| 唐僧       | 旖檀功德佛       | NULL   |</span><br><span class="line">| 猪八戒     | 净坛使者         | NULL   |</span><br><span class="line">| 孙悟空     | 斗战胜佛         | 成佛    |</span><br><span class="line">| 沙僧       | 金身罗汉         | NULL   |</span><br><span class="line">+-----------+-----------------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="使用JOIN优化聚合子查询"><a href="#使用JOIN优化聚合子查询" class="headerlink" title="使用JOIN优化聚合子查询"></a>使用JOIN优化聚合子查询</h3><p>如何查询出四人组中打怪最多的日期？</p>
<ol>
<li>聚合子查询</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,b.timestr,b.kills FROM user1 a INNER JOIN user_kills b ON a.id&#x3D;b.user_id WHERE b.kills&#x3D;(SELECT MAX(kills) FROM user_kills c WHERE c.user_id&#x3D;b.user_id); </span><br><span class="line">+-----------+------------+-------+</span><br><span class="line">| user_name | timestr    | kills |</span><br><span class="line">+-----------+------------+-------+</span><br><span class="line">| 猪八戒     | 2018-03-05 |    18 |</span><br><span class="line">| 孙悟空     | 2018-04-28 |    12 |</span><br><span class="line">| 沙僧       | 2018-02-05 |     3 |</span><br><span class="line">+-----------+------------+-------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>JOIN优化查询</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.user_name,b.timestr,b.kills FROM user1 a JOIN user_kills b ON a.id&#x3D;b.user_id JOIN user_kills c ON c.user_id&#x3D;b.user_id GROUP BY a.user_name,b.timestr,b.kills HAVING b.kills&#x3D;MAX(c.kills);</span><br><span class="line">+-----------+------------+-------+</span><br><span class="line">| user_name | timestr    | kills |</span><br><span class="line">+-----------+------------+-------+</span><br><span class="line">| 孙悟空    | 2018-04-28 |    12 |</span><br><span class="line">| 沙僧      | 2018-02-05 |     3 |</span><br><span class="line">| 猪八戒    | 2018-03-05 |    18 |</span><br><span class="line">+-----------+------------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>​    这个例子中<code>user_kills</code>这张表关联了两次，目的是第一次是为了查询出最终的结果集==时间==和==杀怪数量==，第二次是为了跟<code>HAVING</code>从句中使用来得出最大的杀怪数量是多少。</p>
<h3 id="实现分组选择"><a href="#实现分组选择" class="headerlink" title="实现分组选择"></a>实现分组选择</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/JavaScript/Node%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/JavaScript/Node%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/" class="post-title-link" itemprop="url">Node实现canvas图片上传</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-01 14:20:10" itemprop="dateCreated datePublished" datetime="2018-03-01T14:20:10+08:00">2018-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Node实现canvas图片上传"><a href="#Node实现canvas图片上传" class="headerlink" title="Node实现canvas图片上传"></a>Node实现canvas图片上传</h1><blockquote>
<p>转自：<a href="https://cnodejs.org/topic/4f939c84407edba2143c12f7" target="_blank" rel="noopener">https://cnodejs.org/topic/4f939c84407edba2143c12f7</a></p>
</blockquote>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>​    目前流行的“你画我猜”应用，你有没有想过使用HTML5来实现过？那么不可避免的需要解决canvas保存图片到硬盘或mongodb之类的数据库。本文主要介绍使用nodejs将html5 canvas base64编码图片保存为文件，同时提供两种解决方案。</p>
<p>​    html5 canvas属于客户端API，没有权限去保存图片到硬盘，只有canvas . toDataURL()这一个接口可导出画布的base64编码，以提供给服务端进行处理保存，据我所知.net和php都有方法或类来进行简单的处理保存。nodejs呢？是的，没错！nodejs同样有能力来保存base64编码的图片。</p>
<h2 id="解决方案一"><a href="#解决方案一" class="headerlink" title="解决方案一"></a>解决方案一</h2><p>使用new Buffer来创建对应编码的缓冲，通过fs模块将Buffer写成一个文件。</p>
<p>优点：简单易用，无需其它模块的支持。</p>
<p>缺点：不能对图片的尺寸，水印，压缩，格式等进行处理。</p>
<p><strong>注意点：</strong></p>
<ol>
<li>new Buffer接收到base64编码，不能带data:URL，而使用canvas . toDataURL()导出的base64编码会带data:URL，所以需要先过滤掉类似这样的一段“data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0”需过滤成：“iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0”</li>
<li>’binary’ – 一种只使用每个字符前8个字节将原始的二进制数据编码进字符串的方式。这个方式已经废弃，应当尽量使用buffer 对象。这个编码将会在未来的node 中删除。==看到有人把base64声明的Buffer再转换成binary，这个是完全没必要的。==</li>
</ol>
<p>3、生成的图片有size变化，但是打开后是一个无效的图像，这个看本文的第三点。</p>
<p><strong>使用express搭建的/upload (POST)上传保存接口，完成代码如下：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">module</span>.exports = express();</span><br><span class="line"><span class="comment">//配置</span></span><br><span class="line">app.configure(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  app.use(express.bodyParser());</span><br><span class="line">  app.use(express.methodOverride());</span><br><span class="line">  app.use(express.cookieParser(<span class="string">'keyboard cat'</span>));</span><br><span class="line">  app.use(express.session());</span><br><span class="line">  app.use(app.router);</span><br><span class="line">  app.use(express.static(__dirname + <span class="string">'/up'</span>)); <span class="comment">//静态文件目录</span></span><br><span class="line">  app.use(express.errorHandler(&#123; <span class="attr">dumpExceptions</span>: <span class="literal">true</span>, <span class="attr">showStack</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//保存base64图片POST方法</span></span><br><span class="line">app.post(<span class="string">'/upload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//接收前台POST过来的base64</span></span><br><span class="line">	<span class="keyword">var</span> imgData = req.body.imgData;</span><br><span class="line">	<span class="comment">//过滤data:URL</span></span><br><span class="line">	<span class="keyword">var</span> base64Data = imgData.replace(<span class="regexp">/^data:image\/\w+;base64,/</span>, <span class="string">""</span>);</span><br><span class="line">	<span class="keyword">var</span> dataBuffer = <span class="keyword">new</span> Buffer(base64Data, <span class="string">'base64'</span>);</span><br><span class="line">	fs.writeFile(<span class="string">"out.png"</span>, dataBuffer, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		  res.send(err);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		  res.send(<span class="string">"保存成功！"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">module</span>.parent) &#123;</span><br><span class="line">  app.listen(<span class="number">8000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Express started on port 8000'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##解决方案二：</p>
<p>使用node-canvas模块进行图片处理和保存。</p>
<p>​    优点：能对图片像html5 canvas一样进行处理，尺寸调整、水印、图片反转色、格式转换</p>
<p>​    缺点：需安装模块支持、当base64编码有误不能解析成图片时会报错并停止nodejs服务。</p>
<p>​    注意点：canvas透明背景，默认为黑色；使用base64给img.src赋值时，需带上data:URL</p>
<p><strong>使用express搭建的/upload (POST)上传保存接口，完成代码如下：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Canvas = <span class="built_in">require</span>(<span class="string">'canvas'</span>); <span class="comment">//需安装canvas模块</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="built_in">module</span>.exports = express();</span><br><span class="line"><span class="comment">//配置</span></span><br><span class="line">app.configure(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  app.use(express.bodyParser());</span><br><span class="line">  app.use(express.methodOverride());</span><br><span class="line">  app.use(express.cookieParser(<span class="string">'keyboard cat'</span>));</span><br><span class="line">  app.use(express.session());</span><br><span class="line">  app.use(app.router);</span><br><span class="line">  app.use(express.static(__dirname + <span class="string">'/up'</span>)); <span class="comment">//静态文件目录</span></span><br><span class="line">  app.use(express.errorHandler(&#123; <span class="attr">dumpExceptions</span>: <span class="literal">true</span>, <span class="attr">showStack</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/upload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> base64Data = req.body.imgData;</span><br><span class="line">	<span class="keyword">var</span> img = <span class="keyword">new</span> Canvas.Image;</span><br><span class="line"></span><br><span class="line">	img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> w = img.width;</span><br><span class="line">		<span class="keyword">var</span> h = img.height;</span><br><span class="line">		<span class="keyword">var</span> canvas = <span class="keyword">new</span> Canvas(w, h);</span><br><span class="line">		<span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">		ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> out = fs.createWriteStream(__dirname + <span class="string">'/crop.jpg'</span>);</span><br><span class="line">		<span class="keyword">var</span> stream = canvas.createJPEGStream(&#123;</span><br><span class="line">			bufsize : <span class="number">2048</span>,</span><br><span class="line">			quality : <span class="number">80</span></span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		stream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</span><br><span class="line">			out.write(chunk);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		stream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			out.end();</span><br><span class="line">			res.send(<span class="string">"上传成功！"</span>);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">		res.send(err);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	img.src = base64Data;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">module</span>.parent) &#123;</span><br><span class="line">  app.listen(<span class="number">8000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Express started on port 3000'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>容易出现的错误（base64编码中，不容忽视的“+”号）</strong></p>
<ol>
<li>如果canvas没有任何像素，则返回值为：“data:,”，这是最短的data:URL，代码中最好做一下保护。</li>
<li>使用解决方案一实现图片保存，生成的图片有size，但是打开后却是不能识别的无效图像。</li>
</ol>
<p>使用解决方案二实现图片保存，nodejs直接报错，并且服务挂掉。</p>
<p><strong>原因：</strong></p>
<p>这个问题，花了我很长时间才找到原因，根本原因是base64编码，使用express接收POST值后，base64编码字符串中的“+”号被替换成空格了，引起编码出错，img.src = base64Data;直接把nodejs服务挂掉。如果你出现类似问题，请console.log(base64Data);看字符串是否有空格。</p>
<p><strong>解决办法：</strong></p>
<p>将空格替换回“+”号</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base64Data = imgData.replace(<span class="regexp">/\s/g</span>,<span class="string">"+"</span>);</span><br></pre></td></tr></table></figure>



<p>​    </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ccbeango"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Ccbeango</p>
  <div class="site-description" itemprop="description">个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ccbeango" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ccbeango" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:liuyh940@gmail.com" title="E-Mail → mailto:liuyh940@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ccbeango</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  


</body>
</html>
