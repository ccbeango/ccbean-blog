<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="凹凸豆的博客">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="凹凸豆的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ccbeango">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>凹凸豆的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">凹凸豆的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">那天，黄昏，开始飘起来白雪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/Linux/Linux%E4%B8%8B%E5%AE%89%E8%A3%85phpMyAdmin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/Linux/Linux%E4%B8%8B%E5%AE%89%E8%A3%85phpMyAdmin/" class="post-title-link" itemprop="url">Linux系统目录结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-27 15:27:10" itemprop="dateCreated datePublished" datetime="2018-01-27T15:27:10+08:00">2018-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux下安装phpMyAdmin"><a href="#Linux下安装phpMyAdmin" class="headerlink" title="Linux下安装phpMyAdmin"></a>Linux下安装phpMyAdmin</h1><h3 id="1-下载phpMyAdmin"><a href="#1-下载phpMyAdmin" class="headerlink" title="1.下载phpMyAdmin"></a>1.下载phpMyAdmin</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget  https:&#x2F;&#x2F;files.phpmyadmin.net&#x2F;phpMyAdmin&#x2F;4.7.4&#x2F;phpMyAdmin-4.7.4-all-languages.zip</span><br></pre></td></tr></table></figure>

<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h3><p>解压并改名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo unzip phpMyAdmin-4.7.4-all-languages.zip </span><br><span class="line">sudo mv phpMyAdmin-4.7.4-all-languages phpMyAdmin</span><br></pre></td></tr></table></figure>

<p>找到 <code>phpMyAdmin/libraries/config.default.php</code>文件，将<code>config.default.php</code>复制到<code>phpmyadmin</code>目录下，然后更名为<code>config.inc.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp  libraries&#x2F;config.default.php .&#x2F;config.inc.php</span><br></pre></td></tr></table></figure>

<p><strong>对config.inc.php文件进行vi编辑：</strong></p>
<ol>
<li><p>查找 <code>$cfg[&#39;PmaAbsoluteUri&#39;]</code> 修改为你将上传到空间的phpMyAdmin的网址：</p>
<p>如：$cfg[‘PmaAbsoluteUri’] = ‘<a href="http://192.168.1.11/phpMyAdmin/" target="_blank" rel="noopener">http://192.168.11.115/phpMyAdmin/</a>‘;</p>
</li>
<li><p>查找 <code>$cfg[&#39;Servers&#39;][$i][&#39;host&#39;] = &#39;localhost&#39;;</code>（通常用默认，也有例外，可以不用修改）</p>
</li>
<li><p>查找<code>$cfg[&#39;Servers&#39;][$i][&#39;auth_type&#39;] = &#39;config&#39;;</code></p>
<p>　　在自己的机子里调试用config；如果在网络上的空间用cookie，这里我们既然在前面已经添加了网址，就修改成cookie ，这里建议使用cookie。</p>
</li>
<li><p>查找 <code>$cfg[&#39;Servers&#39;][$i][&#39;user&#39;] = &#39;root&#39;;</code>   MySQL user（mysql用户名，自己机里用root；）</p>
</li>
<li><p>查找<code>$cfg[&#39;Servers&#39;][$i][&#39;password&#39;] = &#39;&#39;;</code>   MySQL password (mysql用户的密码,自己的服务器一般都是mysql用户root的密码)</p>
</li>
<li><p>查找 <code>$cfg[&#39;Servers&#39;][$i][&#39;only_db&#39;] = &#39;&#39;;</code>   If set to a db-name, only（你只有一个数据就设置一下；如果你在本机或想架设服务器，那么建议留空</p>
</li>
<li><p>查找<code>$cfg[&#39;DefaultLang&#39;] = &#39;zh&#39;;</code> （这里是选择语言，zh代表简体中文的意思,这里不知道填gbk对否）</p>
</li>
<li><p>设置完毕后保存退出即可。</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/Linux/Linux%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/Linux/Linux%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">Linux系统目录结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-27 15:27:10" itemprop="dateCreated datePublished" datetime="2018-01-27T15:27:10+08:00">2018-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux系统目录结构"><a href="#Linux系统目录结构" class="headerlink" title="Linux系统目录结构"></a>Linux系统目录结构</h1><p>在终端运行<code>ls /</code>可看到如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mcee@mcee ~]$ ls /</span><br><span class="line">bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  etc  lib   media  opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>

<p>树状目录结构：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Linux/linux%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.jpg" alt="./images/1.jpg"></p>
<h4 id="树状目录结构解释："><a href="#树状目录结构解释：" class="headerlink" title="树状目录结构解释："></a>树状目录结构解释：</h4><ul>
<li><p><strong>/bin</strong>/</p>
<ul>
<li>bin是Binary的缩写, 这个目录存放着最经常使用的命令。</li>
<li>存放系统命令的目录，普通用户和超级用户都可以执行。不过，放在/bin下的命令在单用户模式下也可以执行。</li>
</ul>
</li>
<li><p><strong>/sbin/</strong></p>
<ul>
<li>s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。</li>
<li>保存和系统环境设置相关的命令，只有超级用户可以使用这些命令进行系统环境设置，但是有些命令可以允许普通用户查看。</li>
</ul>
</li>
<li><p><strong>/usr/bin/</strong></p>
<ul>
<li>系统用户使用的应用程序。</li>
<li>存放系统命令目录，普通用户和超级用户都可以执行。这些命令和系统启动无关，在单用户模式下不能执行。</li>
</ul>
</li>
<li><p><strong>/usr/sbin/</strong></p>
<ul>
<li>超级用户使用的比较高级的管理程序和系统守护程序。</li>
<li>存放根文件系统不必要的系统管理命令，例如多数服务程序。只有超级用户可以使用。大家其实可以注意到Linux的系统，在所有“sbin” 目录中保存的命令只有超级用户可以使用，“bin”目录中保存的命令所有用户都可以使用。</li>
</ul>
</li>
<li><p><strong>/boot/</strong></p>
<ul>
<li>这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。</li>
<li>系统启动目录，保存系统启动相关的文件，如内核文件和启动引导程序（grub）文件等。</li>
</ul>
</li>
<li><p><strong>/dev/</strong></p>
<ul>
<li>dev是Device(设备)的缩写, 该目录下存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。</li>
<li>设备文件保存位置。Linux中所有内容以文件方式保存，包括硬件。这个目录就是用来保存所有硬件设备文件的。</li>
</ul>
</li>
<li><p><strong>/etc/</strong></p>
<ul>
<li>这个目录用来存放所有的系统管理所需要的配置文件和子目录。</li>
<li>配置文件保存位置。系统内所有采用默认安装方式（rpm安装）的服务的配置文件都保存在这个目录中，如用户账户和密码、服务的启动脚本、常用服务的配置文件等。</li>
</ul>
</li>
<li><p><strong>/home/</strong></p>
<ul>
<li>用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。</li>
<li>普通用户的家目录。建立每个用户时，每个用户要有一个默认登录位置，这个位置就是用户的家目录，所有普通用户的家目录就是在/home下建立一个和用户名相同的目录。</li>
</ul>
</li>
<li><p><strong>/lib/</strong></p>
<ul>
<li>这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。</li>
<li>系统调用的函数库保存位置</li>
</ul>
</li>
<li><p><strong>/lost+found/</strong></p>
<ul>
<li>这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</li>
<li>当系统意外崩溃或机器意外关机，而产生一些文件碎片放在这里。当系统启动的过程中fsck工具会检查这里，并修复已经损坏的文件系统。这个目录只在每个分区中出现，例如/lost+found就是根分区的备份回复目录；/bootlost+found就是/boot分区的备份恢复目录</li>
</ul>
</li>
<li><p><strong>/media/</strong></p>
<ul>
<li>linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。</li>
<li>挂载目录。系统建议用户挂载媒体设备的，例如软盘和光盘</li>
</ul>
</li>
<li><p><strong>/mnt/</strong></p>
<ul>
<li>系统提供该目录是为了让用户临时挂载别的文件系统的，可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</li>
<li>挂载目录。早起Linux中只有这一个挂载目录，并没有细分。现在这个目录系统建议挂载额外设备，如U盘，移动硬盘和其他操作系统的分区</li>
</ul>
</li>
<li><p><strong>/misc/</strong></p>
<ul>
<li>挂载目录。系统建议用来挂载NFS服务的共享目录。</li>
</ul>
</li>
<li><p><strong>/opt/</strong></p>
<ul>
<li>这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</li>
<li>第三方安装的软件保存位置。这个目录就是放置和安装其他软件的位置，手工安装的源码包软件都可以安装在这个目录中。</li>
<li>安装在/usr/local/中挺好的，可以不安装在这里，习惯问题</li>
</ul>
</li>
<li><p><strong>/proc/</strong> </p>
<ul>
<li><p>这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure>
</li>
<li><p>虚拟文件系统。该目录中的数据并不保存在硬盘中，而是保存到内存中。主要保存系统的内核、进程、外部设备状态和网络状态灯。如/proc/cpuinfo是保存CPU信息的、/proc/devices是保存设备驱动的列表的、/proc/filesystems是保存文件系统列表的、/proc/net/是保存网络协议信息的</p>
</li>
</ul>
</li>
<li><p><strong>/sys/</strong></p>
<ul>
<li>虚拟文件系统。和/proc目录相似，都是保存在内存当中的，主要是保存内核相关信息的</li>
</ul>
</li>
<li><p><strong>/root/</strong></p>
<ul>
<li>该目录为系统管理员，也称作超级权限者的用户主目录。</li>
</ul>
</li>
<li><p><strong>/srv/</strong></p>
<ul>
<li>该目录存放一些服务启动之后需要提取的数据。</li>
<li>服务数据目录。一些系统服务启动之后，可以在这个目录中保存所需要的数据</li>
</ul>
</li>
<li><p><strong>/tmp/</strong></p>
<ul>
<li>这个目录是用来存放一些临时文件的。</li>
<li>临时目录。系统存放临时文件的目录，该目录下所有用户都可以访问和写入。</li>
</ul>
</li>
<li><p><strong>/usr/</strong></p>
<ul>
<li>这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</li>
<li>系统软件资源目录。是“Unix Software Resource”的缩写，所以存放系统软件资源的目录。系统中安装的软件大多数保存在这里。</li>
</ul>
</li>
<li><p><strong>/usr/src</strong></p>
<ul>
<li>内核源代码默认的放置目录</li>
</ul>
</li>
<li><p><strong>/var/</strong></p>
<ul>
<li>动态数据保存位置。主要保存缓存、日志以及软件运行所产生的文件。</li>
</ul>
</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>​    在linux系统中，有几个目录是比较重要的，平时需要注意不要误删除或者随意更改内部文件。</p>
<p><code>/etc</code>： 上边也提到了，这个是系统中的配置文件，如果你更改了该目录下的某个文件可能会导致系统不能启动。</p>
<p><code>/bin, /sbin, /usr/bin, /usr/sbin</code>: 这是系统预设的执行文件的放置目录，比如 ls 就是在/bin/ls 目录下的。</p>
<p>值得提出的是，/bin, /usr/bin 是给系统用户使用的指令（除root外的通用户），而/sbin, /usr/sbin 则是给root使用的指令。</p>
<p><code>/var</code>： 这是一个非常重要的目录，系统上跑了很多程序，那么每个程序都会有相应的日志产生，而这些日志就被记录到这个目录下，具体在/var/log 目录下，另外mail的预设放置也是在这里。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/PHP/PHP%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84%E6%8E%92%E5%BA%8F-%E4%BF%9D%E6%8C%81%E7%B4%A2%E5%BC%95%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB,%E5%B7%A7%E7%94%A8uasort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/PHP/PHP%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84%E6%8E%92%E5%BA%8F-%E4%BF%9D%E6%8C%81%E7%B4%A2%E5%BC%95%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB,%E5%B7%A7%E7%94%A8uasort/" class="post-title-link" itemprop="url">PHP 多维数组排序 保持索引对应关系 巧用 uasort</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-18 13:00:10" itemprop="dateCreated datePublished" datetime="2018-01-18T13:00:10+08:00">2018-01-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="PHP-多维数组排序-保持索引对应关系-巧用-uasort"><a href="#PHP-多维数组排序-保持索引对应关系-巧用-uasort" class="headerlink" title="PHP 多维数组排序 保持索引对应关系 巧用 uasort"></a>PHP 多维数组排序 保持索引对应关系 巧用 uasort</h1><p>​    实际开发中，多多少少都会遇到数组的排序问题，除了常规的写简单的排序算法，PHP 还提供了内置数组排序函数，本次重点分享一下：<a href="http://www.php.net/manual/zh/function.uasort.php" target="_blank" rel="noopener">uasort</a>  使用用户自定义的比较函数对数组中的值进行排序并保持索引关联，可排序多维数组，本文重点讲解此函数。 </p>
<p><strong>uasort 函数</strong></p>
<p>​    参数类型：bool uasort ( array &amp;$array, callable $cmp_function)</p>
<p>​    本函数对数组排序并保持索引和单元之间的关联。</p>
<p>​    主要用于对那些单元顺序很重要的结合数组进行排序。比较函数是用户自定义的。</p>
<p>​    成功时返回 TRUE， 或者在失败时返回 FALSE。 </p>
<p><strong>数组排序实例（非class中）：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 自定义排序函数</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $param1</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $param2</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 0(不移动) 1(正向调换顺序) -1(逆向调换顺序)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_sort</span><span class="params">($param1, $param2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($param1 == $param2) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> $param1 &gt; $param2 ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'a'</span>=&gt;<span class="string">'20'</span>,</span><br><span class="line">            <span class="string">'b'</span>=&gt;<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'c'</span>=&gt;<span class="string">'10'</span>,</span><br><span class="line">            <span class="string">'d'</span>=&gt;<span class="string">'5'</span>,</span><br><span class="line">            <span class="string">'e'</span>=&gt;<span class="string">'21'</span>,</span><br><span class="line">            <span class="string">'f'</span>=&gt;<span class="string">'4'</span>,</span><br><span class="line">            <span class="string">'g'</span>=&gt;<span class="string">'3'</span>,</span><br><span class="line">        );</span><br><span class="line">uasort($arr, <span class="string">'my_sort'</span>);</span><br><span class="line">var_dump($arr);</span><br><span class="line"><span class="comment">/*输出值</span></span><br><span class="line"><span class="comment">array (size=7)</span></span><br><span class="line"><span class="comment">  'b' =&gt; string '1' (length=1)</span></span><br><span class="line"><span class="comment">  'g' =&gt; string '3' (length=1)</span></span><br><span class="line"><span class="comment">  'f' =&gt; string '4' (length=1)</span></span><br><span class="line"><span class="comment">  'd' =&gt; string '5' (length=1)</span></span><br><span class="line"><span class="comment">  'c' =&gt; string '10' (length=2)</span></span><br><span class="line"><span class="comment">  'a' =&gt; string '20' (length=2)</span></span><br><span class="line"><span class="comment">  'e' =&gt; string '21' (length=2)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<p><strong>多维数组排序实例（非class中）：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 自定义排序函数</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $param1</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $param2</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 0(不移动) 1(正向调换顺序) -1(逆向调换顺序)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_sort</span><span class="params">($param1, $param2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($param1[<span class="string">'value'</span>] == $param2[<span class="string">'value'</span>]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> $param1[<span class="string">'value'</span>] &gt; $param2[<span class="string">'value'</span>] ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'a'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义1'</span>, <span class="string">'value'</span>=&gt;<span class="string">'20'</span>),</span><br><span class="line">            <span class="string">'b'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义2'</span>, <span class="string">'value'</span>=&gt;<span class="string">'1'</span>),</span><br><span class="line">            <span class="string">'c'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义3'</span>, <span class="string">'value'</span>=&gt;<span class="string">'10'</span>),</span><br><span class="line">            <span class="string">'d'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义4'</span>, <span class="string">'value'</span>=&gt;<span class="string">'5'</span>),</span><br><span class="line">            <span class="string">'e'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义5'</span>, <span class="string">'value'</span>=&gt;<span class="string">'21'</span>),</span><br><span class="line">            <span class="string">'f'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义6'</span>, <span class="string">'value'</span>=&gt;<span class="string">'4'</span>),</span><br><span class="line">            <span class="string">'g'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义7'</span>, <span class="string">'value'</span>=&gt;<span class="string">'3'</span>),</span><br><span class="line">        );</span><br><span class="line">uasort($arr, <span class="string">'my_sort'</span>);</span><br><span class="line">var_dump($arr);</span><br><span class="line"><span class="comment">/*输出值</span></span><br><span class="line"><span class="comment">array (size=7)</span></span><br><span class="line"><span class="comment">  'b' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义2' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '1' (length=1)</span></span><br><span class="line"><span class="comment">  'g' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义7' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '3' (length=1)</span></span><br><span class="line"><span class="comment">  'f' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义6' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '4' (length=1)</span></span><br><span class="line"><span class="comment">  'd' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义4' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '5' (length=1)</span></span><br><span class="line"><span class="comment">  'c' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义3' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '10' (length=2)</span></span><br><span class="line"><span class="comment">  'a' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义1' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '20' (length=2)</span></span><br><span class="line"><span class="comment">  'e' =&gt;</span></span><br><span class="line"><span class="comment">    array (size=2)</span></span><br><span class="line"><span class="comment">      'key' =&gt; string '定义5' (length=7)</span></span><br><span class="line"><span class="comment">      'value' =&gt; string '21' (length=2)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<p><strong>class中排序，为了方便以二维数组为例：</strong></p>
<p>​    uasort($arr1, array($this, ‘public_my_sort’));</p>
<p>​    uasort($arr2, array(‘self’, ‘self_my_sort’));</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myClassSort</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序主方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $arr1  self静态排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $arr2  this排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 排序后的数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">($arr1 = array<span class="params">()</span>, $arr2 = array<span class="params">()</span>)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">        uasort($arr1, <span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="string">'public_my_sort'</span>));</span><br><span class="line">        </span><br><span class="line">        uasort($arr2, <span class="keyword">array</span>(<span class="string">'self'</span>, <span class="string">'self_my_sort'</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'arr1'</span>=&gt;$arr1, <span class="string">'arr2'</span>=&gt;$arr2);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义排序函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $param1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $param2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0(不移动) 1(正向调换顺序) -1(逆向调换顺序)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">self_my_sort</span><span class="params">($param1, $param2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($param1[<span class="string">'value'</span>] == $param2[<span class="string">'value'</span>]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> $param1[<span class="string">'value'</span>] &gt; $param2[<span class="string">'value'</span>] ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//同上</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">public_my_sort</span><span class="params">($param1, $param2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($param1[<span class="string">'value'</span>] == $param2[<span class="string">'value'</span>]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> $param1[<span class="string">'value'</span>] &gt; $param2[<span class="string">'value'</span>] ? <span class="number">1</span> : <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">$arr = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'a'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义1'</span>, <span class="string">'value'</span>=&gt;<span class="string">'20'</span>),</span><br><span class="line">            <span class="string">'b'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义2'</span>, <span class="string">'value'</span>=&gt;<span class="string">'1'</span>),</span><br><span class="line">            <span class="string">'c'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义3'</span>, <span class="string">'value'</span>=&gt;<span class="string">'10'</span>),</span><br><span class="line">            <span class="string">'d'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义4'</span>, <span class="string">'value'</span>=&gt;<span class="string">'5'</span>),</span><br><span class="line">            <span class="string">'e'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义5'</span>, <span class="string">'value'</span>=&gt;<span class="string">'21'</span>),</span><br><span class="line">            <span class="string">'f'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义6'</span>, <span class="string">'value'</span>=&gt;<span class="string">'4'</span>),</span><br><span class="line">            <span class="string">'g'</span>=&gt;<span class="keyword">array</span>(<span class="string">'key'</span>=&gt;<span class="string">'定义7'</span>, <span class="string">'value'</span>=&gt;<span class="string">'3'</span>),</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">$myClassSort = <span class="keyword">new</span> myClassSort();</span><br><span class="line">var_dump($myClassSort-&gt;main($arr, $arr));</span><br><span class="line"><span class="comment">/*输出结果同以上实例*/</span></span><br></pre></td></tr></table></figure>





<p><strong>类似函数扩展</strong></p>
<p>   <a href="http://www.php.net/manual/zh/function.array-multisort.php" target="_blank" rel="noopener">array_multisort</a> 对多个数组或多维数组进行排序，但是最终填入使用的还是具体一维数组</p>
<p>   <a href="http://www.php.net/manual/zh/function.arsort.php" target="_blank" rel="noopener">arsort</a>  对一维数组进行逆向排序并保持索引关系，保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.asort.php" target="_blank" rel="noopener">asort</a>  对一维数组进行正向排序并保持索引关系，保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.krsort.php" target="_blank" rel="noopener">krsort</a>  对数组按照键名逆向排序，保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.ksort.php" target="_blank" rel="noopener">ksort</a>  对数组按照键名正向排序，保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.natcasesort.php" target="_blank" rel="noopener">natcasesort</a>  用“自然排序”算法对一维数组进行不区分大小写字母的排序，可以用来排序数组内容中字母数字混合的情况，保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.natsort.php" target="_blank" rel="noopener">natsort</a>  用“自然排序”算法对一维数组排序，区分大小写字母，可以用来排序数组内容中字母数字混合的情况，保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.rsort.php" target="_blank" rel="noopener">rsort</a>  对一维数组逆向排序，不保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.sort.php" target="_blank" rel="noopener">sort</a>  对一维数组正向排序，不保持索引对应关系</p>
<p>   <a href="http://www.php.net/manual/zh/function.uasort.php" target="_blank" rel="noopener">uasort</a>  使用用户自定义的比较函数对数组中的值进行排序并保持索引关联，可排序多维数组，本文重点讲解此函数</p>
<p>   <a href="http://www.php.net/manual/zh/function.uksort.php" target="_blank" rel="noopener">uksort</a>  使用用户自定义的比较函数对数组中的键名进行排序</p>
<p>   <a href="http://www.php.net/manual/zh/function.usort.php" target="_blank" rel="noopener">usort</a>  使用用户自定义的比较函数对数组中的值进行排序，不保持索引关联</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/React/React%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%EF%BC%88%E4%B8%8B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/React/React%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%EF%BC%88%E4%B8%8B%EF%BC%89/" class="post-title-link" itemprop="url">react实现按需加载-代码分割（下）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-29 15:09:10" itemprop="dateCreated datePublished" datetime="2017-12-29T15:09:10+08:00">2017-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="react实现按需加载-代码分割（下）"><a href="#react实现按需加载-代码分割（下）" class="headerlink" title="react实现按需加载-代码分割（下）"></a>react实现按需加载-代码分割（下）</h1><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>上节中所使用的<code>webpack</code>配置的时候所安装的<code>react</code>，可以使用<code>bundle-loader</code>来实现按需加载，但是在<code>create-react-app</code>中使用会出现报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Line <span class="number">4</span>:   Unexpected <span class="string">'!'</span> <span class="keyword">in</span> <span class="string">'bundle-loader?lazy&amp;name=login!./container/login/login'</span>. Do not use <span class="keyword">import</span> syntax to configure webpack loaders                 <span class="keyword">import</span>/no-webpack-loader-syntax</span><br><span class="line">Line <span class="number">5</span>:   Unexpected <span class="string">'!'</span> <span class="keyword">in</span> <span class="string">'bundle-loader?lazy&amp;name=register!./container/register/register'</span>. Do not use <span class="keyword">import</span> syntax to configure webpack loaders        <span class="keyword">import</span>/no-webpack-loader-syntax</span><br></pre></td></tr></table></figure>

<p>这是因为create-react-app不支持webpack-loader，具体的可以看看这个<a href="https://github.com/facebookincubator/create-react-app/issues/2477" target="_blank" rel="noopener">issue</a>，在这个issue中给出了解决方案。</p>
<h3 id="一、根据router实现按需加载"><a href="#一、根据router实现按需加载" class="headerlink" title="一、根据router实现按需加载"></a>一、根据router实现按需加载</h3><p>1.未按需加载前，原文件<code>router.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route,Switch,Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'./container/login/login'</span></span><br><span class="line"><span class="keyword">import</span> Register <span class="keyword">from</span> <span class="string">"./container/register/register"</span>;</span><br><span class="line"><span class="keyword">import</span> Bossinfo <span class="keyword">from</span> <span class="string">"./container/bossinfo/bossinfo"</span>;</span><br><span class="line"><span class="keyword">import</span> Geniusinfo <span class="keyword">from</span> <span class="string">"./container/geniusinfo/geniusinfo"</span>;</span><br><span class="line"><span class="keyword">import</span> AuthRoute <span class="keyword">from</span> <span class="string">"./components/authroute/authroute"</span>;</span><br><span class="line"><span class="keyword">import</span> Dashboard <span class="keyword">from</span> <span class="string">"./components/dashboard/dashboard"</span>;</span><br><span class="line"><span class="keyword">import</span> Chat <span class="keyword">from</span> <span class="string">'./components/chat/chat'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            hasError:<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidCatch(err,info)&#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            hasError:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            <span class="keyword">this</span>.state.hasError ? <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">'/msg'</span>&gt;</span><span class="tag">&lt;/<span class="name">Redirect</span>&gt;</span></span></span><br><span class="line">                :</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;AuthRoute/&gt;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/login'</span> component=&#123;Login&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Route path='/</span>register<span class="string">' component=&#123;Register&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/bossinfo<span class="string">' component=&#123;Bossinfo&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/geniusinfo<span class="string">' component=&#123;Geniusinfo&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/chat/:user<span class="string">' component=&#123;Chat&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route component=&#123;Dashboard&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>2.使用<code>AsyncComponent.js</code>，最原始的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      mod: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;<span class="attr">default</span>: mod&#125; = <span class="keyword">await</span> <span class="keyword">this</span>.props.load()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      mod: mod.default || mod</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="keyword">this</span>.state.mod ? <span class="keyword">this</span>.props.children(<span class="keyword">this</span>.state.mod) : <span class="literal">null</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Bundle</span><br></pre></td></tr></table></figure>

<p>然后在入口文件中这么使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter,</span><br><span class="line">  Route</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> Bundle <span class="keyword">from</span> <span class="string">'./bundle'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> CodeSplit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;BrowserRouter&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Route path=&#123;<span class="string">'/cp1'</span>&#125; render=&#123;() =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="function">(<span class="params">&lt;Bundle load=&#123;(</span>) =&gt;</span> <span class="keyword">import</span>(<span class="string">'./cp1'</span>)&#125;&gt;</span><br><span class="line">            &#123;(Cp1) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Cp1</span>&gt;</span><span class="tag">&lt;/<span class="name">Cp1</span>&gt;</span></span>&#125;</span><br><span class="line">          &lt;<span class="regexp">/Bundle&gt;)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        &#125;&gt;&lt;/</span>Route&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Route path=&#123;<span class="string">'/cp2'</span>&#125; render=&#123;() =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="function">(<span class="params">&lt;Bundle load=&#123;(</span>) =&gt;</span> <span class="keyword">import</span>(<span class="string">'./cp2'</span>)&#125;&gt;</span><br><span class="line">            &#123;(Cp2) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Cp2</span>&gt;</span><span class="tag">&lt;/<span class="name">Cp2</span>&gt;</span></span>&#125;</span><br><span class="line">          &lt;<span class="regexp">/Bundle&gt;)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        &#125;&gt;&lt;/</span>Route&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>BrowserRouter&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CodeSplit</span><br></pre></td></tr></table></figure>

<p>这样进行使用太麻烦了，可以进行优化改进，下面是改进的使用方案，让其能够更优雅地进行使用。</p>
<p>3.创建文件<code>AsyncComponent.js</code>，因为import返回一个promise，所以我们这里将componentDidMount变成一个async函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncComponent</span>(<span class="params">importComponent</span>) </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AsyncComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        component: <span class="literal">null</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">default</span>: component &#125; = <span class="keyword">await</span> importComponent();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        component: component</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> C = <span class="keyword">this</span>.state.component;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> C ? <span class="xml"><span class="tag">&lt;<span class="name">C</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span> : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> AsyncComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.使用<code>AsyncComponent</code></p>
<p>我们原来导入组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./containers/Home"</span>;</span><br></pre></td></tr></table></figure>

<p>现在导入组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AsyncHome = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./containers/Home"</span>));</span><br></pre></td></tr></table></figure>

<p>当创建<code>AsyncHome</code>时，调用的函数<code>asyncComponent</code>会动态地<code>import</code>组件；然后<code>Route</code>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/"</span> exact component=&#123;AsyncHome&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncComponent <span class="keyword">from</span> <span class="string">'./async-component'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取到异步组件</span></span><br><span class="line"><span class="keyword">const</span> AsyncDemo = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./demo'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Route path=<span class="string">"/demo"</span> component=&#123;AsyncDemo&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 如果要传参 这样会router中的参数以0下标传入，感觉并不合理，还没找到合理的办法 更合理的办法应该是修改async函数，但是不知道怎么修改 不知道我这理解对不对</span></span><br><span class="line"><span class="regexp">render() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;Route path="/</span>demo<span class="string">" render=&#123;(...props) =&gt; &#123;</span></span><br><span class="line"><span class="string">        &lt;AsyncDemo test="</span>hello<span class="string">" &#123;...props&#125;&gt;&lt;/AsyncDemo&gt;</span></span><br><span class="line"><span class="string">    &#125;&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后修改入口文件就像这样：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route,Switch,Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> asyncComponent <span class="keyword">from</span> <span class="string">'./Bundle'</span></span><br><span class="line"><span class="keyword">const</span> Login = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./container/login/login"</span>));</span><br><span class="line"><span class="keyword">const</span> Register = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./container/register/register"</span>));</span><br><span class="line"><span class="keyword">const</span> Bossinfo = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./container/bossinfo/bossinfo"</span>));</span><br><span class="line"><span class="keyword">const</span> Geniusinfo = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./container/geniusinfo/geniusinfo"</span>));</span><br><span class="line"><span class="keyword">const</span> AuthRoute = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./components/authroute/authroute"</span>));</span><br><span class="line"><span class="keyword">const</span> Dashboard = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./components/dashboard/dashboard"</span>));</span><br><span class="line"><span class="keyword">const</span> Chat = asyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./components/chat/chat"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            hasError:<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidCatch(err,info)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err,info);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            hasError:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            <span class="keyword">this</span>.state.hasError ? <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">'/msg'</span>&gt;</span><span class="tag">&lt;/<span class="name">Redirect</span>&gt;</span></span></span><br><span class="line">                :</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;AuthRoute/&gt;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/login'</span> component=&#123;Login&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Route path='/</span>register<span class="string">' component=&#123;Register&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/bossinfo<span class="string">' component=&#123;Bossinfo&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/geniusinfo<span class="string">' component=&#123;Geniusinfo&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/chat/:user<span class="string">' component=&#123;Chat&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route component=&#123;Dashboard&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>

<p>执行<code>npm run build</code>可看到文件被<code>code-spliting</code></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/React/%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E4%B8%8B1.jpeg" alt="点击"></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/React/%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E4%B8%8B2.jpeg" alt=""></p>
<p>###二、以组件为中心进行代码分片</p>
<p>待续···</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/React/%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/React/%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84redux/" class="post-title-link" itemprop="url">构建自己的redux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-29 15:09:10" itemprop="dateCreated datePublished" datetime="2017-12-29T15:09:10+08:00">2017-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="构建自己的redux"><a href="#构建自己的redux" class="headerlink" title="构建自己的redux"></a>构建自己的redux</h1><h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><p><code>redux</code>的基本概念：</p>
<blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html</a></p>
</blockquote>
<h3 id="一、构建自己的redux"><a href="#一、构建自己的redux" class="headerlink" title="一、构建自己的redux"></a>一、构建自己的redux</h3><p>在redux中，对外主要提供<code>createStore</code>和<code>applyMiddleware</code>两种方法，具体的代码块如下：</p>
<p>创建<code>piggy-redux.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 片段一</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer,enhancer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果有中间件，那么就用中间件包裹一层</span></span><br><span class="line">    <span class="keyword">if</span>(enhancer)&#123;</span><br><span class="line">        <span class="keyword">return</span> enhancer(createStore)(reducer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> currentState = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> currentListeners = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> currentState;</span><br><span class="line">    <span class="keyword">const</span> subscribe = <span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">        currentListeners.push(listener);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">        currentState = reducer(currentState,action);</span><br><span class="line">        currentListeners.map(<span class="function"><span class="params">v</span> =&gt;</span> v());</span><br><span class="line">        <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化的时候getState就能获取到值，先执行下dispatch</span></span><br><span class="line">    dispatch(&#123;<span class="attr">type</span>:<span class="string">'@@piggy-redux'</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;getState,subscribe,dispatch&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>redux提供<code>createStore</code>来返回一个对象，对象中包含的方法有：</p>
<ul>
<li><code>getState</code>来获取此时的<code>state</code>状态</li>
<li><code>subscribe</code>来设置监听函数</li>
<li><code>dispatch</code>来发出<code>view</code>中的<code>action</code>到<code>reducer</code>，<code>dispatch</code>会自动操作<code>reducer</code>，所以<code>reducer</code>需要直接传进来；同时也调用了<code>subscribe</code>的函数，所以每次<code>dispatch</code>的时候被监听的函数都会被执行</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 片段二 为actionCreater包裹一层dispatch  此方法是在react-redux中使用</span></span><br><span class="line"><span class="comment">// 将actionCreater包裹dispatch 以实现dispatch发送action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span>  bindActionCreaters = <span class="function">(<span class="params">creaters,dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 写法一</span></span><br><span class="line">    <span class="comment">// let bound = &#123;&#125;;</span></span><br><span class="line">    <span class="comment">// Object.keys(creaters).forEach(v =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//    let creater = creaters[v];</span></span><br><span class="line">    <span class="comment">//    bound[v] = bindActionCreater(creater,dispatch);</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">// return bound;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写法二</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.keys(creaters).reduce(<span class="function">(<span class="params">ret,item</span>) =&gt;</span> &#123;</span><br><span class="line">        ret[item]  = bindActionCreater(creaters[item],dispatch);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;,&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用一个actioncreater函数如：addGun(…参数)，经过函数包裹后就是dispatch(addGun(...参数)) （…args）是参数透传，不理解creater中的参数怎么传过去的</span></span><br><span class="line"><span class="keyword">const</span> bindActionCreater = <span class="function">(<span class="params">creater,dispatch</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(creater(...args))</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 片段三 应用中间件</span></span><br><span class="line"><span class="comment">// 应用中间件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> applyMiddleware = <span class="function">(<span class="params">...middleWares</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> store = createStore(...args);</span><br><span class="line">        <span class="keyword">let</span> dispatch = store.dispatch;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> midApi = &#123;</span><br><span class="line">            getState:store.getState,</span><br><span class="line">            dispatch:<span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(...args)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 多个中间件</span></span><br><span class="line">        <span class="keyword">const</span> middleWareChain = middleWares.map(<span class="function"><span class="params">middleWare</span> =&gt;</span> middleWare(midApi))</span><br><span class="line">        dispatch = compose(...middleWareChain)(store.dispatch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...store,</span><br><span class="line">            dispatch</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">...funcs</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(funcs.length === <span class="number">0</span>) <span class="keyword">return</span> <span class="function"><span class="params">func</span> =&gt;</span> func;</span><br><span class="line">    <span class="keyword">if</span>(funcs.length === <span class="number">1</span>) <span class="keyword">return</span> funcs[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">ret,item</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> ret(item(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二、构建react-redux"><a href="#二、构建react-redux" class="headerlink" title="二、构建react-redux"></a>二、构建react-redux</h3><p>使用<code>react-redux</code>可以在react中优雅地使用redux。首先引入需要使用的类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types’;</span></span><br><span class="line"><span class="string">import &#123;bindActionCreaters&#125; from '</span>./piggy-redux<span class="string">';</span></span><br></pre></td></tr></table></figure>

<p>react-redux主要提供两个方法，</p>
<ul>
<li>一个是Provider：把store放到context中，所有的子元素可以直接取到store；</li>
<li>另一个是connect：负责连接组件，将redux里的数据放到组件的属性里。作用是负责接受一个组件，将一些state放入进去；数据变化时，能够通知组件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Provider</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">        store: PropTypes.object</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getChildContext()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">store</span>:<span class="keyword">this</span>.store&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(props,context)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props,context);</span><br><span class="line">        <span class="keyword">this</span>.store = props.store;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> connect = <span class="function">(<span class="params">mapStateToProps = state =&gt; state,mapDispatchToProps = &#123;&#125;</span>) =&gt;</span> <span class="function"><span class="params">WrapComponent</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">        <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">            store:PropTypes.object</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">constructor</span>(props,context)&#123;</span><br><span class="line">            <span class="keyword">super</span>(props,context);</span><br><span class="line">            <span class="keyword">this</span>.state = &#123;</span><br><span class="line">                props:&#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        componentDidMount()&#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;store&#125; = <span class="keyword">this</span>.context;</span><br><span class="line">            <span class="comment">// 在写createStore的时候一直不明白什么时候订阅的，是谁订阅的，写到这里突然明白了，是connect订阅的，确实很优雅</span></span><br><span class="line">            store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.update())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.update();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        update()&#123;</span><br><span class="line">            <span class="comment">// 获取mapStateToProps和mapDispatchToProps将其更新到props中，使被connect包裹的组件可以直接使用store中的数据</span></span><br><span class="line">            <span class="keyword">const</span> &#123;store&#125; = <span class="keyword">this</span>.context;</span><br><span class="line">            <span class="keyword">const</span> stateProps = mapStateToProps(store.getState());</span><br><span class="line">            <span class="comment">// state可以直接传入，但是action不能直接传入，action需要diapatch把它传给store。action的生成是通过acticnCreater生成的，所以用dispatch把actionCreater包裹一层即可</span></span><br><span class="line">            <span class="comment">// 将actionCreater包裹一层dispatch;同时函数内部也应该具有dispatch功能，所有把dispatch传进去  实现此功能的函数是redux给的，所以在redux中实现此函数</span></span><br><span class="line">            <span class="keyword">const</span> dispatchProps = bindActionCreaters(mapDispatchToProps,store.dispatch);</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                props:&#123;</span><br><span class="line">                    ...this.state.props,</span><br><span class="line">                    ...stateProps,</span><br><span class="line">                    ...dispatchProps</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        render()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrapComponent</span> &#123;<span class="attr">...this.state.props</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">WrapComponent</span>&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、使用它们"><a href="#三、使用它们" class="headerlink" title="三、使用它们"></a>三、使用它们</h3><p>两个简单的中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 便于理解上面的中间件应用</span></span><br><span class="line"><span class="keyword">const</span> thunk  = <span class="function">(<span class="params">&#123;dispatch,getState&#125;</span>) =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> action === <span class="string">'function'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> action(dispatch,getState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next(action);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--------------------------------------------*/</span></span><br><span class="line"><span class="keyword">const</span> arraythunk  = <span class="function">(<span class="params">&#123;dispatch,getState&#125;</span>) =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Array</span>.isArray(action))&#123;</span><br><span class="line">        <span class="comment">// 如果是数组，遍历dispatch出数据</span></span><br><span class="line">        <span class="keyword">return</span> action.forEach(<span class="function"><span class="params">v</span> =&gt;</span> dispatch(v))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next(action);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> arraythunk;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// action type</span></span><br><span class="line"><span class="keyword">const</span> ADD_GUN = <span class="string">'ADD_GUN'</span>;</span><br><span class="line"><span class="keyword">const</span> REMOVE_GUN = <span class="string">'REMOVE_GUN'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reducer</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counter = <span class="function">(<span class="params">state = <span class="number">0</span>,action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'ADD_GUN'</span>:</span><br><span class="line">            <span class="keyword">return</span> state+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'REMOVE_GUN'</span>:</span><br><span class="line">            <span class="keyword">return</span> state<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// action creater</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addGun = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">type</span>:ADD_GUN&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span>  removeGun = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">type</span>:REMOVE_GUN&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> twiceGun = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="attr">type</span>:ADD_GUN&#125;,&#123;<span class="attr">type</span>:ADD_GUN&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeGunAsync = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    dispatch =&gt; setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(removeGun())</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'./piggy-react-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123;addGun,removeGun,removeGunAsync,twiceGun&#125; <span class="keyword">from</span> <span class="string">'./react.redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123;createSelector&#125; <span class="keyword">from</span> <span class="string">'reselect'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reselect是对redux进行优化的库</span></span><br><span class="line"><span class="keyword">const</span> numSelector = createSelector(</span><br><span class="line">    state =&gt; state,</span><br><span class="line">    <span class="comment">// 第二个函数的参数，是第一个的返回值</span></span><br><span class="line">    state =&gt; (&#123;<span class="attr">num</span>:state*<span class="number">2</span>&#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  使用装饰器优化connect的代码</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">@connect(</span><br><span class="line">    state =&gt; numSelector(state),</span><br><span class="line">    &#123;addGun,removeGun,removeGunAsync,twiceGun&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;h1&gt;现在有&#123;<span class="keyword">this</span>.props.num&#125;把枪&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.props.addGun&#125;&gt;申请武器&lt;/</span>button&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.props.removeGun&#125;&gt;上交武器&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.props.removeGunAsync&#125;&gt;等会上交&lt;/</span>button&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.props.twiceGun&#125;&gt;申请两把&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     return &#123;</span></span><br><span class="line"><span class="comment">//         num : state</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果action的方法名和在组件中使用的名称不一致，可以这样写，不过一般情况下都是保持一致的</span></span><br><span class="line"><span class="comment">// const mapDispatchToProps = (dispatch) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     return &#123;</span></span><br><span class="line"><span class="comment">//         addGun: () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//             dispatch(addGun())</span></span><br><span class="line"><span class="comment">//         &#125;,</span></span><br><span class="line"><span class="comment">//         removeGun: () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//             dispatch(removeGun())</span></span><br><span class="line"><span class="comment">//         &#125;,</span></span><br><span class="line"><span class="comment">//         removeGunAsync: () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//             dispatch(removeGunAsync())</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果一致，就可以进行简写</span></span><br><span class="line"><span class="comment">// const mapDispatchToProps = &#123;addGun,removeGun,removeGunAsync&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* connect接收两个参数，一个mapStateToProps,就是把redux的state，</span></span><br><span class="line"><span class="comment">* 转为组件的Props，还有一个参数是mapDispatchToprops,就是把</span></span><br><span class="line"><span class="comment">* dispatch(actions)的方法，转为Props属性函数。</span></span><br><span class="line"><span class="comment">* 也就是说，第一个参数是：你要state中的什么属性放到组件的props中</span></span><br><span class="line"><span class="comment">* 第二个参数是：你要actions中的什么方法放到组件的props中，并自动dispatch</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 下面的connect写法是标准的装饰器写法，就是connect先执行，然后再把App</span></span><br><span class="line"><span class="comment">* 当做参数传进来</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="comment">// App = connect(mapStateToProps,mapDispatchToProps)(App);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/React/%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%EF%BC%88%E4%B8%8A%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/React/%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%EF%BC%88%E4%B8%8A%EF%BC%89/" class="post-title-link" itemprop="url">react实现按需加载-代码分割（上）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-29 10:27:10" itemprop="dateCreated datePublished" datetime="2017-12-29T10:27:10+08:00">2017-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="react实现按需加载-代码分割（上）"><a href="#react实现按需加载-代码分割（上）" class="headerlink" title="react实现按需加载-代码分割（上）"></a>react实现按需加载-代码分割（上）</h1><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>我们直接使用<code>webpack</code>配置的<code>react</code>环境，在编译打包之后，页面只生成了一个文件<code>bundle.js</code>，这样在首屏加载时就会很慢，因为加载一个页面的时候也同时加载了其他页面的<code>js</code>，首次进入页面时，只加载自己的JS，这样首屏加载就会快很多。</p>
<h3 id="一、按需加载"><a href="#一、按需加载" class="headerlink" title="一、按需加载"></a>一、按需加载</h3><p>1.首屏加载需要使用<code>bundle-loader</code>这个插件，所以先安装这个插件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install bundle-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>2.新建<code>Bundle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            <span class="comment">// short for "module" but that's a keyword in js, so "mod"</span></span><br><span class="line">            mod: <span class="literal">null</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.load(<span class="keyword">this</span>.props)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextProps.load !== <span class="keyword">this</span>.props.load) &#123;</span><br><span class="line">            <span class="keyword">this</span>.load(nextProps)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    load(props) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            mod: <span class="literal">null</span></span><br><span class="line">        &#125;);</span><br><span class="line">        props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                <span class="comment">// handle both es imports and cjs</span></span><br><span class="line">                mod: mod.default ? mod.default : mod</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.props.children(<span class="keyword">this</span>.state.mod)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Bundle;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此文件是官方提供，参考文档</p>
</blockquote>
<p>3.改造路由器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原路由文件</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route,Switch,Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'./container/login/login'</span></span><br><span class="line"><span class="keyword">import</span> Register <span class="keyword">from</span> <span class="string">"./container/register/register"</span>;</span><br><span class="line"><span class="keyword">import</span> Bossinfo <span class="keyword">from</span> <span class="string">"./container/bossinfo/bossinfo"</span>;</span><br><span class="line"><span class="keyword">import</span> Geniusinfo <span class="keyword">from</span> <span class="string">"./container/geniusinfo/geniusinfo"</span>;</span><br><span class="line"><span class="keyword">import</span> AuthRoute <span class="keyword">from</span> <span class="string">"./components/authroute/authroute"</span>;</span><br><span class="line"><span class="keyword">import</span> Dashboard <span class="keyword">from</span> <span class="string">"./components/dashboard/dashboard"</span>;</span><br><span class="line"><span class="keyword">import</span> Chat <span class="keyword">from</span> <span class="string">'./components/chat/chat'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            hasError:<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidCatch(err,info)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err,info);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            hasError:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            <span class="keyword">this</span>.state.hasError ? <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">'/msg'</span>&gt;</span><span class="tag">&lt;/<span class="name">Redirect</span>&gt;</span></span></span><br><span class="line">                :</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;AuthRoute/&gt;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/login'</span> component=&#123;Login&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Route path='/</span>register<span class="string">' component=&#123;Register&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/bossinfo<span class="string">' component=&#123;Bossinfo&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/geniusinfo<span class="string">' component=&#123;Geniusinfo&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/chat/:user<span class="string">' component=&#123;Chat&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route component=&#123;Dashboard&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>

<p>改造：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route,Switch,Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Bundle <span class="keyword">from</span> <span class="string">'./Bundle'</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=login!./container/login/login'</span></span><br><span class="line"><span class="keyword">import</span> Register <span class="keyword">from</span> <span class="string">"bundle-loader?lazy&amp;name=register!./container/register/register"</span>;</span><br><span class="line"><span class="keyword">import</span> Bossinfo <span class="keyword">from</span> <span class="string">"bundle-loader?lazy&amp;name=bossinfo!./container/bossinfo/bossinfo"</span>;</span><br><span class="line"><span class="keyword">import</span> Geniusinfo <span class="keyword">from</span> <span class="string">"bundle-loader?lazy&amp;name=geniusinfo!./container/geniusinfo/geniusinfo"</span>;</span><br><span class="line"><span class="keyword">import</span> AuthRoute <span class="keyword">from</span> <span class="string">"bundle-loader?lazy&amp;name=authroute!./components/authroute/authroute"</span>;</span><br><span class="line"><span class="keyword">import</span> Dashboard <span class="keyword">from</span> <span class="string">"bundle-loader?lazy&amp;name=dashboard!./components/dashboard/dashboard"</span>;</span><br><span class="line"><span class="keyword">import</span> Chat <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=chat!./components/chat/chat'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Loading = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用bundle高阶组件，包裹原始组件</span></span><br><span class="line"><span class="keyword">const</span> createComponent = <span class="function">(<span class="params">component</span>) =&gt;</span> <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">    &lt;Bundle load=&#123;component&#125;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            (Component) =&gt; Component ? <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">Loading</span>/&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &lt;<span class="regexp">/Bundle&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class App extends React.Component&#123;</span></span><br><span class="line"><span class="regexp">    constructor(props)&#123;</span></span><br><span class="line"><span class="regexp">        super(props);</span></span><br><span class="line"><span class="regexp">        this.state = &#123;</span></span><br><span class="line"><span class="regexp">            hasError:false</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    componentDidCatch(err,info)&#123;</span></span><br><span class="line"><span class="regexp">        console.log(err,info);</span></span><br><span class="line"><span class="regexp">        this.setState(&#123;</span></span><br><span class="line"><span class="regexp">            hasError:true</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    render()&#123;</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            this.state.hasError ? &lt;Redirect to='/m</span>sg<span class="string">'&gt;&lt;/Redirect&gt;</span></span><br><span class="line"><span class="string">                :</span></span><br><span class="line"><span class="string">            &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;AuthRoute/&gt;</span></span><br><span class="line"><span class="string">                &lt;Switch&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/login<span class="string">' component=&#123;createComponent(Login)&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/register<span class="string">' component=&#123;createComponent(Register)&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/bossinfo<span class="string">' component=&#123;createComponent(Bossinfo)&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/geniusinfo<span class="string">' component=&#123;createComponent(Geniusinfo)&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route path='</span>/chat/:user<span class="string">' component=&#123;createComponent(Chat)&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                    &lt;Route component=&#123;createComponent(Dashboard)&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">                &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>

<p>现在你可以<code>npm start</code>，打开浏览器，看是不是进入新的页面，都会加载自己的JS的~</p>
<p>但是发现，名字都是<code>0.bundle.js</code>这样子的，分不清楚是哪个页面的<code>js</code>。</p>
<p>修改下<code>webpack.dev.config.js</code>,加个<code>chunkFilename</code>。<code>chunkFilename</code>是除了<code>entry</code>定义的入口<code>js</code>之外的<code>js</code>~</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: path.join(__dirname, './dist'),</span><br><span class="line">    filename: 'bundle.js',</span><br><span class="line">    chunkFilename: '[name].js'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在运行发现名字变成<code>home.js</code>,这样的了。</p>
<p>那么问题来了<code>home</code>是在哪里设置的？<code>webpack</code>怎么知道他叫<code>home</code>？</p>
<p>其实在这里我们定义了，<code>router.js</code>里面</p>
<p><code>import Home from &#39;bundle-loader?lazy&amp;name=home!pages/Home/Home&#39;;</code></p>
<p>这里有个<code>name=home</code>。</p>
<h3 id="二、缓存"><a href="#二、缓存" class="headerlink" title="二、缓存"></a>二、缓存</h3><p>想象一下这个场景~</p>
<p>我们网站上线了，用户第一次访问首页，下载了<code>home.js</code>，第二次访问又下载了<code>home.js</code>~</p>
<p>这肯定不行呀，所以我们一般都会做一个缓存，用户下载一次<code>home.js</code>后，第二次就不下载了。</p>
<p>有一天，我们更新了<code>home.js</code>，但是用户不知道呀，用户还是使用本地旧的<code>home.js</code>。出问题了~</p>
<p>怎么解决？每次代码更新后，打包生成的名字不一样。比如第一次叫<code>home.a.js</code>，第二次叫<code>home.b.js</code>。</p>
<p>文档<a href="https://doc.webpack-china.org/guides/caching" target="_blank" rel="noopener">看这里</a></p>
<p>我们照着文档来</p>
<p><code>webpack.dev.config.js</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: path.join(__dirname, './dist'),</span><br><span class="line">    filename: '[name].[hash].js',</span><br><span class="line">    chunkFilename: '[name].[chunkhash].js'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每次打包都用增加<code>hash</code>~</p>
<p>现在我们试试，是不是修改了文件，打包后相应的文件名字就变啦？</p>
<p><a href="https://camo.githubusercontent.com/e9c041242d52d16bc841253126000ef029ebfd99/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f7061636b6167652e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/e9c041242d52d16bc841253126000ef029ebfd99/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f7061636b6167652e706e67" alt="package"></a></p>
<p>但是你可能发现了，网页打开报错了~因为你<code>dist/index.html</code>里面引用<code>js</code>名字还是<code>bundle.js</code>老名字啊,改成新的名字就可以啦。</p>
<p>这样每次都去改名字是不现实的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/React/React%E9%9B%B6%E7%A2%8E%E7%82%B9%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/React/React%E9%9B%B6%E7%A2%8E%E7%82%B9%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">React零碎点总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-21 10:27:10" itemprop="dateCreated datePublished" datetime="2017-12-21T10:27:10+08:00">2017-12-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="React零碎点总结"><a href="#React零碎点总结" class="headerlink" title="React零碎点总结"></a>React零碎点总结</h1><p>1.<code>create-ract-app</code>可创建项目</p>
<p>2.<code>npm run eject</code>弹出配置文件，可以自定义配置 webpack配置</p>
<p>3.<code>axios</code>  Axios 是一个基于 promise 的 HTTP 库，可以用在浏览器和 node.js 中。</p>
<p>使用时，需要在package.json文件中添加后端的服务器代理地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;proxy&quot;: &quot;http:&#x2F;&#x2F;localhost:9093&quot;;</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios —-save</span><br></pre></td></tr></table></figure>

<p>4.<code>antd-mobile</code> 是样式插件，实现按需加载，需要在package.json中的babel的plugins下添加：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">"import"</span>,</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"style"</span>: <span class="string">"css"</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install antd-mobile —-save</span><br></pre></td></tr></table></figure>

<p>5.<code>babel-plugin-transform-decorators-legacy</code>  装饰器语法支，安装之后需要在babel的plugins下添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;plugins&quot;: [&quot;transform-decorators-legacy&quot;]</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-plugin-transform-decorators-legacy —-save</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">"babel": &#123;</span><br><span class="line">    "presets": [</span><br><span class="line">      <span class="string">"react-app"</span></span><br><span class="line">    ],</span><br><span class="line">    "plugins": [</span><br><span class="line">      [</span><br><span class="line">        <span class="string">"import"</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>,</span><br><span class="line">          <span class="attr">"style"</span>: <span class="string">"css"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"transform-decorators-legacy"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>非eject模式下：</p>
<h1 id="支持装饰器写法"><a href="#支持装饰器写法" class="headerlink" title="支持装饰器写法"></a>支持装饰器写法</h1><ul>
<li>找到<code>node_modules/babel-preset-react-app/index.js</code>，然后加入装饰器支持。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">  <span class="built_in">require</span>.resolve(<span class="string">'babel-plugin-transform-decorators-legacy'</span>),<span class="comment">// 支持装饰器写法 增加此行</span></span><br><span class="line">  <span class="comment">// Necessary to include regardless of the environment because</span></span><br><span class="line">  <span class="comment">// in practice some other transforms (such as object-rest-spread)</span></span><br><span class="line">  <span class="comment">// don't work without it: https://github.com/babel/babel/issues/7215</span></span><br><span class="line">  <span class="built_in">require</span>.resolve(<span class="string">'babel-plugin-transform-es2015-destructuring'</span>),</span><br><span class="line">  <span class="comment">// class &#123; handleClick = () =&gt; &#123; &#125; &#125;</span></span><br><span class="line">  <span class="built_in">require</span>.resolve(<span class="string">'babel-plugin-transform-class-properties'</span>),</span><br></pre></td></tr></table></figure>

<p>​</p>
<ul>
<li>同目录下打开<code>package.json</code>文件，末尾添加</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;babel&quot;:  &#123;</span><br><span class="line">    &quot;presets&quot;: [</span><br><span class="line">      &quot;react-app&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">      &quot;transform-decorators-legacy&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.<code>redux</code> 状态管理，提供<code>createStore</code>  <code>applyMiddleware</code> 和 <code>compose</code></p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux —-save</span><br></pre></td></tr></table></figure>

<p>7.<code>redux-thunk</code> ：中间件，使redux支持异步处理</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux-thunk —-save</span><br></pre></td></tr></table></figure>

<p>8.<code>redux-devtools-extension</code>：chrome支持redux插件，在chrome中安装Redux DevTool，之后需要添加配置， 使用compose结合thunk和window.devToolsExtension：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reduxDevTools = <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span>f;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducers,compose(</span><br><span class="line">    applyMiddleware(thunk),</span><br><span class="line">    reduxDevTools</span><br><span class="line">));</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux-devtools-extension —-save</span><br></pre></td></tr></table></figure>

<p>9.<code>react-redux</code>:提供<code>Provider</code>和<code>connect</code>两个接口，方便react和redux进行链接</p>
<ul>
<li>Provider组件在应用最外层，传入store即可，只用一次</li>
<li>Connect负责从外部获取组件需要的参数</li>
</ul>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-redux —-save</span><br></pre></td></tr></table></figure>

<p>10.<code>express</code>：基于nodejs，快速、开放、极简的web开发框架</p>
<ul>
<li>app.get、app.post 分别开发 get 和 post 接口</li>
<li>app.use 使用模块</li>
<li>代 res.send（返回html）、res.json（返回json）、res.sendfile（） 响应不同的内容</li>
</ul>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express —-save</span><br></pre></td></tr></table></figure>

<p>11.<code>nodemon</code>：可以自动重启修改后的后端服务</p>
<p>安装:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon —-save</span><br></pre></td></tr></table></figure>

<p>12.<code>mongoose</code>: 操作mongodb的驱动，即通过mongoose来操作mongodb，</p>
<p>mongoose的基础使用：</p>
<ul>
<li>Connect 链接数据库</li>
<li>定义文档模型，Schema 和 model 新建模型</li>
<li>代一个数据库文档对应一个模型，通过模型对数据库进行操作</li>
</ul>
<p>mongoose的文档类型：</p>
<ul>
<li>String，Number 等数据结构</li>
<li>create，remove , update 分别用来增、删、改的操作</li>
<li>Find  和 findOne 用来查询数据</li>
</ul>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mongoose —-save</span><br></pre></td></tr></table></figure>

<p>13.<code>cookie-parser</code>:后端支持cookie的存储</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser’)；</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">app.use(bodyParser.json());</span></span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cookie-parser —-save</span><br></pre></td></tr></table></figure>

<p>14.<code>body-parser</code>: 解析post过来的json数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser’)；</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">app.use(bodyParser.json());</span></span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install body-parser —-save</span><br></pre></td></tr></table></figure>

<p>15.<code>react-router-dom</code>:路由支持</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom —-save</span><br></pre></td></tr></table></figure>

<p>16.<code>utility</code>：密码加密库,可用于用户密码加密</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">'utility'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// md5</span></span><br><span class="line">utils.md5(<span class="string">'苏千'</span>).should.equal(<span class="string">'5f733c47c58a077d61257102b2d44481'</span>);</span><br><span class="line">utils.md5(<span class="keyword">new</span> Buffer(<span class="string">'苏千'</span>)).should.equal(<span class="string">'5f733c47c58a077d61257102b2d44481'</span>);</span><br><span class="line"><span class="comment">// md5 base64 format</span></span><br><span class="line">utils.md5(<span class="string">'苏千'</span>, <span class="string">'base64'</span>); <span class="comment">// 'X3M8R8WKB31hJXECstREgQ=='</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object md5 hash. Sorted by key, and JSON.stringify. See source code for detail</span></span><br><span class="line">utils.md5(&#123;<span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">bar</span>: <span class="string">'foo'</span>&#125;).should.equal(utils.md5(&#123;<span class="attr">bar</span>: <span class="string">'foo'</span>, <span class="attr">foo</span>: <span class="string">'bar'</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// sha1</span></span><br><span class="line">utils.sha1(<span class="string">'苏千'</span>).should.equal(<span class="string">'0a4aff6bab634b9c2f99b71f25e976921fcde5a5'</span>);</span><br><span class="line">utils.sha1(<span class="keyword">new</span> Buffer(<span class="string">'苏千'</span>)).should.equal(<span class="string">'0a4aff6bab634b9c2f99b71f25e976921fcde5a5'</span>);</span><br><span class="line"><span class="comment">// sha1 base64 format</span></span><br><span class="line">utils.sha1(<span class="string">'苏千'</span>, <span class="string">'base64'</span>); <span class="comment">// 'Ckr/a6tjS5wvmbcfJel2kh/N5aU='</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object sha1 hash. Sorted by key, and JSON.stringify. See source code for detail</span></span><br><span class="line">utils.sha1(&#123;<span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">bar</span>: <span class="string">'foo'</span>&#125;).should.equal(utils.sha1(&#123;<span class="attr">bar</span>: <span class="string">'foo'</span>, <span class="attr">foo</span>: <span class="string">'bar'</span>&#125;));</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install utility —-save</span><br></pre></td></tr></table></figure>

<p>17.<code>prop-types</code>:对属性类型进行检查</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install prop-types —-save</span><br></pre></td></tr></table></figure>

<p>18.<code>browser-cookies</code>:浏览器端处理cookie</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install browser-cookies —-save</span><br></pre></td></tr></table></figure>

<p>19.socket.io:服务端支持websocket</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install socket.io —-save</span><br></pre></td></tr></table></figure>

<p>20.<code>socket.io-client</code>:客户端支持websocket</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install socket.io-client —-save</span><br></pre></td></tr></table></figure>

<p>21.<code>immutable</code>：数据创建后不会被改变，可用于react和redux的性能优化</p>
<p>优点：</p>
<ul>
<li>减少内存使用</li>
<li>并发安全</li>
<li>降低项目复杂度</li>
<li>便于比较复杂数据，定制shouldComponentUpdate方便</li>
<li>时间旅行功能方便</li>
<li>函数式编程</li>
</ul>
<p>缺点：</p>
<ul>
<li>学习成本</li>
<li>库的大小</li>
<li>对原有项目入侵严重，所以新项目使用比较合适</li>
</ul>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install immutable —-save</span><br></pre></td></tr></table></figure>

<p>22.<code>reselect：redux</code>数据优化缓存，reselect为selector设置了缓存，只有当selector的输入改变时，程序才重新调用selector函数。</p>
<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createSelector&#125; <span class="keyword">from</span> <span class="string">'reselect'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reselect是对redux进行优化的库</span></span><br><span class="line"><span class="keyword">const</span> numSelector = createSelector(</span><br><span class="line">    state =&gt; state,</span><br><span class="line">    <span class="comment">// 第二个函数的参数，是第一个的返回值</span></span><br><span class="line">    state =&gt; (&#123;<span class="attr">num</span>:state*<span class="number">2</span>&#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  使用装饰器优化connect的代码</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">@connect(</span><br><span class="line">    state =&gt; numSelector(state),</span><br><span class="line">    &#123;addGun,removeGun,removeGunAsync,twiceGun&#125;</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install reselect —-save</span><br></pre></td></tr></table></figure>

<p>23.<code>eslint</code>：可组装的JavaScript和JSX检查工具</p>
<p><code>create-react-app</code>安装后有<code>eslint</code>模块，添加配置就在<code>eslintConfig</code>下进行添加，默认还扩展了react-app的配置。</p>
<p><code>package.json</code>添加的额外配置的代号加上等级，等级有off（0）、warning（1）、error（2），代号在控制台上可以看到，也可以去官网上看到。</p>
<p>这些错误可以关闭，也可以进行修复。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">"eslintConfig": &#123;</span><br><span class="line">    "extends": "react-app",</span><br><span class="line">    "rules": &#123;</span><br><span class="line">      "eqeqeq": [</span><br><span class="line">        <span class="string">"off"</span></span><br><span class="line">      ],</span><br><span class="line">      "jsx-a11y/accessible-emoji": [</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>24.<code>async+await</code>: 用同步方式写异步</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最原始的是使用callback，会陷入callback hell</span></span><br><span class="line"><span class="comment">// 然后是promise方案 es6</span></span><br><span class="line"><span class="comment">// 使用async和await来改变promise的写法  es7</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> readMsg = <span class="function"><span class="params">from</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// async和await写法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch,getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios.post(<span class="string">'/user/readmsg'</span>,&#123;<span class="keyword">from</span>&#125;);</span><br><span class="line">        <span class="keyword">const</span> userid = getState().user._id;</span><br><span class="line">        <span class="keyword">if</span>(res.status ==<span class="number">200</span> &amp;&amp; res.data.code === <span class="number">0</span>)&#123;</span><br><span class="line">            dispatch(msgRead(&#123;<span class="keyword">from</span>,userid,<span class="attr">num</span>:res.data.num&#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// promise写法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch,getState</span>) =&gt;</span>&#123;</span><br><span class="line">        axios.post(<span class="string">'/user/readmsg'</span>,&#123;<span class="keyword">from</span>&#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> userid = getState().user._id;</span><br><span class="line">                <span class="keyword">if</span>(res.status ==<span class="number">200</span> &amp;&amp; res.data.code === <span class="number">0</span>)&#123;</span><br><span class="line">                    dispatch(msgRead(&#123;<span class="keyword">from</span>,userid,<span class="attr">num</span>:res.data.num&#125;));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>25.<code>bundle-loader</code>:按需加载所需插件</p>
<p>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install bundle-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>26.create-react-app支持<code>less</code></p>
<p>首先安装所需插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install less-loader less --save-dev</span><br></pre></td></tr></table></figure>

<p>修改 <code>webpack.config.dev.js</code> 和 <code>webpack.config-prod.js</code> 配置文件</p>
<ul>
<li><code>test: /\.css$/</code> 改为 <code>/\.(css|less)$/</code></li>
<li><code>test: /\.css$/</code> 的 <code>use</code> 数组配置增加 <code>less-loader</code></li>
</ul>
<p>修改后如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: /\.(css|less)$/,</span><br><span class="line">  use: [</span><br><span class="line">    require.resolve('style-loader'),</span><br><span class="line">    &#123;</span><br><span class="line">      loader: require.resolve('css-loader'),</span><br><span class="line">      options: &#123;</span><br><span class="line">        importLoaders: 1,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: require.resolve('postcss-loader'),</span><br><span class="line">      options: &#123;</span><br><span class="line">        <span class="comment">// Necessary for external CSS imports to work</span></span><br><span class="line">        <span class="comment">// https://github.com/facebookincubator/create-react-app/issues/2677</span></span><br><span class="line">        ident: 'postcss',</span><br><span class="line">        plugins: () =&gt; [</span><br><span class="line">          require('postcss-flexbugs-fixes'),</span><br><span class="line">          autoprefixer(&#123;</span><br><span class="line">            browsers: [</span><br><span class="line">              '&gt;1%',</span><br><span class="line">              'last 4 versions',</span><br><span class="line">              'Firefox ESR',</span><br><span class="line">              'not ie &lt; 9', // React doesn't support IE8 anyway</span><br><span class="line">            ],</span><br><span class="line">            flexbox: 'no-2009',</span><br><span class="line">          &#125;),</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader:require.resolve('less-loader') // compiles Less to CSS</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<p>27 <code>babel-node</code>:后台支持import语法</p>
<p>安装插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-node --save</span><br></pre></td></tr></table></figure>

<p>使用：<code>package.json</code>修改<code>script</code>的server为最新的server</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">"scripts": &#123;</span><br><span class="line">    ...</span><br><span class="line">    "server": "NODE_ENV=test nodemon --exec babel-node server/server.js",</span><br><span class="line">    "server_bak": "nodemon server/server.js"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>设备<code>node</code>的运行环境为<code>test</code>，即<code>NODE_ENV=test</code>，默认启用<code>node</code>，改为启用<code>babel-node</code>，再启动<code>server</code>。启用之后就会发现，后台也支持import语法了。</p>
<p>28 后端设置也支持jsx语法:</p>
<p>创建<code>.babelrc</code>，然后将package.json中的babel字段粘贴至此，使整个项目全局都支持此babel配置的语法</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    <span class="string">"react-app"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"import"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>,</span><br><span class="line">        <span class="attr">"style"</span>: <span class="string">"css"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"transform-decorators-legacy"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/React/Apollo-Client%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/React/Apollo-Client%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">Apollo-Client简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-19 10:09:10" itemprop="dateCreated datePublished" datetime="2017-03-19T10:09:10+08:00">2017-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Apollo-Client简介"><a href="#Apollo-Client简介" class="headerlink" title="Apollo-Client简介"></a>Apollo-Client简介</h1><h3 id="一-、安装"><a href="#一-、安装" class="headerlink" title="一 、安装"></a>一 、安装</h3><p>在React中使用Apollo,首先需要安装相应插件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> installing the preset package and react integration</span></span><br><span class="line">npm install apollo-boost react-apollo graphql --save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> installing each piece independently</span></span><br><span class="line">npm install apollo-client apollo-cache-inmemory apollo-link-http react-apollo graphql-tag graphql --save</span><br></pre></td></tr></table></figure>

<p>React中使用Apollo，首先需要创建<code>ApolloClient</code>和<code>ApolloProvider</code>：</p>
<ul>
<li><code>ApolloClient</code>是你应用程序中使用<code>Graphql</code>的中心，它管理你所有的<code>data</code>。</li>
<li><code>ApolloProvider</code>可以让你在应用中任何地方使用<code>Apollo</code>，就和<code>Redux</code>中的<code>Provider</code>一个道理，提供<code>context</code>，包裹在应用的最外层。</li>
</ul>
<h3 id="二、创建client和provider"><a href="#二、创建client和provider" class="headerlink" title="二、创建client和provider"></a>二、创建client和provider</h3><ol>
<li>创建client作为客户端的graphql服务：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpLink &#125; <span class="keyword">from</span> <span class="string">'apollo-link-http'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  <span class="comment">// 默认情况下，客户端会讲查询发送至同域名下以`/graphql`为结尾的后端服务</span></span><br><span class="line">  <span class="comment">// 可以为new HttpLink()传入uri以制定后端服务地址，更多个性化配置可使用Apollo Link</span></span><br><span class="line">  <span class="comment">// link: new HttpLink(&#123;uri: 'http://localhost:4000/graphql'&#125;),</span></span><br><span class="line">  link: <span class="keyword">new</span> HttpLink(),</span><br><span class="line">  cache: <span class="keyword">new</span> InMemoryCache()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ApolloClient还有很多其他的参数来控制客户端行为，可以去看看。</p>
<ol start="2">
<li><p>创建Provider</p>
<p>使用<code>ApolloProvider</code>组件来连接客户端至<code>Component Tree</code>。</p>
<blockquote>
<p>We suggest putting the <code>ApolloProvider</code> somewhere high in your app, above any places where you need to access GraphQL data. For example, it could be outside of your root route component if you’re using React Router.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApolloProvider &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApolloClient &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpLink &#125; <span class="keyword">from</span> <span class="string">'apollo-link-http'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InMemoryCache &#125; <span class="keyword">from</span> <span class="string">'apollo-cache-inmemory'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  link: <span class="keyword">new</span> HttpLink(),</span><br><span class="line">  cache: <span class="keyword">new</span> InMemoryCache()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;ApolloProvider client=&#123;client&#125;&gt;</span><br><span class="line">    &lt;MyAppComponent /&gt;</span><br><span class="line">  &lt;<span class="regexp">/ApolloProvider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root')</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="三、使用graphql-tag创建操作语句"><a href="#三、使用graphql-tag创建操作语句" class="headerlink" title="三、使用graphql-tag创建操作语句"></a>三、使用graphql-tag创建操作语句</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</span><br></pre></td></tr></table></figure>

<p><code>gql</code>模板标签是用来定义在apollo客户端的graphql查询。它会将<code>GraphQL query</code>解析成<a href="https://github.com/graphql/graphql-js/blob/d92dd9883b76e54babf2b0ffccdab838f04fc46c/src/language/ast.js" target="_blank" rel="noopener">GraphQL.js AST format</a> 。只要使用ql查询语句，都需要使用此标签进行包裹。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">onst query = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query Query($id:Int!)&#123;</span></span><br><span class="line"><span class="string">      books(id:$id)&#123;</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">        author</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="四、使用graphql进行查询"><a href="#四、使用graphql进行查询" class="headerlink" title="四、使用graphql进行查询"></a>四、使用graphql进行查询</h3><p>API：<code>graphql(query, [config])(component)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br></pre></td></tr></table></figure>

<p>这个API模式也在redux中的connect中使用，此方法会创建一个查询与更新Apollo Store的高阶组件。</p>
<ol>
<li>query参数</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TodoApp</span>(<span class="params">&#123; data: &#123; todos &#125; &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;todos.map(<span class="function">(<span class="params">&#123; id, text &#125;</span>) =&gt;</span> (</span><br><span class="line">        &lt;li key=&#123;id&#125;&gt;&#123;text&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">      ))&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></span><br><span class="line"><span class="string">  query TodoAppQuery &#123;</span></span><br><span class="line"><span class="string">    todos &#123;</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      text</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>)(TodoApp);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>config参数</li>
</ol>
<blockquote>
<p>The <code>config</code> object is the second argument you pass into the <code>graphql()</code>function, after your GraphQL document. The config is optional and allows you to add some custom behavior to your higher order component.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(</span><br><span class="line">  gql<span class="string">`&#123; ... &#125;`</span>,</span><br><span class="line">  config, <span class="comment">// &lt;- The `config` object.</span></span><br><span class="line">)(MyComponent);</span><br></pre></td></tr></table></figure>

<p>​    <code>graphql</code>的第二个参数<code>config</code>有好6个，具体的可以在官网的<a href="https://www.apollographql.com/docs/react/basics/setup.html#graphql-config" target="_blank" rel="noopener">Query Configuration</a>看到，下面简单介绍下每个参数作用：</p>
<ul>
<li><p><code>config.options</code> ：是一个对象或一个函数，在处理Graphql数据时，允许你的组件定义具体的行为。根据是<code>query</code>还是<code>mutation</code>，options下还有许多其他的参数，可以去详细了解。。。</p>
<ul>
<li><p>一个很经常用到的参数<code>options.variables</code>，给graphql语句中的变量传值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></span><br><span class="line"><span class="string">  query ($width: Int!, $height: Int!) &#123;</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>, &#123;</span><br><span class="line">  options: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">      width: props.size,</span><br><span class="line">      height: props.size,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;)(MyComponent);</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>config.props</code>： 允许你定义一个映射函数，此函数可以使用你的props，包括query时的<code>props.data</code>和mutation时的<code>props.mutate</code>;并且，允许你返回一个新的props对象，此对象将会被提供给你所包裹的组件。我的理解就是，接收ql查询返回过来的props，并在将属性添加到包裹组件之前进行操作计算，也就是可以把组件中接收到props进行提前处理，直接将加工好的数据交给包裹组件，那么包裹的组件就不用再做其他计算，只负责实现UI就可以</p>
<ul>
<li><p>This example uses <a href="https://www.apollographql.com/docs/react/basics/setup.html#graphql-query-data-fetchMore" target="_blank" rel="noopener"><code>props.data.fetchMore</code></a>. 加载更多，fetch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`&#123; ... &#125;`</span>, &#123;</span><br><span class="line">  props: <span class="function">(<span class="params">&#123; data: &#123; fetchMore &#125; &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    onLoadMore: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      fetchMore(&#123; ... &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;)(MyComponent);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; onLoadMore &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button onClick=&#123;onLoadMore&#125;&gt;</span><br><span class="line">      Load More!</span><br><span class="line">    &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>config.skip</code> 它是一个布尔值，如果为<code>true</code>将会完全跳过此次查询。也可以是一个函数，但结果要返回一个布尔值。它的作用在于可以根据一些的props做出不同的查询</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`&#123; ... &#125;`</span>, &#123;</span><br><span class="line">  skip: <span class="function"><span class="params">props</span> =&gt;</span> !!props.skip, <span class="comment">// 查或者不查</span></span><br><span class="line">&#125;)(MyComponent);</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
<li><p><code>config.name</code>： 默认情况下，query返回数据的<code>props</code>会命名为<code>data</code>，mutation返回数据的<code>props</code>会命名为<code>mutate</code>。此参数可更改返回的名字。当使用多个查询时，返回的props命名会冲突，后查询结果会覆盖前查询结构，为避免此状况发生，可以使用这个参数。</p>
<p>栗子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的compose和redux中的compose一样 具体可以往下看</span></span><br><span class="line"><span class="keyword">import</span> &#123; compose &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compose(</span><br><span class="line">  graphql(gql<span class="string">`mutation (...) &#123; ... &#125;`</span>, &#123; <span class="attr">name</span>: <span class="string">'createTodo'</span> &#125;),</span><br><span class="line">  graphql(gql<span class="string">`mutation (...) &#123; ... &#125;`</span>, &#123; <span class="attr">name</span>: <span class="string">'updateTodo'</span> &#125;),</span><br><span class="line">  graphql(gql<span class="string">`mutation (...) &#123; ... &#125;`</span>, &#123; <span class="attr">name</span>: <span class="string">'deleteTodo'</span> &#125;),</span><br><span class="line">)(MyComponent);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Instead of the default prop name, `mutate`,</span></span><br><span class="line">  <span class="comment">// we have three different prop names.</span></span><br><span class="line">  <span class="built_in">console</span>.log(props.createTodo);</span><br><span class="line">  <span class="built_in">console</span>.log(props.updateTodo);</span><br><span class="line">  <span class="built_in">console</span>.log(props.deleteTodo);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>config.withRef</code> ：类似于React中的<code>ref</code>特性，具体可以自己去看。</p>
</li>
</ul>
<h3 id="五、compose作用简介"><a href="#五、compose作用简介" class="headerlink" title="五、compose作用简介"></a>五、compose作用简介</h3><p>API：<code>compose(...enhancers)(component)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; compose &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</span><br></pre></td></tr></table></figure>

<p>使用compose可立马简洁优雅地使用一些组件增强剂。包括多个<code>graphql()</code>或Redux中的<code>connect()</code>。redux中也有一个compose，两者作用相同，用哪个都可以。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compose(</span><br><span class="line">  withApollo,</span><br><span class="line">  graphql(<span class="string">`query &#123; ... &#125;`</span>),</span><br><span class="line">  graphql(<span class="string">`mutation &#123; ... &#125;`</span>),</span><br><span class="line">  connect(...),</span><br><span class="line">)(MyComponent);</span><br></pre></td></tr></table></figure>

<p>注意：<code>compose()</code>最先执行最后的<code>enhancer</code>。例子：<code>funcC(funcB(funcA(component)))</code>等价于<code>compose(funcC, funcB, funcA)(component)</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2012/01/TypeScript/TypeScript%E5%85%A5%E9%97%A8%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2012/01/TypeScript/TypeScript%E5%85%A5%E9%97%A8%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">TypeScript学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2012-01-13 10:23:10" itemprop="dateCreated datePublished" datetime="2012-01-13T10:23:10+08:00">2012-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:41:59" itemprop="dateModified" datetime="2020-05-16T10:41:59+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TypeScript/" itemprop="url" rel="index"><span itemprop="name">TypeScript</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TypeScript/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="TypeScript学习"><a href="#TypeScript学习" class="headerlink" title="TypeScript学习"></a>TypeScript学习</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a href="http://www.typescriptlang.org/" target="_blank" rel="noopener">TypeScript</a> 是 JavaScript 的一个超集，主要提供了<strong>类型系统</strong>和<strong>对 ES6 的支持</strong>，它由 Microsoft 开发，代码<a href="https://github.com/Microsoft/TypeScript" target="_blank" rel="noopener">开源于 GitHub</a> 上。</p>
<p>安装TypeScript的方法很简单：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g typescript</span><br></pre></td></tr></table></figure>

<p>一个小测试，创建<code>hello.ts</code>，如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">person: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="string">'Tom'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(sayHello(user));</span><br></pre></td></tr></table></figure>

<p>然后只需要运行<code>tsc hello.ts</code>进行编译，这时候会生成一个编译好的<code>hello.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> user = <span class="string">'Tom'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(sayHello(user));</span><br></pre></td></tr></table></figure>

<p>假如现在将<code>hello.ts</code>稍作修改。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">person: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = [<span class="string">'Tom'</span>];</span><br><span class="line"><span class="built_in">console</span>.log(sayHello(user));</span><br></pre></td></tr></table></figure>

<p>再运行<code>tsc hello.ts</code>进行编译，会报错如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hello.ts:<span class="number">6</span>:<span class="number">22</span> - error TS2345: Argument of type <span class="string">'string[]'</span> is not assignable to <span class="keyword">parameter</span> of type <span class="string">'string'</span>.</span><br><span class="line"></span><br><span class="line"><span class="number">6</span> console.log(sayHello(person));</span><br><span class="line">                       ~~~~~~</span><br><span class="line">Found <span class="number">1</span> error.</span><br></pre></td></tr></table></figure>

<p>但是仍然会编译成功</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello, "</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person = [<span class="string">'Tom'</span>];</span><br><span class="line"><span class="built_in">console</span>.log(sayHello(person));</span><br></pre></td></tr></table></figure>

<p><strong>TypeScript 编译的时候即使报错了，还是会生成编译结果</strong>，我们仍然可以使用这个编译之后的文件。</p>
<p>编译报错可以终止JS文件的生成，可以在 <code>tsconfig.json</code> 中配置 <code>noEmitOnError</code> 即可。</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="原始数据类型"><a href="#原始数据类型" class="headerlink" title="原始数据类型"></a>原始数据类型</h3><p>TypeScript的原始数据类型和JavaScript的原始数据类型相同，包含：布尔值、数值、字符串、<code>null</code>、<code>undefined</code>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ccbeango</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ccbeango</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
