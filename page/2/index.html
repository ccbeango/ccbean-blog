<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#af4c4c","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="凹凸豆的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="凹凸豆的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ccbeango">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>凹凸豆的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">凹凸豆的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">那天，黄昏，开始飘起来白雪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">21</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">49</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/ccbeango" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/Network/Modbus%E7%9A%84CRC16%E6%A0%A1%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/Network/Modbus%E7%9A%84CRC16%E6%A0%A1%E9%AA%8C/" class="post-title-link" itemprop="url">Modbus的CRC16校验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-17 19:50:10" itemprop="dateCreated datePublished" datetime="2019-12-17T19:50:10+08:00">2019-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:37:42" itemprop="dateModified" datetime="2020-05-16T10:37:42+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Modbus的CRC16校验方法"><a href="#Modbus的CRC16校验方法" class="headerlink" title="Modbus的CRC16校验方法"></a>Modbus的CRC16校验方法</h1><h2 id="CRC简介"><a href="#CRC简介" class="headerlink" title="CRC简介"></a>CRC简介</h2><p>CRC是数据通信领域中最常用的一种差错校验码，其特征是信息字段和校验字段的长度可以任意选定。</p>
<p>生成CRC的基本原理是：任意一个由二进制位串组成的代码都可以和一个系数仅为<code>0</code>和<code>1</code>取值的多项式一一对应。</p>
<p>例如：二进制码<code>10010111</code>()对应的多项式为x^7^+x^4^+x^2^+x+1，而多项式为x^5^+x^4^+x^2^+x+1对应的二进制码是<code>110111</code>。</p>
<p>对报文进行CRC校验，这个过程其实就是按照一定的公式，对一串二进制码进行计算且获得结果值的过程。</p>
<p>CRC16的计算公式为：<strong>x^16^+x^15^+x^2^+1</strong>  </p>
<h2 id="校验方法"><a href="#校验方法" class="headerlink" title="校验方法"></a>校验方法</h2><p>ModBus 通信协议的CRC ( 冗余循环校验码）含2个字节, 即16位二进制数。CRC码由发送设备计算, 放置于所发送信息帧的尾部。接收设备再重新计算所接收信息的CRC, 比较计算得到的CRC是否与接收到的CRC相符, 如果两者不相符, 则认为数据出错。</p>
<p>CRC16校验的校验步骤：</p>
<ol>
<li>预置1个16位的寄存器为十六进制<strong>FFFF</strong>(即全为 1) , 称此寄存器为CRC寄存器。</li>
<li>把第一个8位二进制数据 (通信信息帧的第一个字节) 与16位的CRC寄存器的低8位相异或, 把结果放于 CRC寄存器。</li>
<li>把 CRC 寄存器的内容右移一位( 朝低位)用 0 填补最高位, 并检查右移后的移出位。</li>
<li>如果移出位为<code>0</code>, 重复第3步 ( 再次右移一位); 如果移出位为<code>1</code>, CRC 寄存器与多项式<code>0xA001</code> ( 1010 0000 0000 0001) 进行异或。</li>
<li>重复步骤3和步骤4, 直到右移8次,这样整个8位数据全部进行了处理。</li>
<li>重复步骤2到步骤5, 进行通信信息帧下一个字节的处理。</li>
<li>将该通信信息帧所有字节按上述步骤计算完成后,得到的16位CRC寄存器的高、低字节进行交换。</li>
<li>最后得到的 CRC寄存器内容即为CRC码。</li>
</ol>
<h3 id="具体实现代码-JS-："><a href="#具体实现代码-JS-：" class="headerlink" title="具体实现代码(JS)："></a>具体实现代码(JS)：</h3><p><strong>计算法</strong></p>
<p>此方法在调用时计算，最慢。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crc16</span>(<span class="params">buf</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> crc = <span class="number">0xFFFF</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">        crc ^= buf[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">let</span> odd = crc &amp; <span class="number">0x0001</span>;</span><br><span class="line">            crc = crc &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (odd) crc ^= <span class="number">0xA001</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> crc;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查表法一</strong></p>
<p>查表法 ，高低位的表，代码量太大了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crcTableHi = [</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>,</span><br><span class="line">    <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>,</span><br><span class="line">    <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>,</span><br><span class="line">    <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>,</span><br><span class="line">    <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0xC0</span>, <span class="number">0x80</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x40</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crcTableLo = [</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0xC0</span>, <span class="number">0xC1</span>, <span class="number">0x01</span>, <span class="number">0xC3</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0xC2</span>, <span class="number">0xC6</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x05</span>, <span class="number">0xC5</span>, <span class="number">0xC4</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xCC</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0xCD</span>, <span class="number">0x0F</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0x0E</span>, <span class="number">0x0A</span>, <span class="number">0xCA</span>, <span class="number">0xCB</span>, <span class="number">0x0B</span>, <span class="number">0xC9</span>, <span class="number">0x09</span>,</span><br><span class="line">    <span class="number">0x08</span>, <span class="number">0xC8</span>, <span class="number">0xD8</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0xD9</span>, <span class="number">0x1B</span>, <span class="number">0xDB</span>, <span class="number">0xDA</span>, <span class="number">0x1A</span>, <span class="number">0x1E</span>, <span class="number">0xDE</span>, <span class="number">0xDF</span>, <span class="number">0x1F</span>, <span class="number">0xDD</span>,</span><br><span class="line">    <span class="number">0x1D</span>, <span class="number">0x1C</span>, <span class="number">0xDC</span>, <span class="number">0x14</span>, <span class="number">0xD4</span>, <span class="number">0xD5</span>, <span class="number">0x15</span>, <span class="number">0xD7</span>, <span class="number">0x17</span>, <span class="number">0x16</span>, <span class="number">0xD6</span>, <span class="number">0xD2</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0xD3</span>,</span><br><span class="line">    <span class="number">0x11</span>, <span class="number">0xD1</span>, <span class="number">0xD0</span>, <span class="number">0x10</span>, <span class="number">0xF0</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0xF1</span>, <span class="number">0x33</span>, <span class="number">0xF3</span>, <span class="number">0xF2</span>, <span class="number">0x32</span>, <span class="number">0x36</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>,</span><br><span class="line">    <span class="number">0x37</span>, <span class="number">0xF5</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0xF4</span>, <span class="number">0x3C</span>, <span class="number">0xFC</span>, <span class="number">0xFD</span>, <span class="number">0x3D</span>, <span class="number">0xFF</span>, <span class="number">0x3F</span>, <span class="number">0x3E</span>, <span class="number">0xFE</span>, <span class="number">0xFA</span>, <span class="number">0x3A</span>,</span><br><span class="line">    <span class="number">0x3B</span>, <span class="number">0xFB</span>, <span class="number">0x39</span>, <span class="number">0xF9</span>, <span class="number">0xF8</span>, <span class="number">0x38</span>, <span class="number">0x28</span>, <span class="number">0xE8</span>, <span class="number">0xE9</span>, <span class="number">0x29</span>, <span class="number">0xEB</span>, <span class="number">0x2B</span>, <span class="number">0x2A</span>, <span class="number">0xEA</span>, <span class="number">0xEE</span>,</span><br><span class="line">    <span class="number">0x2E</span>, <span class="number">0x2F</span>, <span class="number">0xEF</span>, <span class="number">0x2D</span>, <span class="number">0xED</span>, <span class="number">0xEC</span>, <span class="number">0x2C</span>, <span class="number">0xE4</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0xE5</span>, <span class="number">0x27</span>, <span class="number">0xE7</span>, <span class="number">0xE6</span>, <span class="number">0x26</span>,</span><br><span class="line">    <span class="number">0x22</span>, <span class="number">0xE2</span>, <span class="number">0xE3</span>, <span class="number">0x23</span>, <span class="number">0xE1</span>, <span class="number">0x21</span>, <span class="number">0x20</span>, <span class="number">0xE0</span>, <span class="number">0xA0</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0xA1</span>, <span class="number">0x63</span>, <span class="number">0xA3</span>, <span class="number">0xA2</span>,</span><br><span class="line">    <span class="number">0x62</span>, <span class="number">0x66</span>, <span class="number">0xA6</span>, <span class="number">0xA7</span>, <span class="number">0x67</span>, <span class="number">0xA5</span>, <span class="number">0x65</span>, <span class="number">0x64</span>, <span class="number">0xA4</span>, <span class="number">0x6C</span>, <span class="number">0xAC</span>, <span class="number">0xAD</span>, <span class="number">0x6D</span>, <span class="number">0xAF</span>, <span class="number">0x6F</span>,</span><br><span class="line">    <span class="number">0x6E</span>, <span class="number">0xAE</span>, <span class="number">0xAA</span>, <span class="number">0x6A</span>, <span class="number">0x6B</span>, <span class="number">0xAB</span>, <span class="number">0x69</span>, <span class="number">0xA9</span>, <span class="number">0xA8</span>, <span class="number">0x68</span>, <span class="number">0x78</span>, <span class="number">0xB8</span>, <span class="number">0xB9</span>, <span class="number">0x79</span>, <span class="number">0xBB</span>,</span><br><span class="line">    <span class="number">0x7B</span>, <span class="number">0x7A</span>, <span class="number">0xBA</span>, <span class="number">0xBE</span>, <span class="number">0x7E</span>, <span class="number">0x7F</span>, <span class="number">0xBF</span>, <span class="number">0x7D</span>, <span class="number">0xBD</span>, <span class="number">0xBC</span>, <span class="number">0x7C</span>, <span class="number">0xB4</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0xB5</span>,</span><br><span class="line">    <span class="number">0x77</span>, <span class="number">0xB7</span>, <span class="number">0xB6</span>, <span class="number">0x76</span>, <span class="number">0x72</span>, <span class="number">0xB2</span>, <span class="number">0xB3</span>, <span class="number">0x73</span>, <span class="number">0xB1</span>, <span class="number">0x71</span>, <span class="number">0x70</span>, <span class="number">0xB0</span>, <span class="number">0x50</span>, <span class="number">0x90</span>, <span class="number">0x91</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0x93</span>, <span class="number">0x53</span>, <span class="number">0x52</span>, <span class="number">0x92</span>, <span class="number">0x96</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x97</span>, <span class="number">0x55</span>, <span class="number">0x95</span>, <span class="number">0x94</span>, <span class="number">0x54</span>, <span class="number">0x9C</span>, <span class="number">0x5C</span>,</span><br><span class="line">    <span class="number">0x5D</span>, <span class="number">0x9D</span>, <span class="number">0x5F</span>, <span class="number">0x9F</span>, <span class="number">0x9E</span>, <span class="number">0x5E</span>, <span class="number">0x5A</span>, <span class="number">0x9A</span>, <span class="number">0x9B</span>, <span class="number">0x5B</span>, <span class="number">0x99</span>, <span class="number">0x59</span>, <span class="number">0x58</span>, <span class="number">0x98</span>, <span class="number">0x88</span>,</span><br><span class="line">    <span class="number">0x48</span>, <span class="number">0x49</span>, <span class="number">0x89</span>, <span class="number">0x4B</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, <span class="number">0x4A</span>, <span class="number">0x4E</span>, <span class="number">0x8E</span>, <span class="number">0x8F</span>, <span class="number">0x4F</span>, <span class="number">0x8D</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x8C</span>,</span><br><span class="line">    <span class="number">0x44</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0x87</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x86</span>, <span class="number">0x82</span>, <span class="number">0x42</span>, <span class="number">0x43</span>, <span class="number">0x83</span>, <span class="number">0x41</span>, <span class="number">0x81</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x40</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crc16table</span>(<span class="params">buf</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> high = <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">let</span> low = <span class="number">0xff</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> ch = buf[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> index = low ^ ch;</span><br><span class="line">        low = high ^ crcTableHi[index];</span><br><span class="line">        high = crcTableLo[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (high &lt;&lt; <span class="number">8</span> | low);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查表法二</strong></p>
<p>此方法最优，推荐使用，不过我还是用的第一种计算法，可以随时写出来。。。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crctalbeabs = [</span><br><span class="line">    <span class="number">0x0000</span>, <span class="number">0xCC01</span>, <span class="number">0xD801</span>, <span class="number">0x1400</span>, <span class="number">0xF001</span>, <span class="number">0x3C00</span>, <span class="number">0x2800</span>, <span class="number">0xE401</span>,</span><br><span class="line">    <span class="number">0xA001</span>, <span class="number">0x6C00</span>, <span class="number">0x7800</span>, <span class="number">0xB401</span>, <span class="number">0x5000</span>, <span class="number">0x9C01</span>, <span class="number">0x8801</span>, <span class="number">0x4400</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crc16tablefast</span>(<span class="params">buf</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> crc = <span class="number">0xFFFF</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> ch = buf[i];</span><br><span class="line">        crc = crctalbeabs[(ch ^ crc) &amp; <span class="number">15</span>] ^ (crc &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        crc = crctalbeabs[((ch &gt;&gt; <span class="number">4</span>) ^ crc) &amp; <span class="number">15</span>] ^ (crc &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> crc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码可在github上查看<a href="https://github.com/ccbeango/modbus-crc16" target="_blank" rel="noopener">modbus-crc16</a></p>
<p><strong>在线校验</strong></p>
<p>CRC（循环冗余校验）在线计算：<a href="http://www.ip33.com/crc.html" target="_blank" rel="noopener">http://www.ip33.com/crc.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/Mysql/%E5%85%B3%E4%BA%8EMysql%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/Mysql/%E5%85%B3%E4%BA%8EMysql%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">关于MySQL索引</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-22 10:27:10" itemprop="dateCreated datePublished" datetime="2019-11-22T10:27:10+08:00">2019-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:35:46" itemprop="dateModified" datetime="2020-05-16T10:35:46+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mysql/" itemprop="url" rel="index"><span itemprop="name">Mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="关于MySQL索引"><a href="#关于MySQL索引" class="headerlink" title="关于MySQL索引"></a>关于MySQL索引</h1><blockquote>
<p>读 《高性能MySQL》</p>
</blockquote>
<p>索引是存储引擎用于快速找到记录的一种数据结构，这是索引的基本功能。</p>
<p>索引优化应该是对性能优化最有效的手段了。索引能够轻易将查询性能提高几个数量级，”最优”的索引有时比一个”好的”索引能要好两个数量级。</p>
<h2 id="索引基础"><a href="#索引基础" class="headerlink" title="索引基础"></a>索引基础</h2><p>在MySQL中，存储引擎先在索引中找到对应值，然后根据匹配的索引记录找到对应的数据行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT first_name FROM sakila.actor WHERE actor_id&#x3D;5;</span><br></pre></td></tr></table></figure>

<p>如果在<code>actor_id</code>列上建有索引，则MySQL将使用该索引找到<code>actor_id</code>为5的行，也就是说，MySQL现在索引上按值进行查找，然后返回所有包含该值的数据行。</p>
<p>在MySQL中，索引是在存储引擎层而不是服务器层实现的。所以，并没有统一的索引标准：不同存储引擎的索引的工作方式并不一样，也不是所有的存储引擎都支持所有类型的索引。即使多个存储引擎支持同一种类型的索引，其底层的实现也可能不同。</p>
<h3 id="B-Tree索引"><a href="#B-Tree索引" class="headerlink" title="B-Tree索引"></a>B-Tree索引</h3><p><a href="[https://zh.wikipedia.org/wiki/B%E6%A0%91](https://zh.wikipedia.org/wiki/B树)">B-Tree</a>通常意味着所有的值都是按顺序存储的，并且每一个叶子页到根的距离相同。</p>
<p>下图展示了B-Tree索引的抽象表示，大致反映了InnoDB索引是如何工作的。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9501.png" alt=""></p>
<p>B-Tree索引能够加快访问数据的速度，因为存储引擎不再需要进行全盘扫描来获取需要的数据，取而代之的是从索引的根节点开始搜索。根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下层查找。通过比较节点页的值和要查找的值可以找到合适的指针进入下层子节点，这些指针实际上定义了子节点页中值的上限和下限。最终存储引擎要么找到对应的值，要么该记录不存在。</p>
<p>上图中，仅绘制了一个节点和其对应的叶子节点，其实在根节点和叶子节点之间可能有很多层节点页。树的深度和表的大小直接相关。</p>
<p>B-Tree索引顺序列是顺序组织存储的，所以很适合查找范围数据。例如，在一个基于文本域的索引树上，按字母顺序传递连续的值进行查找是非常合适的，所以像”找出所有以I到K开头的名字”这样的查找效率会非常高。</p>
<p>有数据表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE People (</span><br><span class="line">		last_name varchar(50) 	not null,</span><br><span class="line">  	first_name varchar(50) 	not null,</span><br><span class="line">  	dob date								not null,</span><br><span class="line">  	gender enum(&#39;m&#39;, &#39;f&#39;)		not null,</span><br><span class="line">  	key(last_name, first_name, dob)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>对于表中的数据，索引包含了<code>last_name</code>、<code>first_name</code>和<code>dob</code>列的值，下图显示了该索引是如何组织数据的存储的。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9502.png" alt=""></p>
<p>请注意，索引对多个值进行排序的依据是<code>CREATE TABLE</code>语句中定义索引时列的顺序。上图最后两个条目，姓和名相同，则根据他们的日期来排列顺序。</p>
<p>可以使用B-Tree索引的查询类型：</p>
<ul>
<li>全值匹配：和索引中的所有列进行匹配，如索引可用于查找姓名为Cuba Allen、出生于1960-01-01的人。</li>
<li>匹配最左前缀：只使用索引的第一列。索引可用于查找所有姓为Allen的人。</li>
<li>匹配列前缀：匹配某一列的值的开头部分。索引可用于朝赵所有以J开头的姓的人。这里也只使用了索引的第一列。</li>
<li>匹配范围值：例如前面提到的索引可用于查找姓在Allen和Barrymore之间的人。这里也只使用了索引的第一列。</li>
<li>精确匹配某一列并范围匹配另外一列：用于查找所有姓为Allen，并且名字是字母K开头的人。即第一列<code>last_name</code>全匹配，第二列<code>first_name</code>范围匹配。</li>
<li>只访问索引的查询：只需要访问索引，而无需访问数据行。</li>
</ul>
<p>一般来说，如果B-Tree可以按照某种方式查找到值，那么也可以按照这种方式用于排序。所以，如果<code>ORDER BY</code>子句满足前面列出的几种查询类型，则这个索引也可以满足对应的排序需求。</p>
<p>关于B-Tree索引的一些限制：</p>
<ul>
<li><p>如果不是按照索引的最左列开始查找，则无法使用索引。</p>
</li>
<li><p>不能跳过索引中的列。</p>
</li>
<li><p>如果查询中有某个列的范围查询，则其右边所有列都无法使用索引优化查找。</p>
</li>
</ul>
<p>到此可明白，索引列的顺序是非常重要的：这些限制都和索引列的顺序有关。在优化性能的时候，可能需要使用相同的列但顺序不同的索引来满足不同类型的查询需求。</p>
<h3 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h3><p>哈希索引基于哈希表实现，只有精确匹配索引所有列的查询才有效。</p>
<p>对于每一行数据，存储引擎都会对所有的索引计算一个哈希码，哈希码是一个较小的值，并且不同键值的行计算出来的哈希码也不一样。哈希索引将所有的哈希码存储在索引中，同时在哈希表中保存指向每个数据行的指针。</p>
<p>在MySQL中，只有Memory引擎显示支持哈希索引。这是其默认支持类型，也支持B-Tree索引。</p>
<p>如果多个列的哈希值相同，索引会以链表的方式存放多个记录指针到同一个哈希条目中。</p>
<p>有数据表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE testhash (</span><br><span class="line">		fname VARCHAR(50) NOT NULL,</span><br><span class="line">  	lname VARCHAR(50) NOT NULL,</span><br><span class="line">  	KEY USING HASH(fname)</span><br><span class="line">) ENGINE&#x3D;MEMORY;</span><br></pre></td></tr></table></figure>

<p>表中有如下数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-----------+----------+</span><br><span class="line">| fname     | lname    |</span><br><span class="line">+-----------+----------+</span><br><span class="line">| Arjen     | Lentz    |</span><br><span class="line">| Baron     | Schwartz |</span><br><span class="line">| Peter     | Zaitsev  |</span><br><span class="line">| Vadim     | Tkachenko|</span><br><span class="line">+-----------+----------+</span><br></pre></td></tr></table></figure>

<p>假设索引使用假想的哈希函数<code>f()</code>，它返回下面的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f(&#39;Arjen&#39;) &#x3D; 2323</span><br><span class="line">f(&#39;Baron&#39;) &#x3D; 7437</span><br><span class="line">f(&#39;Peter&#39;) &#x3D; 8784</span><br><span class="line">f(&#39;Vadim&#39;) &#x3D; 2458</span><br></pre></td></tr></table></figure>

<p>则哈希索引的数据结构如下：</p>
<table>
<thead>
<tr>
<th>槽（Slot）</th>
<th>值（Value）</th>
</tr>
</thead>
<tbody><tr>
<td>2323</td>
<td>指向第1行的指针</td>
</tr>
<tr>
<td>2458</td>
<td>指向第4行的指针</td>
</tr>
<tr>
<td>7437</td>
<td>指向第2行的指针</td>
</tr>
<tr>
<td>8784</td>
<td>指向第3行的指针</td>
</tr>
</tbody></table>
<p>要注意每个槽的编号是顺序的，但是数据行不是。查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT lname FROM testhash WHERE fname&#x3D;&#39;Peter&#39;;</span><br></pre></td></tr></table></figure>

<p>MySQL先计算<code>Peter</code>的哈希值，并使用此值寻找对应的记录指针。因为<code>f(&#39;Peter&#39;)=8784</code>，所以MySQL在索引中查找8784，可以找到指向第三行的指针，最后一步是比较第三行的值是否为<code>Peter</code>，以确保就是要查找的行。</p>
<p>因为索引自身只需存储对应的哈希值，所以索引的结构十分紧凑，这也让哈希索引查找的速度非常快。</p>
<p>哈希索引的一些限制：</p>
<ul>
<li><p>哈希索引只包含哈希值和行指针，而不存储字段值，所以不能使用索引中的值来避免读取行。</p>
</li>
<li><p>哈希索引数据并不是按照索引顺序存储的，所以无法用于排序。</p>
</li>
<li><p>哈希索引也不支持部分索引列匹配查找，因为哈希索引始终是使用索引列的全部内容来计算哈希值的。</p>
</li>
<li><p>哈希索引只支持等值比较查询，包括<code>=</code>、<code>IN()</code>、<code>&lt;=&gt;</code>。不支持任何范围查询，如<code>WHERE price &gt; 100</code>。</p>
</li>
<li><p>访问哈希索引的数据非常快，除非有很多哈希冲突。当哈希冲突时，存储引擎必须遍历链表中所有的行指针，逐行进行比较，直到找到所有符合条件的行。</p>
</li>
<li><p>如果哈希冲突很多的话，一些索引维护操作的代价也会很高。</p>
</li>
</ul>
<h3 id="空间数据索引"><a href="#空间数据索引" class="headerlink" title="空间数据索引"></a>空间数据索引</h3><p>MyISAM表支持空间索引，可以用作地理数据存储。</p>
<h3 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h3><p>全文索引是一种特殊类型的索引，它查找的是文本中的关键词，而不是直接比较索引中的值。</p>
<p>全文索引更类似于搜索引擎做的事情，而不是简单的<code>WHERE</code>条件匹配。在相同的列上同事创建全文索引和基于值的B-Tree索引不会有冲突，全文索引适用于<code>MATCH AGAINGST</code>，而不是普通的<code>WHERE</code>条件操作。</p>
<h2 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h2><p>索引可以让服务器快速地定位到表的指定位置。但这并不是索引的唯一作用，根据创建索引的数据结构不同，索引也有一些其他的附加作用。</p>
<p>最常见的B-Tree索引，按照顺序存储数据，所以MySQL可以用来做<code>ORDER BY</code>和<code>GROUP BY</code>操作。因为数据是有序的，所以B-Tree也就会将相关的列值都存储在一起。最后，因为索引中存储了实际的列值，所以某些查询只使用索引就能够完成全部查询。</p>
<p>总结索引的三个优点：</p>
<ul>
<li>索引大大减少了服务器需要扫描的数据量。</li>
<li>索引可以帮助服务器避免排序和临时表。</li>
<li>索引可以将随机<code>I/O</code>变为顺序<code>I/O</code>。</li>
</ul>
<p>索引并不总是最好的工具。总的来说，只有当索引帮助存储引擎快速查找到记录带来的好处大于其带来的额外工作时，索引才是有效的。对于非常小的表，大部分情况下简单的全表扫描更高效。对于中到大型的表，索引非常有效。但对于特大型的表，建立和使用索引的代价随之增长。这种情况下，则需要一种技术直接查询需要的一组数据，而不是一条记录一条记录地匹配，如分区技术。</p>
<p>《Relational Database Index Design and the Optimizers》书中介绍了如何评价一个索引是否适合某个查询的“三星系统”：索引将相关的记录放到一起则获得一星；如果索引中的数据顺序和查找中的排列顺序一致则获得二星；如果索引中的列包含了查询中需要的全部列则获得三星。</p>
<h2 id="高性能的索引策略"><a href="#高性能的索引策略" class="headerlink" title="高性能的索引策略"></a>高性能的索引策略</h2><p>正确地创建和使用索引是实现高性能查询的基础。</p>
<h3 id="独立的列"><a href="#独立的列" class="headerlink" title="独立的列"></a>独立的列</h3><p>一些查询不当地使用索引，会使得MySQL无法使用已有的索引。如果查询中的列不是独立的，则MySQL就不会使用索引。独立的列是指索引不能是表达式的一部分，也不能是函数的参数。</p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT actor_id FROM sakila.actor WHERE actor_id +1 &#x3D; 5;</span><br></pre></td></tr></table></figure>

<p>可以看出上面的<code>WHERE</code>表达式其实等价于<code>actor_id=4</code>，但是MySQL无法解析这个方程式。应该直接将索引单独放在比较符号的一侧。</p>
<p>又如，将索引作为参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... WHERE TO_DAYS(CURRENT_DATE) - TO_DAYS(date_col) &lt;&#x3D; 10;</span><br></pre></td></tr></table></figure>

<h3 id="前缀索引和索引选择性"><a href="#前缀索引和索引选择性" class="headerlink" title="前缀索引和索引选择性"></a>前缀索引和索引选择性</h3><p>有时候需要索引很长的字符串列，这会让索引变得大且慢。一个策略是前面起到的模拟哈希索引。但有时候这样还不够。</p>
<p>通常可以索引开始的部分字符，这样可以大大节约索引空间，从而提高索引效率。但这样也会降低索引的选择性。索引的选择性是指，不重复的索引值(也称为基数，cardinality)和数据表的记录总数(#T)的比值，范围从<code>1/#T</code>到<code>1</code>之间。索引的选择性越高则查询效率越高，因为选择性高的索引可以在MySQL在查找时过滤掉更多的行。唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p>
<p>一般情况下某个列前缀的选择性也是足够高的，足以满足查询性能。对于<code>BLOB</code>、<code>TEXT</code>或者很长的<code>VARCHAR</code>类型的列，必须使用前缀索引，因为<code>MySQL</code>不允许索引这些列的完整长度。</p>
<p>诀窍在于要选择足够长的前缀以保证较高的选择性，同时又不能太长(以便节约空间)。前缀应该足够长，以使得前缀索引的选择性接近于索引整个列。换句话说，前缀的基数应该接近于完整列的基数。</p>
<p>前缀索引是一种能使索引更小、更快的有效办法，但另一方面也有其缺点：MySQL无法使用前缀索引做<code>ORDER BY</code>和<code>GROUP BY</code>，也无法使用前缀索引做覆盖扫描。</p>
<p>有时候后缀索引也有用途，MySQL并不支持反向索引，但是可以把字符串翻转后存储，并基于此建立前缀索引。可以通过触发器维护这种索引。</p>
<h3 id="多列索引"><a href="#多列索引" class="headerlink" title="多列索引"></a>多列索引</h3><p>在多个列上建立独立的单列索引大部分情况下并不能提高MySQL的查询性能。</p>
<p>MySQL在5.0和更新的版本中引入了一种叫索引合并(index merge)的策略，一定程度上可以使用表上的多个单列索引来定位指定的行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT file_id, actor_id FROM sakila.file_actor WHERE actor_id &#x3D; 1 OR film_id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<p>查询能够同时使用这两个单列索引进行扫描，并将结果进行合并。</p>
<p>可以使用<code>EXPLAIN</code>中的<code>Extra</code>列可以看到这点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT film_id, actor_id FROM sakila.file_actor WHERE actor_id &#x3D; 1 OR film_id &#x3D;1 \G;</span><br><span class="line"></span><br><span class="line">*************************** 1. row **********************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: film_actor</span><br><span class="line">         type: index_merge</span><br><span class="line"></span><br><span class="line">possible_keys: PRIMARY,idx_fk_film_id</span><br><span class="line"></span><br><span class="line">          key: PRIMARY,idx_fk_film_id</span><br><span class="line">      key_len: 2,2</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 29</span><br><span class="line">        Extra: Using union(PRIMARY,idx—fk一film一id);Using where</span><br></pre></td></tr></table></figure>

<p>MySQL会使用这类技术优化复杂查询，所以在某些语句的<code>Extra</code>列中还可以看到嵌套操作。</p>
<p>索引合并策略有时候是一种优化的结果，但实际上更多时候说明了表上的索引建的很糟糕：</p>
<ul>
<li>当出现服务器对多个索引做相交操作时（通常有多个<code>AND</code>条件），通常意味着需要一个包含所有相关列的多列索引，而不是多个独立的单列索引。</li>
<li>当服务器需要对多个索引做联合操作时（通常有多个<code>OR</code>条件），通常需要耗费大量CPU和内存资源在算法的缓存、排序和合并操作上。特别是当其中有些索引的选择性不高，需要合并扫描返回的大量数据的时候。</li>
<li>更重要的是，优化器不会把这些计算到“查询成本”（cost)中，优化器只关心随机页面读取。这会使得查询的成本被“低估”，导致该执行计划还不如直接走全表扫描。这样做不但会消耗更多的CPU和内存资源，还可能会影响查询的并发性，但如果是单独运行这样的查询则往往会忽略对并发性的影响。通常来说，还不如像在MySQL 4.1或者更早的时代一样，将查询改写成<code>UNION</code>的方式往往更好。</li>
</ul>
<p>如果在<code>EXPLAIN</code>中看到有索引合并，应该好好检查一下查询和表的结构，看是不是己经是最优的。也可以通过参数<code>optimizer_switch</code>来关闭索引合并功能。也可以使用<code>IGNORE INDEX</code>提示让优化器忽略掉某些索引。</p>
<h3 id="选择合适的索引列顺序"><a href="#选择合适的索引列顺序" class="headerlink" title="选择合适的索引列顺序"></a>选择合适的索引列顺序</h3><p>B-Tree索引会按照顺序存储数据，哈希或者其他类型的索引不会按顺序。</p>
<p>在一个多列B-Tree索引中，索引列的顺序意味着索引首先按照最左列进行排序，其次是第二列，等等。索引可以按照升序或者降序进行扫描，以满足精确符合列顺序的<code>ORDER BY</code>、<code>GROUP BY</code>和<code>DISTINCT</code>等子句的查询要求。所以多列索引的顺序也至关重要。</p>
<p>当不需要考虑排序和分组时，将选择性最高的列放在前面通常是好的。性能不只是依赖于索引列的选择性(整体基数)，也和查询条件的具体值有关，也就是和值的分布有关。</p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM payment WHERE staff_id &#x3D; 2 ADN customer_id &#x3D; 584;</span><br></pre></td></tr></table></figure>

<p>这个查询是应该创建一个<code>staff_id, customer_id</code>索引还是应该颠倒一下顺序，可以跑一些查询来确定这个表中值的分布情况，并确定哪个列的选择性更高。</p>
<p>先用下面查询测试下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(staff_id &#x3D; 2), SUM(customer_id &#x3D; 584) FROM payment\G</span><br><span class="line">**************************** 1. row *******************</span><br><span class="line">SUM(staff_id &#x3D; 2): 7992</span><br><span class="line">SUM(customer_id): 30</span><br></pre></td></tr></table></figure>

<p>索引，应该把索引列<code>customer_id</code>放到墙面，因为对应条件值的<code>customer_id</code>数量更小。</p>
<p>再来看对于这个<code>customer_id</code>的条件值，对应的<code>staff_id</code>列的选择性如何：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(staff_id &#x3D; 2) FROM payment WHERE customer_id &#x3D; 584\G</span><br><span class="line">************************ 1. row **************************</span><br><span class="line">SUM(staff_id &#x3D; 2): 17</span><br></pre></td></tr></table></figure>

<p>有一个需要注意的地方是，查询的结果非常依赖于选定的具体值，这种优化可能对其他一些条件值的查询不公平，服务器的整体性能可能变得更糟，或者其他某些查询的运行变得不如预期。</p>
<p>如果是从诸如pt-query-digest这样的工具的报告中提取”最差”查询，那么再按上述办法选定的索引顺序往往是非常高效的。如果没类似的具体查询来运行，那么最好还是按经验法则来做，因为经验法则考虑的是全局基数和选择性，而不是某个具体查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(DISTINCT staff_id)&#x2F;COUNT(*) AS staff_id_selectivity, COUNT(DISTINCT customer_id)&#x2F;COUNT(*) AS customer_id_selectivity, COUNT(*) FROM payment\G</span><br><span class="line">************************ 1. row ************************</span><br><span class="line">       staff_id_selectivity: 0.0001</span><br><span class="line">    customer_id_selectivity: 0.373</span><br><span class="line">                   COUNT(*): 16049</span><br></pre></td></tr></table></figure>

<p><code>customer_id</code>的选择性更高，索引答案是将其作为索引列的第一列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE payment ADN KEY(customer_id, staff_id);</span><br></pre></td></tr></table></figure>

<h3 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h3><p>聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。InnoDB的聚簇索引实际上在同一个结构中保存了B-Tree索引数据行。当表中有聚簇索引时，它的数据行实际存放在索引的叶子页中。</p>
<p>术语”聚簇”表示数据行和相邻的键值紧凑地存储在一起。因为无法同时把数据行存放在两个不同的地方，索引一个表只能有一个聚簇索引。</p>
<p>InnoDB通过主键聚集数据，如果没有定义主键，InnoDB会选择一个唯一的非空索引代替。如果没有这样的索引，InnoDB会隐式地定义一个主键作为聚簇索引。</p>
<p>InnoDB只聚集在同一个页面中的记录。包含相邻键值的页面可能会相距甚远。</p>
<p>聚簇索引可能对性能有帮助，但也可能导致严重的性能问题，使用时要好好考虑。</p>
<p>聚簇索引的一些重要优点：</p>
<ul>
<li>可以把相关数据保存在一起。如实现电子邮箱，使用用户ID来聚集数据，这样只需从磁盘中读取少数数据页就能获取全部邮件。没有使用聚簇索引，则没封邮件都可能导致一次磁盘I/O。</li>
<li>数据访问更快。因为它将索引和数据保存在同一个B-Tree中。</li>
<li>使用覆盖索引扫描的查询可以直接使用页节点中的主键值。</li>
</ul>
<p>一些缺点：</p>
<ul>
<li>具体索引提高了I/O密集型应用的性能，但如果数据全部存放在内初中，访问的顺序就没那么重要了。</li>
<li>插入速度严重依赖于插入顺序。</li>
<li>更新聚簇索引列的代价很高，因为会强制InnoDB将每个被更新的行移动到新的位置。</li>
<li>基于聚簇索引的表在插入新航，或者主键被更新导致需要移动行的时候，可能面临”页分裂”的问题。当行的主键要求必须将这一行插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳改行，这就是一次分页列操作。页分裂导致表占用更多的磁盘空间。</li>
<li>聚簇索引可能导致全表扫描变慢，尤其是行比较稀疏，或者由于页分裂导致数据存储不连续的时候。</li>
<li>二级索引(非聚簇索引)可能比想象的要更大，因为在二级索引的叶子节点包含了引用行的主键列。</li>
<li>二级索引访问需要两次索引查找，而不是一次。因为二级索引叶子节点保存的不是指向行的物理位置的指针，而是行的主键值。即先要找到主键值，在去聚簇索引中查找对应的行。</li>
</ul>
<h4 id="InnoDB和MyISAM的数据分布对比"><a href="#InnoDB和MyISAM的数据分布对比" class="headerlink" title="InnoDB和MyISAM的数据分布对比"></a>InnoDB和MyISAM的数据分布对比</h4><p>聚簇索引和非聚簇索引的数据分布有区别，以及对应的主键索引和二级索引的数据分布也有区别，通常会让人感到困惑和意外。</p>
<p>来看InnoDB和MyISAM是如何存储下面的表的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE layout_test (</span><br><span class="line">		col1 int NOT NULL,</span><br><span class="line">  	col2 int NUT NULL,</span><br><span class="line">  	PRIMARY KEY(col1),</span><br><span class="line">  	KEY(col2)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>假设表中主键取值为1~10000，按照随机顺序插入并使用<code>OPTIMIZE TABLE</code>命令做了优化。</p>
<p>MyISAM的数据分布，MyISAM按照数据插入的顺序存储在磁盘上：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9503.png" alt=""></p>
<p>在行的旁边显示了行号，从0开始递增。因为行是定长的，所以MyISAM可以从表的开头跳过所需的字节找到需要的行。</p>
<p>下面的一系列的图只显示索引中的节点，索引中的每个叶子节点包含”行号”。</p>
<p>下图显示了表的主键：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9504.png" alt=""></p>
<p>下图显示<code>col2</code>列上的索引：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9505.png" alt=""></p>
<p>事实上，MyISAM中的主键索引和其他索引在结构上没有什么不同。主键索引就是一个名为<code>PRIMARY</code>的唯一非空索引。</p>
<p>InnoDB因为支持聚簇索引，所以使用非常不同的方式存储同样的数据。InnoDB以下图方式存储数据：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9506.png" alt=""></p>
<p>该图显示了整个表，而不是只有索引。因为在InnoDB中，聚簇索引就是表，所以不像MyISAM那样需要独立的行存储。</p>
<p>聚簇索引的每一个叶子节点都包含了主键值、事务ID、用于事务和MVCC的回归指针以及所有的剩余列(此例中是col2)。如果主键是一个列前缀索引，InnoDB也会包含完整的主键列和剩下的其他列。</p>
<p>下图显示了示例表的<code>col2</code>索引。每一个叶子节点都包含索引列<code>col2</code>，紧接着是主键值<code>col1</code>。这对聚簇索引和二级索引都使用。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9507.png" alt=""></p>
<p>下图描述InnoDB和MyISAM如何存放表的抽象图。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Mysql/%E5%85%B3%E4%BA%8EMySQL%E7%B4%A2%E5%BC%9508.png" alt=""></p>
<h4 id="在InnoDB表中按主键顺序插入行"><a href="#在InnoDB表中按主键顺序插入行" class="headerlink" title="在InnoDB表中按主键顺序插入行"></a>在InnoDB表中按主键顺序插入行</h4><p>如果正在使用InnoDB表并且没有什么数据需要聚集，那么可以定义一个代理键<code>surrogate index</code>作为主键，这种主键的数据应该和应用无关，最简单的方法是使用<code>AUTO_INCREMENt</code>自增列，这样可以保证数据行是按顺序写入，对于根据主键做关联操作的性能也会更好。</p>
<p>最好避免随机的(不连续且值的分布范围非常大)聚簇索引，特别是对于I/O密集型的应用。</p>
<p>例如，从性能的角度考虑，使用UUID来作为聚簇索引则会很糟糕：它使得聚簇索引的插入变得完全随机，这是最坏的情况，使得数据没有任何聚集特性。</p>
<h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>如果一个索引包含(或者说覆盖)所有需要查询的字段的值，我们就称之为”覆盖索引”。</p>
<h3 id="使用索引扫描来做排序"><a href="#使用索引扫描来做排序" class="headerlink" title="使用索引扫描来做排序"></a>使用索引扫描来做排序</h3><p>MySQL有两种方式可以生成有序的结果：通过排序操作；或者按索引顺序扫描；如果<code>EXPLAIN</code>出来的<code>type</code>列的值为<code>index</code>，则说明MySQL使用了索引扫描来做排序。</p>
<h3 id="压缩（前缀压缩）索引"><a href="#压缩（前缀压缩）索引" class="headerlink" title="压缩（前缀压缩）索引"></a>压缩（前缀压缩）索引</h3><p>MyISAM使用前缀压缩来减少索引的大小，从而让更多的索引可以放入内存中，这在某些情况下能极大地提高性能。可压缩字符串和整数。</p>
<p>MyISAM压缩每个索引块的方法是，先完全保存索引块中的一个值，然后将其他值和第一个值进行比较得到相同前缀的字节数和剩余的不同后缀部分，把这部分存储起来即可。</p>
<p>如，索引块第一个值是<code>perform</code>，第二个值是<code>performance</code>，那么第二个值的前缀压缩后存储的值类似<code>7，ance</code>。</p>
<p>MyISAM对行指针也采用类似的前缀压缩方式。</p>
<p>压缩块使用更少的空间，代价是某些操作可能变慢。因为每个值的压缩前缀都依赖前面的值，索引MyISAM无法在索引块中使用二分查找而只能从头开始扫描。正序扫描还不错，倒序<code>ORDER BY DESC</code>就不是很好了。</p>
<p>所有在块中查找某一行的操作平均都需要扫描半个索引块。</p>
<p>在<code>CREATE TABLE</code>语句中指定<code>PACK_KEYS</code>参数来控制索引压缩的方式。</p>
<h3 id="冗余和重复索引"><a href="#冗余和重复索引" class="headerlink" title="冗余和重复索引"></a>冗余和重复索引</h3><p>MySQL允许在相同列上创建多个索引，无论是有意的还是无意的。MySQL需要单独维护重复的索引，并且优化器在优化查询的时候也需要逐个地进行考虑，这会影响性能。</p>
<p>重复索引是指在相同的列上按照相同的顺序创建的相同类型的索引。应该避免这种索引的创建。</p>
<p>下面的写法实际创建了三个重复的索引，因为MySQL的唯一限制和主键限制都是通过索引实现的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test(</span><br><span class="line">		ID INT NOT NULL PRIMARY KEY,</span><br><span class="line">  	A  INT NOT NULL,</span><br><span class="line">  	b  int NOT NULL,</span><br><span class="line">  	UNIQUE(ID),</span><br><span class="line">  	INDEX(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>冗余索引和重复索引有些不同。如果创建了索引<code>(A,B)</code>，在创建索引<code>A</code>就是荣誉索引，因为这只是前一个索引的前缀索引。如果再创建索引<code>(B, A)</code>，也不是冗余索引，索引<code>B</code>也不是，因为<code>B</code>不是索引<code>(A, B)</code>的最左前缀列。</p>
<p>大多数情况下不需要冗余索引，应该尽量扩展已有的索引而不是创建新索引。但有时候出于性能方面的考虑，需要冗余索引，因为扩展已有的索引会导致其变得太大，从而影响其他使用该索引的查询的性能。</p>
<h3 id="索引和锁"><a href="#索引和锁" class="headerlink" title="索引和锁"></a>索引和锁</h3><p>索引可以让查询锁定更少的行。如果你的查询从不访问哪些不需要的行，那么，就会锁定更少的行，有两个好处：</p>
<ul>
<li>减少锁定行的时候带来的开销</li>
<li>减少锁定超过需要的行增加的锁争用并避免减少并发性。</li>
</ul>
<p>InnoDB只有在访问行的时候才会对其枷锁，而索引能够减少InnoDB访问的行数，从而减少锁的数量。但这只有当InnoDB在存储引擎层能够过滤掉所有不需要的行时才有效。如果索引无法过滤掉无效的行，那么再InnoDB检索到数据并返回给服务器层以后，MySQL服务器才能应用<code>WHERE</code>子句。这时候已经无法避免锁定行了：InnoDB已经锁住了这些行，到适当的时候才释放。</p>
<p>看下面的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SET AUTOCOMMIT&#x3D;0;</span><br><span class="line">BEGIN;</span><br><span class="line">SELECT actor_id FROM sakila.actor WHERE actor_id &lt; 5 AND actor_id &lt;&gt; 1 FOR UPDATE;</span><br><span class="line"></span><br><span class="line">+------------+</span><br><span class="line">| customerid |</span><br><span class="line">+------------+</span><br><span class="line">|          2 |</span><br><span class="line">|          3 |</span><br><span class="line">|          4 |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure>

<p>这条查询仅返回2~4之间的行，但实际上获取了1到4之间的行的排它锁。InnoDB会锁住第一行，这是因为MySQL为该查询选择的执行计划是索引范围扫描：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT actor_id FROM sakila.actor WHERE actor_id &lt; 5 AND actor_id &lt;&gt; 1 FOR UPDATE;</span><br><span class="line">+-----+------------+-------+-------+---------+-------------+</span><br><span class="line">| id  | select_type| table | type  | key     | Extra       |</span><br><span class="line">+-----+------------+-------+-------+---------+-------------+</span><br><span class="line">| 121 | SIMPLE     | actor | range | PRIMARY |Using Where; |</span><br><span class="line">|     |            |       |       |         |Using Index  |</span><br><span class="line">+-----+------------+-------+-------+---------+-------------+</span><br></pre></td></tr></table></figure>

<p>换句话说，底层存储引擎的操作是”从索引的开头开始获取满足条件<code>actor_id&lt;5</code>的记录”，服务器并没有告诉InnoDB可以过滤第一行的<code>WHERE</code>条件。注意到<code>EXPLAIN</code>的<code>Extra</code>列出现了<code>Using where</code>，这表示MySQL服务器将存储引擎返回行以后再应用<code>WHERE</code>过滤条件。</p>
<p>下面的查询就可以证明第一行确实被锁定，尽管第一个查询的结果中并没有这个第一行。保持第一行链接打开，然后开启第二个连接并执行如下查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET AUTOCOMMIT&#x3D;0;</span><br><span class="line">BEGIN;</span><br><span class="line">SELECT actor_id FROM sakila.actor WHERE actor_id &#x3D; 1 FOR UPDATE;</span><br></pre></td></tr></table></figure>

<p>这个查询将会被挂起，直到第一个事务释放第一行的锁。</p>
<p>就像这个例子显示的，即使使用了索引，InnoDB也可能锁住一些不需要的数据。如果不能使用索引查找和锁定行的话问题可能会更糟糕，MySQL会做全表扫描并锁住所有的行，而不管是不是需要。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/Python/Python%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/Python/Python%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">Python入门阅读笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-18 10:23:10" itemprop="dateCreated datePublished" datetime="2019-07-18T10:23:10+08:00">2019-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:38:54" itemprop="dateModified" datetime="2020-05-16T10:38:54+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python入门阅读笔记"><a href="#Python入门阅读笔记" class="headerlink" title="Python入门阅读笔记"></a>Python入门阅读笔记</h1><blockquote>
<p>《Python编程从入门到实践》</p>
</blockquote>
<ol>
<li>Python文件的后缀为<code>.py</code></li>
</ol>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ol>
<li><p>变量的命名和使用：</p>
<ul>
<li>变量名只能包含字母、数字和下划线。变量名可以字母或下划线打头，但不能以数字打头。 </li>
<li>变量名不能包含空格，但可使用下划线来分隔其中的单词 。</li>
<li>不要将Python关键字和函数名用作变量名，即不要使用Python保留用于特殊用途的单词 ，如<code>print</code>。</li>
<li>变量名应既简短又具有描述性</li>
<li>慎用小写字母l和大写字母O，因为它们可能被人错看成数字1和0</li>
</ul>
</li>
<li><p>在保存每个程序时，使用符合标准Python约定的文件名：使用<strong>小写字母</strong>和<strong>下划线</strong>，如<code>hello_world.py</code>。</p>
</li>
<li><p>字符串就是一系列字符。用引号括起的都是字符串，其中的引号可以是单引号，也可以是双引号。这种灵活性让你能够在字符串中包含引号和撇号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'I told my friend, "Python is my favorite language!"'</span></span><br><span class="line"></span><br><span class="line"><span class="string">"The language 'Python' is named after Monty Python, not the snake."</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串大小写：</p>
<ul>
<li><code>title()</code>：首字母大写，其余小写。</li>
<li><code>upper()</code>：大写</li>
<li><code>lower()</code>：小写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">'ccbAan gO'</span></span><br><span class="line"></span><br><span class="line">print(name.title()) <span class="comment"># Ccbean Go</span></span><br><span class="line">print(name.upper()) <span class="comment"># CCBEAN GO</span></span><br><span class="line">print(name.lower()) <span class="comment"># ccbean go</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>合并(拼接)字符串：使用<code>+</code>来合并字符串</p>
</li>
<li><p>字符串制表符或换行符添加空白：<strong>空白</strong>泛指任何非打印字符，如空格、制表符和换行符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Languages:\n\tPython\n\tC\n\tJavaScript"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Languages:</span></span><br><span class="line"><span class="comment">#        Python</span></span><br><span class="line"><span class="comment">#        C</span></span><br><span class="line"><span class="comment">#        JavaScript</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串删除空白：</p>
<ul>
<li><code>strip()</code>：删除字符串两端的空白</li>
<li><code>lstrip()</code>：删除字符串左边的空白</li>
<li><code>rstrip()</code>：删除字符串右边的空白</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">favorite_language = <span class="string">' python '</span> </span><br><span class="line"></span><br><span class="line">print(favorite_language)  <span class="comment"># ' python '</span></span><br><span class="line">print(favorite_language.strip())  <span class="comment"># 'python'</span></span><br><span class="line">print(favorite_language.rstrip())  <span class="comment"># ' python'</span></span><br><span class="line">print(favorite_language.lstrip())  <span class="comment"># 'python '</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>数字整数：可对整数执行加<code>+</code>、减<code>-</code>、乘<code>*</code>、除<code>/</code>、乘方<code>**</code>，可以使用括号来修改运算次序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> + <span class="number">3</span>*<span class="number">4</span> 		<span class="comment"># 14</span></span><br><span class="line">(<span class="number">2</span> + <span class="number">3</span>) * <span class="number">4</span> <span class="comment"># 20</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>数字浮点数：将带有小数点的数字都称为浮点数。使用的是<a href="https://zh.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener"><code>IEEE-754</code></a>。</p>
</li>
<li><p>使用<code>str()</code>避免类型错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">23</span></span><br><span class="line">message = <span class="string">"Happy "</span> + age + <span class="string">"rd Birthday!"</span></span><br><span class="line">print(message)</span><br><span class="line"><span class="comment"># 报错</span></span><br><span class="line"><span class="comment"># TypeError: must be str, not int</span></span><br><span class="line"></span><br><span class="line">message = <span class="string">"Happy "</span> + str(age) + <span class="string">"rd Birthday!"</span></span><br><span class="line">print(message) <span class="comment"># Happy 23rd Birthday!</span></span><br></pre></td></tr></table></figure>

<p>这是类型错误，在代码中，使用了整数(int)变量，但它不知道如何解读这个值。<code>str()</code>将非字符串值表示为字符串。</p>
</li>
<li><p>在Python 2中，将两个整数相除得到的结果稍有不同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; python2.7</span><br><span class="line">&gt;&gt;&gt; 3 &#x2F; 2</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; 3 &#x2F; 2</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; 3.0 &#x2F; 2</span><br><span class="line">1.5</span><br><span class="line">&gt;&gt;&gt; 3 &#x2F; 2.0 </span><br><span class="line">1.5</span><br><span class="line">&gt;&gt;&gt; 3.0 &#x2F; 2.0 </span><br><span class="line">1.5</span><br></pre></td></tr></table></figure>
</li>
<li><p>Python注释用井号<code>#</code>标识。<code># hello world</code></p>
</li>
<li><p>Python之禅：<code>import this</code>。</p>
</li>
</ol>
<h2 id="列表简介"><a href="#列表简介" class="headerlink" title="列表简介"></a>列表简介</h2><ol>
<li><p>列表由一系列按特定顺序排列的元素组成，用方括号<code>[]</code>来表示列表，并用逗号来分隔其中的元素。相当于PHP中的索引数组和JS中的数组。</p>
</li>
<li><p>列表是有序集合，因此要访问列表的任何元素，只需将该元素的位置或索引告诉Python即可。<br>要访问列表元素，可指出列表的名称，再指出元素的索引，并将其放在方括号内。</p>
</li>
<li><p>修改元素列表：与访问类似，直接对应索引即可修改。</p>
</li>
<li><p>在列表中添加元素：</p>
<ul>
<li><code>append()</code>：在列表末尾添加元素。</li>
<li><code>insert()</code>：在列表的任何位置插入元素，指定新元素的索引和值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">names = [ <span class="string">'tom'</span>, <span class="string">'jack'</span>, <span class="string">'andy'</span> ]</span><br><span class="line">print(names) <span class="comment"># ['tom', 'jack', 'andy'] </span></span><br><span class="line"></span><br><span class="line">names.append(<span class="string">'mike'</span>);</span><br><span class="line">print(names) <span class="comment"># ['tom', 'jack', 'andy', 'mike']</span></span><br><span class="line"></span><br><span class="line">names.insert(<span class="number">1</span>,<span class="string">'lily'</span>)</span><br><span class="line">print(names) <span class="comment"># ['tom', 'lily', 'jack', 'andy', 'mike']</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在列表中删除元素：</p>
<ul>
<li><code>del</code>: 指定删除的索引</li>
<li><code>pop()</code>：删除列表中的元素，默认删除末尾元素；也可删除列表中任何位置元素，参数中传入索引即可，返回删除值。</li>
<li><code>remove()</code>：根据值删除元素。如果某个值在列表中出现多次，只删除第一次出现的值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">names = [<span class="string">'jack'</span>, <span class="string">'tom'</span>, <span class="string">'andy'</span>, <span class="string">'mike'</span>, <span class="string">'lily'</span>, <span class="string">'alex'</span>]</span><br><span class="line">print(names)</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> names[<span class="number">0</span>] </span><br><span class="line">print(names)  <span class="comment"># ['tom', 'andy', 'mike', 'lily', 'alex']</span></span><br><span class="line"></span><br><span class="line">names.pop()  </span><br><span class="line">print(names)  <span class="comment"># ['tom', 'andy', 'mike', 'lily']</span></span><br><span class="line"></span><br><span class="line">names.pop(<span class="number">2</span>)</span><br><span class="line">print(names)  <span class="comment"># ['tom', 'andy', 'lily']</span></span><br><span class="line"></span><br><span class="line">names.remove(<span class="string">'lily'</span>)</span><br><span class="line">print(names)  <span class="comment"># ['tom', 'andy']</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>列表排序：</p>
<ul>
<li><code>sort()</code>：对列表进行永久性排序。</li>
<li><code>sorted()</code>：对列表进行临时排序</li>
<li><code>reverse()</code>：反转列表元素的排列顺序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cars = ['bmw', 'audi', 'toyota', 'subaru'] </span></span><br><span class="line"></span><br><span class="line">cars.sort()</span><br><span class="line">print(cars)  <span class="comment"># ['audi', 'bmw', 'subaru', 'toyota']</span></span><br><span class="line"></span><br><span class="line">cars.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">print(cars) <span class="comment"># ['toyota', 'subaru', 'bmw', 'audi']</span></span><br><span class="line"></span><br><span class="line">print(sorted(cars)) <span class="comment"># ['audi', 'bmw', 'subaru', 'toyota']</span></span><br><span class="line"></span><br><span class="line">print(cars) <span class="comment"># ['bmw', 'audi', 'toyota', 'subaru']</span></span><br></pre></td></tr></table></figure>

<p>如果你要按与字母顺序相反的顺序显示列表，<code>sort()</code>和<code>sorted()</code>都可以传递参数<code>reverse=True</code>。</p>
</li>
<li><p>确定列表长度</p>
<ul>
<li><code>len()</code>：获取列表长度。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cars = [<span class="string">'bmw'</span>, <span class="string">'audi'</span>, <span class="string">'toyota'</span>, <span class="string">'subaru'</span>]</span><br><span class="line">len(cars) <span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免索引错误：</p>
<ul>
<li>访问不存在的索引会报错<code>IndexError: list index out of range</code></li>
<li>索引<code>-1</code>总是返回列表最后一个元素，仅当列表为空时，会导致错误。</li>
</ul>
</li>
</ol>
<h2 id="操作列表"><a href="#操作列表" class="headerlink" title="操作列表"></a>操作列表</h2><ol>
<li><p>遍历整个列表使用<code>for</code>循环。使用<code>for</code>容易出现的错误是忘记使用冒号<code>:</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cars = [<span class="string">'bmw'</span>, <span class="string">'audi'</span>, <span class="string">'toyota'</span>, <span class="string">'subaru'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> car <span class="keyword">in</span> cars:</span><br><span class="line">    print(car)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Python根据缩进来判断代码行与前一个代码行的关系。</p>
</li>
<li><p>缩进常见的错误：</p>
<ul>
<li>忘记缩进</li>
<li>忘记缩进额外的代码行，容易出现逻辑错误</li>
<li>不必要缩进的时候缩进</li>
</ul>
</li>
<li><p>创建数值列表：</p>
<ul>
<li><p>使用函数<code>range()</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">		print(value)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>list()</code>可以将<code>range()</code>的结果直接转换为列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numbers = list(range(<span class="number">1</span>,<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">print(numbers) <span class="comment"># [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure>

<p>函数<code>range()</code>也可以指定步长：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">even_numbers = list(range(<span class="number">2</span>,<span class="number">11</span>,<span class="number">2</span>))</span><br><span class="line">print(even_numbers) <span class="comment"># [2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>对数字列表执行简单的统计计算：</p>
<ul>
<li><code>max()</code>：最大值</li>
<li><code>min()</code>：最小值</li>
<li><code>sum()</code>：求和</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">digits = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">min(digits) <span class="comment"># 0</span></span><br><span class="line">max(digits) <span class="comment"># 9</span></span><br><span class="line">sum(digits) <span class="comment"># 45</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>列表解析：列表解析将for循环和创建新元素的代码合并成一行，并自动附加新元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">squares = [value**<span class="number">2</span> <span class="keyword">for</span> value <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)] </span><br><span class="line"></span><br><span class="line">print(squares) <span class="comment"># [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span></span><br></pre></td></tr></table></figure>

<p>要注意，这里的<code>for</code>语句末尾没有冒号。</p>
</li>
<li><p>列表的部分元素，Python中称之为<strong>切片</strong>。要创建切片，可指定要使用的第一个元素和最后一个元素的索引。它如<code>range()</code>函数一样，都是左闭右开区间。</p>
</li>
<li><p>使用切片可以生成列表的任何子集。</p>
<p>提取2~4个元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numbers = [ <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>, <span class="string">'six'</span> ];</span><br><span class="line"></span><br><span class="line">print(numbers[<span class="number">1</span>:<span class="number">4</span>]) <span class="comment"># ['two', 'three', 'four']</span></span><br></pre></td></tr></table></figure>

<p>如果没有指定第一个索引，将从列表开头开始：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numbers = [ <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>, <span class="string">'six'</span> ];</span><br><span class="line"></span><br><span class="line">print(numbers[:<span class="number">4</span>]) <span class="comment"># ['one', two', 'three', 'four']</span></span><br></pre></td></tr></table></figure>

<p>同样，不指定最后的索引，切片会直接到末尾：</p>
</li>
</ol>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numbers = [ <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>, <span class="string">'six'</span> ];</span><br><span class="line"></span><br><span class="line">print(numbers[<span class="number">2</span>:]) <span class="comment"># [ 'three', 'four', 'five', 'six']</span></span><br></pre></td></tr></table></figure>

<p>   负数索引返回离列表末尾相应距离的元素：</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numbers = [ <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>, <span class="string">'six'</span> ];</span><br><span class="line"></span><br><span class="line">print(numbers[<span class="number">-3</span>:]) <span class="comment"># [ 'four', 'five', 'six']</span></span><br></pre></td></tr></table></figure>

<ol start="9">
<li><p>遍历切片：如果要遍历列表的部分元素，可以在<code>for</code>循环中使用切片。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">numbers = [ <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>, <span class="string">'six'</span> ];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers[<span class="number">2</span>:<span class="number">5</span>]:</span><br><span class="line">    print(number)</span><br><span class="line"><span class="comment"># three</span></span><br><span class="line"><span class="comment"># four</span></span><br><span class="line"><span class="comment"># five</span></span><br></pre></td></tr></table></figure>

<p>在很多情况下，切片都很有用。例如，编写游戏时，你可以在玩家退出游戏时将其最终得分<br>加入到一个列表中。然后，为获取该玩家的三个最高得分，你可以将该列表按降序排列，再创建<br>一个只包含前三个得分的切片。处理数据时，可使用切片来进行批量处理;编写Web应用程序时，<br>可使用切片来分页显示信息，并在每页显示数量合适的信息。</p>
</li>
<li><p>复制列表：复制列表是创建一个包含整个列表的切片，方法是同事省略起始索引和终止索引<code>[:]</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">my_foods = [<span class="string">'pizza'</span>, <span class="string">'falafel'</span>, <span class="string">'carrot cake'</span>] </span><br><span class="line"></span><br><span class="line">friend_foods = my_foods[:]</span><br><span class="line">friend_foods.append(<span class="string">'rice'</span>)</span><br><span class="line">print(<span class="string">"My favorite foods are:"</span>) </span><br><span class="line">print(my_foods)</span><br><span class="line">print(<span class="string">"\nMy friend's favorite foods are:"</span>)</span><br><span class="line">print(friend_foods)</span><br><span class="line"></span><br><span class="line"><span class="comment"># My favorite foods are:</span></span><br><span class="line"><span class="comment"># ['pizza', 'falafel', 'carrot cake']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># My friend's favorite foods are:</span></span><br><span class="line"><span class="comment"># ['pizza', 'falafel', 'carrot cake', 'rice']</span></span><br></pre></td></tr></table></figure>

<p>复制会创建一个新的列表，然后将变量与此关联起来。然而，不使用切片，直接将列表赋值给其他值，那么列表是共享的，其中一个发生改变，另一个也会发生变化。因为变量名称是一个指向列表的指针，同JS的引用类型。</p>
</li>
<li><p>元组：不可变的列表。元组看起来犹如列表，但使用圆括号<code>()</code>来标识。定义元组后，就可以使用索引来访问其元素，就像访问列表元素一样。也可同列表一样进行遍历。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dimensions = (<span class="number">200</span>, <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">print(dimensions[<span class="number">0</span>]) <span class="comment"># 200</span></span><br><span class="line">print(dimensions[<span class="number">1</span>]) <span class="comment"># 50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line">dimensions[<span class="number">0</span>] = <span class="number">250</span></span><br><span class="line"><span class="comment"># TypeError: 'tuple' object does not support item assignment</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>若要提出Python语言修改建议，需要编写Python改进提案(Python Enhancement Proposal，PEP)，代码格式：</p>
<ul>
<li>缩进，建议每级缩进都使用四个空格，既可提高可阅读星，又留下了足够的多级缩进空间。</li>
<li>行长，建议每行不超过<strong>80</strong>个字符。最初是因为大多数计算机中，终端窗口每行只能容纳79个字符；当前，计算机屏幕每行可容纳的字符数多得多，为何还要使用79字符的标准行长呢?这里有别的原因。专业程序员通常会在同一个屏幕上打开多个文件，使用标<br>准行长可以让他们在屏幕上并排打开两三个文件时能同时看到各个文件的完整行。PEP 8还建议注释的行长都不超过72字符，因为有些工具为大型项目自动生成文档时，会在每行注释开头添加格式化字符。</li>
<li>空行，合理运用，不要再程序中过多地使用空行。</li>
</ul>
</li>
</ol>
<h2 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h2><ol>
<li><p>每条if语句的核心都是一个值为<code>True</code>或<code>False</code>的表达式，这种表达式被称为条件测试。Python根据条件测试的值为<code>True</code>还是<code>False</code>来决定是否执行if语句中的代码。如果条件测试的值为<code>True</code>，Python就执行紧跟在<code>if</code>语句后面的代码;如果为<code>False</code>，Python就忽略这些代码。</p>
</li>
<li><p>检查多个条件，可使用逻辑运算符：且<code>and</code>和或<code>or</code></p>
</li>
<li><p>检查特定值(不)包含在列表中，使用关键字<code>in</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">requested_toppings = [<span class="string">'mushrooms'</span>, <span class="string">'onions'</span>, <span class="string">'pineapple'</span>]</span><br><span class="line"><span class="string">'mushrooms'</span> <span class="keyword">in</span> requested_toppings <span class="comment"># True</span></span><br><span class="line"><span class="string">'pepperoni'</span> <span class="keyword">in</span> requested_toppings <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="string">'pepperoni'</span> <span class="keyword">not</span> <span class="keyword">in</span> requested_toppings <span class="comment"># True</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>布尔表达式，<code>True</code>和<code>False</code>，开头是大写，其他都是错的。。。</p>
</li>
<li><p>语句格式：</p>
<ul>
<li><p><code>if</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> conditional_test: </span><br><span class="line">  do something</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>if-else</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> conditional_test: </span><br><span class="line">  do something</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  do something</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>if-elif-else</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> conditional_test: </span><br><span class="line">  do something</span><br><span class="line"><span class="keyword">elif</span> conditional_test:</span><br><span class="line">  do something</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  do something</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>确定列表是否为空：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test = []</span><br><span class="line"><span class="keyword">if</span> test:</span><br><span class="line">    print(<span class="string">'这个列表不是空的'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"这个列表是空的"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 输出：这个列表是空的</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>if语句的格式，在诸如<code>==</code>、<code>&gt;=</code>、<code>&lt;=</code>等比较运算符两边各添加一个空格。</p>
</li>
</ol>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><ol>
<li><p>在Python中，字典是一系列键-值对。每个键都与一个值相关联，可以使用键来访问与之相关联的值。可将任何Python对象用作字典中的值。键和值之间用冒号分割，键值对之间用逗号分割。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">alien_0 = &#123;<span class="string">'color'</span>: <span class="string">'green'</span>, <span class="string">'points'</span>: <span class="number">5</span>&#125;</span><br><span class="line">print(alien_0[<span class="string">'color'</span>]) <span class="comment"># green</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加值</span></span><br><span class="line"><span class="comment"># &#123;'color': 'green', 'points': 5, 'y_position': 25, 'x_position': 0&#125;</span></span><br><span class="line">alien_0[<span class="string">'x_position'</span>] = <span class="number">0</span></span><br><span class="line">alien_0[<span class="string">'y_position'</span>] = <span class="number">25</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改值</span></span><br><span class="line"><span class="comment"># &#123;'color': 'yellow', 'points': 5, 'y_position': 25, 'x_position': 0&#125;</span></span><br><span class="line">alien_0[<span class="string">'color'</span>] = <span class="string">'yellow'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除值</span></span><br><span class="line"><span class="comment"># &#123;'color': 'green', 'y_position': 25, 'x_position': 0&#125;</span></span><br><span class="line"><span class="keyword">del</span> alien_0[<span class="string">'points'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历字典中所有的键和值：</p>
<p>方法<code>items()</code>返回一个键值对列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user = &#123; <span class="string">'name'</span>: <span class="string">'wangge'</span>, <span class="string">'age'</span>: <span class="string">'18'</span>, <span class="string">'favorite'</span>: <span class="string">'banana'</span> &#125;</span><br><span class="line"><span class="comment"># user.items() 返回 dict_items([('name', 'wangge'), ('age', '18'), ('favorite', 'banana')])</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> user.items():</span><br><span class="line">    print(<span class="string">'\nKey: '</span> + key)</span><br><span class="line">    print(<span class="string">'\nValue: '</span> + value)</span><br></pre></td></tr></table></figure>

<p>遍历字典时，键值对的返回顺序与存储顺序可能不同，字典是无序的，Python并不关心存储顺序，而只跟踪键和值之间的关联关系。</p>
</li>
<li><p>遍历字典中所有的键：</p>
<p>方法<code>keys()</code>返回字典中所有的键列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = &#123; <span class="string">'name'</span>: <span class="string">'wangge'</span>, <span class="string">'age'</span>: <span class="string">'18'</span>, <span class="string">'favorite'</span>: <span class="string">'banana'</span> &#125;</span><br><span class="line"><span class="comment"># user.keys() 返回 dict_keys(['name', 'age', 'favorite'])</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> user.keys():</span><br><span class="line">    print(<span class="string">'Key: '</span> + key)</span><br></pre></td></tr></table></figure>

<p>遍历代码时，会默认遍历所有的键，因此可省略<code>keys()</code>，输出将不变。</p>
<p>因为字典是无序的，如果想对其进行排序，一种做法是，使用函数<code>sorted()</code>来获得按特定顺序排列的键列表副本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">favorite_languages = &#123;</span><br><span class="line">    <span class="string">'jen'</span>: <span class="string">'python'</span>, </span><br><span class="line">    <span class="string">'sarah'</span>: <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'edward'</span>: <span class="string">'ruby'</span>, </span><br><span class="line">    <span class="string">'phil'</span>: <span class="string">'python'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> sorted(favorite_languages.keys()):</span><br><span class="line">    print(name.title())</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历字典中的所有值：</p>
<p>方法<code>values()</code>返回一个值列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">favorite_languages = &#123;</span><br><span class="line">    <span class="string">'jen'</span>: <span class="string">'python'</span>, </span><br><span class="line">    <span class="string">'sarah'</span>: <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'edward'</span>: <span class="string">'ruby'</span>, </span><br><span class="line">    <span class="string">'phil'</span>: <span class="string">'python'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> favorite_languages.values():</span><br><span class="line">    print(name.title())</span><br></pre></td></tr></table></figure>

<p>以此法提取的所有值没有考虑是否有重复。为剔除重复，可以使用集合<code>set</code>，集合类似于列表，但每个元素都必须是独一无二的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">favorite_languages = &#123;</span><br><span class="line">    <span class="string">'jen'</span>: <span class="string">'python'</span>, </span><br><span class="line">    <span class="string">'sarah'</span>: <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'edward'</span>: <span class="string">'ruby'</span>, </span><br><span class="line">    <span class="string">'phil'</span>: <span class="string">'python'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> set(favorite_languages.values()):</span><br><span class="line">    print(name.title())</span><br></pre></td></tr></table></figure>
</li>
<li><p>嵌套：将一系列字典存储在列表中，或将列表作为值存储在字典中。</p>
</li>
</ol>
<h2 id="用户输入和while循环"><a href="#用户输入和while循环" class="headerlink" title="用户输入和while循环"></a>用户输入和while循环</h2><ol>
<li><p>函数<code>input()</code>让程序暂停运行，等待用户输入一些文本。获取用户输入后，Python将其存储在一个变量中，以便之后使用。此函数接受一个参数， 要向用户显示的说明。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message = input(<span class="string">"Tell me something, and I will repeat it back to you: "</span>)</span><br><span class="line">print(message)</span><br></pre></td></tr></table></figure>
</li>
<li><p>函数<code>int()</code>获取数值输入，使用函数<code>input()</code>时，Python将用户输入解读为字符串。使用<code>int()</code>可将用户输入的数字字符串转为数值，不使用而直接作为数值使用会报错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">height = input(<span class="string">"How tall are you, in centimeter? "</span>) </span><br><span class="line">height = int(height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> height &gt;= <span class="number">170</span>:</span><br><span class="line">    print(<span class="string">"\nYou're tall enough to ride!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"\nYou'll be able to ride when you're a little older."</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>while循环简介：while  不断地运行，直到 定的条<br>件不满足为止。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户输入quit时程序退出</span></span><br><span class="line">prompt = <span class="string">"\nTell me something, and I will repeat it back to you:"</span></span><br><span class="line">prompt += <span class="string">"\nEnter 'quit' to end the program. "</span></span><br><span class="line"></span><br><span class="line">message = <span class="string">""</span></span><br><span class="line"><span class="keyword">while</span> message != <span class="string">'quit'</span>:</span><br><span class="line">    message = input(prompt)</span><br><span class="line">    <span class="keyword">if</span> message != <span class="string">'quit'</span></span><br><span class="line">    		print(message)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用标志可以简化while语句。</p>
</li>
<li><p>使用<code>break</code>可立即退出<code>while</code>循环，也可用于<code>for</code>循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">current_number = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> current_number &lt; <span class="number">10</span>:</span><br><span class="line">    current_number += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> current_number % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(current_number)</span><br><span class="line">    <span class="comment"># 1</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="6">
<li><p>使用<code>continue</code>跳出本次循环：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">current_number = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> current_number &lt; <span class="number">10</span>:</span><br><span class="line">    current_number += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> current_number % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    print(current_number)</span><br><span class="line">    <span class="comment"># 1 3 5 7 9</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用while循环来处理列表和字典：for  是一种遍历列表的有效方式，但在for循环中不应修改列表，否则将导致Python难以跟踪其中的元素（？？？）。要在遍历列表的同时对其进行修改，可使用while循环。通过将while循环同列表和字典结合起来使用，可 集、存储并组织大量输入，供以后查看和显示。</p>
</li>
<li><p>在列表间移动元素</p>
</li>
<li><p>删除包含特定值的所有列表元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pets = [<span class="string">'dog'</span>, <span class="string">'cat'</span>, <span class="string">'dog'</span>, <span class="string">'goldfish'</span>, <span class="string">'cat'</span>, <span class="string">'rabbit'</span>, <span class="string">'cat'</span>] </span><br><span class="line">print(pets)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="string">'cat'</span> <span class="keyword">in</span> pets:</span><br><span class="line">    pets.remove(<span class="string">'cat'</span>)</span><br><span class="line"></span><br><span class="line">print(pets)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用用户输入来填充字典：可使用while  提示用户输入任意数量的信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">responses = &#123;&#125;</span><br><span class="line"><span class="comment"># 设置一个标志 指出调查是否继续 </span></span><br><span class="line">polling_active = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> polling_active:</span><br><span class="line">    <span class="comment"># 提示输入被调查 的名字和回</span></span><br><span class="line">    name = input(<span class="string">"\nWhat is your name? "</span>)</span><br><span class="line">    response = input(<span class="string">"Which mountain would you like to climb someday? "</span>)</span><br><span class="line">    <span class="comment"># 将答卷存储在字典中 </span></span><br><span class="line">    responses[name] = response</span><br><span class="line">    <span class="comment"># 看看是否还有人要参与调查</span></span><br><span class="line">    repeat = input(<span class="string">"Would you like to let another person respond? (yes/ no) "</span>) </span><br><span class="line">    <span class="keyword">if</span> repeat == <span class="string">'no'</span>:</span><br><span class="line">        polling_active = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调查结束 显示结果</span></span><br><span class="line">print(<span class="string">"\n--- Poll Results ---"</span>)</span><br><span class="line"><span class="keyword">for</span> name, response <span class="keyword">in</span> responses.items():</span><br><span class="line">    print(name + <span class="string">" would like to climb "</span> + response + <span class="string">"."</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ol>
<li><p>函数定义：使用关键字<code>def</code>向Python指出函数名，可在括号内指出函数为完成其任务需要的参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'hello world'</span>)</span><br><span class="line">  </span><br><span class="line">hello() <span class="comment"># hello world</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>实参和形参：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(username)</span>:</span></span><br><span class="line">  print(<span class="string">'hello '</span> + username)</span><br><span class="line"></span><br><span class="line">hello(<span class="string">'wangge'</span>)  <span class="comment"># hello wangge</span></span><br></pre></td></tr></table></figure>

<p>在定义函数<code>hello()</code>时，变量<code>username</code>是<strong>形参</strong>—函数完成其工作所需的一项信息。在代码<code>hello(&#39;wangge&#39;)</code>中，值<code>wangge</code>是一个<strong>实参</strong>—调用函数时传递给函数的信息。</p>
</li>
<li><p>传递实参：</p>
<ul>
<li><p>位置实参：调用函数时，Python必须将函数调用中的每个实参都关联到函数定义中的每个形参。最简单的关联方式是基于实参的顺序。这种关联方式被称为位置实参。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">describe_pet</span><span class="params">(animal_type, pet_name)</span>:</span></span><br><span class="line">    <span class="string">"""显示 物的信息"""</span></span><br><span class="line">    print(<span class="string">"\nI have a "</span> + animal_type + <span class="string">"."</span>)</span><br><span class="line">    print(<span class="string">"My "</span> + animal_type + <span class="string">"'s name is "</span> + pet_name.title() + <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">describe_pet(<span class="string">'hamster'</span>, <span class="string">'harry'</span>) <span class="comment"># 注意参数顺序</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关键字实参：传递给函数的名称-值对。直接在实参中将名称和值关联起来，向函数传递实参时无需关注参数传递顺序，而且还清楚地指出了函数调用中各个值的用途。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">describe_pet</span><span class="params">(animal_type, pet_name)</span>:</span></span><br><span class="line">    <span class="string">"""显示 物的信息"""</span></span><br><span class="line">    print(<span class="string">"\nI have a "</span> + animal_type + <span class="string">"."</span>)</span><br><span class="line">    print(<span class="string">"My "</span> + animal_type + <span class="string">"'s name is "</span> + pet_name.title() + <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">describe_pet(animal_type=<span class="string">'hamster'</span>, pet_name=<span class="string">'harry'</span>)</span><br><span class="line">describe_pet(pet_name=<span class="string">'harry'</span>, animal_type=<span class="string">'hamster'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认值：编写函数时，可以给每个形参指定默认值。给形参指定默认值后，可在函数调用中省略相应的实参。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">describe_pet</span><span class="params">(pet_name, animal_type = <span class="string">'dog'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""显示 物的信息"""</span></span><br><span class="line">    print(<span class="string">"\nI have a "</span> + animal_type + <span class="string">"."</span>)</span><br><span class="line">    print(<span class="string">"My "</span> + animal_type + <span class="string">"'s name is "</span> + pet_name.title() + <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">describe_pet(<span class="string">'Peter'</span>)</span><br></pre></td></tr></table></figure>

<p>注意：使用默认值时，在形参列表中必须先列出没有默认值的形参，再列出有默认值的实参。这让Python依然能够正确地解读位置实参。</p>
</li>
<li><p>等效的函数调用：由于可以混合使用位置实参、关键字实参和默认值，通常有多重等效的函数调用方式。</p>
<p>函数定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">describe_pet</span><span class="params">(pet_name, animal_type=<span class="string">'dog'</span>)</span>:</span></span><br></pre></td></tr></table></figure>

<p>调用方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一条名为Willie的小  </span></span><br><span class="line">describe_pet(<span class="string">'willie'</span>) </span><br><span class="line">describe_pet(pet_name=<span class="string">'willie'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一只名为Harry的仓</span></span><br><span class="line">describe_pet(<span class="string">'harry'</span>, <span class="string">'hamster'</span>) </span><br><span class="line">describe_pet(pet_name=<span class="string">'harry'</span>, animal_type=<span class="string">'hamster'</span>) </span><br><span class="line">describe_pet(animal_type=<span class="string">'hamster'</span>, pet_name=<span class="string">'harry'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>禁止函数修改列表而又操作修改列表的方法是想函数传递副本即切片。</p>
</li>
<li><p>传递任意数量的实参：Python允许函数从调用语句中收集任意数量的实参。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_pizza</span><span class="params">(*toppings)</span>:</span></span><br><span class="line">    <span class="string">"""打印顾客所点的所有配料"""</span></span><br><span class="line">    print(toppings)</span><br><span class="line"></span><br><span class="line">make_pizza(<span class="string">'pepperoni'</span>) <span class="comment"># ('pepperoni',)</span></span><br><span class="line">make_pizza(<span class="string">'mushrooms'</span>, <span class="string">'green peppers'</span>, <span class="string">'extra cheese'</span>) <span class="comment"># ('mushrooms', 'green peppers', 'extra cheese')</span></span><br></pre></td></tr></table></figure>

<ul>
<li>结合使用位置实参和任意数量实参：如果要让函数接受不同类型的实参，必须在函数定义中将接纳任意数量实参的形参放在最后。Python先匹配位置实参和关键字实参，再将余下的实参都收集到最后一个形参中。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_pizza</span><span class="params">(size, *toppings)</span>:</span></span><br><span class="line">    print(<span class="string">"\nMaking a "</span> + str(size) +</span><br><span class="line">        <span class="string">"-inch pizza with the following toppings:"</span>)</span><br><span class="line">    <span class="keyword">for</span> topping <span class="keyword">in</span> toppings:</span><br><span class="line">        print(<span class="string">"- "</span> + topping)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make_pizza(<span class="number">16</span>, <span class="string">'pepperoni'</span>)</span><br><span class="line">make_pizza(<span class="number">12</span>, <span class="string">'mushrooms'</span>, <span class="string">'green peppers'</span>, <span class="string">'extra cheese'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用任意数量的关键字实参：有时 ，需要接受任意数量的实参，但预先不知道传递给函数的会是什么样的信息。在这种情况下，可将函数编写成能够接受任意数量的键值对——调用语句提供了多少就接受多少。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_profile</span><span class="params">(first, last, **user_info)</span>:</span> </span><br><span class="line">    <span class="string">"""创建一个字典，其中包含有关用户的一切"""</span> </span><br><span class="line">    profile = &#123;&#125;</span><br><span class="line">    profile[<span class="string">'first_name'</span>] = first</span><br><span class="line">    profile[<span class="string">'last_name'</span>] = last</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> user_info.items():</span><br><span class="line">        profile[key] = value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> profile</span><br><span class="line"></span><br><span class="line">user_profile = build_profile(</span><br><span class="line">    <span class="string">'albert'</span>, </span><br><span class="line">    <span class="string">'einstein'</span>, </span><br><span class="line">    location=<span class="string">'princeton'</span>,</span><br><span class="line">    field=<span class="string">'physics'</span></span><br><span class="line">)</span><br><span class="line">print(user_profile)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将函数存储在模块中：将函数存储在被称为模块的独立文件中，再将模块导入到主程序中。<code>import</code>语句允许在当前运行的程序文件中使用模块中的代码。</p>
</li>
<li><p>如果使用<code>import</code>语句导入了名为<code>module_name.py</code>的整个模块，就可以使用<code>module_name.function_name()</code>的语法使用其中任何一个函数。看下例子：</p>
<p>先创建<code>pizza.py</code>文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pizza.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_pizza</span><span class="params">(size, *toppings)</span>:</span></span><br><span class="line">    print(<span class="string">"\nMaking a "</span> + str(size) +</span><br><span class="line">        <span class="string">"-inch pizza with the following toppings:"</span>)</span><br><span class="line">    <span class="keyword">for</span> topping <span class="keyword">in</span> toppings:</span><br><span class="line">        print(<span class="string">"- "</span> + topping)</span><br></pre></td></tr></table></figure>

<p>再创建<code>making_pizzas.py</code>文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># making_pizzas.py</span></span><br><span class="line"><span class="keyword">import</span> pizza</span><br><span class="line"></span><br><span class="line">pizza.make_pizza(<span class="number">16</span>, <span class="string">'pepperoni'</span>)</span><br><span class="line">pizza.make_pizza(<span class="number">12</span>, <span class="string">'mushrooms'</span>, <span class="string">'green peppers'</span>, <span class="string">'extra cheese'</span>)</span><br></pre></td></tr></table></figure>

<p>Python执行代码行<code>import pizza</code>时，会打开文件<code>pizza.py</code>，并将其中的所有函数都复制到这个程序中。</p>
</li>
<li><p>导入特定函数，可使用下面的语法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module_name <span class="keyword">import</span> function_0, function_1, function_2</span><br></pre></td></tr></table></figure>

<p>对于<strong>第7</strong>中的<code>making_pizzas.py</code>，可以改成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># making_pizzas.py</span></span><br><span class="line"><span class="keyword">from</span> pizza <span class="keyword">import</span> make_pizza</span><br><span class="line"></span><br><span class="line">make_pizza(<span class="number">16</span>, <span class="string">'pepperoni'</span>)</span><br><span class="line">make_pizza(<span class="number">12</span>, <span class="string">'mushrooms'</span>, <span class="string">'green peppers'</span>, <span class="string">'extra cheese'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用as给函数指定别名，语法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module_name <span class="keyword">import</span> function_name <span class="keyword">as</span> fn</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># making_pizzas.py</span></span><br><span class="line"><span class="keyword">from</span> pizza <span class="keyword">import</span> make_pizza <span class="keyword">as</span> mp</span><br><span class="line"></span><br><span class="line">mp(<span class="number">16</span>, <span class="string">'pepperoni'</span>)</span><br><span class="line">mp(<span class="number">12</span>, <span class="string">'mushrooms'</span>, <span class="string">'green peppers'</span>, <span class="string">'extra cheese'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入模块中的所有函数：使用星号<code>*</code>运算符可以导入模块中所有函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module_name <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>



</li>
</ol>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># making_pizzas.py</span></span><br><span class="line"><span class="keyword">from</span> pizza <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">make_pizza(<span class="number">16</span>, <span class="string">'pepperoni'</span>)</span><br><span class="line">make_pizza(<span class="number">12</span>, <span class="string">'mushrooms'</span>, <span class="string">'green peppers'</span>, <span class="string">'extra cheese'</span>)</span><br></pre></td></tr></table></figure>

尽量避免使用此语法，Python可能遇到多个名称相同的函数或变量，进而函数覆盖。</code></pre><ol start="11">
<li><p>函数编写指南：</p>
<ul>
<li><p>应该给函数指定描述性名称，且只在其中使用小写字母和下划线。</p>
</li>
<li><p>每个函数都应包含简要地阐述其功能的注释，该注释应该紧跟在函数定义后面，并采用文档字符串格式。</p>
</li>
<li><p>给形参指定默认值时，等号两边不要有空格；函数调用中的关键字实参，也应如此。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 形参指定默认值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_name</span><span class="params">(parameter_0, parameter_1=<span class="string">'default value'</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 函数调用的关键字实参</span></span><br><span class="line"><span class="function"><span class="title">function_name</span><span class="params">(value_0, parameter_1=<span class="string">'value'</span>)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>PEP 8建议代码长度不要超过79字符，这样只要编辑器窗口适中，就能看到整行代码。如果形参很多，导致函数定义的长度超过79字符，可在函数定义中输入括号后按回车键，并在下一行按两次Tab键，从而将形参列表和只缩进一层的函数体区分开来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_name</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        parameter_0, parameter_1, </span></span></span><br><span class="line"><span class="function"><span class="params">        parameter_2, parameter_3, </span></span></span><br><span class="line"><span class="function"><span class="params">        parameter_4, parameter_5)</span>:</span></span><br><span class="line">    function body...</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果程序或模块包含多个函数，可使用两个空行将相邻的函数分开，这样更容易知道前一个函数的结束位置和下一个函数的开始位置。</p>
</li>
<li><p>所有的<code>import</code>语句都应该放在文件开头，唯一例外的情景是，在文件开头使用了注释来描述整个程序。</p>
</li>
</ul>
</li>
</ol>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><ol>
<li><p>创建一个<code>Dog</code>类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""一个简单的小狗类测试"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        <span class="string">"""初始化属性name和age"""</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sit</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""小狗蹲下"""</span></span><br><span class="line">        print(self.name.title() + <span class="string">' is now sitting.'</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">roll_over</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""小狗打滚"""</span></span><br><span class="line">        print(self.name.title() + <span class="string">' rolled over!'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>类中的函称为方法，函数的一切都适用方法，唯一重要的差别是调用方法的方式。方法<code>__init__()</code>是一个特殊的方法（构造函数），开头和结尾各有两个下划线，这是一种约定，旨在避免Python默认方法与普通方法发生名称冲突。</p>
</li>
<li><p>在<strong>第1</strong>中，方法<code>__init__()</code>定义了包含三个形参：<code>self</code>、<code>name</code>和<code>age</code>。在此方法中，<code>self</code>是必须的，且必须位于其他形参前面，因为Python调用<code>__init__()</code>方法来创建实例时，将自动传入实参<code>self</code>。每个与类相关联的方法调用都自动传递实参<code>self</code>，它是一个指向实例本身的引用，让实例能够访问类中的属性和方法。</p>
<p>我们将通过实参向<code>Dog()</code>传递名字和年龄；<code>self</code>会自动传递，因此我们不需要传递它。每当我们根据<code>Dog</code>类创建实例时，都只需 最后两个形参(<code>name</code>和<code>age</code>)提供值。</p>
</li>
<li><p>以<code>self</code>为前缀的变量可供类中的所有方法使用，像这样可以通过实例访问的变量称为属性。</p>
</li>
<li><p>创建实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my_dog = Dog(<span class="string">'peter'</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'dog`s name is '</span> + my_dog.name.title() + <span class="string">'.'</span>)</span><br><span class="line">print(<span class="string">'dog is '</span> + str(my_dog.age) + <span class="string">' yeats old.'</span>)</span><br><span class="line"></span><br><span class="line">my_dog.sit()</span><br><span class="line">my_dog.roll_over()</span><br></pre></td></tr></table></figure>
</li>
<li><p>继承：一个类继承另一个类时，它将自动获得另一个类的所有属性和方法，这个类还可以定义自己的属性和方法。原有的类称为父类，而新类称为子类。</p>
</li>
<li><p>子类的方法<code>__init__()</code>，创建子类的实例时，Python首先是给父类的所有属性赋值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继承第1中的Dog</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Corgi</span><span class="params">(Dog)</span>:</span></span><br><span class="line">    <span class="string">"""柯基"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        <span class="string">"""初始化父类属性"""</span></span><br><span class="line">        super().__init__(name, age)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">barking</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""子类方法 狗叫"""</span></span><br><span class="line">        print(<span class="string">'WuWang!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">corgi = Corgi(<span class="string">'tom'</span>, <span class="number">3</span>)</span><br><span class="line">corgi.roll_over() <span class="comment"># Tom rolled over!</span></span><br><span class="line">corgi.barking() <span class="comment"># WuWang！</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重写父类方法：在子类中定义与父类方法同名方法。这样，Python将不会考虑这个父类方法，而只关注在子类中定义的相应方法。</p>
</li>
<li><p>将实例用作属性：可能需要将类的一部分作为一个独立的类提取出来，将大型的类拆分成多个协同工作的小类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></span><br><span class="line"><span class="class">    """汽车"""</span></span><br><span class="line"><span class="class">  </span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Battery</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""一次模拟电动汽车电瓶的简单尝试"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, battery_size=<span class="number">70</span>)</span>:</span></span><br><span class="line">        <span class="string">"""初始化电瓶属性"""</span> </span><br><span class="line">        self.battery_size = battery_size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describe_battery</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""打印一条 述  容量的消息"""</span></span><br><span class="line">        print(<span class="string">"This car has a "</span> + str(self.battery_size) + <span class="string">"-kWh battery."</span>)</span><br><span class="line">   </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElectricCar</span><span class="params">(Car)</span>:</span></span><br><span class="line">    <span class="string">"""电瓶车的独特之处"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, make, model, year)</span>:</span></span><br><span class="line">        <span class="string">"""初始化父类属性"""</span></span><br><span class="line">        super().__init__(make, model, year)</span><br><span class="line">        self.battery = Battery()</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入类：</p>
<p>创建文件<code>car.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""一次模拟汽车的简单尝试"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, make, model, year)</span>:</span> </span><br><span class="line">        <span class="string">"""初始化描述汽车属性"""</span> </span><br><span class="line">        self.make = make</span><br><span class="line">        self.model = model</span><br><span class="line">        self.year = year </span><br><span class="line">        self.odometer_reading = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_descriptive_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""返回整洁的描述性名称"""</span></span><br><span class="line">        long_name = str(self.year) + <span class="string">' '</span> + self.make + <span class="string">' '</span> + self.model </span><br><span class="line">        <span class="keyword">return</span> long_name.title()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_odometer</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""打印一条消息，指出汽车的里程数"""</span></span><br><span class="line">        print(<span class="string">"This car has "</span> + str(self.odometer_reading) + <span class="string">" miles on it."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_odometer</span><span class="params">(self, mileage)</span>:</span> </span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">            将里程表读数设置为指定的值   </span></span><br><span class="line"><span class="string">            拒绝将里程表往回拨 </span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> mileage &gt;= self.odometer_reading:</span><br><span class="line">                self.odometer_reading = mileage </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"You can't roll back an odometer!"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">increment_odometer</span><span class="params">(self, miles)</span>:</span> </span><br><span class="line">        <span class="string">"""将里程表读数增加指定的量"""</span> </span><br><span class="line">        self.odometer_reading += miles</span><br></pre></td></tr></table></figure>

<p>创建另一个文件<code>my_car.py</code>，在其中导入<code>Car</code>类并创建其实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> car <span class="keyword">import</span> Car</span><br><span class="line"></span><br><span class="line">my_new_car = Car(<span class="string">'audi'</span>, <span class="string">'a4'</span>, <span class="number">2016</span>)</span><br><span class="line">print(my_new_car.get_descriptive_name()) <span class="comment"># 2016 Audi A4</span></span><br><span class="line"></span><br><span class="line">my_new_car.odometer_reading = <span class="number">23</span></span><br><span class="line">my_new_car.read_odometer() <span class="comment"># This car has 23 miles on it.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在一个模块中存储多个类，导入时多个类用逗号隔开。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module_name <span class="keyword">import</span> class_name01, class_name02</span><br></pre></td></tr></table></figure>

<p>也可以导入整个模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> car</span><br><span class="line"></span><br><span class="line">my_beetle = car.Car(<span class="string">'volkswagen'</span>, <span class="string">'beetle'</span>, <span class="number">2016</span>)</span><br><span class="line">print(my_beetle.get_descriptive_name())</span><br><span class="line"></span><br><span class="line">my_tesla = car.ElectricCar(<span class="string">'tesla'</span>, <span class="string">'roadster'</span>, <span class="number">2016</span>)</span><br><span class="line">print(my_tesla.get_descriptive_name())</span><br></pre></td></tr></table></figure>

<p>导入模块中的所有类，不推荐这样使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module_name <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
</li>
<li><p>Python标准库是一组模块，安装的Python都包含它。下面看下<code>collections</code>中的一个类<code>orderedDict</code>，这个类的实例的行为几乎与字典相同，区别只在于记录了键值对的添加顺序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">favorite_languages = OrderedDict()</span><br><span class="line"></span><br><span class="line">favorite_languages[<span class="string">'jen'</span>] = <span class="string">'python'</span> </span><br><span class="line">favorite_languages[<span class="string">'sarah'</span>] = <span class="string">'c'</span> </span><br><span class="line">favorite_languages[<span class="string">'edward'</span>] = <span class="string">'ruby'</span> </span><br><span class="line">favorite_languages[<span class="string">'phil'</span>] = <span class="string">'python'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, language <span class="keyword">in</span> favorite_languages.items(): </span><br><span class="line">    print(name.title() + <span class="string">"'s favorite language is "</span> + language.title() + <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Jen's favorite language is Python. </span></span><br><span class="line"><span class="comment"># Sarah's favorite language is C. </span></span><br><span class="line"><span class="comment"># Edward's favorite language is Ruby. </span></span><br><span class="line"><span class="comment"># Phil's favorite language is Python.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>类编码风格：</p>
<ul>
<li>类名应采用<strong>驼峰命名法</strong>，即将类名中的每个单词的首字母都大写，而不使用下划线。</li>
<li>实例名和模块名都采用小写格式，并在单词之间加上下划线。</li>
<li>对于每个类，都应紧跟在类定义后面包含一个文档字符串。</li>
<li>可使用空行来组织代码，但不要滥用。在类中，可使用一个空行来分隔方法；而在模块中，可使用两个空行来分隔类。</li>
<li>需要同时导入标准库中的模块和自己编写的模块时，先编写导入标准库模块的<code>import</code>语句，再添加一个空行，然后编写导入自己编写的模块的<code>import</code>语句。</li>
</ul>
</li>
</ol>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><ol>
<li><p>读取整个文件：</p>
<p>创建一个文件<code>pi_digits.txt</code>，包含小数点后30位的圆周率值，且在小数点后每10位处都换行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.1415926535</span> </span><br><span class="line">	<span class="number">8979323846</span> </span><br><span class="line">  <span class="number">2643383279</span></span><br></pre></td></tr></table></figure>

<p>读取文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'pi_digits.txt'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    contents = file_object.read()</span><br><span class="line">    print(contents.rstrip())</span><br></pre></td></tr></table></figure>

<p>关键字<code>with</code>在不需要访问文件后将其关闭</p>
<p>函数<code>open()</code>接受一个参数：要打开的文件的名称；返回一个表示文件的对象。上面的代码中只是打开文件，并没有关闭，可手动进行关闭，但是未妥善的关闭文件可能会导致数据丢失或受损。其实我们只管打开文件，并在需要的时候使用它，Python自会在合适的时候自动将其关闭。</p>
<p><code>rstrip()</code>删除末尾的空白。</p>
</li>
<li><p>文件路径：要让Python打开不与程序文件位于同一个目录中的文件，需要提供文件路径，它让Python到系统的特定位置去查找。可以使用绝对路径，也可使用相对路径。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'text_files/filename.txt'</span>) <span class="keyword">as</span> file_object:</span><br></pre></td></tr></table></figure>
</li>
<li><p>逐行读取：要以每次一行的方式检查文件，可对文件对象使用<code>for</code>循环：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'pi_digits.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(filename) <span class="keyword">as</span> file_object:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file_object:</span><br><span class="line">        print(line.rstrip())</span><br></pre></td></tr></table></figure>

<p>输出与之前的方式完全相同。</p>
</li>
<li><p>创建一个包含文件各行内容的列表：使用关键字<code>with</code>时，<code>open()</code>返回的文件对象只在<code>with</code>代码块内可用。如果要在其代码块外访问文件的内容，可在<code>with</code>代码块内将文件的各行存储在一个列表中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'pi_digits.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(filename) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    print(line.rstrip())</span><br></pre></td></tr></table></figure>

<p>函数<code>readlines()</code>从文件中读取每一行，并将其存储在列表中。</p>
</li>
<li><p>读取文本文件时，Python将其中所有文本都为字符串。如果你读取的是数字，并要将其作为数值使用，就必须使用函数<code>int()</code>将其转换为整数，或使用函数<code>float()</code>将其转换为浮点数。</p>
</li>
<li><p>写入空文件：调用<code>open()</code>时需要提供另一个实参，告诉Python你要写入打开的文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'test.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">"人生苦短，快学Python"</span>)</span><br></pre></td></tr></table></figure>

<p><code>open()</code>接收的第二个参数是要告诉Python打开文件的模式：读取模式<code>r</code>、写入模式<code>w</code>、附加模式<code>a</code>、读取和写入文件模式<code>r+</code>。省略模式参数，默认以只读模式打开文件。</p>
<p>如果要写入的文件不存在，函数<code>open()</code>将自动创建它。然而，以写入<code>w</code>模式打开文件，如果文件已经存在，Python将在返回文件对象前清空该文件。</p>
<p>如果要写入多行，需要换行符<code>\n</code>。</p>
</li>
<li><p>附加到文件：如果要给文件添加内容，而不是覆盖，可以使用附加模式<code>a</code>打开文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'test.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">"Python大法好"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Python使用被称为异常的特殊对象来管理程序执行期间发生的错误。如果编写了处理异常的代码，程序将继续运行；如果未对异常进行处理，程序将停止，并显示一个<code>traceback</code>，其中包含有关异常的报告。</p>
</li>
<li><p>异常是使用<code>try-except</code>代码块处理的。使用此处理，即便出现异常，程序也会继续运行。</p>
</li>
<li><p>使用<code>try-except</code>代码块，处理<code>ZeroDivisionError</code>异常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="number">5</span>/<span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    print(<span class="string">'You can`t divide by zero!'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Hi'</span>) <span class="comment"># 正常运行</span></span><br></pre></td></tr></table></figure>

<p><code>try-except</code>代码后面的代码会正常运行，因为已经告诉了Python如何处理这种错误。</p>
</li>
<li><p>使用<code>try-except-else</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Give me two numbers, and I'll divide them."</span>) </span><br><span class="line">print(<span class="string">"Enter 'q' to quit."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    first_number = input(<span class="string">"\nFirst number: "</span>) </span><br><span class="line">    <span class="keyword">if</span> first_number == <span class="string">'q'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    second_number = input(<span class="string">"Second number: "</span>) </span><br><span class="line">    <span class="keyword">if</span> second_number == <span class="string">'q'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        answer = int(first_number) / int(second_number)</span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">        print(<span class="string">"You can't divide by 0!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(answer)</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="12">
<li><p>pass语句：失败时一声不吭。Python中有一个<code>pass</code>语句，可在代码块中使用它来让Python什么都不要做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_words</span><span class="params">(filename)</span>:</span> </span><br><span class="line">    <span class="string">"""计算一个文件大致包含多少个单词"""</span> </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        --snip--</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="keyword">pass</span> </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        --snip--</span><br><span class="line"></span><br><span class="line">filenames = [<span class="string">'alice.txt'</span>, <span class="string">'siddhartha.txt'</span>, <span class="string">'moby_dick.txt'</span>, <span class="string">'little_women.txt'</span>] </span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">    count_words(filename)</span><br></pre></td></tr></table></figure>
</li>
<li><p>模块<code>json</code>能够将简单的Python数据结构转储到文件中，并在程序再次运行时加载该文件中的数据：</p>
<ul>
<li><code>json.dump()</code>：存储数据。接受两个实参，分别是要存储的数据和可用于存储数据的文件对象。</li>
<li><code>json.load()</code>：加载数据。接收一个参数，存储数据的文件对象。</li>
</ul>
</li>
</ol>
<h2 id="测试代码-第11章"><a href="#测试代码-第11章" class="headerlink" title="测试代码(第11章)"></a>测试代码(第11章)</h2><ol>
<li><p>Python的标准库中的模块<code>unittest</code>提供了代码测试工具。<strong>单元测试</strong>用于核实函数的某个方面没有问题；<strong>测试用例</strong>是一组单元测试，这些单元测试一起核实函数在各种情形下的行为都符合要求。<strong>全覆盖式测试</strong>用例包含一整套单元测试，涵盖了各种可能的函数使用方式。</p>
</li>
<li><p>对于大型项目，要实现全覆盖测试可能很难。通常，最初只要针对代码的重要行为编写测试即可，等项目被广泛使用时再考虑全覆盖。</p>
</li>
<li><p>可通过的测试：</p>
<p>创建一个文件<code>name_function.py</code>，写如下代码，它接收名和姓并返回整洁的姓名：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_fromatted_name</span><span class="params">(first, last)</span>:</span></span><br><span class="line">    full_name = first + <span class="string">' '</span> + last</span><br><span class="line">    <span class="keyword">return</span> full_name.title()</span><br></pre></td></tr></table></figure>

<p>创建<code>test_name_function.py</code>，可通过的测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> name_function <span class="keyword">import</span> get_fromatted_name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="string">"""测试name_function.py"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_first_last_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""能够正确地处理像Andy Liu这样的样的姓名吗 """</span></span><br><span class="line">        format_name = get_fromatted_name(<span class="string">'andy'</span>, <span class="string">'liu'</span>)</span><br><span class="line">        self.assertEqual(format_name, <span class="string">'Andy Liu'</span>)</span><br><span class="line"></span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>

<p>首先，我们导入了模块<code>unittest</code>和要测试的函数<code>get_formatted_name()</code>。然后创建了一个名为<code>NameTestCase</code>的类，用于包含一系列针对<code>get_formatted_name()</code>的单元测试。你可随便给这个类命名,但最好让它看起来与要测试的函数相关，并包含字样<code>Test</code>，这个类必须继承<code>unittest.TestCase</code>类，这样 Python才知道如何运行你编写的测试。</p>
<p><code>NamesTestCase</code>只包含一个方法,用于测试<code>get_formatted_name()</code>的一个方面。我们将这个方法命名为<code>test_first_last_name()</code>，因为我们要核实的是只有名和姓的姓名能否被正确地格式化。我们运行 <code>test_name_function.py</code>时，所有以<code>test</code>打头的方法都将自动运行。在这个方法中，我们调用了要测试的函数，并存储了要测试的返回值在这个示例中,我们使用实参<code>Andy</code>和<code>Liu</code>调用<code>get_formatted_name()</code>，并将结果存储到变量<code>formatted_name</code>中。</p>
<p>我们使用了<code>unittest</code>类中的一个<strong>断言方法</strong>—用来核实得到的结果是否与期望的结果一致。并向它传递<code>formatted_name</code>和<code>Andy Liu</code>。将两者进行比较，如果结果相等，就万事大吉，如果不相等，通知一声。</p>
<p>代码<code>unittest.main()</code>让Python运行这个文件中的测试，运行<code>test_name_function.py</code>时，结果输出如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">1</span> test <span class="keyword">in</span> <span class="number">0.005</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>第一行的句点<code>.</code>表示测试通过了。接下来的一行指出Python运行了一个测试，运行的时间不到0.005秒。最后的OK表示该测试用例中的所有单元测试都通过了。</p>
</li>
<li><p>不能通过的测试：</p>
<p>修改文件<code>name_function.py</code>中的<code>get_formatted_name()</code>，使其能够处理中间名，但这样做时，故意让这个函数无法正确处理想<code>Janis Joplin</code>这样只有名和姓的姓名。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_fromatted_name</span><span class="params">(first, middle, last)</span>:</span></span><br><span class="line">    full_name = first + <span class="string">' '</span> + middle + <span class="string">' '</span> + last</span><br><span class="line">    <span class="keyword">return</span> full_name.title()</span><br></pre></td></tr></table></figure>

<p>运行测试文件<code>test_name_function.py</code>，输出如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">E</span><br><span class="line">======================================================================</span><br><span class="line">ERROR: test_first_last_name (__main__.NameTestCase)</span><br><span class="line">能够正确地处理像Andy Liu这样的样的姓名吗</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/andy/Work/python/hello/my_car.py"</span>, line <span class="number">10</span>, <span class="keyword">in</span> test_first_last_name</span><br><span class="line">    format_name = get_fromatted_name(<span class="string">'andy'</span>, <span class="string">'liu'</span>)</span><br><span class="line">TypeError: get_fromatted_name() missing <span class="number">1</span> required positional argument: <span class="string">'last'</span></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">1</span> test <span class="keyword">in</span> <span class="number">0.004</span>s</span><br><span class="line"></span><br><span class="line">FAILED (errors=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>第一行一个字母<code>E</code>，指出测试用例中有一个单元测试导致了错误。接下来谁导致的错误和标准的<code>traceBack</code>。最后一条信息，它指出整个测试用例都未通过，因为运行该测试用例时发生了一个错误。</p>
</li>
<li><p>测试未通过时，不要修改测试，而应修复导致测试不能通过的代码：检查刚对函数所做的修改，找出导致函数行为不符合预期的修改。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_fromatted_name</span><span class="params">(first, last, middle = <span class="string">''</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> middle:</span><br><span class="line">        full_name = first + <span class="string">' '</span> + middle + <span class="string">' '</span> + last</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        full_name = first + <span class="string">' '</span> + last</span><br><span class="line">    <span class="keyword">return</span> full_name.title()</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加新测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> name_function <span class="keyword">import</span> get_fromatted_name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="string">"""测试name_function.py"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_first_last_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""能够正确地处理像Andy Liu这样的样的姓名吗 """</span></span><br><span class="line">        format_name = get_fromatted_name(<span class="string">'andy'</span>, <span class="string">'liu'</span>)</span><br><span class="line">        self.assertEqual(format_name, <span class="string">'Andy Liu'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_first_middle_last_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""能够处理像Wolfgang Amadeus Mozart这样的姓名吗"""</span></span><br><span class="line">        formatted_name = get_fromatted_name(<span class="string">'wolfgang'</span>, <span class="string">'mozart'</span>, <span class="string">'amadeus'</span>)</span><br><span class="line">        self.assertEqual(formatted_name, <span class="string">'Wolfgang Amadeus Mozart'</span>)</span><br><span class="line"></span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>

<p>运行测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">..</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">2</span> tests <span class="keyword">in</span> <span class="number">0.003</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
</li>
<li><p>断言方法：检查你认为应该满足的条件是否确实满足。如果该条件确实满足，你对程序行为的假设就得到了确认，你就可以确信其中没有错误。如果你认为应该满足的条件实际上并不满足，Python将引发异常。</p>
<p><code>unittest Module</code>中的断言方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>assertEqual(a, b)</td>
<td>核实<code>a == b</code></td>
</tr>
<tr>
<td>assertNotEqual(a, b)</td>
<td>核实<code>a != b</code></td>
</tr>
<tr>
<td>assertTrue(x)</td>
<td>核实x为True</td>
</tr>
<tr>
<td>assertFalse(x)</td>
<td>核实x为False</td>
</tr>
<tr>
<td>assertIn(item, list)</td>
<td>核实item在list中</td>
</tr>
<tr>
<td>assertNotIn(item, list)</td>
<td>核实item不在list中</td>
</tr>
</tbody></table>
<p>注：只能在继承<code>unittest.TestCase</code>的类中使用这些方法。</p>
</li>
<li><p>一个要测试的类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnonymousSurvey</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""收集匿名调查问卷的答案"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, question)</span>:</span></span><br><span class="line">        <span class="string">"""存储一个问题，并为存储答案做准备"""</span></span><br><span class="line">        self.question = question</span><br><span class="line">        self.responses = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_question</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""显示调查问卷"""</span></span><br><span class="line">        print(self.question)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">store_response</span><span class="params">(self, new_response)</span>:</span></span><br><span class="line">        <span class="string">"""存储单份调查答案"""</span></span><br><span class="line">        self.responses.append(new_response)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_results</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""显示收集到的所有答案"""</span></span><br><span class="line">        print(<span class="string">"Survey results:"</span>)</span><br><span class="line">        <span class="keyword">for</span> response <span class="keyword">in</span> self.responses:</span><br><span class="line">            print(<span class="string">'- '</span> + response)</span><br></pre></td></tr></table></figure>

<p>编写使用程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># language_survey.py</span></span><br><span class="line"><span class="keyword">from</span> survey <span class="keyword">import</span> AnonymousSurvey</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个问题，并创建一个表示调查的AnonymousSurvey对象</span></span><br><span class="line">question = <span class="string">"What language did you first learn to speak?"</span></span><br><span class="line">my_survey = AnonymousSurvey(question)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示问题并存储答案</span></span><br><span class="line">my_survey.show_question()</span><br><span class="line">print(<span class="string">"Enter 'q' at any time to quit.\n"</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    response = input(<span class="string">"Language: "</span>)</span><br><span class="line">    <span class="keyword">if</span> response == <span class="string">'q'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    my_survey.store_response(response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示调查结果</span></span><br><span class="line">print(<span class="string">"\nThank you to everyone who participated in the survey!"</span>)</span><br><span class="line">my_survey.show_results()</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试AnonymousSurvey类：</p>
<p>方法<code>setUp()</code>：<code>unittest.TestCase</code>类包含此方法，让我们只需要创建对象一次，并在每个测试方法中使用它们。如果在<code>TestCase</code>类中包含了方法<code>setUp()</code>，Python将先运行它，再运行各个以<code>test_</code>打头的方法。这样，在编写的每个测试方法中就都可以使用在<code>setUp()</code>中创建的对象了。</p>
<p>写测试代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> survey <span class="keyword">import</span> AnonymousSurvey</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAnonymousSurvey</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="string">""" 针对Anonymous类测试 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" </span></span><br><span class="line"><span class="string">        创建一个调查对象和一组答案，供使用的测试方法使用</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        question = <span class="string">"What language did you first learn to speak?"</span></span><br><span class="line">        self.my_survey = AnonymousSurvey(question)</span><br><span class="line">        self.responses = [<span class="string">'English'</span>, <span class="string">'Spanish'</span>, <span class="string">'Mandarin'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_store_signle_response</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" 测试单个答案会被妥善地存储 """</span></span><br><span class="line">        self.my_survey.store_response(self.responses[<span class="number">0</span>]) </span><br><span class="line">        self.assertIn(self.responses[<span class="number">0</span>], self.my_survey.responses)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_store_three_responses</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" 测试三个答案是否会被妥善地存储 """</span></span><br><span class="line">        <span class="keyword">for</span> response <span class="keyword">in</span> self.responses:</span><br><span class="line">            self.my_survey.store_response(response) </span><br><span class="line">        <span class="keyword">for</span> response <span class="keyword">in</span> self.responses:</span><br><span class="line">            self.assertIn(response, self.my_survey.responses)</span><br><span class="line"></span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">..</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">2</span> tests <span class="keyword">in</span> <span class="number">0.003</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行测试用例时，每当完成一个测试，Python都打印一个字符：测试通过时打印一个句点<code>.</code>；测试引发错误时打印一个<code>E</code>；测试导致断言失败时打印一个<code>F</code>。</p>
</li>
<li><p>对于自己编写的函数和类，请编写针对其重要行为的测试，但在项目早期，不要试图去编写全覆盖的测试用途，除非有充分的理由这样做。</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/Essay/%E8%A5%BF%E6%B8%B8%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/Essay/%E8%A5%BF%E6%B8%B8%E8%AE%B0/" class="post-title-link" itemprop="url">西游记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-09 22:41:42" itemprop="dateCreated datePublished" datetime="2019-06-09T22:41:42+08:00">2019-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:25:50" itemprop="dateModified" datetime="2020-05-16T10:25:50+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Essay/" itemprop="url" rel="index"><span itemprop="name">Essay</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="西游记"><a href="#西游记" class="headerlink" title="西游记"></a>西游记</h1><blockquote>
<p>记2019.06.01——2019.6.8那段难忘的时光</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>事情还是要从三月底铎哥提起的带我出去浪，毫无疑问，我肯定更要去呀，我铎哥对我真好~</p>
<p>五月初定下到西宁的机票，开始了西北之行的快乐等待。转眼到了05月30号，下班之后奔回小窝，整装待发。飞机是明天早上六点半的，我们两个憨皮晚上就打车到了机场，一块找了条长椅窝了一晚上。</p>
<h2 id="Day-01-西宁，你好"><a href="#Day-01-西宁，你好" class="headerlink" title="Day 01  西宁，你好"></a>Day 01  西宁，你好</h2><blockquote>
<p>桃李春风一杯酒，江湖夜雨十年灯</p>
</blockquote>
<p>还是原来的你们，很快我们就又要见面了。。。</p>
<p>第一天杭州到西宁，下飞机时间是九点二十，师傅直接给接机到酒店。西宁的天气不错，很是凉爽！</p>
<p>其他小伙伴也陆陆续续到达，敏姐、多多、迪哥、铎哥、我，全员报道。嘿，见到你们真好！</p>
<p>大家收拾好东西，稍作休息晚上在西宁转了转，走在北关街、索麻巷，虽是晚上八点左右，但是天还是很亮。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0601-01.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0601-02.jpg" alt=""></p>
<p>找了家小饭馆（有尔烤肉面片）坐了下来，吃了羊肉串、烤羊肚、炕锅羊肉、面片、喝的茶味道怪怪的，我觉得有股汽油味，问了服务员，小哥腼腆一笑，不知道普通话这个的名字怎么讲。。。不过越喝越上瘾，哈哈。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0601-03.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0601-04.jpg" alt=""></p>
<p>差不多九点天热才慢慢暗下来，出门之后一起又兜兜转转想找酸奶，但未能如愿，倒是看到了两个很大的清真寺，作罢返程，感受了一股来自西宁的妖风问候，哈哈，有趣的夜晚，遇见了澳门电话是否能接的东北口音的西北大叔，自来熟的和我们聊了几句，有趣的夜晚。</p>
<p>今天祝你生日快乐。</p>
<p>回到住处，敷了张面膜，还是第一次这么精致，晚安。旅途开启~</p>
<h2 id="Day-02-塔尔寺-–-垃圾山-–-青海湖"><a href="#Day-02-塔尔寺-–-垃圾山-–-青海湖" class="headerlink" title="Day 02 塔尔寺 – 垃圾山 – 青海湖"></a>Day 02 塔尔寺 – 垃圾山 – 青海湖</h2><p>第二天八点半多出发，电梯抢了我的酸奶！很好，我们迟到了，吃了师傅贴心的抱怨，上车直奔塔尔寺，也就几十分钟的车程，到达了目的地。</p>
<h3 id="净上津梁浮壁画，法幢梵教有酥花"><a href="#净上津梁浮壁画，法幢梵教有酥花" class="headerlink" title="净上津梁浮壁画，法幢梵教有酥花"></a>净上津梁浮壁画，法幢梵教有酥花</h3><p>找了位大哥先来了张游客照。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-01.jpeg" alt=""></p>
<p>接着走进寺内，跟着大部队，稍稍蹭一蹭别人家的导游，拍拍照照。一路走来，大大小小二十个左右的寺殿，各有特色，还有几个记得名字：小金瓦殿——祈寿殿——释迦佛殿——弥勒佛殿——酥油花陈列馆——度母殿，一路走走停停，怀着好奇与敬畏之心，谨遵注意事项，仰望着辉煌的殿宇，看着虔诚的信徒，心生震撼，咔嚓咔嚓，咔咔嚓嚓，记录了许许多多美好的景色。同行的皮皮怪也一个个蹦蹦哒哒地跳进了我的相框，按下快门，一一捕捉。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-04.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-03.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-04.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-05.jpeg" alt=""></p>
<h3 id="青海长云暗雪山，孤城遥望玉门关"><a href="#青海长云暗雪山，孤城遥望玉门关" class="headerlink" title="青海长云暗雪山，孤城遥望玉门关"></a>青海长云暗雪山，孤城遥望玉门关</h3><p>走出塔尔寺，师傅很关心地夸了我们，说我们迟到了。松离合给油，师傅载着我们，一路向西，蜿蜿蜒蜒的山路，路旁时见蒙古包，还有那肆意舞动地多彩经幡，宛若黑石头一动不动大快朵颐的牦牛，犹如汉白玉的羊群点缀着山边稍有绿意涌来的山野，棉花糖做的云朵，乘着青海独特的风，飘飘荡荡，气定神闲的哞哞哞，甜美的咩咩咩，是不是也飘进了我的耳朵呢？风景真的好美，什么时候剪个视频看看呢~</p>
<p>很快，海拔4188米的垃圾山走到了我们的面前，风有些大，祭出羽绒服，三步并两步地飞到了观景台，天空中时有的小雪飘落，寒风呜呜呜地叫着，兴奋地拍打着我的脸颊，运动裤好像被谁给我扒了。放眼望去，远处的山着着深色的军装尽显威严，白皙的脸庞，天山相隔，虽未到边塞，但王昌龄那”青海长云暗雪山”的境意已有一二。大呼过瘾，手中的相机有些按耐不住，想将这山中的美景一网打尽。</p>
<p>垃圾山上挂着各种颜色的彩带，在软软的白云上，蔚蓝的舞台中，载歌载舞！</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-06.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-07.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-08.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-09.jpeg" alt=""></p>
<h3 id="青海无波春雁下，草生碛里见牛羊"><a href="#青海无波春雁下，草生碛里见牛羊" class="headerlink" title="青海无波春雁下，草生碛里见牛羊"></a>青海无波春雁下，草生碛里见牛羊</h3><p>几十分钟后，驱车赶往下一个经典——青海湖！到达此地，已是下午四点，对于青海来说，正是下午，适逢其会。</p>
<blockquote>
<p>青海湖的蓝，蓝得纯净，蓝的深湛，也蓝得温柔恬雅。那蓝锦缎似的湖面上，起伏着一层微微的涟漪，像是淌未凝固的玻璃浆液，又像是白色种的小姑娘那水灵灵、蓝晶晶的眸子。</p>
<p>​                                                    —《青海湖，梦幻般的湖》</p>
</blockquote>
<p>还记得这篇小学课文，这如梦般的景色，心驰神往，青海湖，她，美的到底是什么模样？</p>
<p>踏入景区大门，我们一行人悠悠地踱到湖边，看到此时此刻的她，惘然若失，这不是我脑补的青海湖，太阳躲起来不想与她相见，我能看到她的眼眸中满满的惆怅，整个人灰暗暗的。以至于拍个照，需要人给我打光。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-10.jpeg" alt=""></p>
<p>不过，在她在见到太阳后立马大变样，她，真的好美。美的让我无法形容，如此湛蓝的她美得人沉醉。在蒙语里，它被叫作“库库诺尔”，在藏语里，它被叫作“错温布”，都是“青颜色的大海”之意。在海拔3196米上的她，湖水中含氧量较低，浮游生物稀少，含盐量在百分之零点六左右，透明度达到八九米以上，因而，湖水就显得更晶莹明澈。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-11.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-12.jpeg" alt=""></p>
<p>由于我要成为海贼王的梦想宣言太过大声，惹得旁边同是游玩的小姐姐偷偷地瞥我偷笑。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-13.jpeg" alt=""></p>
<p>湖边很多海鸥（是海鸥吗？），买了些小饼干，一起喂了喂它们。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-14.jpeg" alt=""></p>
<p>在这美丽的湖边，我是那位最靓的仔。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-15.jpeg" alt=""></p>
<p>她的好心情是那一阵，随后她便又黯淡了下来，但是她已给我们显示了足够的美，我已心满意足。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-16.jpeg" alt=""></p>
<p>出来景区，和迪哥一起赛跑，我赢啦，但是我的脑袋更疼了，高原反应好像更严重了，煤气中毒的感觉。</p>
<p>太阳快要落山，师傅驱车，我们听着歌，看着日落，赶往大柴旦，晚上要在那住宿。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0602-17.jpeg" alt=""></p>
<h2 id="Day-03-茶卡盐湖-—-可鲁克湖-—-翡翠湖"><a href="#Day-03-茶卡盐湖-—-可鲁克湖-—-翡翠湖" class="headerlink" title="Day 03 茶卡盐湖 — 可鲁克湖 — 翡翠湖"></a>Day 03 茶卡盐湖 — 可鲁克湖 — 翡翠湖</h2><p>四点半头痛把我叫醒，你可真黏人，可恶啊，高原反应！自后听着轻音一直清醒地养神到近七点，很棒。</p>
<p>早上的我们，又被师傅夸了，师傅有点无奈，怼了我们两句就快马加鞭地启程，开始了新一天的行程。</p>
<h3 id="日照银波动诗砚，盐涛滚滚物华殊"><a href="#日照银波动诗砚，盐涛滚滚物华殊" class="headerlink" title="日照银波动诗砚，盐涛滚滚物华殊"></a>日照银波动诗砚，盐涛滚滚物华殊</h3><p>第一站是茶卡盐湖，坐上开往盐湖深处的1993小火车，伴随着动感的动次打次，不出一会的功夫，来到了下车点。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-01.jpeg" alt=""></p>
<p>有想着租鞋套的我们看着那条小蜈蚣，并没有为他再添腿，走向旁边的盐湖，浸润在湖底的盐粒如珍珠般铺满整个茶卡湖，天空中没有太多的白云，天气虽不是太好，但淡蓝的天空配着远处有些缥缈的连绵雪峰山川，颇有味道。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-02.jpeg" alt=""></p>
<p>站在铁轨道旁，美丽湖畔边的那个女孩，她身上似从旭日上采下的红一直延伸到脚踝，搭配着一双小巧白鞋，裙摆随着她轻快地跃动流转着，戴着一顶米白色又或是卡其色的可爱草帽，帽子盛满了撒下的阳光，她秀发微卷，过肩大半，翻起朵朵黑色的浪花，再配上一副猫猫框边的墨镜，衬得她白皙的皮肤更加夺目，犹如红纱舞动，在这天空之境，温婉如水的她如入画中。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-03.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-04.jpeg" alt=""></p>
<p>从景区深处，沿着进来时小火车来的方向向出口走，大概四公里的路程，和朋友走走停停，遇见值得记录的美景，相互拍照留念，最喜欢那张我爱茶卡，没错，我要成为海贼王，哈哈。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-05.jpeg" alt=""></p>
<p>聊天，漫步茶卡，拍天空之境石碑旅游照纪念，返程。</p>
<p>我们这次还是迟到了一会呢~</p>
<h3 id="烟波浩森，水天一色"><a href="#烟波浩森，水天一色" class="headerlink" title="烟波浩森，水天一色"></a>烟波浩森，水天一色</h3><p>可鲁克湖，师傅给我们打了预防针，一个小院子般的景区，二十多分钟浏览完毕，风不是很大，印象比较深刻的就是有人在钓鱼。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-06.jpeg" alt=""></p>
<p>还有多多奔跑的枸杞照</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-13.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-14.jpeg" alt=""></p>
<p>然后，我们拍完纪念照就溜了。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-07.jpeg" alt=""></p>
<p>走出克鲁克湖景区的大门，下一站是翡翠湖。</p>
<h3 id="谁家妆镜落凡间，照得峨嵋尽笑颜"><a href="#谁家妆镜落凡间，照得峨嵋尽笑颜" class="headerlink" title="谁家妆镜落凡间，照得峨嵋尽笑颜"></a>谁家妆镜落凡间，照得峨嵋尽笑颜</h3><p>五点钟到达湖边，跳下车来，游戏开始。青海的天，小孩子的脸，闹腾腾，灰蒙蒙的天空，风力十足。</p>
<p>之前有看到网上对于翡翠湖的评价：纯粹！但今天翡翠湖的天并没有给我们呈现她那纯粹的蓝，但，水是纯粹的碧，湖堤是纯粹的白。</p>
<p>饱和的湖水析出的盐分并不均匀，如妆镜前的少女，刚学化妆，学着茶卡姐姐拿着粉扑在脸上拍，不够娴熟，但又不失她自己独特的美。湖水的颜色是湖底矿物质的原因，据知名医学生推测，绿色的的湖水是大量的二价铁离子存在的原因。除了绿色的湖水，还有一点点的红色，但在大片的湖水中并不明显，也不知这点红是真的存在还是我的错觉，管不了那么多了，而且，大佬也没跟我讲这是什么离子，</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-10.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-11.jpeg" alt=""></p>
<p>和朋友一起打打趣，拍拍照，看着湖边的小沟洼，一圈圈螺纹般的白壁配上澄澈的盐水，让我忍不住探之，湖水稍有凉意，抽出被湖水浸湿的手，试着舔了下手指，苦涩的咸刺激着味蕾，我吐了吐舌头上的这般苦，与朋友分享试吃感受，大伙被我逗笑了。</p>
<p>风很俏皮，方向有些不定，很快地带走了我手上的水分，白色的盐从中析出附着在我的手上，相机手柄染上了这层粉霜，不经意间地也染白了我的裤腰。<br>一起的航拍合照出乎意料的美，一汪汪碧眼大大小小，连成一片。一个个碧眼的湖水如翡翠般格外耀眼，伫立在盐地的我在之前也只是看到了她一二分的美。真真正正的惊艳之美她不愿轻易让我们发现。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-08.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-09.jpeg" alt=""></p>
<p>走出翡翠湖已六点半，师傅送了我们用盐做的小兔子，很可爱。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0603-12.jpeg" alt=""></p>
<p>返回住处，一起去觅食，炕锅羊肉和粥真的很美味。</p>
<p>(多多拍的美食照.jpeg)</p>
<p>饭后一起买了些水果，回住处休息。</p>
<h2 id="Day-04-魔鬼城-—-石油小镇-—-阳关"><a href="#Day-04-魔鬼城-—-石油小镇-—-阳关" class="headerlink" title="Day 04 魔鬼城 — 石油小镇 — 阳关"></a>Day 04 魔鬼城 — 石油小镇 — 阳关</h2><p>今天早上没有迟到，师傅一定很高兴。不过下午的时候，师傅更高兴了。。。</p>
<h3 id="风蚀奇景有雅丹，玉门关外魔鬼城"><a href="#风蚀奇景有雅丹，玉门关外魔鬼城" class="headerlink" title="风蚀奇景有雅丹，玉门关外魔鬼城"></a>风蚀奇景有雅丹，玉门关外魔鬼城</h3><p>从车上跳下来，狂风呼作。神奇的雅丹地貌，高起的风蚀土柱神工意匠，巧夺天工。</p>
<p>登上一最高处，耳边狂风呼啸，放眼眺望，远至天边，一望无际，一棵棵耸立的柱子形成了如壮阔的森林之景，大自然这位神匠以最精湛的技艺，用心雕刻，完成了这惊世骇俗之作。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-01.jpeg" alt=""></p>
<p>登上最满意的土邱，把最美的雅丹风光照给安排上！</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-02.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-03.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-04.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-05.jpeg" alt=""></p>
<p>拍完照片一起去公路边为拍公路照做准备，迈着六亲不认的步伐，一块向公路边走去。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-06.jpeg" alt=""></p>
<p>拜托师傅给我们拍了公路照，随着正数三声令下，一跃而起，定格此刻最美的我们。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-07.jpeg" alt=""></p>
<p>安排完毕，坐上车子，跟着师傅一起前往下一个景点。</p>
<h3 id="石油俱乐部，光彩幼儿园"><a href="#石油俱乐部，光彩幼儿园" class="headerlink" title="石油俱乐部，光彩幼儿园"></a>石油俱乐部，光彩幼儿园</h3><p>石油小镇地图上居然没找到，一个小小的景点，又或是不算，是几个电影的拍摄地，《英雄》、《九层妖塔》、《西风烈》，只是看过《英雄》，这次回去要补一补了。拍了些照片，公共汽车，幼儿园，石油工厂，吉普车。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-08.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-09.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-10.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-12.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-13.jpeg" alt=""></p>
<p>这里需要安排一张卫昊的神照，P一P放上来，先留个位置</p>
<p>(神照0604-14.jpeg)</p>
<p>走出来，已经有一个小时了，我们逛的挺久。</p>
<h3 id="醉卧沙场君莫笑，古来征战几人回"><a href="#醉卧沙场君莫笑，古来征战几人回" class="headerlink" title="醉卧沙场君莫笑，古来征战几人回"></a>醉卧沙场君莫笑，古来征战几人回</h3><p>上车后驶向阳关，师傅在车上考了考我们那首王维的诗，很惭愧，只记得最后两句。</p>
<blockquote>
<p>​            渭城曲 / 送元二使安西</p>
<p>渭城朝雨浥轻尘，客舍青青柳色新。</p>
<p>劝君更尽一杯酒，<em>西出阳关无故人</em>。</p>
</blockquote>
<p>到了阳关，进去的时间是三点五十左右。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-15.jpeg" alt=""></p>
<p>跟随着导游了走过博物馆，了解张骞开辟伟大丝绸之路的全过程；看”一进古董滩，两手不空还”的出土文物，了解你走你的阳关道，我过我的独木桥的故事。</p>
<p>出来之后向景区深处走去，来到阳关道处。烈日当空，满山荒凉。王维左持酒杯，右指远疆，雄才扫狼烟，旁边的石碑上是那首耳熟能详的《渭城曲》。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-17.jpeg" alt=""></p>
<p>再向前几十米处的阳关道碑，在漫卷黄沙的背景下显得更加凄凉。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-16.jpeg" alt=""></p>
<p>坐上游览车到达景区深处，一望无际的黄海，这辽阔的眼前沙场让，李白的凉州词二首对正是对此景最壮阔的描述。</p>
<blockquote>
<p>​             《凉州词二首 其一》</p>
<p>葡萄美酒夜光杯，欲饮琵琶马上催。</p>
<p>醉卧沙场君莫笑，古来征战几人回</p>
</blockquote>
<p>在麻绳木道上走走停停，烈日当头，我们毫无退意。我们拍了照，晒了很久的太阳。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-18.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-19.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-20.jpeg" alt=""></p>
<p>走出阳关景区，已将近六点三十。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-21.jpeg" alt=""></p>
<p>这下师傅算是真的佩服我们了，三年多的带团经验，我们是第一个能在烈日阳关下，游玩两个半小时的，师傅不好发作，耐着性子怼了我们好大会，让我们明天到鸣沙山也这样子好好玩，给我们夸的哟，要把我们写入教科书，以后再有游客，要拿我们当课讲，我们都腼腆的笑了，哈哈哈哈。</p>
<p>之前啤酒厂上班，喝啤酒得过奖的他约我们后天和他好好喝几杯，我们答应了下来。</p>
<p>晚上八点钟达到敦煌，一个环境超棒的县级市，安排好住宿一起走出酒店，已经是晚上九点左右了，但是，天依然大亮，夜生活还没开始，无奈。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0604-22.jpeg" alt=""></p>
<p>找了家饭馆吃饭，印象深刻的青菜豆腐汤，滋味无穷。</p>
<p>一起逛了逛特色的小街，回到酒店收拾休息，敦煌的游玩就此开始。</p>
<h2 id="Day-05-鸣沙山，月牙泉-—-敦煌莫高窟"><a href="#Day-05-鸣沙山，月牙泉-—-敦煌莫高窟" class="headerlink" title="Day 05 鸣沙山，月牙泉 — 敦煌莫高窟"></a>Day 05 鸣沙山，月牙泉 — 敦煌莫高窟</h2><p>今天的我们长记性了，八点，我们没迟到。师傅带着我们，二十分钟便到了鸣沙山。</p>
<h3 id="我亦红尘沙一粒，于清风下作长鸣。"><a href="#我亦红尘沙一粒，于清风下作长鸣。" class="headerlink" title="我亦红尘沙一粒，于清风下作长鸣。"></a>我亦红尘沙一粒，于清风下作长鸣。</h3><p>进入景区，我们第一项的活动是骑骆驼，拿好骑乘单，坐上了我的骆驼，437号，它长得很帅，不过脾气有点犟，在这短短的几十分钟内被打了四次，有点心疼它，以前不明白为什么骆驼会走的这么整齐，现在算是知道了，牵引绳是在鼻子上。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-01.jpeg" alt=""></p>
<p>足踩脚蹬，手扶鞍前铁环，骑坐在两峰之间，随着骆驼一步步地行走在沙山中，虽稍有不稳，但很舒服，不过时间没多久就有些累，悠悠的骆驼就令我生此感，对于骑马骑骆驼等不知甘苦的我，有些理解了信使快马加鞭的鞍马劳顿。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-04.jpeg" alt=""></p>
<p>远眺大漠，驼队井然有序，沙山高遮半天。在这沙鸣山中，我是如此的渺小，非关瀚海气难平，情动如何不发声。我亦红尘沙一粒，于清风下作长鸣。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-02.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-03.jpeg" alt=""></p>
<p>跳下骆驼，走向月牙湾，醉卧沙鸣月泉侧，千沙万泉无颜色。月牙泉，沙鸣山的女神之泪。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-05.jpeg" alt=""></p>
<p>走到月牙泉旁边的建筑，楼上的扁写着月泉阁。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-06.jpeg" alt=""></p>
<p>走进月牙泉旁边的建筑，最高的一块边上写着第一泉，但我能到达的也就二楼，在楼上看不到月牙泉的全貌，不过视野稍微会开阔一点，这里也有些求神拜佛的屋子，我并没有进去。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-11.jpeg" alt=""></p>
<p>走出月牙泉旁边的建筑，开始爬沙山，无知的我以为能很容易上去，无需借助沙梯，三分钟内爬上山顶！现实狠狠地给了我一巴掌，脚下滑沙，每一次蹬脚，沙子都会下滑，赤脚狂奔三十米后，我已经有些接不上气了，只得作罢，老老实实地顺着沙梯上行，直到山顶，我都有些小喘，蠢。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-07.jpeg" alt=""></p>
<p>山上的视野很是开阔，在此眺望，可以看到月牙泉的全貌，鸣沙山之眼。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-08.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-09.jpeg" alt=""></p>
<p>一起拍了合照，稍作休息后，冲下沙山！</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-10.jpeg" alt=""></p>
<p>出来景区，去取忘在酒店的莫高窟以及又见敦煌的演出门票，顺便吃了驴肉黄面，然后便一块赶往了莫高窟景区。</p>
<h3 id="悬宫居国粹，舞女踏云祥"><a href="#悬宫居国粹，舞女踏云祥" class="headerlink" title="悬宫居国粹，舞女踏云祥"></a>悬宫居国粹，舞女踏云祥</h3><p>一起排队，先看了两个电影。</p>
<p>第一个电影史《千年莫高》，血染夕阳，张骞带领着众人走在漫漫的黄沙荒漠，开启了丝绸之路；乐尊游历至敦煌，越过最后一道沙山，看到不远处的崖壁金光万道，宛若千佛，如若佛示，凿洞修禅，开启千年莫高。 </p>
<p>第二个是《梦幻佛宫》，我们如同乘坐飞船，穿越梦境，在梦境中领略千年莫高窟的神作之美。</p>
<p>对于这两个片子的评价，按照俺这粗人的说法就是贼好看！</p>
<p>看完影片，接着拿票乘车去看洞窟。双脚走进洞窟，双眼又见敦煌。</p>
<p>所有的洞窟都在一个由北向南的鸣沙山山脉的崖壁上，据说是乐尊和尚游历至此，又饿又累的他越过最后一座沙丘，抬头眺望，不远处的崖壁上金光万道，宛若千佛，他认为这是佛的指示，乐尊因此在峭壁上开凿洞窟，修禅打坐，从此开始了上千年的莫高窟修建之路。因丝绸之路的兴起，人们出于各种目的的来到此地，为莫高窟的发展提供了最大的资源，后来随着丝绸之路没落，洞窟也慢慢地走向荒凉。</p>
<p>我们带着收音器，跟随着导游开始向洞窟走去。</p>
<p>参观的第一是029窟，好记性不如烂笔头，当时没有任何记录，我已经忘记了自己看的是什么，只记得墙壁上的画有飞天，导游姐姐的声音很甜美。</p>
<p>第二是23、24窟，该窟建于1200年的盛唐时期，富态的唐风佛像，墙壁上的画是佛祖讲法图，唐朝的经变画的特色令人不觉赞叹，主体是佛祖讲法图，画中的建筑、服饰、装饰、乐器，无不流露着唐朝盛世旷大，人们对佛的虔诚；壁画的左上角天空云布，下着雨，田间有人正在雨中耕作，一位中年正挑着扁担像是在送饭，再向下有三人正在吃饭，旁边的孩童正在不知疲倦的玩耍，一片国泰民安的盛景。佛说法正如大雨一样滋润着这世间万物，修行的方式不止出家，正如画中的他们，也是修行，修行的方式多种多样，这一片国泰民安的景象，活画活现。</p>
<p>接着走出洞窟，随导游来到十分有名的第17窟，藏经洞，这个洞的特别之处在于，它是一位清朝末期负责管理洞窟的道士—王圆禄偶然发现的，其中书多达五万件，文本、绢画、刺绣等，种类繁多，当时他七年间多次上报朝廷后，并没有引起太多的重视，后来他想完成清扫洞窟的宏愿，将经书第一次卖给了一个外国探险家—斯坦因，后来又分多次卖给了外国人，四万多册的珍贵文献流落异国他乡，只剩下几千件。回过来看，此洞原本是晚唐河西释门都僧统洪辩的禅窟，但为什么会有这么多经书呢，到目前仍是谜，最具普遍的猜测是宋初西夏人占领莫高窟前，<br>千佛洞的僧人为了躲避战乱，临走前将这些文本藏入洞中，僧人一去不复返，此洞便成了永远的秘密。</p>
<p>走出藏经洞，继续向南走，来到的是第16窟，这是一个西夏时期的大洞，窟中左侧迦叶，右侧阿难，中间是释迦摩尼。壁画相对较简单，内容是贴金莲花，墙壁上可见金色的凸起，这种贴金的出现最早在唐朝最初的壁画，再现已是西夏。</p>
<p>随着导游上楼，可见栈道旁残存的宋代崖壁画，向东看去，有块小牌坊，是郭沫若的莫高窟题字。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-13.jpeg" alt=""></p>
<p>接着走进第292窟，这是一个1400年的隋代洞窟，洞窟中是三世佛，由左向右是燃灯佛过去佛，释迦牟尼佛现在佛，弥勒佛未来佛。佛像神态生动，身着丝绸锦缎，裙摆上是颇具特色的连珠纹，可见当时纺织业的发达。壁画上是无数的小佛像，佛像颜色蓝白相间，蓝色的小佛像，颜料是一种来自阿富汗的矿物质，想当年能用到这远在天边的颜料，可见人们信仰的虔诚和经济的繁荣。</p>
<p>下楼继续前走，来到的是第055窟，慈窟是公园694年修建，窟中未来佛神色安详，两腿自然下垂。佛像是敦煌中小型佛像特有的修建手法，先由木头搭建架子，再用泥土糊上，然后上色，此做法称为木骨泥塑。 壁画是宋代的壁画画法，佛说世界的美好，画中乐队伴奏，中间是经典的反弹琵琶，其中还有些莫高窟常见的两层壁画。除此并无太多其他印象。</p>
<p>再向前是九层塔，塔呈砖红，在整段沙黄的断崖上飞阁流丹。九层塔最初只有两层，随着不断地翻新修建，塔的层数越来越多了，地基也越来越高，最后一次重修是1928—1935年，走进塔内，是世界第三大佛，总高35.5米，此窟依山凿洞，利用洞窟石头本身开凿做胎，涂泥上色，是莫高窟佛像的另一种做法——石胎泥塑。抬头仰望佛像，山顶佛光流淌，荡魂摄魄。地上还有着修建佛像时搭架子留下的桩洞，大石窟的搭建或都如此。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-12.jpeg" alt=""></p>
<p> 向前走，涯壁顶端是年代已久的木房，是何种木材，未知。快走到了最南端，是第148窟，大卧佛，此窟建于盛唐公元776，佛长14.7米，是释迦牟尼的涅槃佛，也因此佛窟内部整体构造如棺材。佛像在清代末期重色，嘴巴有变，整个佛像神态发生改变，但佛像的衣褶处理，线条流畅，还可看出唐代彩塑的特征。</p>
<p>走出洞窟，交还收音器，莫高窟的正式参观就走完了。和朋友一同游逛拍照。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-15.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-16.jpeg" alt=""></p>
<p>海贼王必不可少！</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-14.jpeg" alt=""></p>
<p>五点多打道回府，接着是晚上的舞台剧表演—《又见敦煌》，一千年究竟有多长？不过一瞬间。春一去，冬一来，一千年就过去啦。又见敦煌，不过黄沙一捧，寂寞胜雪。</p>
<blockquote>
<p> 我是你低头看见的大陆无边，我是你抬头看见的星辰万点，我是你的一瞬间，我是你的一千年。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-17.jpeg" alt=""></p>
<p>放上几张人物出场照，后面的演出太美，太美，我怎能拍的出来。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-18.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-19.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-20.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-21.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-22.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0605-23.jpeg" alt=""></p>
<p>看完此剧，内心久久无法平静，现在想起，仍起鸡皮疙瘩，有机会一定要去看，强烈推荐！</p>
<p>走出影厅，心情不太美丽，坐上车也没怎么说话，不知大家当时是什么心情，我们都没怎么说话。</p>
<p>天亮就要离开敦煌，睡吧。</p>
<h2 id="Day-06-瓜州-—-嘉峪关-路过-—-张掖"><a href="#Day-06-瓜州-—-嘉峪关-路过-—-张掖" class="headerlink" title="Day 06 瓜州 — 嘉峪关(路过) — 张掖"></a>Day 06 瓜州 — 嘉峪关(路过) — 张掖</h2><p>早上收拾完毕上车，这两天还都挺准时的，我们要开始返程，今天要走七百多公里。</p>
<p>第一站是瓜州，大概十一点多到了瓜州，尝了尝西瓜和哈密瓜，一般般，并没有买什么东西，上车走人，路途遥远，沿途甚是荒凉，安静地坐在车上，无人多语，很喜欢这种安静听歌，用心码字的濠上之乐，昨天的莫高窟之旅的参观路线，就这样完成了。不知车子还要多久到达下一个目的地，能这样不停地驶向东方，也是件美事，就这样一直走下去吧！</p>
<p>没多久便睡着了，睡得很香，醒来的时候快两点，到了嘉峪关，门票要110，听师傅介绍也不是很吸引人，门口拍了个照，一起吃了午饭就又坐上车了。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-01.jpeg" alt=""></p>
<p>向张掖进发，我又睡着了，抵达张掖是下午四点多，一起去参观七彩丹霞，丹霞很美。天气不是很好，师傅让我们玩好，什么时候饿了，什么时候累了再出来，我们都很同情师傅，哈哈。走到第二个景点，我们拍了好多沙雕照，哼，我才是最美的。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-02.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-06.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-03.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-04.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-05.jpeg" alt=""></p>
<p>两个半小时我们走到了第二个，在去第三个的路上下起了雨，让师傅失望了，我们才逛了两个，就要出来了。</p>
<p>晚上吃饭，先是饭馆喝酒，师傅给我们推荐的饭馆相当不错，老板还给我们献上了哈达，喝了五杯白的，又喝了几杯啤的，为了今晚的快乐时光埋下了种子。</p>
<p>饭馆出来后和师傅合照。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0606-07.jpeg" alt=""></p>
<p>回到酒店后，跟着师傅来到餐厅继续喝酒，最后喝的有点点多，我还是第一次喝的这么多，一起喝酒一起唱歌，我喝多了，有些兴奋，一直想唱歌，唱了好多首，一起听故事，玩的很高兴。感觉有些不舒服就吐了些，也是第一次，哈哈哈，好多第一次呀。铎哥喝的也有点多，不过酒量比我好，还和师傅聊了聊自己的苦恼，成年人的世界，哪有容易二字，生活还在继续，我们还是要抬头向前走。</p>
<p>回到房间倒头还在唱歌，忘记唱的什么了，然后就趴着睡着了，半夜醒来衣服鞋子什么的都没脱，蹬掉鞋子，翻身扯下袜子，断断续续地脱下衣裳，钻进了被窝，很快就又睡着了。</p>
<h2 id="Day-07-七彩丹霞-—-扁都口-—-达板山-—-大草原-—-远山雪峰-—-西宁"><a href="#Day-07-七彩丹霞-—-扁都口-—-达板山-—-大草原-—-远山雪峰-—-西宁" class="headerlink" title="Day 07 七彩丹霞 — 扁都口 — 达板山 — 大草原 — 远山雪峰 — 西宁"></a>Day 07 七彩丹霞 — 扁都口 — 达板山 — 大草原 — 远山雪峰 — 西宁</h2><p>(有空重写，8号没来得及整理，现在是9号22：30，我赶着睡觉。。。)</p>
<p>早早地醒来，六点。今天的张掖，天气格外的好啊，早上铎哥放了放无人机，七彩丹霞，美不胜收的一天。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-01.jpeg" alt=""></p>
<p>吃完早饭跟着师傅开始了最后一天的行程，我们先到了扁山口，六月初，油菜花还没开，不过依然很漂亮。由于无人机被扣了下来，还和铎哥一起爬了爬山，他可猛了，裤子都给蹭破了，不过还好，挺好的。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-02.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-03.jpeg" alt=""></p>
<p>再次发车，天空蔚蓝，云朵白的就像是假的，超级白。很快我们就到了达板山，一起下车拍了拍照。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-04.jpeg" alt=""></p>
<p>然后上车赶往大草原，草原上的风有点大，有点冷，拍了好多照片，玩到最后师傅坐不住了，来找我们。。。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-05.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-06.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-07.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0607-08.jpeg" alt=""></p>
<p>一起乘车开往西宁，路过雪峰，到达西宁，已经下午六七点了。和师傅说再见，一起来到民宿，收拾完东西看《向往的生活》，八点出来觅食，锅串串还是什么，挺好吃的，也不辣！买了些吃的，一起回到住处，打牌，赢的唱歌。敏姐唱歌真的太好听啦，哈哈。我录下了她唱的《我是一只小小鸟》，这要是哪天睡不着，就可以拿出来听听。还录了迪哥和多多一起唱的《知足》，以及多多唱的《宁夏》，一直玩到凌晨一点多。</p>
<p>相继收拾完毕，睡觉。</p>
<h2 id="Day-08-西宁，再见"><a href="#Day-08-西宁，再见" class="headerlink" title="Day 08 西宁，再见"></a>Day 08 西宁，再见</h2><p>早上起来收拾完毕，大家一同打车前往机场，又到了说再见的时刻，一周的时间，飞快。</p>
<p>看到准点率3%，延迟起飞平均时间147min，吓得大气都不敢喘。</p>
<p>十二点三十起飞的飞机，先推迟了半个多小时，最先离开的我和铎哥，先送走了多多和敏姐，相互拥抱道别，下次再见。</p>
<p>然后送走了一点五十起飞的迪哥，长点心吧，对自己好点，拥抱道别，下次再见。</p>
<p>然后我俩在机场开始了等待，飞机的起飞时间改成了五点五十，我们成了机场中最快乐的男孩，中午的盒饭给了俩鸡腿，真香啊。</p>
<p>下午五点五十飞机起飞，到达杭州是八点四十五再转机场大巴，然后坐地铁，到家已是晚上十点四十，铎哥更晚。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0608-01.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0608-02.jpeg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/%E8%A5%BF%E5%8C%97%E6%B8%B8%E8%AE%B0/0608-03.jpeg" alt=""></p>
<p>整个行程就此结束。</p>
<h2 id="后语"><a href="#后语" class="headerlink" title="后语"></a>后语</h2><p>早上醒来已经是十点，最近这些天睡得最好的一次，果然还是自己的床舒服。想着没什么事情，整理着写下了这个游记。</p>
<p>整个旅程，我们在车上的时间也很多，窗外的风景也很美，如果有时间，有能力，再剪个视频，附在此文中，再说吧。</p>
<p>​                                                                                                                2019.06.09 记</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/Essay/%E6%8E%A2%E6%B8%85%E6%B0%B4%E6%B2%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/Essay/%E6%8E%A2%E6%B8%85%E6%B0%B4%E6%B2%B3/" class="post-title-link" itemprop="url">探清水河</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-29 18:11:23" itemprop="dateCreated datePublished" datetime="2019-05-29T18:11:23+08:00">2019-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:28:20" itemprop="dateModified" datetime="2020-05-16T10:28:20+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Essay/" itemprop="url" rel="index"><span itemprop="name">Essay</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="探清水河"><a href="#探清水河" class="headerlink" title="探清水河"></a>探清水河</h1><p>桃叶儿那尖上尖</p>
<p>柳叶儿遮满了天</p>
<p>在其位的这个明阿公</p>
<p>细听我来言呐</p>
<p>此事哎 出在了京西蓝靛厂啊</p>
<p>蓝靛厂 火器营儿 有一个松老三</p>
<p>提起了松老三</p>
<p>两口子卖大烟</p>
<p>一辈子无有儿</p>
<p>生了个女婵娟呐</p>
<p>小妞哎 年长那一十五啊</p>
<p>起了个乳名儿 荷花万字叫大莲</p>
<p>姑娘叫大莲</p>
<p>俊俏好容颜</p>
<p>此鲜花无人采</p>
<p>琵琶断弦无人弹呐</p>
<p>奴好比貂蝉思吕布</p>
<p>又好比阎婆惜坐楼想王三</p>
<p>太阳落了山</p>
<p>秋虫儿闹声喧</p>
<p>日思夜想的六哥哥</p>
<p>来在了我的门前呐</p>
<p>约下了今晚那三更来相会呀</p>
<p>大莲我羞答答 低头无话言</p>
<p>一更鼓儿天</p>
<p>姑娘我泪涟涟</p>
<p>为何俺二爹娘爱抽鸦片烟呐</p>
<p>耽误了小奴我的婚姻事啊</p>
<p>青春要是过去 何处你找少年</p>
<p>二更鼓儿发</p>
<p>小六儿把墙爬</p>
<p>惊动了上房屋 痴了心的女娇娃哟</p>
<p>急慌忙打开了门双扇呐</p>
<p>一把手 拉住了心爱的小冤家</p>
<p>三更鼓儿连</p>
<p>月亮那照中天</p>
<p>好一对多情的人 对坐话缠绵呐</p>
<p>鸳鸯哎戏水 我说说心里话呀</p>
<p>手拉着知心的人不住地泪涟涟</p>
<p>四更鼓儿忙 </p>
<p>二人就上了床 </p>
<p>上得那牙床宽 </p>
<p>宽去了我的衣裳呦 </p>
<p>我二人嘴对嘴就腮贴腮呀 </p>
<p>六哥哥的舌头尖点在了我的牙膛啊</p>
<p>五经天大明</p>
<p>爹娘他知道细情</p>
<p>无廉耻的这个丫头哎</p>
<p>败坏了我的门庭啊</p>
<p>今日里一定要将你打呀</p>
<p>皮鞭子沾凉水 定打不容情</p>
<p>大莲无话说</p>
<p>被逼就跳了河</p>
<p>惊动了六哥哥</p>
<p>来探清水河哟</p>
<p>情人哎 你死都是为了我呀</p>
<p>大莲妹妹慢点走 等等六哥哥</p>
<p>秋雨下连绵</p>
<p>霜降那清水河</p>
<p>好一对钟情的人</p>
<p>双双跳下了河哟</p>
<p>鸳鸯哎戏水说说心里话呀</p>
<p>编成了小曲儿来探清水河</p>
<p>编成了小曲儿来探清水河 啊</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/Essay/%E8%81%8A%E5%A4%A9%E9%9A%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/Essay/%E8%81%8A%E5%A4%A9%E9%9A%8F%E8%AE%B0/" class="post-title-link" itemprop="url">聊天随记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-24 22:11:42" itemprop="dateCreated datePublished" datetime="2019-05-24T22:11:42+08:00">2019-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:27:30" itemprop="dateModified" datetime="2020-05-16T10:27:30+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Essay/" itemprop="url" rel="index"><span itemprop="name">Essay</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>2015.02.23</strong></p>
<p>今天俺dada喝了点酒，本来把我叫过去，我也在的，他是想让我看看，我从小都见过的人，社会中摸爬滚打过来，都变得怎么样，人，是怎么成长起来的。但老刘找我玩，就出去了。</p>
<p>就在刚刚，他来找我说话，说了很多，怕忘了，我想记下来。</p>
<p>你要记好一句话，咱们不靠别人，自己能干好的就不去求别人，不过要是有人帮你，你就接受，不接受的那是傻。</p>
<p>你要记好一句话，环境决定人，人要有诚信，有良心。</p>
<p>你要记好一句话，人都是有权利享受的，但是你也是要尽相应的义务，自己的爹娘，自己要养。等自己能挣钱了，千万别忘了他们，有机会，带他们出来耍。</p>
<p>你要记好一句话，你是家里的老大，什么事吃点亏是再正常不过的，当大的，就要有当大的样。</p>
<p>你要记好一句话，不孝敬自己爹妈的人，不配做人。不要和这些人做朋友。</p>
<p>你要记好一句话，自己家的人可以有内部矛盾，永远不要把上一代人的矛盾带到你的身上，自己人在家有矛盾可以，出来们你是一家人。</p>
<p>你要记好一句话，自己的路自己走，永远不要让别人的建议禁锢了你的路。</p>
<p>你要记好一句话，能用钱解决的事，那都不是事，钱没了还可以挣，但是在一起的感情，你也知道，不是说给谁点钱都能跟你好。</p>
<p>你要记好一句话，自家人来往才会亲。叔跟姨相同的血缘关系，你自己清楚和谁亲，将来的孩子，我还是想让多和你们兄弟们来往。</p>
<p>你要记好一句话，上学只是个近路，不是你唯一的出路。自己的路自己决定，不要被父母的期望把你压垮，太在乎那些条条框框，什么都干不好。想做什么就去做，别怕失败，你只要记好，你想要什么。</p>
<p>你要记好一句话，当奶奶，当爹妈的说什么，你要听着，就算你不想听，也要假装听，他们说的有些话你听听就行了，不要太在意。你不能剥夺他们做长辈的权利，有些事肯定会有矛盾，想要让两个时代的人什么事都站在同一理念上，那是不可能的。爹妈都四十多了，有时候说话，你要换个方式，不要怪。</p>
<p>你要记好一句话，我说的每一句，不一定是对的。</p>
<p><strong>2019.05.23</strong></p>
<p><strong>叔</strong>：”趁着大学刚毕业还不久，抽空多看看人工智能相关的东西，以后肯定用得着，现在微积分跟统计学的相关知识应该还差不多记得，学起来简单一点”</p>
<p><strong>我</strong>：”嗯 知道了  最近在看些数据结构和算法的东西”</p>
<p><strong>叔</strong>：”没事多看看，现在程序员太多了，将来万一行情大变，现在最常见的这些偏业务型的程序原比较容易被淘汰掉。”</p>
<p><strong>我</strong>：”嗯”</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/Essay/%E8%8B%B1%E8%AF%AD%E5%8F%91%E9%9F%B3%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/Essay/%E8%8B%B1%E8%AF%AD%E5%8F%91%E9%9F%B3%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">英语发音学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-25 17:13:10" itemprop="dateCreated datePublished" datetime="2019-04-25T17:13:10+08:00">2019-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-16 10:28:40" itemprop="dateModified" datetime="2020-05-16T10:28:40+08:00">2020-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Fish/" itemprop="url" rel="index"><span itemprop="name">Fish</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="英语发音学习"><a href="#英语发音学习" class="headerlink" title="英语发音学习"></a>英语发音学习</h1><blockquote>
<p>谢孟媛老师发音篇：<a href="https://www.youtube.com/watch?v=buTX2_bCcKw&list=PLaYqF7AnyNPd86-BJip5ldg6vw4lcZzxx" target="_blank" rel="noopener">Youtube</a></p>
</blockquote>
<p>之前看完视频，记在了小本子上，不方便，索性就做个在线笔记。</p>
<h2 id="UNIT-1-K-K-音标"><a href="#UNIT-1-K-K-音标" class="headerlink" title="UNIT 1   K.K.音标"></a>UNIT 1   K.K.音标</h2><p>KK音标大体分为两个部分：<strong>母音</strong>和<strong>子音</strong>。母音可以单独存在，但子音必须配上母音来发音。</p>
<embed quality="high" src="//i.xiao84.com/en-yinbiao/kk/kklist.swf" type="application/x-shockwave-flash" height="800" width="600" base="." >

<h3 id="母音"><a href="#母音" class="headerlink" title="母音"></a>母音</h3><p>母音的发音规则是：<code>[ə]</code>和<code>[ɚ]</code>轻声，其余的四声。</p>
<p><code>[ə]</code>称为懒人音，不需要用力，轻轻地发声即可；<code>[ɚ]</code>发音在<code>[ə]</code>基础上轻轻翘舌发声。这两个音一定出现在不是重音的音节，如：<code>[ə&#39;bɔrd]</code>、<code>[&#39;sIstɚ]</code>。</p>
<p>其实英语只有轻重音，说是轻声和四声是借助母语来讲。</p>
<p>大野狼的故事：大野狼在山上叫，不是<strong>啊呜啊呜······</strong>，它的叫是<strong>嗷呜嗷呜······</strong>，前者的嘴型变化是很突然且很大的，后者的变化是很圆润的，我们可以自行感受一下，后者相对前者来说会省力很多。英语的发音同样如此，如从扁的<code>[i]</code>到最大的<code>[a]</code>，是慢慢变化的。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Fish/KK%E9%9F%B3%E6%A0%8701.png" alt="母音"></p>
<p>上图为母音音标，是一个<strong>倒梯形</strong>，左侧嘴型由扁到大，右侧由大到小。假设这个倒梯是人的嘴角的话，越靠上，嘴角越靠两边，嘴巴越扁，越靠下，嘴角越大。</p>
<h4 id="音标讲解"><a href="#音标讲解" class="headerlink" title="音标讲解"></a>音标讲解</h4><p>老师说：“<code>[i]</code>元复始。”，整个讲解顺序为：先走梯形<code>[i]--&gt;[a]---&gt;[u]</code>，再<code>[a]--&gt;[ɝ]</code>，最后是双母音。</p>
<p>图中同色音标具有相似之处，以此分组讲解，游戏开始：</p>
<h5 id="i-—-I"><a href="#i-—-I" class="headerlink" title="[ i ]—[ I ]"></a>[ i ]—[ I ]</h5><p>两个音的发音都类似于<code>yì</code>。</p>
<p><code>[i]</code>和<code>[I]</code>这两个音的差别不是发音时间长短；最大的差别是嘴巴的松紧度。</p>
<p><code>[i]</code>：是紧张音，念时嘴巴很紧。</p>
<p><code>[I]</code>：是放松音，念时嘴巴稍微放松。</p>
<h5 id="e-—-ε-—-ae"><a href="#e-—-ε-—-ae" class="headerlink" title="[ e ]—[ ε ]—[ æ ]"></a>[ e ]—[ ε ]—[ æ ]</h5><p>二十六个字母单独发音是为四声。</p>
<p><code>[e]</code>：是A的发音，类似于<code>èi</code>。</p>
<p><code>[ε]</code>：嘴巴不用刻意用力。</p>
<p><code>[æ]</code>比<code>[ε]</code>音重，区别发音的方法是，嘴巴张大，舌头下压。</p>
<h5 id="a-—-v"><a href="#a-—-v" class="headerlink" title="[ a ]—[ ʌ ]"></a>[ a ]—[ ʌ ]</h5><p><code>[a]</code>：嘴巴张最大，类似于<code>à 啊</code>。</p>
<p><code>[ʌ]</code>：倒V音，嘴巴变小一些，发<code>à 啊</code>，听起来比较短。</p>
<p>到<code>[a]</code>嘴巴已经张到最大，接下来的音嘴巴会慢慢变小</p>
<h5 id="o-—-o"><a href="#o-—-o" class="headerlink" title="[ o ]—[ ɔ ]"></a>[ o ]—[ ɔ ]</h5><p><code>[o]</code>：从<code>[a]</code>嘴巴变小，发音类似于<code>ò</code>和<code>ū</code>的结合音，<code>ū</code>是一个不太明显的尾音。是音标<code>[u]</code>的发音。o~</p>
<p><code>[ɔ]</code>：嘴巴定格。</p>
<h5 id="u-—-U"><a href="#u-—-U" class="headerlink" title="[ u ]—[ U ]"></a>[ u ]—[ U ]</h5><p><code>[u]</code>：是紧张音，嘴巴嘟起来，发音类似于<code>ù</code>。小嘴嘟嘟嘟？哈哈哈哈。</p>
<p><code>[U]</code>：是放松音，嘴巴放松，不嘟，也发<code>ù</code>。</p>
<p>两个音由于嘴型不一样，虽然发音都类似于<code>ù</code>，但是听起来长短会不一样。</p>
<h5 id="ə-—-ɚ-—-ɝ"><a href="#ə-—-ɚ-—-ɝ" class="headerlink" title="[ ə ]—[ ɚ ]—[ ɝ ]"></a>[ ə ]—[ ɚ ]—[ ɝ ]</h5><p>这三个音中前两个音是懒人音，发的都是轻声。</p>
<p><code>ə</code>：轻声<code>饿</code></p>
<p><code>ɚ</code>：轻声，发音<code>饿</code>时舌头瞬间弹起来（舌头上翘），再放平。</p>
<p><code>[ɝ]</code>：发音时，也发<code>饿</code>，不过是舌头先卷起来再发音即舌头先翘起来再发音。</p>
<h5 id="au-—-aI-—-oI"><a href="#au-—-aI-—-oI" class="headerlink" title="[ au ]—[ aI ]—[ ɔI ]"></a>[ au ]—[ aI ]—[ ɔI ]</h5><p>双母音由两个母音组合发音。</p>
<h4 id="易混淆发音"><a href="#易混淆发音" class="headerlink" title="易混淆发音"></a>易混淆发音</h4><table>
<thead>
<tr>
<th>One</th>
<th>two</th>
<th>ONE</th>
<th>TWO</th>
</tr>
</thead>
<tbody><tr>
<td><code>[i]</code></td>
<td><code>[I]</code></td>
<td><code>[e]</code></td>
<td><code>[ε]</code></td>
</tr>
<tr>
<td>b<strong>e</strong>ater</td>
<td>b<strong>i</strong>tter</td>
<td>w<strong>a</strong>ste</td>
<td>w<strong>e</strong>st</td>
</tr>
<tr>
<td>r<strong>ea</strong>ch</td>
<td>r<strong>i</strong>ch</td>
<td>d<strong>a</strong>te</td>
<td>d<strong>e</strong>bt</td>
</tr>
<tr>
<td>gr<strong>ee</strong>d</td>
<td>gr<strong>i</strong>d</td>
<td>m<strong>a</strong>te</td>
<td>m<strong>e</strong>t</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>[e]</code></td>
<td><code>[æ]</code></td>
<td><code>[o]</code></td>
<td><code>[ɔ]</code></td>
</tr>
<tr>
<td>m<strong>a</strong>id</td>
<td>m<strong>a</strong>d</td>
<td>l<strong>o</strong>w</td>
<td>l<strong>a</strong>w</td>
</tr>
<tr>
<td>l<strong>a</strong>ke</td>
<td>l<strong>a</strong>ck</td>
<td>c<strong>o</strong>at</td>
<td>c<strong>a</strong>ught</td>
</tr>
<tr>
<td>sn<strong>a</strong>ke</td>
<td>sn<strong>a</strong>ck</td>
<td>b<strong>o</strong>at</td>
<td>b<strong>o</strong>ught</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>[I]</code></td>
<td><code>[ε]</code></td>
<td><code>[a]</code></td>
<td><code>[ʌ]</code></td>
</tr>
<tr>
<td>s<strong>i</strong>t</td>
<td>s<strong>e</strong>t</td>
<td>n<strong>o</strong>t</td>
<td>n<strong>u</strong>t</td>
</tr>
<tr>
<td>t<strong>i</strong>n</td>
<td>t<strong>e</strong>n</td>
<td>s<strong>o</strong>ck</td>
<td>s<strong>u</strong>ck</td>
</tr>
<tr>
<td>l<strong>i</strong>sten</td>
<td>l<strong>e</strong>sson</td>
<td>c<strong>o</strong>llar</td>
<td>c<strong>o</strong>lor</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="子音"><a href="#子音" class="headerlink" title="子音"></a>子音</h3><p>子音分为有声子音和无声子音。有声子音有声音发出，无声子音不是只动嘴巴无声音，而是有气音送出来。</p>
<p>子音都为轻声，且有声子音有15个，无声子音有9个。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/Fish/KK%E9%9F%B3%E6%A0%8702.png" alt="母音"></p>
<h4 id="音标讲解-1"><a href="#音标讲解-1" class="headerlink" title="音标讲解"></a>音标讲解</h4><p>将子音进行分组，前八组（第一横行）上下对照，嘴型相同。</p>
<h5 id="p-—-b"><a href="#p-—-b" class="headerlink" title="[ p ]—[ b ]"></a>[ p ]—[ b ]</h5><p><code>[p]</code> ：字母<code>Pp [pi]</code>中，有音标<code>[p]</code>，我们知道<code>P</code>的发音，也知道<code>[i]</code>的发音，很容易知道音标<code>[p]</code>的发音了。</p>
<p><code>[b]</code>：嘴型相同，有声发音。</p>
<h5 id="t-—-d"><a href="#t-—-d" class="headerlink" title="[ t ]—[ d ]"></a>[ t ]—[ d ]</h5><p><code>[t]</code>：字母<code>Tt [ti]</code>，同<code>[p]</code>理解。</p>
<p><code>[d]</code>：嘴型相同，有声发音。</p>
<h5 id="k-—-g"><a href="#k-—-g" class="headerlink" title="[ k ]—[ g ]"></a>[ k ]—[ g ]</h5><p><code>[k]</code>：字母<code>Kk [ke]</code>，同<code>[p]</code>理解。</p>
<p><code>[g]</code>：嘴型相同，有声发音。</p>
<h5 id="f-—-v"><a href="#f-—-v" class="headerlink" title="[ f ]—[ v ]"></a>[ f ]—[ v ]</h5><p><code>[f]</code>：字母<code>Ff [εf]</code>，同<code>[p]</code>理解。发音方法是上排牙齿咬住下面嘴唇。</p>
<p><code>[v]</code>：嘴型相同，有声发音。<code>five [faIv]</code></p>
<h5 id="s-—-z"><a href="#s-—-z" class="headerlink" title="[ s ]—[ z ]"></a>[ s ]—[ z ]</h5><p><code>[s]</code>：发音类似<code>sī 嘶</code></p>
<p><code>[z]</code>：字母<code>Zz [zi]</code>，同<code>[p]</code>理解。</p>
<h5 id="θ-—-ð"><a href="#θ-—-ð" class="headerlink" title="[ θ ]—[ ð ]"></a>[ θ ]—[ ð ]</h5><p>两个音都是咬舌音</p>
<p><code>[θ]</code>：<code>[s]</code>–咬舌音–&gt;<code>[θ]</code></p>
<p><code>[ð]</code>：<code>[z]</code>–咬舌音–&gt;<code>[ð]</code></p>
<h5 id="ʃ-—-ʒ"><a href="#ʃ-—-ʒ" class="headerlink" title="[ ʃ ]—[ ʒ ]"></a>[ ʃ ]—[ ʒ ]</h5><p>类似于让人不要讲话是发的音</p>
<p><code>[ʃ]</code>：类似于<code>shī~</code></p>
<p><code>[ʒ]</code>：类似于<code>rī~</code></p>
<h5 id="tʃ-—-dʒ"><a href="#tʃ-—-dʒ" class="headerlink" title="[ tʃ ]—[ dʒ ]"></a>[ tʃ ]—[ dʒ ]</h5><p><code>tʃ</code>：类似于<code>chī~</code>，拼音是一声的，拖长音感觉又像四声。</p>
<p><code>[dʒ]</code>：类似于<code>zhī~</code>，拼音是一声的，拖长音感觉又像四声。</p>
<h5 id="h"><a href="#h" class="headerlink" title="[ h ]"></a>[ h ]</h5><p><code>[h]</code>：无声，类似于<code>hē</code></p>
<h5 id="m-—-n-—-ŋ"><a href="#m-—-n-—-ŋ" class="headerlink" title="[ m ]—[ n ]—[ ŋ ]"></a>[ m ]—[ n ]—[ ŋ ]</h5><p>这三个音称为鼻音，顾名思义，是由鼻子发出来的声音。</p>
<p><code>[m]</code>：有两种发音。发音嘴唇闭起来。在母音前，发音是<code>mē</code>；在母音后，发音是<code>em</code>。</p>
<p><code>[n]</code>：有两种发音。发音嘴唇不要闭起来，舌尖轻轻抵在上排牙齿后面。 在母音前，发音是<code>nē</code>；在母音后，发音是嘴唇不要闭起来，舌尖轻轻抵在上排牙齿后面。</p>
<p>看<code>nine [naIn]</code>的发音，体会一下。</p>
<p><code>[ŋ]</code>：这个鼻音是最重的，发音是，舌头抵在下排牙齿后面发音。类似于<code>eng</code>，可以感受到，发<code>eng</code>时舌头的位置与此音相同。</p>
<h5 id="l"><a href="#l" class="headerlink" title="[ l ]"></a>[ l ]</h5><p><code>[l]</code>：有两种发音。在母音前，发音是<code>l</code>；在母音后，发音在<code>饿</code>跟<code>哦</code>之间，发音时，舌头由平<code>饿</code>到翘<code>哦</code>发音，得到的音就是这个音，读<code>girl [gɝl]</code>感受一下。</p>
<h5 id="r"><a href="#r" class="headerlink" title="[ r ]"></a>[ r ]</h5><p><code>[r]</code>：有两种发音。在母音前，发音是<code>入</code>，有点像我家乡话“输了”中的“输”。在母音后，发音是<code>e</code>的翘舌音，感受字母<code>Rr [ar]</code>的发音。</p>
<h5 id="w"><a href="#w" class="headerlink" title="[ w ]"></a>[ w ]</h5><p><code>[w]</code>：发音是<code>wū</code>，轻声。嘴巴不要嘟起来。</p>
<h5 id="j"><a href="#j" class="headerlink" title="[ j ]"></a>[ j ]</h5><p><code>[j]</code>：发音是<code>yī</code>，轻声。</p>
<h4 id="易混淆发音-1"><a href="#易混淆发音-1" class="headerlink" title="易混淆发音"></a>易混淆发音</h4><table>
<thead>
<tr>
<th>one</th>
<th>two</th>
<th>one</th>
<th>two</th>
</tr>
</thead>
<tbody><tr>
<td><code>[s]</code></td>
<td><code>[θ]</code></td>
<td><code>[z]</code></td>
<td><code>[ð]</code></td>
</tr>
<tr>
<td>pa<strong>ss</strong></td>
<td>pa<strong>th</strong></td>
<td>si<strong>z</strong>e</td>
<td>scy<strong>th</strong>e</td>
</tr>
<tr>
<td><strong>s</strong>ink</td>
<td><strong>th</strong>ink</td>
<td>clo<strong>s</strong>ed</td>
<td>clo<strong>th</strong>ed</td>
</tr>
<tr>
<td><strong>s</strong>um</td>
<td><strong>th</strong>umb</td>
<td>bay<strong>s</strong></td>
<td>ba<strong>th</strong>e</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>[l]</code></td>
<td><code>[r]</code></td>
<td><code>[s]</code></td>
<td><code>[ʃ]</code></td>
</tr>
<tr>
<td><strong>l</strong>ead</td>
<td><strong>r</strong>ead</td>
<td><strong>s</strong>ip</td>
<td><strong>sh</strong>ip</td>
</tr>
<tr>
<td>f<strong>l</strong>ea</td>
<td>f<strong>r</strong>ee</td>
<td><strong>s</strong>eat</td>
<td><strong>sh</strong>eet</td>
</tr>
<tr>
<td>c<strong>l</strong>oud</td>
<td>c<strong>r</strong>owd</td>
<td><strong>s</strong>ee</td>
<td><strong>sh</strong>e</td>
</tr>
</tbody></table>
<h2 id="UNIT-2-拼读练习"><a href="#UNIT-2-拼读练习" class="headerlink" title="UNIT 2   拼读练习"></a>UNIT 2   拼读练习</h2><p>拼读原则是：<strong>子音+母音</strong>，即<strong>后母接前子</strong>。</p>
<p><strong>规则：</strong>在接下来的所有练习中，画删除线<del>D</del>表示不发音，斜体<em>D</em>为母音，加粗<strong>D</strong>表示前后两个斜体的字母音连读。</p>
<p>PS：typora中的<code>markdown</code>语法github和博客有好多不支持/(ㄒoㄒ)/~~，规则只能这么来了。</p>
<h3 id="举例学习"><a href="#举例学习" class="headerlink" title="举例学习"></a>举例学习</h3><h4 id="i-gt"><a href="#i-gt" class="headerlink" title="[ i ] =&gt;"></a>[ i ] =&gt;</h4><ol>
<li>w<strong>e</strong> <code>[wi]</code></li>
<li>s<strong>ee</strong><code>[si]</code></li>
<li>thr<strong>ee</strong><code>[θri]</code></li>
</ol>
<p>当只有一个母音在一个单词里面出现时，母音都会是四声，子音为轻声，所以母音读音听起来明显。</p>
<ol start="4">
<li>bunny<code>[&#39;bʌni]</code></li>
<li>f<strong>ie</strong>ld<code>[fild]</code></li>
</ol>
<p>当两个及以上的母音出现的时候，一定会标重音记号来指示哪个音重，中文有四个声调，英文是轻重音（强弱音），加重音记号声音较重，可以念为中文的一声。</p>
<ol start="6">
<li>We see three bunnies in the field.</li>
</ol>
<p>一个英文句子，无论长短，从第一个单词都最后一个单词的发音，会互相干扰，而且一个句子还要强调轻重音，不仅仅一个单词里需要强调，句子中也需要强调孰重孰轻。不过句子中的轻重音没有固定的，是要看自己要强调什么。如上面的句子，假如要强调三只，那么<code>three</code>就是重音；假如强调<code>field</code>，那么它就是重音。</p>
<p>单词组成一个句子，单词分为两种：</p>
<ul>
<li>机能语：有功用的，有中文解释</li>
<li>非机能语：有中文解释，但有时候不翻译出来也没关系。如<code>I like a dog</code>，翻译是我喜欢狗，不是我喜欢一只狗（两只就不喜欢）。</li>
</ul>
<p>像介系词或冠词，都是非机能语，一般不会读重音，也不会翻译，除非你要特别强调它。</p>
<p>比如序号6这个句子，<code>in</code>和<code>the</code>的读音很轻，基本上一带而过。听一句话，听其中的重音就是要表达强调的部分；讲一句话也是如此，要强调的讲重音。</p>
<h4 id="I-gt"><a href="#I-gt" class="headerlink" title="[ I ]  =&gt;"></a>[ I ]  =&gt;</h4><ol>
<li>T<em>i</em>m <code>[tIm]</code></li>
<li>gr<em>i</em>ll <code>[grill]</code></li>
<li>six <code>[sIks]</code></li>
<li>fish <code>[fIʃ]</code></li>
<li>Tim grilled six fish.</li>
</ol>
<p>过去式<code>ed</code>的发音与结尾音有关，结尾为有声子音，发<code>[d]</code>，也是有声发音。</p>
<h4 id="e-gt"><a href="#e-gt" class="headerlink" title="[ e ] =&gt;"></a>[ e ] =&gt;</h4><ol>
<li><p>May <code>[me]</code></p>
</li>
<li><p>bake <code>[bake]</code></p>
</li>
<li><p>eight <code>[eight]</code></p>
<p><code>gh</code>在一个单里面出现是不发音的。</p>
</li>
<li><p>cake <code>[kek]</code></p>
</li>
<li><p>May baked eight cakes.</p>
</li>
</ol>
<p>过去式<code>ed</code>，结尾为无声子音，<code>d</code>发音是上下对应的<code>[t]</code>，也是无声发音。总结就是，发音时，无声跟无声，有声跟有声。这样方便发音，反过来发音体会一下。</p>
<p>名词复数也是同样的拼读原则。<code>cakes</code>结尾音为<code>[k]</code>，无声，加<code>s</code>的发音也是无声<code>[s]</code>。</p>
<h4 id="ε-gt"><a href="#ε-gt" class="headerlink" title="[ ε ] =&gt;"></a>[ ε ] =&gt;</h4><ol>
<li>Ted <code>[tεd]</code></li>
<li>help <code>[hεlp]</code></li>
<li>them <code>[ðεm]</code></li>
<li>sell <code>[sεl]</code></li>
<li>seven <code>[‘sevən]</code></li>
<li>egg <code>[εg]</code></li>
<li>Ted helped them sell  seven eggs.</li>
</ol>
<p><code>th</code>在一起90%的发音是<code>[θ]</code>和<code>[ð]</code></p>
<h4 id="ae-gt"><a href="#ae-gt" class="headerlink" title="[ æ ] =&gt;"></a>[ æ ] =&gt;</h4><ol>
<li>that <code>[ðæt]</code></li>
<li>man <code>[mæn]</code></li>
<li>cast <code>[kðst]</code></li>
<li>glame <code>[glæns]</code></li>
<li>at <code>[æt]</code></li>
<li>cat <code>[kæt]</code></li>
<li>The man cas<strong>t a</strong> glame at the cat.</li>
</ol>
<h4 id="a-gt"><a href="#a-gt" class="headerlink" title="[ a ] =&gt;"></a>[ a ] =&gt;</h4><ol>
<li><p>watch <code>[watʃ]</code></p>
</li>
<li><p>are <code>[ar]</code></p>
<p>单词结尾是<code>e</code>，<code>e</code>是不发音的</p>
</li>
<li><p>not <code>[nat]</code></p>
</li>
<li><p>clock <code>[klak]</code></p>
</li>
<li><p>Watches are not clocks.</p>
<p><code>watches</code>中的<code>es</code>的发音为<code>[Iz]</code>，其中<code>[tʃ]</code>和<code>[I]</code>是可拼读的。</p>
</li>
<li><p>A watch is not a clock.</p>
</li>
</ol>
<h3 id="o-gt"><a href="#o-gt" class="headerlink" title="[ o ] =&gt;"></a>[ o ] =&gt;</h3><ol>
<li><p>those <code>[ðoz]</code></p>
</li>
<li><p>owner <code>[&#39;onɝ]</code></p>
<p><code>er</code>有两个发音，<code>[ɝ]</code>和<code>[ɚ]</code>。<code>o</code>单独发音，<code>[nɝ]</code></p>
</li>
<li><p>row <code>[row]</code></p>
</li>
<li><p>old <code>[old]</code></p>
</li>
<li><p>boat <code>[bot]</code></p>
</li>
<li><p>Those owners rowed old boats.</p>
</li>
</ol>
<hr>
<p>参考链接：</p>
<ol>
<li><a href="https://en-yinbiao.xiao84.com/2014/1277.html" target="_blank" rel="noopener">https://en-yinbiao.xiao84.com/2014/1277.html</a></li>
<li><a href="https://en-yinbiao.xiao84.com/KK/" target="_blank" rel="noopener">https://en-yinbiao.xiao84.com/KK/</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">Node的简介与模块机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-01 14:20:10" itemprop="dateCreated datePublished" datetime="2019-04-01T14:20:10+08:00">2019-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Node的简介与模块机制"><a href="#Node的简介与模块机制" class="headerlink" title="Node的简介与模块机制"></a>Node的简介与模块机制</h1><blockquote>
<p>阅读《深入浅出Node.js》</p>
</blockquote>
<h2 id="Node简介"><a href="#Node简介" class="headerlink" title="Node简介"></a>Node简介</h2><h3 id="Node的由来"><a href="#Node的由来" class="headerlink" title="Node的由来"></a>Node的由来</h3><p>Node.js的作者是Ryan Dahl，是一名C/C++程序员，他发现高性能Web服务器主要有几个要点：事件驱动、非阻塞I/O。所以他最初的目的就是写一个基于事件驱动、非阻塞I/O的Web服务器，以达到更高的性能。</p>
<p>在实现Node时，Ryan Dahl评估过<code>C</code>、<code>Lua</code>、<code>Haskell</code>、<code>Ruby</code>等语言作为备选，结论为：<code>C</code>门槛过高，<code>Lua</code>自身存在许多阻塞I/O库，<code>Haskell</code>作者觉得自己不足以玩转，<code>Ruby</code>的虚拟机性能不好。相比之下，JavaScript比C的开发门槛低，比Lua的历史包袱少，又逢Chrome的V8引擎性能优秀。考虑到<strong>高性能</strong>、<strong>符合事件驱动</strong>、<strong>没有历史包袱</strong>，JavaScript成为了Node的实现语言。</p>
<p>Chrome浏览器和Node的组件构成如图。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B601.png" alt=""></p>
<p>除了<code>HTML</code>、<code>WebKit</code>和显卡这些UI相关技术没有支持外，Node的结构与Chrome十分相似。他们都是基于事件驱动的异步架构，浏览器通过事件驱动来服务界面上的交互，Node通过事件驱动来服务I/O。</p>
<h3 id="Node的特点"><a href="#Node的特点" class="headerlink" title="Node的特点"></a>Node的特点</h3><h4 id="异步I-O"><a href="#异步I-O" class="headerlink" title="异步I/O"></a>异步I/O</h4><p>异步调用中对于结果值的捕获符合<strong>Don`t call me, I will call you</strong>的原则，这也是注重结果，不关心过程的一种表现。经典的Ajax调用如下：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B602.png" alt=""></p>
<p>在Node中，异步I/O也很常见。与前端的Ajax调用方式类似：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'/path'</span>, (err, file) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'读取文件完成'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'发起读取文件'</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B603.png" alt=""></p>
<p>在Node中，绝大多数的操作都是以异步的方式进行调用。对于异步I/O,两个文件读取任务的耗时取决于最慢的那个文件读取耗时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'/path1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, file</span>) </span>&#123; 	     	<span class="built_in">console</span>.log(<span class="string">'读取文件1完成'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">fs.readFile(<span class="string">'/path2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, file</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'读取文件2完成'</span>); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>对于同步I/O而言，他们的耗时是两个任务的耗时之和。</p>
<h4 id="事件与回调函数"><a href="#事件与回调函数" class="headerlink" title="事件与回调函数"></a>事件与回调函数</h4><p>Node创建一个Web服务器，并侦听8080端口。对于服务器，我们为它绑定了<code>request</code>事件，对于请求对象，我们为它绑定了<code>data</code>和<code>end</code>事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="comment">// 服务器的request事件 </span></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> postData = <span class="string">''</span>; req.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    <span class="comment">// 请求的data事件 </span></span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">trunk</span>) </span>&#123;</span><br><span class="line">        postData += trunk; </span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 请求的end事件 </span></span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.end(postData); </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).listen(<span class="number">8080</span>); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'服务器启动完成'</span>);</span><br></pre></td></tr></table></figure>

<p>事件的编程方式具有轻量级、松耦合、只关注事务点等优势；JS中回调函数无处不在，这是因为JS中，我们将函数作为第一等公民来对待，可以将函数作为对象传递给方法作为实参进行调用。</p>
<h4 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h4><p>Node保持了JavaScript在浏览器中单线程的特点。在Node中，JavaScript与其余线程是无法共享任何状态的。</p>
<p>单线程的最大优点：不用像多想成那样处处在意状态的同步问题，没有思索的存在，也没有线程上下文交换所带来的性能上的开销。同样，缺点也存在：无法利用多核CPU；错误会引起整个应用退出，应用的健壮性值得考验；大量计算占用CPU导致无法继续调用异步I/O。</p>
<h4 id="跨平台"><a href="#跨平台" class="headerlink" title="跨平台"></a>跨平台</h4><p>Node兼容<code>Windows</code>和<code>*nix</code>平台主要得益于它在架构层面的改动，它在操作系统与Node上层模块系统之间构面了一层平台层架构，即<code>libuv</code>。Node基于libuv实现跨平台的架构如下图：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B604.png" alt=""></p>
<h2 id="Node模块机制"><a href="#Node模块机制" class="headerlink" title="Node模块机制"></a>Node模块机制</h2><p>JavaScript先天缺乏一项功能：模块；在其他语言中，<code>Java</code>有类文件，<code>Python</code>有<code>import</code>机制，<code>Ruby</code>有<code>require</code>，<code>PHP</code>有<code>include</code>和<code>require</code>。在<code>JavaScript</code>发展过程中，社区为它指定了相应的规范，其中<code>CommonJS</code>规范的提出是非常重要的。</p>
<h3 id="CommonJS的出发点"><a href="#CommonJS的出发点" class="headerlink" title="CommonJS的出发点"></a>CommonJS的出发点</h3><p>CommonJS规范的提出，主要是为了弥补当前JavaScript应用中没有标准的缺陷，以达到像<code>Python</code>、<code>Ruby</code>和<code>Java</code>具备开发大型应用的基础能力，而不是停留在小脚本程序的阶段。</p>
<p>如今，CommonJS规范已初显成效，为JavaScript发展指明了一条非常棒的道路。这些规范涵盖了模块、二进制、Buffer、字符集编码、I/O流、进程环境、文件系统、套接字、单元测试、Web服务器网关接口、包管理等。</p>
<p>Node与浏览器以及W3C组织、CommonJS组织、ESMAScript之间的关系如下图：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B605.png" alt=""></p>
<p>Node借鉴CommonJS的Module规范实现了一套非常易用的模块系统，NPM对Packages规范的完好支持使得Node应用在开发过程中事半功倍。</p>
<h3 id="CommonJS的模块规范"><a href="#CommonJS的模块规范" class="headerlink" title="CommonJS的模块规范"></a>CommonJS的模块规范</h3><p>CommonJS对模块的定义十分简单，主要分为模块引用、模块定义和模块标识3个部分。</p>
<h4 id="1-模块引用"><a href="#1-模块引用" class="headerlink" title="1.模块引用"></a>1.模块引用</h4><p>模块引用的示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br></pre></td></tr></table></figure>

<p>在CommonJS规范中，存在<code>require()</code>方法，这个方法接受模块标识，以此引用一个模块的API到当前上下文中。</p>
<h4 id="2-模块定义"><a href="#2-模块定义" class="headerlink" title="2.模块定义"></a>2.模块定义</h4><p>对应引入功能，上下文提供了<code>exports</code>对象用于导出当前模块的方法或者变量，并且它是唯一导出的出口。在模块中，还存在一个<code>module</code>对象，它代表模块自身，而<code>exports</code>是<code>module</code>的属性。在Node中，一个文件就是一个模块，将方法挂在在<code>exports</code>对象上作为属性即可定义导出的方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.js</span></span><br><span class="line">exports.add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> sum = <span class="number">0</span>, i = <span class="number">0</span>,</span><br><span class="line">	args = <span class="built_in">arguments</span>,</span><br><span class="line">    l = args.length;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; l) &#123;</span><br><span class="line">        sum += args[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在另一个文件中<code>require()</code>方法引入模块后，就能调用定义的属性和方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// program.js</span></span><br><span class="line"><span class="keyword">const</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>); </span><br><span class="line">exports.increment = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> math.add(val, <span class="number">1</span>); </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-模块标识"><a href="#3-模块标识" class="headerlink" title="3.模块标识"></a>3.模块标识</h4><p>模块标识其实就是传递给<code>require()</code>方法的参数，它必须是符合小驼峰命令的字符串，或者以<code>.</code>、<code>..</code>开头的相对路径，或者绝对路径。</p>
<p>模块的意义在于将类聚的方法和变量等限定在私有的作用域中，同时支持引入和导出功能以顺畅地连接上下游依赖。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B606.png" alt=""></p>
<p>CommonJS构建的这套模块导出和引入机制使得用户完全不必考虑变量污染。</p>
<h3 id="Node的模块实现"><a href="#Node的模块实现" class="headerlink" title="Node的模块实现"></a>Node的模块实现</h3><p>Node在实现中并非完全按照规范实现，而是对模块规范进行了一定的取舍，同时也增加了少许自身需要的特性。</p>
<p>在Node中引入模块要经历步骤：路径分析；文件定位；编译执行。</p>
<p>模块分为两类：一类是Node提供的模块，成为<strong>核心模块</strong>；另一类是用户编写的模块，称为<strong>文件模块</strong>。</p>
<ul>
<li>核心模块部分在Node源代码的编译过程中，编译进了二进制执行文件。在Node进程启动时，部分核心模块就被直接加载进内存中，所以这部分核心模块被引入时，文件定位和编译执行这两个步骤可以省略掉，并且在路径分析中优先判断，所以它的加载速度是最快的。</li>
<li>文件模块则是在运行时动态加载，需要完整的路径分析、文件定位、编译执行过程，速度比核心模块慢。</li>
</ul>
<h4 id="模块加载过程"><a href="#模块加载过程" class="headerlink" title="模块加载过程"></a>模块加载过程</h4><p>与前端浏览器会缓存静态脚本文件性能一样，Node对引入的模块都会进行缓存，以减少二次引入时的开销。不同的地方在于，浏览器仅仅缓存文件，而Node缓存的是编译和执行之后的对象。</p>
<p>不论是核心模块还是文件模块，<code>require()</code>方法对相同模块的二次加载都一律采用缓存优先的方式。不同的是核心模块的缓存检查先于文件模块的缓存检查。</p>
<h4 id="路径分析"><a href="#路径分析" class="headerlink" title="路径分析"></a>路径分析</h4><p>对于不同的标识符，即模块标识，模块的查找和定位有不同程度上的差异。</p>
<p>在Node的实现中，基于<code>require()</code>方法接受一个标识符作为参数进行模块查找。模块标识符查找主要分为以下几类：</p>
<ul>
<li>核心模块，如<code>http</code>、<code>fs</code>、<code>path</code>等。</li>
<li><code>.</code>或<code>..</code>开始的相对路径文件模块。</li>
<li>以<code>/</code>开始的绝对路径文件模块。</li>
<li>非路径形式的文件模块，如自定义的<code>connect</code>模块。</li>
</ul>
<h5 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h5><p>核心模块的优先级仅次于缓存加载，它在Node的源代码编译过程中已经编译为二进制代码，其加载过程最快。</p>
<p>如果试图加载一个与核心模块标识符相同的自定义模块，是不会成功的。如果自己编写了一个http用户模块，想要加载成功，必须选择一个不同的标识符或者换用路径的方式。</p>
<h5 id="路径形式的文件模块"><a href="#路径形式的文件模块" class="headerlink" title="路径形式的文件模块"></a>路径形式的文件模块</h5><p>以<code>.</code>、<code>..</code>和<code>/</code>开始的标识符，这里都被当做文件模块来处理。在分析路径模块时，<code>require()</code>方法会将路径转换为真实路径，并以真实路径作为索引，将编译执行后的结果放到缓存中，以使二次加载时更快。</p>
<p>由于文件模块给Node指明了确切的文件位置，所以在查找过程中可以节约大量时间，其加载速度慢于核心模块。</p>
<h5 id="自定义模块"><a href="#自定义模块" class="headerlink" title="自定义模块"></a>自定义模块</h5><p>自定义模块指的是非核心模块，也不是路径形式的标识符。它是一种特殊的文件模块，可能是一个文件或者包的形式。这类模块的查找是所有方式中最慢的一种。</p>
<p><strong>模块路径</strong></p>
<p>了解自定义模块前，首先要了解一下模块路径，模块路径是Node在定位文件模块的具体文件时指定的查找策略，具体表现为一个路径组成的数组。</p>
<p>路径的生成规则如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在任意一个文件中执行</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.paths);</span><br></pre></td></tr></table></figure>

<p>得到如下结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="string">'/Users/andy/Work/node/mcee_v2/platform/BulletAnt/node_modules'</span>,  <span class="string">'/Users/andy/Work/node/mcee_v2/platform/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/andy/Work/node/mcee_v2/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/andy/Work/node/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/andy/Work/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/andy/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/node_modules'</span>,</span><br><span class="line">  <span class="string">'/node_modules'</span> </span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>可以看出，模块路径的生成规则如下：</p>
<ul>
<li>当前文件目录下的<code>node_modules</code>目录。</li>
<li>父目录下的<code>node_modules</code>目录。</li>
<li>父目录的父目录下的<code>node_modules</code>目录。</li>
<li>沿路径向上逐级递归，直到根目录下的<code>node_modules</code>目录。</li>
</ul>
<p>它的生成方式与JavaScript的原型链或作用域链的查找方式十分类似。在加载过程中，Node会逐个尝试模块路径中的路径，直到找到目标文件位置。可以看出，当前文件的路径越深，模块查找耗时会越多，这是自定义模块的加载速度是最慢的原因。</p>
<h4 id="文件定位"><a href="#文件定位" class="headerlink" title="文件定位"></a>文件定位</h4><p>文件定位过程中，有一些细节要注意，主要包括文件扩展名的分析、目录和包的处理。</p>
<h5 id="文件扩展名分析"><a href="#文件扩展名分析" class="headerlink" title="文件扩展名分析"></a>文件扩展名分析</h5><p><code>require()</code>在分析标识符过程中，会出现标识符中不包含文件扩展名的情况，这种情况下，Node会依次尝试<code>.js</code>、<code>.json</code>、<code>.node</code>的次序补足扩展名。</p>
<p>在尝试过程中，需要调用<code>fs</code>模块同步阻塞式地判断文件是否存在。因为Node是单线程的，所以这里是一个会引起性能问题的地方。</p>
<h5 id="目录分析和包"><a href="#目录分析和包" class="headerlink" title="目录分析和包"></a>目录分析和包</h5><p>在分析标识符的过程中，<code>require()</code>通过分析文件扩展名之后，可能没有查找到对应文件，但却得到一个目录，这在引入自定义模块和逐个模块路径进行查找时经常会出现，此时Node会将目 录当做一个包来处理。 </p>
<p>在这个过程中，Node对CommonJS包规范进行了一定程度的支持。首先，Node在当前目录下查找<code>package.json</code> (CommonJS包规范定义的包描述文件），通过<code>JSON.parse()</code>解析出包描述对象， 从中取出<code>main</code>属性指定的文件名进行定位。如果文件名缺少扩展名，将会进入扩展名分析的步骤。 而如果<code>main</code>属性指定的文件名错误，或者压根没有<code>package.json</code>文件，Node会将<code>index</code>当做默 认文件名，然后依次查找<code>index.js</code>、<code>index.json</code>、<code>index.node</code>。 </p>
<p>如果在目录分析的过程中没有定位成功任何文件，则自定义模块进入下一个模块路径进行查找。如果模块路径数组都被遍历完毕，依然没有查找到目标文件，则会拋出查找失败的异常。</p>
<h4 id="模块编译"><a href="#模块编译" class="headerlink" title="模块编译"></a>模块编译</h4><p>在Node中，每个文件模块都是一个对象，它的定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Module</span>(<span class="params">id, parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">    <span class="keyword">this</span>.exports = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    <span class="keyword">if</span>(parent &amp;&amp; parent.children) &#123;</span><br><span class="line">        parent.children.push(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.filename = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.loaded = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.children = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译和执行是引入文件模块的最后一个阶段。定位到具体的文件后，Node会新建一个模块对象，然后根据路径载入并编译。</p>
<p>对于不同的文件扩展名，其载入方法也有所不同，具体如下：</p>
<ul>
<li><code>.js</code>文件。通过<code>fs</code>模块同步读取文件后编译执行。</li>
<li><code>.node</code>文件。这是用<code>C/C++</code>编写的扩展文件，通过<code>dlopen()</code>方法加载最后编译生成的文件。</li>
<li><code>.json</code>文件。通过<code>fs</code>模块同步读取文件后，<code>JSON.parse()</code>解析返回结果。</li>
<li>其余扩展名文件。都会被当做<code>.js</code>文件载入。</li>
</ul>
<p>每一个编译成功的模块都会将其文件路径作为索引缓存在<code>Module._cache</code>对象上，以提高二次引入的性能。</p>
<p>根据不同的文件扩展名，Node会调用不同的读取方式，如<code>.json</code>文件的调用如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Native extension for .json</span></span><br><span class="line">Module._extensions[<span class="string">'.json'</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">module, filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> content = NativeModule.require(<span class="string">'fs'</span>).readFileSync(filename, <span class="string">'utf8'</span>); </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="built_in">JSON</span>.parse(stripBOM(content));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        err.message = filename + <span class="string">': '</span> + err.message; </span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其中，<code>Module._extensions</code>会被赋值给<code>require()</code>的<code>extensions</code>属性，所以通过在代码中访问<code>require.extensions</code>可以知道系统中已有的扩展加载方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">require</span>.extensions); <span class="comment">// &#123; '.js': [Function], '.json': [Function], '.node': [Function] &#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="JavaScript模块的编译"><a href="#JavaScript模块的编译" class="headerlink" title="JavaScript模块的编译"></a>JavaScript模块的编译</h5><p>在<code>CommonJs</code>模块规范中，每个模块文件中都存在<code>require</code>、<code>exports</code>、<code>module</code>这3个变量，但是他们在模块文件中并没有定义，在Node的Api文档中，每个模块有<code>__filename</code>、<code>__dirname</code>这两个变量，他们从何而来？</p>
<p>事实上，在编译过程中，Node对获取的JavaScript文件内容进行了头尾包装。一个正常的JavaScript文件都会被包装成如下样子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br><span class="line">    exports.area = <span class="function"><span class="keyword">function</span> (<span class="params">radius</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.PI * radius * radius;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样每个模块文件都进行了作用域隔离。包装之后的代码会通过<code>vm</code>原生模块的<code>runInThisContext()</code>方法执行（类似<code>eval</code>，只是具有明确上下文，不污染全局），返回一个具体的<code>function</code>对象。最后，将当前模块对象的<code>exports</code>属性、<code>require()</code>方法、<code>module</code>（模块对象自身），以及在文件定位中得到的完整文件路径和文件目录作为参数传递给这个<code>function()</code>执行。</p>
<p>这就是这些变量并没有定义在每个模块文件中却存在的原因。在执行后，模块的<code>exports</code>属性被返回给了调用方。<code>exports</code>属性上的任何方法和属性都可以被外部调用到，但是模块中的其余变量或属性则不可直接被调用。</p>
<h5 id="C-C-模块的编译"><a href="#C-C-模块的编译" class="headerlink" title="C/C++模块的编译"></a>C/C++模块的编译</h5><p>Node调用<code>process.dlopen()</code>方法进行加载和执行。在Node的架构下，<code>dlopen()</code>方法在Windows和*nix平台下分别有不同的实现，通过<code>libuv</code>兼容层进行了封装。</p>
<p>实际上，<code>.node</code>的模块文件不需要编译，因为它是编写<code>C/C++</code>模块之后编译生成的，所以这里只有加载和执行的过程。在执行的过程中，模块的<code>exports</code>对象与<code>.node</code>模块产生联系，然后返回给调用者。</p>
<h5 id="JSON文件的编译"><a href="#JSON文件的编译" class="headerlink" title="JSON文件的编译"></a>JSON文件的编译</h5><p><code>.josn</code>文件的编译是3种编译方式中最简单的。Node利用<code>fs</code>模块同步读取<code>JSON</code>文件的内容之后，调用<code>JSON.parse()</code>方法得到对象，然后将它赋值给模块对象的<code>exports</code>，以供外部调用。</p>
<p>这里我们提到的模块编译都是指文件模块，即用户自己编写的模块。接下来介绍核心模块中的<code>JavaScript</code>模块和<code>C/C++</code>模块。</p>
<h3 id="核心模块-1"><a href="#核心模块-1" class="headerlink" title="核心模块"></a>核心模块</h3><p>核心模块分<code>C/C++</code>和<code>JS</code>编写的两部分，其中<code>C/C++</code>存放在Node项目的<code>src</code>目录下，<code>JavaScript</code>文件存放在<code>lib</code>目录下。</p>
<h4 id="JavaScript核心模块的编译过程"><a href="#JavaScript核心模块的编译过程" class="headerlink" title="JavaScript核心模块的编译过程"></a>JavaScript核心模块的编译过程</h4><p>在编译所有<code>C/C++</code>文件之前，编译程序需要将所有的<code>JavaScript</code>模块文件编译为<code>C/C++</code>代码。此时并不是直接将其编译为可执行代码，要经过两步：</p>
<p><strong>1. 转存为C/C++代码</strong></p>
<p>Node才用了V8附带的<code>js2c.py</code>工具，将所有内置的<code>JavaScript</code>代码（<code>src/node.js</code>和<code>lib/*.js</code>）转换成C++里的数组，生成<code>node_natives.h</code>头文件，相关代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> node</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> node_native[] = &#123;<span class="number">47</span>, <span class="number">47</span>, ..&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> dgram_native[] = &#123;<span class="number">47</span>, <span class="number">47</span>, ..&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> console_native[] = &#123;<span class="number">47</span>, <span class="number">47</span>, ..&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> buffer_native[] = &#123;<span class="number">47</span>, <span class="number">47</span>, ..&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> querystring_native[] = &#123;<span class="number">47</span>, <span class="number">47</span>, ..&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> punycode_native[] = &#123;<span class="number">47</span>, <span class="number">42</span>, ..&#125;;</span><br><span class="line">    ... </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">native</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *name;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *source;</span><br><span class="line">        <span class="keyword">size_t</span> source_len;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">native</span> <span class="title">natives</span>[] = &#123;</span></span><br><span class="line">        &#123;<span class="string">"node"</span>, node_native, <span class="keyword">sizeof</span>(node_native) - <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">"dgram"</span>, dgram_native, <span class="keyword">sizeof</span>(dgram_native) - <span class="number">1</span>&#125;,</span><br><span class="line">        ...</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在此过程中，<code>JavaScript</code>代码以字符串的形式存储在<code>node</code>命令空间中，是不可直接执行的。在启动Node进程时，JavaScript代码直接加载进内存中。在加载的构成中，JavaScript核心模块经历标识符分析后直接定位到内存中，比普通的文件模块从磁盘中一处一处查找要快很多。</p>
<p><strong>2.编译JavaScript核心模块</strong></p>
<p><code>lib</code>目录下的所有模块文件也没有定义<code>require</code>、<code>module</code>、<code>exports</code>这些变量，在引入JavaScript核心模块的过程中，也经历了头尾包装的过程，然后才执行和导出了<code>exports</code>对象。</p>
<p>与文件模块有区别的地方在于：获取源代码的方式（核心模块是从内存中加载的）以及缓存执行结果的位置。</p>
<p>Javascript核心模块的定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NativeModule</span>(<span class="params">id</span>) </span>&#123; 	</span><br><span class="line">    <span class="keyword">this</span>.filename = id + <span class="string">'.js'</span>; </span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">	<span class="keyword">this</span>.exports = &#123;&#125;; </span><br><span class="line">    <span class="keyword">this</span>.loaded = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">NativeModule._source = process.binding(<span class="string">'natives'</span>); NativeModule._cache = &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>源文件通过<code>process.binding(&#39;natives&#39;)</code>取出，编译成功的模块缓存到<code>NativeModule._cache</code>对象上。</p>
<h4 id="C-C-核心模块的编译过程"><a href="#C-C-核心模块的编译过程" class="headerlink" title="C/C++核心模块的编译过程"></a>C/C++核心模块的编译过程</h4><p>在核心模块中，有些模块全部由<code>C/C++</code>编写，有些则由<code>C/C++</code>完成核心部分，其他部分则由<code>JavaScript</code>实现包装或向外导出，以满足性能要求。后者是Node提高性能的常见方式。</p>
<p>这里将那些由纯<code>C/C++</code>编写的部分统一称为内建模块，因为它们通常不被用户直接调用。Node的<code>buffer</code>、<code>crypto</code>、<code>evals</code>、<code>fs</code>、<code>os</code>等模块都是部分通过<code>C/C++</code>编写的。</p>
<p>内建模块的优势在于：首先，它们本身由<code>C/C++</code>编写，性能优于脚本语言；其次，在进行文件编译时，它们被编译进二进制文件。一旦Node开始执行，它们直接被加载进内存中，无需再次标识符定位、文件定位、编译等过程，直接就可执行。</p>
<p>在Node的所有模块类型中，存在着一种依赖层级关系，即文件模块可能会依赖核心模块，核心模块可能会依赖内建模块。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B607.png" alt=""></p>
<p>通常不推荐直接调用内建模块。如需调用，直接调用核心模块即可，因为核心模块基本都封装了内建模块。</p>
<p>内建模块将内部变量或方法导出，是如何做到的？</p>
<p>Node在启动时，会生成一个全局变量<code>process</code>，并提供<code>Binding()</code>方法来协助加载内建模块。<code>Binding()</code>的实现代码在<code>src/node.cc</code>中。</p>
<p>注：具体代码内容阅读《深入浅出Node.js》</p>
<h4 id="核心模块的引入流程"><a href="#核心模块的引入流程" class="headerlink" title="核心模块的引入流程"></a>核心模块的引入流程</h4><p>如图是原生模块的引入流程，为符合<code>CommonJS</code>模块规范，从JavaScript到C/C++过程是相当复杂的，它要经历<code>C/C++</code>层面的内建模块定义、<code>JavaScript</code>核心模块的定义和引入以及(JavaScript)文件模块层面的引入。但对于用户来说，<code>require()</code>十分简洁友好。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B608.png" alt=""></p>
<h3 id="C-C-扩展模块"><a href="#C-C-扩展模块" class="headerlink" title="C/C++扩展模块"></a>C/C++扩展模块</h3><blockquote>
<p>P27</p>
</blockquote>
<h3 id="模块调用栈"><a href="#模块调用栈" class="headerlink" title="模块调用栈"></a>模块调用栈</h3><p>文件模块、核心模块、内建模块、C/C++扩展模块之间的调用关系如图：</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/JavaScript/Node%E7%9A%84%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B609.png" alt=""></p>
<p>C/C++内建模块属于最底层的模块，它属于核心模块，主要提供API给<code>JavaScript</code>核心模块和第三方JavaScript文件模块调用。</p>
<p>JavaScript核心模块主要扮演的职责有两类：一类是作为C/C++内建模块的封装层和桥接层，供文件模块调用；一类是纯粹的功能模块，它不需要跟底层打交道，但又十分重要。</p>
<p>文件模块通常由第三方编写，包括JavaScript模块和C/C++扩展模块，主要调用方向为普通JavaScript模块调用扩展模块。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/Network/Session%E5%92%8CCookie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/Network/Session%E5%92%8CCookie/" class="post-title-link" itemprop="url">Session和Cookie</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-12 12:03:10" itemprop="dateCreated datePublished" datetime="2019-03-12T12:03:10+08:00">2019-03-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Session和Cookie"><a href="#Session和Cookie" class="headerlink" title="Session和Cookie"></a>Session和Cookie</h1><p>HTTP协议是互联网上应用最广泛的一种网络协议，所有Web都必须遵守这个协议。由于HTTP协议是无状态的，服务器无从得知两次请求是否来自同一个用户，所以需要某种机制来区分用户。<code>Session</code>和<code>Cookie</code>就是常用的会话跟踪技术，<code>Cookie</code>通过在客户端记录信息确定用户身份，<code>Session</code>在服务器端记录用户信息确定用户身份。</p>
<p>用一个例子来说明两者之间的区别与联系：</p>
<p>假如去村口理发店找托尼老师理发，托尼老师告诉我们说理发5次免费送1次，本来五十块钱只能理5次，现在变成6次了，然而不可能直接被干5次，这时候，想象一下也就一下几种方案：</p>
<ol>
<li>托尼老师是个奇才，村里面找他理发的人只要一进去，他就知道这人理过几次，还剩几次，这次剃头是不是要收钱。这种做法是协议本身支持状态。</li>
<li>托尼老师给每个人发一张卡片，上面记录理发次数，一般托尼老师还搞一个期限。每次理发时，顾客出示这张卡片，则此次理发就会与以前或以后的理发消费相关联起来。这种做法是客户端保持状态。</li>
<li>托尼老师让大家办VIP卡，除了卡号之外什么信息也不记录，每次理发时出示卡片，托尼就会在理发店的记录本上找到这个卡号对应的记录添加一些消费信息。这种做法就是在服务器端保持状态。</li>
</ol>
<p>由于HTTP协议是无状态的，而出于种种考虑也不希望使之成为有状态的，因此，后面两种方案就成为现实的选择。具体来说<code>Cookie</code>机制采用的是在客户端保持状态的方案，而<code>Session</code>机制采用的是在服务器端保持状态的方案。同时我们也看到，由于采用服务器端保持状态的方案在客户端也需要保存一个标识，所以<code>Session</code>机制可能需要借助于<code>Cookie</code>机制来达到保存标识的目的，但实际上它还有其他选择。</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><h3 id="什么是Cookie"><a href="#什么是Cookie" class="headerlink" title="什么是Cookie"></a>什么是Cookie</h3><p><code>Cookie</code>意为小甜点，是由W3C组织提出，最早由<code>Netscape</code>社区发展的一种机制。</p>
<p><strong>Cookie的机制</strong>：<code>Cookie</code>分发是通过扩展<code>HTTP</code>协议来实现的，服务器通过在<code>HTTP</code>的响应头中加上一行特殊的指示以提示浏览器按照指示生成相应的<code>Cookie</code>。而<code>Cookie</code>的使用是由浏览器按照一定的原则在后台自动发送给服务器的。浏览器检查所有存储的<code>Cookie</code>，如果某个<code>Cookie</code>所声明的作用范围大于等于将要请求的资源所在的位置，则把该<code>Cookie</code>附在请求资源的<code>HTTP</code>请求头上发送给服务器。Cookie是一个很小的纯文本信息，它存储在客户端。</p>
<p>所以就是，由于HTTP是一种无状态协议，服务器但从网络上无从得知客户端身份，那么，给客户端颁发一个通行证，无论谁访问都需要携带通行证，此通行证对于每个人来说都是独一无二的，这样服务器就能够从通行证中确认客户端身份，针对不同的访问来做出不同的响应。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/NetWork/Session%E5%92%8CCookie01.png" alt=""></p>
<p>Cookie可以包含任意的信息，不仅仅是id，客户端会记录服务器返回来的<code>Set-Cookie</code>首部中的Cookie内容。并将Cookie存储在浏览器的Cookie数据库中，当用户访问同一站点时，浏览器就会挑选当时该站点颁发的<code>id=XXX</code>的身份证Cookie，并在Cookie请求首部发送过去。</p>
<h4 id="服务器发送Cookie给客户端"><a href="#服务器发送Cookie给客户端" class="headerlink" title="服务器发送Cookie给客户端"></a><strong>服务器发送Cookie给客户端</strong></h4><p>从服务器端，发送cookie给客户端，是对应的<code>Set-Cookie</code>。包括了对应的cookie的名称、值以及各个属性。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: lu=Rg3vHJZnehYLjVg7qi3bZjzg; Expires=Fri, 15 Mar 2019 01:45:01 GMT; Path=/; Domain=.ccbeango.com; HttpOnly</span><br><span class="line"></span><br><span class="line">Set-Cookie: made_write_conn=1295214458; Path=/; Domain=.ccbeango.com</span><br><span class="line"></span><br><span class="line">Set-Cookie: reg_fb_gate=deleted; Expires=Fri, 15 Mar 2019 01:45:01 GMT; Path=/; Domain=.ccbeango.com; HttpOnly</span><br></pre></td></tr></table></figure>

<h4 id="从客户端把Cookie发送到服务器"><a href="#从客户端把Cookie发送到服务器" class="headerlink" title="从客户端把Cookie发送到服务器"></a>从客户端把Cookie发送到服务器</h4><p>从客户端发送cookie给服务器的时候，是不发送cookie的各个属性的，而只是发送对应的名称和值。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1  </span><br><span class="line"></span><br><span class="line">Host: www.ccbeango.com  </span><br><span class="line"></span><br><span class="line">Cookie: name=value; name2=value2  </span><br><span class="line"></span><br><span class="line">Accept: */*</span><br></pre></td></tr></table></figure>

<h3 id="Cookie的类型"><a href="#Cookie的类型" class="headerlink" title="Cookie的类型"></a>Cookie的类型</h3><p>可以按照过期时间分为两类：会话cookie和持久cookie。会话cookie是一种临时cookie，用户退出浏览器，会话Cookie就会被删除了，持久cookie则会储存在硬盘里，保留时间更长，关闭浏览器，重启电脑，它依然存在，通常是持久性的cookie会维护某一个用户周期性访问服务器的配置文件或者登录信息。</p>
<p>持久cookie设置一个特定的过期时间（Expires）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id&#x3D;12345; Expires&#x3D;Wed, 21 Oct 2019 07:28:00 GMT;</span><br></pre></td></tr></table></figure>

<p>也可以设置有效期（Max-Age），这个是现在推荐使用的，在Cookie的属性中有介绍。</p>
<h3 id="Cookie的属性"><a href="#Cookie的属性" class="headerlink" title="Cookie的属性"></a>Cookie的属性</h3><p><strong>Cookie的域</strong></p>
<p>域表示当前Cookie所属于哪个域或子域下面。Cookie是不可跨域名的。域名<code>www.google.com</code>颁发的Cookie不会被提交到域名<code>www.baidu.com</code>去。这是由Cookie的隐私安全机制决定的。隐私安全机制能够禁止网站非法获取其他网站的Cookie。</p>
<p>对于服务器返回的Set-Cookie中，如果没有指定Domain的值，那么其Domain的值是默认为当前所提交的http的请求所对应的主域名的。比如访问<code>http://www.ccbeango.com</code>，返回一个cookie，没有指名domain值，那么其为值为默认的<code>http://www.ccbeango.com</code>。</p>
<p>正常情况下，同一个一级域名下的两个二级域名如<code>www.ccbeango.com</code>和<code>images.ccbeango.com</code>也不能交互使用<code>Cookie</code>，因为二者的域名并不严格相同。如果想所有<code>ccbeango.com</code>名下的二级域名都可以使用该<code>Cookie</code>，就需要设置<code>domain</code>参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: name="12345"; domain=".ccbeango.com"</span><br></pre></td></tr></table></figure>

<p>注意：<code>name</code>相同但<code>domain</code>不同的两个Cookie是两个不同的Cookie。如果想要两个域名完全不同的网站共有Cookie，可以生成两个Cookie，<code>domain</code>属性分别为两个域名，输出到客户端。</p>
<p><strong>Cookie的有效期</strong></p>
<p>Cookie的<code>maxAge</code>决定着Cookie的有效期，单位为秒（Second）。它的值可以为正数，表示此Cookie从创建到过期所能存在的时间，此Cookie会存储到客户端电脑，以Cookie文件形式保存，不论关闭浏览器或关闭电脑，直到时间到才会过期。 可以为负数，表示此Cookie只是存储在浏览器内存里，为临时性Cookie，只要关闭浏览器，此Cookie就会消失。<code>maxAge</code>默认值为<code>-1</code>。 还可以为<code>0</code>，表示从客户端电脑或浏览器内存中删除此Cookie。</p>
<p>要想修改Cookie只能使用一个同名的Cookie来覆盖原来的Cookie，达到修改的目的。删除时只需要把maxAge修改为<code>0</code>即可。</p>
<p>注意：从客户端读取Cookie时，包括maxAge在内的其他属性都是不可读的，也不会被提交。浏览器提交Cookie时只会提交<code>name</code>与<code>value</code>属性。maxAge属性只被浏览器用来判断Cookie是否过期。</p>
<p><strong>Cookie的Path</strong></p>
<p><code>domain</code>属性决定运行访问Cookie的域名，而<code>path</code>属性决定允许访问Cookie的路径<code>ContextPath</code>。如果设置为<code>/user/</code>，则只有<code>contextPath</code>为<code>/user</code>的程序可以访问该Cookie。如果设置为<code>/</code>，则本域名下<code>contextPath</code>都可以访问该Cookie。注意：最后一个字符必须为<code>/</code>。</p>
<p>例如：<code>www.ccbeango.com</code> 和 <code>www.ccbeango.com/user/</code>这两个url。 <code>www.ccbeango.com</code> 设置cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-cookie: id&#x3D;&quot;123432&quot;;domain&#x3D;&quot;www.ccbeango.com&quot;;</span><br></pre></td></tr></table></figure>

<p><code>www.ccbeango.com/user/</code> 设置cookie：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-cookie：user&#x3D;&quot;wang&quot;, domain&#x3D;&quot;www.ccbeango.com&quot;; path&#x3D;&#x2F;user&#x2F;</span><br></pre></td></tr></table></figure>

<p>访问其他路径<code>www.ccbeango.com/other/</code>会获得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookie: id&#x3D;&quot;123432&quot;</span><br></pre></td></tr></table></figure>

<p>但如果访问<code>www.ccbeango.com/user/</code>就会获得</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie: id&#x3D;&quot;123432&quot;</span><br><span class="line">cookie: user&#x3D;&quot;wang&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Cookie的secure</strong></p>
<p>HTTP协议不仅是无状态的，而且是不安全的。使用HTTP协议的数据不经过任何加密就直接在网络上传播，有被截获的可能。使用HTTP协议传输很机密的内容是一种隐患。如果不希望Cookie在HTTP等非安全协议中传输，可以设置Cookie的<code>secure</code>属性为<code>true</code>。浏览器只会在<code>HTTPS</code>和<code>SSL</code>等安全协议中传输此类Cookie。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=abcdefg; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure;</span><br></pre></td></tr></table></figure>

<p><strong>Cookie的httponly</strong></p>
<p>表示此cookie必须用于http或https传输。这意味着，浏览器脚本，比如javascript中，是不允许访问操作此cookie的。</p>
<p>Cookie是保存在浏览器端的，因此浏览器具有操作Cookie的先决条件。浏览器可以使用脚本程序如JavaScript或者VBScript等操作Cookie。这里以JavaScript为例介绍常用的Cookie操作。例如下面的代码会输出本页面所有的Cookie。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">document</span>.write(<span class="built_in">document</span>.cookie);&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于JavaScript能够任意地读写Cookie，有些好事者便想使用JavaScript程序去窥探用户在其他网站的Cookie。不过这是徒劳的，W3C组织早就意识到JavaScript对Cookie的读写所带来的安全隐患并加以防备了，W3C标准的浏览器会阻止JavaScript读写任何不属于自己网站的Cookie。换句话说，A网站的JavaScript程序读写B网站的Cookie不会有任何结果。</p>
<h3 id="第三方Cookie"><a href="#第三方Cookie" class="headerlink" title="第三方Cookie"></a>第三方Cookie</h3><p>通常<code>Cookie</code>的域和浏览器地址的域匹配，这被称为第一方Cookie。那么第三方Cookie就是Cookie的域和地址栏中的域不匹配，这种Cookie通常被用在第三方广告网站。为了跟踪用户的浏览记录，并且根据收集的用户的浏览习惯，给用户推送相关的广告。</p>
<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/NetWork/Session%E5%92%8CCookie02.png" alt=""></p>
<p>如上图（a）：用户访问服务器1的一个页面<code>index.html</code>，这个页面和第三方广告网站合作，这个页面还有一张<code>www.advertisement.com</code>域名下的一张广告图<code>ad1.jpg</code>，当请求这张<code>ad1.jpg</code>图片的时候，<code>www.advertisement.com</code>这个服务器会给用户设置<code>cookie</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: user&#x3D;&quot;wang&quot;;like&#x3D;&quot;a&quot;; domain&#x3D;&quot;advertisement.com&quot;</span><br></pre></td></tr></table></figure>

<p>记录用户的浏览记录，分配一个<code>user</code>来表示用户的身份。</p>
<p>图（b）：用户访问服务器2的一个<code>index.html</code>页面，这个页面也和同一家广告商合作，这个页面也包含一张<code>www.advertisement.com</code>域名下的一张广告图<code>ad2.jpg</code>，当请求这张<code>ad2.jpg</code>图片的时候，浏览器就会向<code>www.advertisement.com</code>发送<code>cookie</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: user&#x3D;&quot;wang&quot;; like&#x3D;&quot;a&quot;;</span><br></pre></td></tr></table></figure>

<p><code>www.advertisement.com</code>收到浏览器发送的cookie识别了用户的身份，同时又用这个页面用户的浏览数据设置<code>cookie</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: buy&#x3D;&quot;b&quot;; domain&#x3D;&quot;advertisement.com&quot;</span><br></pre></td></tr></table></figure>

<p>图（c）：很巧，用户访问服务器3的一个<code>index.html</code>页面，这个页面也和那一家广告商合作，这个页面也包含一张<code>www.advertisement.com</code>域名下的一张广告图<code>ad3.jpg</code>，当请求这张<code>ad3.jpg</code>图片的时候，浏览器就会向<code>www.advertisement.com</code>发送<code>cookie</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: user&#x3D;&quot;wang&quot;; like&#x3D;&quot;a&quot;; buy&#x3D;&quot;b&quot;</span><br></pre></td></tr></table></figure>

<p>这样广告公司就可以根据用户的浏览习惯，给用户推送合适的广告。</p>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><h3 id="什么是Session"><a href="#什么是Session" class="headerlink" title="什么是Session"></a>什么是Session</h3><p><code>Session</code>机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。</p>
<p><strong>Session的机制</strong>：当程序需要为某个客户端的请求创建一个<code>Session</code>的时候，服务器首先检查这个客户端的请求里是否已包含了一个<code>Session</code>标识 - 称为<code>session id</code>，如果已包含一个<code>session id</code>则说明以前已经为此客户端创建过<code>Session</code>，服务器就按照<code>session id</code>把这个<code>Session</code>检索出来使用（如果检索不到，可能会新建一个），如果客户端请求不包含<code>session id</code>，则为此客户端创建一个<code>Session</code>并且生成一个与此<code>Session</code>相关联的<code>session id</code>，<code>session id</code>的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个<code>session id</code>将被在本次响应中返回给客户端保存。</p>
<p>如果说<code>Cookie</code>机制是通过检查客户身上的“通行证”来确定客户身份的话，那么<code>Session</code>机制就是通过检查服务器上的“客户明细表”来确认客户身份。<code>Session</code>相当于程序在服务器上建立的一份客户档案，客户来访的时候只需要查询客户档案表就可以了。</p>
<p>如果<code>Cookie</code>被禁用，可以使用URL重写或者隐藏表单来将<code>session id</code>回传给服务器。</p>
<h4 id="Session的生命周期"><a href="#Session的生命周期" class="headerlink" title="Session的生命周期"></a>Session的生命周期</h4><p>在谈论<code>Session</code>机制的时候，常常听到这样一种误解“只要关闭浏览器，<code>Session</code>就消失了”。其实可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对<code>Session</code>来说也是一样的，除非程序通知服务器删除一个<code>Session</code>，否则服务器会一直保留，程序一般都是在用户做登出的时候发个指令去删除<code>Session</code>。然而浏览器从来不会主动在关闭之前通知服务器它将要关闭，因此服务器根本不会有机会知道浏览器已经关闭，之所以会有这种错觉，是大部分<code>Session</code>机制都使用会话<code>Cookie</code>来保存<code>session id</code>，而关闭浏览器后这个<code>session id</code>就消失了，再次连接服务器时也就无法找到原来的<code>Session</code>。如果服务器设置的<code>Cookie</code>被保存到硬盘上，或者使用某种手段改写浏览器发出的<code>HTTP</code>请求头，把原来的<code>session id</code>发送给服务器，则再次打开浏览器仍然能够找到原来的<code>Session</code>。</p>
<p>恰恰是由于关闭浏览器不会导致<code>Session</code>被删除，迫使服务器为<code>Seesion</code>设置了一个失效时间，当距离客户端上一次使用<code>Session</code>的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把<code>Session</code>删除以节省存储空间。</p>
<p>Session保存在服务器端。<strong>为了获得更高的存取速度，服务器一般把Session放在内存里。每个用户都会有一个独立的Session。如果Session内容过于复杂，当大量客户访问服务器时可能会导致内存溢出。因此，Session里的信息应该尽量精简。</strong></p>
<p><strong>Session生成后，只要用户继续访问，服务器就会更新Session的最后访问时间，并维护该Session</strong>。用户每访问服务器一次，无论是否读写Session，服务器都认为该用户的Session“活跃（active）”了一次。</p>
<p>由于会有越来越多的用户访问服务器，因此Session也会越来越多。<strong>为防止内存溢出，服务器会把长时间内没有活跃的Session从内存删除。这个时间就是Session的超时时间。如果超过了超时时间没访问过服务器，Session就自动失效了。</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/Network/Http%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ccbeango">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凹凸豆的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/Network/Http%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">HTTP协议简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-05 16:03:10" itemprop="dateCreated datePublished" datetime="2019-03-05T16:03:10+08:00">2019-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 17:56:53" itemprop="dateModified" datetime="2019-12-27T17:56:53+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="HTTP协议简介"><a href="#HTTP协议简介" class="headerlink" title="HTTP协议简介"></a>HTTP协议简介</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>HTTP是一个属于应用层的面向对象的协议，由于其简洁、快速的方式，适用于分布式超媒体信息系统。它的全称是Hyper Text Transfer Protocol（超文本传输协议），是一种建立在TCP上的无状态连接。</p>
<p>HTTP请求的流程是，客户端发送一个<code>HTTP</code>请求，说明客户端想要访问的资源和请求的动作，服务端接收到请求之后，服务端开始处理请求，并根据请求做出相应的动作访问服务器资源，最后通过发送<code>HTTP</code>响应把结果返回给客户端。</p>
<p>其中，一个请求的开始到一个响应的结束称为事务，当一个事务结束后还会在服务端添加一条日志条目。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>HTTP的特点可概括如下：</p>
<ol>
<li>支持客户端/服务器模式</li>
<li>简单快速：客户端向服务器请求数据时，只需传送请求方法和路径。请求方法常用的有<code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>、<code>HEAD</code>。每种方法规定了客户端与服务器联系的类型不同。由于<code>HTTP</code>协议简单，使得<code>HTTP</code>服务器的程序规模小，因而通信速度很快。</li>
<li>灵活：<code>HTTP</code>允许传输任意类型的对象。正在传输的类型由<code>Content-Type</code>加以标记。</li>
<li>无连接：含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并受到客户的应答后，即断开链接。采用这种方式可以节省传输时间。</li>
<li>无状态：<code>HTTP</code>是无状态协议。无状态协议是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次链接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。</li>
</ol>
<h3 id="HTTP之URL篇"><a href="#HTTP之URL篇" class="headerlink" title="HTTP之URL篇"></a>HTTP之URL篇</h3><p>HTTP是一个基于请求与响应模式的、无状态的、应用层的协议，常基于TCP的连接方式，绝大多数的<code>Web</code>开发，都是构建在<code>HTTP</code>协议上的<code>Web</code>应用。</p>
<p><code>HTTP URL</code>的格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://host[":"port][abs_path]</span><br></pre></td></tr></table></figure>

<p><code>http</code>表示要通过<code>HTTP</code>协议来定位网络资源；<code>host</code>表示合法的<code>Inernet</code>主机域名或者<code>IP</code>地址；<code>port</code>指定一个端口号，为空则使用默认端口<code>80</code>；<code>abs_path</code>指定请求资源的<code>URI</code>；如果<code>URL</code>中没有给出<code>abs_path</code>，那么它作为请求<code>URI</code>时，必须以<code>/</code>的形式给出，通常这个工作浏览器自动帮我们完成。如：输入<code>www.test.com</code>，浏览器会自动转换成<code>http://www.test.com/</code></p>
<p>注：<code>URL</code>是一中特殊类型的<code>URI</code>，包含了用于查找某个资源的足够的信息。</p>
<h2 id="HTTP之请求篇"><a href="#HTTP之请求篇" class="headerlink" title="HTTP之请求篇"></a>HTTP之请求篇</h2><p>HTTP请求是客户端往服务端发送请求动作，告知服务器自己的要求。</p>
<p>HTTP请求由三部分组成，分别是：请求行、消息报头、请求正文。</p>
<p>这里先介绍请求行，消息报头及请求正文后述。</p>
<p>请求行包括请求方式Method、资源路径URL、协议版本Version；</p>
<p>请求行以一个方法符号开头，以空格分开，后面跟着请求的URI和协议的版本，格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method Request-URI HTTP-Version CRLF</span><br></pre></td></tr></table></figure>

<p>其中<code>Method</code>表示请求方法；<code>Request-URI</code>是一个统一资源标识符；<code>HTTP-Version</code>表示请求的<code>HTTP</code>协议版本；<code>CRLF</code>表示回撤和换行（除了作为结尾的<code>CRLF</code>外，不允许出现单独的<code>CR</code>或<code>LF</code>字符）。</p>
<p>请求方法有多种：</p>
<ul>
<li><code>GET</code>：请求获取<code>Request-URI</code>所标识的资源</li>
<li><code>POST</code>：在<code>Request-URI</code>所标识的资源后附加新的数据</li>
<li><code>HEAD</code>：请求获取由<code>Request-URI</code>所标识的资源的响应消息报头</li>
<li><code>PUT</code>：请求服务器存出一个资源，并用<code>Request-URI</code>作为其标识</li>
<li><code>DELETE</code>：请求服务器删除<code>Request-URI</code>所标识的资源</li>
<li><code>TRACE</code>：请求服务器回送收到的请求信息，主要用于测试或诊断</li>
<li><code>CONNECT</code>：保留将来使用</li>
<li><code>OPTIONS</code>：请求查询服务器性能，或者查询与资源相关的选项和需求</li>
</ul>
<p>应用举例：</p>
<ol>
<li><p><code>GET</code>方法：在浏览器的地址栏中输入网址的方式访问网页时，浏览器采用GET方法向服务器获取资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /form.html HTTP/<span class="number">1.1</span> (CRLF)</span><br></pre></td></tr></table></figure>

<p><img src="./images/HTTP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A301.jpg" alt=""></p>
</li>
<li><p><code>POST</code>方法：要求被请求服务器接受附在请求后面的数据，常用于提交表单。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /reg.jsp HTTP/ (CRLF)</span><br><span class="line">Accept:image/gif,image/x-xbit,... (CRLF)</span><br><span class="line">...</span><br><span class="line">HOST:www.guet.edu.cn (CRLF)</span><br><span class="line">Content-Length:<span class="number">22</span> (CRLF)</span><br><span class="line">Connection:Keep-Alive (CRLF)</span><br><span class="line">Cache-Control:no-cache (CRLF)</span><br><span class="line">(CRLF)  <span class="comment">// 该CRLF表示消息报头已经结束，在此之前为消息报头</span></span><br><span class="line">user=jeffrey&amp;pwd=<span class="number">1234</span>  <span class="comment">// 此行以下为提交的数据</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ccbeango/blogImages/master/NetWork/HTTP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A302.jpg" alt=""></p>
</li>
<li><p><code>HEAD</code>方法与<code>GET</code>方法几乎是一样的，对于<code>HEAD</code>请求的回应部分来说，它的<code>HTTP</code>头部中包含的信息与通过<code>GET</code>请求所得到的信息是相同的。利用这个方法，不必传输整个资源内容，就可以得到<code>Request-URI</code>所标识的资源的信息。该方法常用于测试超链接的有效性，是否可以访问，以及最近是否更新。</p>
</li>
</ol>
<h3 id="消息报头"><a href="#消息报头" class="headerlink" title="消息报头"></a>消息报头</h3><h2 id="HTTP之响应篇"><a href="#HTTP之响应篇" class="headerlink" title="HTTP之响应篇"></a>HTTP之响应篇</h2><p>在接收和解释请求报文后，服务器返回一个<code>HTTP</code>响应消息。</p>
<p>HTTP响应也是由三个部分组成，分别是：状态行、消息报头、响应正文。</p>
<p>只介绍状态行，消息报头和响应正文后述。</p>
<p>状态行格式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP-Version Status-Code Reason-Phrase CRLF</span><br></pre></td></tr></table></figure>

<p>其中，<code>HTTP-Version</code>表示服务器<code>HTTP</code>协议版本；<code>Status-Code</code>表示服务器发回的响应状态代码；<code>Reason-Phrase</code>表示状态代码的文本描述。</p>
<p>状态代码由三位数字组成，第一个数字定义了响应的<strong>类别</strong>，且有五种可能取值：</p>
<ol>
<li><code>1XX</code>：指示信息，表示请求已接收，继续处理</li>
<li><code>2XX</code>：成功–表示请求已被成功接收、理解、接受</li>
<li><code>3XX</code>：重定向–要完成请求必须进行更进一步的操作</li>
<li><code>4XX</code>：客户端错误—请求有语法错误或请求无法实现</li>
<li><code>5XX</code>：服务器端错误—服务器未能实现合法的请求，服务器在处理请求过程中发生了错误</li>
</ol>
<p>常见的状态代码、状态描述和说明：</p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>状态描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>OK</td>
<td>客户端请求成功</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>203</td>
<td>Non-Authoritative Information</td>
<td>非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本</td>
</tr>
<tr>
<td>301</td>
<td>Moved Permanently</td>
<td>请求永久重定向。 请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替</td>
</tr>
<tr>
<td>302</td>
<td>Found</td>
<td>请求临时重定向。与301类似，但资源只是临时被移动。客户端应继续使用原有URI</td>
</tr>
<tr>
<td>304</td>
<td>Not Modified</td>
<td>请求被重定向到客户端本地缓存</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>明显客户端错误（如：语法错误、太大的大小、无效请求消息或欺骗性路由）</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>客户端请求未经授权</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>服务器已经理解请求，但是拒绝执行它</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>请求资源不存在， 但允许用户的后续请求</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>服务器发生不可预期的错误</td>
</tr>
<tr>
<td>502</td>
<td>Bad Gateway</td>
<td>作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
<td>服务端发生临时错误。 服务器当前不能处理客户端的请求，一段时间后可能恢复正常</td>
</tr>
</tbody></table>
<p>注：状态码详情介绍可查阅<a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">维基百科</a></p>
<h2 id="HTTP之消息报头篇"><a href="#HTTP之消息报头篇" class="headerlink" title="HTTP之消息报头篇"></a>HTTP之消息报头篇</h2><p>HTTP消息由客户端到服务器的请求和服务器到客户端的响应组成。请求消息和响应消息都是由开始行（对于请求消息，开始行就是请求行，对于响应消息，开始行就是状态行），消息报头（可选），空行（只有CRLF的行），消息正文（可选）组成。</p>
<p>HTTP消息报头包括：普通报头、请求报头、响应报头、实体报头。</p>
<p>每一个报头域都是由<strong>名字+“：”+空格+值</strong>组成，消息报头域的名字是大小写无关的。</p>
<h3 id="1-普通报头"><a href="#1-普通报头" class="headerlink" title="1.普通报头"></a>1.普通报头</h3><p>在普通报头中，有少数报头域用于所有的请求和响应消息，但并不用于被传输的实体，只用于传输的消息。</p>
<p>eg:</p>
<p><code>Cache-Control</code>   用于指定缓存指令，缓存指令是单向的（响应中出现的缓存指令在请求中未必会出现），且是独立的（一个消息的缓存指令不会影响另一个消息处理的缓存机制）。 请求时的缓存指令包括：no-cache（用于指示请求或响应消息不能缓存）、no-store、max-age、max-stale、min-fresh、only-if-cached; 响应时的缓存指令包括：public、private、no-cache、no-store、no-transform、must-revalidate、proxy-revalidate、max-age、s-maxage。</p>
<p><code>Date</code>普通报头域表示消息产生的日期和时间。</p>
<p><code>Connection</code>普通报头域允许发送指定连接的选项。例如指定连接是连续，或者指定“close”选项，通知服务器，在响应完成后，关闭连接。</p>
<h3 id="2-请求报头"><a href="#2-请求报头" class="headerlink" title="2.请求报头"></a>2.请求报头</h3><p>请求报头允许客户端想服务器传递请求的附加信息以及客户端自身的信息。</p>
<p>常用的请求报头：</p>
<p><strong>1. Accept</strong></p>
<p><code>Accept</code>请求报头域用于指定客户端接收哪些类型的信息。</p>
<p>eg：<code>Accept-Charset:iso-8859-1,gb2312</code>.如果在请求消息中没有设置这个域，缺省是任何字符集都可以接受。</p>
<p><strong>2. Accept-Encoding</strong></p>
<p><code>Accept-Encoding</code>请求报头域类似于Accept，但是它是用于指定可接受的内容编码。</p>
<p>eg：<code>Accept-Encoding:gzip.deflate</code>。如果请求消息中没有设置这个域服务器假定客户端对各种内容编码都可以接受。</p>
<p><strong>3. Accept-Language</strong></p>
<p><code>Accept-Language</code>请求报头域类似于<code>Accept</code>，但是它是用于指定一种自然语言。</p>
<p>eg：<code>Accept-Language:zh-cn</code>。如果请求消息中没有设置这个报头域，服务器假定客户端对各种语言都可以接受。</p>
<p><strong>4. Authorization</strong></p>
<p><code>Authorization</code>请求报头域主要用于证明客户端有权查看某个资源。当浏览器访问一个页面时，如果收到服务器的响应代码为401（未授权），可以发送一个包含<code>Authorization</code>请求报头域的请求，要求服务器对其进行验证。</p>
<p>*<em>5.Host *</em></p>
<p><code>Host</code>请求报头域主要用于指定被请求资源的Internet主机和端口号，它通常从<code>HTTP URL</code>中提取出来的，在发送请求时，该报头域是必须的。</p>
<p>eg： 我们在浏览器中输入：<code>http://www.test.com/form.html</code> 浏览器发送的请求消息中，就会包含<code>Host</code>请求报头域，如下：<code>Host：www.test.com</code> 此处使用缺省端口号80，若指定了端口号如9527，则变成：<code>Host：www.test.com:9527</code></p>
<p>*<em>6.User-Agent *</em></p>
<p>我们上网登陆论坛的时候，往往会看到一些欢迎信息，其中列出了你的操作系统的名称和版本，你所使用的浏览器的名称和版本，实际上，服务器应用程序就是从<code>User-Agent</code>这个请求报头域中获取到这些信息。<code>User-Agent</code>请求报头域允许客户端将它的操作系统、浏览器和其它属性告诉服务器。不过，这个报头域不是必需的。</p>
<hr>
<p>请求报头的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /form.html HTTP/1.1 (CRLF)</span><br><span class="line">Accept:image/gif,image/x-xbitmap,image/jpeg,application/x-shockwave-flash,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/msword,*/* (CRLF)</span><br><span class="line">Accept-Language: zh-cn (CRLF)</span><br><span class="line">Accept-Encoding: gzip,deflate (CRLF)</span><br><span class="line">If-Modified-Since: Wed,05 Jan 2007 11:21:25 GMT (CRLF)</span><br><span class="line">If-None-Match: W/"80b1a4c018f3c41:8317" (CRLF)</span><br><span class="line">User-Agent: Mozilla/4.0(compatible;MSIE6.0;Windows NT 5.0) (CRLF)</span><br><span class="line">Host: www.test.com (CRLF)</span><br><span class="line">Connection: Keep-Alive (CRLF)</span><br><span class="line">(CRLF)</span><br></pre></td></tr></table></figure>

<h3 id="3-响应报头"><a href="#3-响应报头" class="headerlink" title="3.响应报头"></a>3.响应报头</h3><p>响应报头允许服务器传递不能放在状态行中的附加响应信息，以及关于服务器的信息和对<code>Request-URI</code>所标识的资源进行下一步访问的信息。 </p>
<p>常用的响应报头</p>
<p><strong>1. Location</strong></p>
<p><code>Location</code>响应报头域用于重定向接受者到一个新的位置。<code>Location</code>响应报头域常用在更换域名的时候。</p>
<p><strong>2. Server</strong></p>
<p>Server响应报头域包含了服务器用来处理请求的软件信息。与User-Agent请求报头域是相对应的。</p>
<p>eg: <code>Server: Apache</code></p>
<p><strong>3. WWW-Authenticate</strong></p>
<p><code>WWW-Authenticate</code>响应报头域必须被包含在<code>401</code>（未授权的）响应消息中，客户端收到<code>401</code>响应消息时候，并发送<code>Authorization</code>报头域请求服务器对其进行验证时，服务端响应报头就包含该报头域。</p>
<p>eg：<code>WWW-Authenticate:Basic realm=&quot;Basic Auth Test!&quot;</code> ，可以看出服务器对请求资源采用的是基本验证机制。</p>
<h3 id="4-实体报头"><a href="#4-实体报头" class="headerlink" title="4.实体报头"></a>4.实体报头</h3><p>请求和响应消息都可以传送一个实体。一个实体由实体报头域和实体正文组成，但并不是说实体报头域和实体正文要在一起发送，可以只发送实体报头域。实体报头定义了关于实体正文（eg：有无实体正文）和请求所标识的资源的元信息。</p>
<p>常用的实体报头</p>
<p><strong>1. Content-Type</strong></p>
<p><code>Content-Type</code>实体报头域用语指明发送给接收者的实体正文的媒体类型。</p>
<p>eg： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Type:text/html;charset=ISO-8859-1 </span><br><span class="line">// or</span><br><span class="line">Content-Type:text/html;charset=GB2312</span><br></pre></td></tr></table></figure>

<p><strong>2. Content-Encoding</strong></p>
<p><code>Content-Encoding</code>实体报头域被用作媒体类型的修饰符，它的值指示了已经被应用到实体正文的附加内容的编码，因而要获得<code>Content-Type</code>报头域中所引用的媒体类型，必须采用相应的解码机制。</p>
<p>eg：<code>Content-Encoding：gzip</code>，Content-Encoding这样用于记录文档的压缩方法。</p>
<p><strong>3. Content-Language</strong></p>
<p><code>Content-Language</code>实体报头域描述了资源所用的自然语言。没有设置该域则认为实体内容将提供给所有的语言阅读 者。</p>
<p>eg：<code>Content-Language:zh-cn</code></p>
<p><strong>4. Content-Length</strong></p>
<p><code>Content-Length</code>实体报头域用于指明实体正文的长度，以字节方式存储的十进制数字来表示。</p>
<p><strong>5. Last-Modified</strong></p>
<p><code>Last-Modified</code>实体报头域用于指示资源的最后修改日期和时间。</p>
<p><strong>6. Expires</strong></p>
<p>Expires实体报头域给出响应过期的日期和时间。为了让代理服务器或浏览器在一段时间以后更新缓存中的页面，可以使用<code>Expires</code>实体报头域指定页面过期的时间。</p>
<p>eg：<code>Expires：Thu，15 Sep 2006 16:23:12 GMT</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">~ andy$ curl -v www.baidu.com</span><br><span class="line">* Rebuilt URL to: www.baidu.com/</span><br><span class="line">*   Trying 115.239.210.27...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to www.baidu.com (115.239.210.27) port 80 (#0)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> GET / HTTP/1.1</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Host: www.baidu.com</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> User-Agent: curl/7.54.0</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Accept: */*</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Accept-Ranges: bytes</span><br><span class="line">&lt; Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform</span><br><span class="line">&lt; Connection: Keep-Alive</span><br><span class="line">&lt; Content-Length: 2381</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; Date: Wed, 06 Mar 2019 03:43:52 GMT</span><br><span class="line">&lt; Etag: "588604fc-94d"</span><br><span class="line">&lt; Last-Modified: Mon, 23 Jan 2017 13:28:28 GMT</span><br><span class="line">&lt; Pragma: no-cache</span><br><span class="line">&lt; Server: bfe/1.0.8.18</span><br><span class="line">&lt; Set-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/</span><br><span class="line">&lt; </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<h2 id="HTTP协议版本更替"><a href="#HTTP协议版本更替" class="headerlink" title="HTTP协议版本更替"></a>HTTP协议版本更替</h2><p><strong>HTTP/0.9</strong></p>
<p>HTTP协议的最初版本，功能简陋，仅支持请求方式<code>GET</code>，并且仅能请求访问<code>HTML</code>格式的资源。</p>
<p><strong>HTTP/1.0</strong> </p>
<p>在0.9版本上做了进步，增加了请求方式<code>POST</code>和<code>HEAD</code>；不再局限于0.9版本的HTML格式，根据<code>Content-Type</code>可以支持多种数据格式，即MIME多用途互联网邮件扩展，例如text/html、image/jpeg等；同时也开始支持cache，就是当客户端在规定时间内访问统一网站，直接访问cache即可。</p>
<p>但是1.0版本的工作方式是每次<code>TCP</code>连接只能发送一个请求，当服务器响应后就会关闭这次连接，下一个请求需要再次建立<code>TCP</code>连接，就是不支持<code>keepalive</code>。</p>
<p><strong>HTTP/1.1</strong>    </p>
<p>解决了1.0版本的<code>keepalive</code>问题，1.1版本加入了持久连接，一个<code>TCP</code>连接可以允许多个<code>HTTP</code>请求； 加入了管道机制，一个TCP连接同时允许多个请求同时发送，增加了并发性；新增了请求方式<code>PUT</code>、<code>PATCH</code>、<code>DELETE</code>等。</p>
<p>但是还存在一些问题，服务端是按队列顺序处理请求的，假如一个请求处理时间很长，则会导致后边的请求无法处理，这样就造成了队头阻塞的问题；同时HTTP是无状态的连接，因此每次请求都需要添加重复的字段，降低了带宽的利用率。</p>
<p><strong>HTTP/2.0</strong></p>
<p>为了解决1.1版本利用率不高的问题，提出了HTTP/2.0版本。增加双工模式，即不仅客户端能够同时发送多个请求，服务端也能同时处理多个请求，解决了队头堵塞的问题；HTTP请求和响应中，状态行和请求/响应头都是些信息字段，并没有真正的数据，因此在2.0版本中将所有的信息字段建立一张表，为表中的每个字段建立索引，客户端和服务端共同使用这个表，他们之间就以索引号来表示信息字段，这样就避免了1.0旧版本的重复繁琐的字段，并以压缩的方式传输，提高利用率。</p>
<p>另外也增加服务器推送的功能，即不经请求服务端主动向客户端发送数据。</p>
<p>注：当前主流的协议版本还是HTTP/1.1版本</p>
<h2 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ol>
<li>高级协议有：文件传输协议FTP、电子邮件传输协议SMTP、域名系统服务DNS、网络新闻传输协议NNTP和HTTP协议等。</li>
<li>中介有三种：代理（Proxy）、网关（Gateway）和通道（Tunnel），一个代理根据<code>URI</code>的绝对格式来接收请求，重写全部或部分信息，通过<code>URI</code>的标识把已格式化过的请求发送到服务器。网关是一个接收代理，作为一些其他服务器的上层，并且如果必须的话，可以把请求翻译给下层的服务器协议。一个通道作为不改变消息的两个连接之间的中继点。当通讯需要通过一个中介（如：防火墙）或者是中介不能识别消息的内容时，通道经常被使用。</li>
<li>代理（Proxy）：一个中间程序，它可以充当一个服务器，也可以充当一个客户机，为其它客户机建立请求。请求时通过可能的在内部翻译或经过传递到其他的服务器中。一个代理在发送请求信息之前，必须解释并且如果可能重写它。代理经常作为通过防火墙的客户端门户，代理还可以作为一个帮助应用来通过协议处理没有被用户代理完成的请求。</li>
<li>网关（Gateway）：一个作为其他服务器中间媒介的服务器。与代理不同的是，网关接受请求就好像对被请求的资源来说它就是源服务器；发出请求的客户机并没有意识到它在同网关打交道。网关经常作为通过防火墙的服务器端的门户，网关还可以作为一个协议翻译器以便存取哪些存储在非HTTP系统中的资源。</li>
<li>通道（Tunnel）：是作为两个连接中继的中介程序。一旦激活，通道便认为不属于HTTP通讯，尽管通道可能是被一个HTTP请求初始化的。当被中继的连接两端关闭时，通道便消失。当一个门户(Portal)必须存在或中介(Intermediary)不能解释中继的通讯时通道被经常使用。</li>
<li>网站访问量   <ul>
<li>IP访问量：相同的公网IP计算一次，就是同一个局域网内的所有用户访问一个网站，但是他们都是借助一个公网IP去访问那个网站的（NAT），因此这也只能算作一个IP访问量。换一次公网IP则会加1。</li>
<li>PV 网页访问量：用户访问的页面数就是PV访问量，同一个局域网的不同用户，而且就算是同一个用户，只要刷新一次网站页面，PV访问量就加1，三个访问量的值往往数PV的值最大。</li>
<li>UV 访客访问量：这里的访客不是用户，而是电脑，一台电脑算一个访客，即使是同一台电脑的不同用户，访问同一个网站UV也只能加1，只有更换电脑才会使UV加1，因为服务端会记录客户端电脑的信息。</li>
</ul>
</li>
</ol>
<h3 id="123"><a href="#123" class="headerlink" title="123"></a>123</h3><p><strong>协议分析的优势—HTTP分析器检测网络攻击</strong> </p>
<p>以模块化的方式对高层协议进行分析处理，将是未来入侵检测的方向。 HTTP及其代理的常用端口80、3128和8080在network部分用port标签进行了规定 </p>
<p><strong>HTTP协议Content Lenth限制漏洞导致拒绝服务攻击</strong></p>
<p> 使用POST方法时，可以设置ContentLenth来定义需要传送的数据长度，例如ContentLenth:999999999，在传送完成前，内 存不会释放，攻击者可以利用这个缺陷，连续向WEB服务器发送垃圾数据直至WEB服务器内存耗尽。这种攻击方法基本不会留下痕迹。</p>
<p><strong>利用HTTP协议的特性进行拒绝服务攻击的一些构思</strong></p>
<p> 服务器端忙于处理攻击者伪造的TCP连接请求而无暇理睬客户的正常请求（毕竟客户端的正常请求比率非常之小），此时从正常客户的角度看来，服务器失去响应，这种情况我们称作：服务器端受到了SYNFlood攻击（SYN洪水攻击）。 </p>
<p>而Smurf、TearDrop等是利用ICMP报文来Flood和IP碎片攻击的。本文用“正常连接”的方法来产生拒绝服务攻击。 </p>
<p>19端口在早期已经有人用来做Chargen攻击了，即Chargen_Denial_of_Service，但是！他们用的方法是在两台Chargen 服务器之间产生UDP连接，让服务器处理过多信息而DOWN掉，那么，干掉一台WEB服务器的条件就必须有2个：1.有Chargen服务；2.有HTTP服务 </p>
<p>方法：攻击者伪造源IP给N台Chargen发送连接请求（Connect），Chargen接收到连接后就会返回每秒72字节的字符流（实际上根据网络实际情况，这个速度更快）给服务器。 </p>
<p><strong>Http指纹识别技术</strong></p>
<p>Http指纹识别的原理大致上也是相同的：记录不同服务器对Http协议执行中的微小差别进行识别.Http指纹识别比TCP/IP堆栈指纹识别复杂许 多,理由是定制Http服务器的配置文件、增加插件或组件使得更改Http的响应信息变的很容易,这样使得识别变的困难；然而定制TCP/IP堆栈的行为 需要对核心层进行修改,所以就容易识别。    </p>
<p>要让服务器返回不同的Banner信息的设置是很简单的,象Apache这样的开放源代码的Http服务器,用户可以在源代码里修改Banner信息,然 后重起Http服务就生效了；对于没有公开源代码的Http服务器比如微软的IIS或者是Netscape,可以在存放Banner信息的Dll文件中修 改,相关的文章有讨论的,这里不再赘述,当然这样的修改的效果还是不错的.另外一种模糊Banner信息的方法是使用插件。</p>
<p> 常用测试请求：</p>
<ol>
<li>HEAD/Http/1.0发送基本的Http请求 </li>
<li>DELETE/Http/1.0发送那些不被允许的请求,比如Delete请求</li>
<li>GET/Http/3.0发送一个非法版本的Http协议请求 </li>
<li>GET/JUNK/1.0发送一个不正确规格的Http协议请求 </li>
</ol>
<p>Http指纹识别工具Httprint,它通过运用统计学原理,组合模糊的逻辑学技术,能很有效的确定Http服务器的类型.它可以被用来收集和分析不同Http服务器产生的签名。 </p>
<p> <strong>其他</strong></p>
<p>为了提高用户使用浏览器时的性能，现代浏览器还支持并发的访问方式，浏览一个网页时同时建立多个连接，以迅速获得一个网页上的多个图标，这样能更快速完成整个网页的传输。 HTTP1.1中提供了这种持续连接的方式，而下一代HTTP协议：HTTP-NG更增加了有关会话控制、丰富的内容协商等方式的支持，来提供更高效率的连接。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ccbeango"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Ccbeango</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ccbeango" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ccbeango" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:liuyh940@gmail.com" title="E-Mail → mailto:liuyh940@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ccbeango</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  


</body>
</html>
